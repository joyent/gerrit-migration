{"project":"joyent/node-manta","branch":"master","id":"Idb26e1bc598de7e9b1fc20649f03cf9d2b4bc272","number":"2605","subject":"joyent/node-manta#328 Version and Help should not require Vars to be Set","owner":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"url":"https://cr.joyent.us/2605","commitMessage":"joyent/node-manta#328 Version and Help should not require Vars to be Set\n","createdOn":1505841796,"lastUpdated":1506092198,"open":false,"status":"MERGED","comments":[{"timestamp":1505841796,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Uploaded patch set 1."},{"timestamp":1505841797,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 21a248823a30e88d097259ef13d1656ae7558591\n    \n    joyent/node-manta#328 Version and Help should not require Vars to be Set\n    Change parseOptions function so that --help and --version options work even if a\n    Manta URl is not specified or set in the environment. Also add test cases to the\n    mput test suite to verify the change."},{"timestamp":1505841827,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505846054,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1505849991,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 1:\n\n\u003e (1 comment)\n\nYeah, I like this better. I\u0027ll make that change and push it up. Thanks!"},{"timestamp":1505851434,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Uploaded patch set 2."},{"timestamp":1505851436,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 94e859123b146ea20c338cc19dce329002a9158d\n    \n    Update changes to options.parseOptions based on Trent\u0027s suggestion"},{"timestamp":1505851471,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505851579,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1\n\n(1 comment)"},{"timestamp":1505851626,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 1:\n\nI remembered that I only converted a few commands to use the options module parseOptions function as part of https://github.com/joyent/node-manta/issues/312 so I\u0027ll also update the commands that still have their own parseOptions function in a similar manner as the changes to options.parseOptions and add some testing for those. I\u0027ll also open a node-manta issue to refactor those other commands to use the options module code since for most of them it\u0027ll be an easy win in terms of code reuse."},{"timestamp":1505860585,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Uploaded patch set 3."},{"timestamp":1505860587,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 397021531203142df50b11cfca61c779e8a98b7b\n    \n    Add tests for --help and --version options for all relevant commands."},{"timestamp":1505860612,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505860692,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 3:\n\n(1 comment)\n\nI added testing for the --help and --version options for all the commands with a parseOptions function or that use the common parseOptions in the options module."},{"timestamp":1505949238,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1506012702,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Uploaded patch set 4."},{"timestamp":1506012704,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit e122bbf19de5a9248e077d99c68628cd4a58f9a0\n    \n    Include PATH in environment when execing commands"},{"timestamp":1506012730,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1506012799,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 4:\n\n\u003e (1 comment)\n\nThe tests were working on Linux, but I saw the same failures once I tried on SmartOS. I added the PATH to the environment in patch set 4 and that resolved the issues on SmartOS for me."},{"timestamp":1506029726,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1506092198,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Kelly McLaughlin"}],"currentPatchSet":{"number":"4","revision":"db26e1bc598de7e9b1fc20649f03cf9d2b4bc272","parents":["bac6168d3c96c5e701ddb3033c3878d3c131afc4"],"ref":"refs/changes/05/2605/4","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1506012702,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1506012730,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1506029726,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1506029726,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1506092198,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/mchattr","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mchmod","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"bin/mfind","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/minfo","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mln","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mlogin","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mls","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mmd5","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mrm","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mrmdir","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/msign","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"lib/options.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"test/options.test.js","type":"ADDED","insertions":109,"deletions":0}],"sizeInsertions":182,"sizeDeletions":-12},"patchSets":[{"number":"1","revision":"733c05d49914d9276618677f5e1711d4b70de231","parents":["bac6168d3c96c5e701ddb3033c3878d3c131afc4"],"ref":"refs/changes/05/2605/1","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1505841796,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505841827,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/options.js","line":55,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"alternative proposal: https://gist.github.com/trentm/0edb9bd62b12bea70a6dfb4aa192f52a\n\nThoughts?  For example, your patch here doesn\u0027t handle `mput --completion` if MANTA_URL isn\u0027t set.\n\nI put it after the `args.parseCmdOptions` because the help string for that says that `opts` can be mutated. So, in theory a caller could provide some values on `opts` that would satisfy `checkBinEnv`."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/options.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/mput.test.js","type":"MODIFIED","insertions":42,"deletions":0}],"sizeInsertions":45,"sizeDeletions":-1},{"number":"2","revision":"8899704ac983f248deb84c40d3570b28aac4e94e","parents":["bac6168d3c96c5e701ddb3033c3878d3c131afc4"],"ref":"refs/changes/05/2605/2","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1505851434,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505851471,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505851579,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505851579,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"lib/options.js","line":52,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"indentation issue there?"},{"file":"lib/options.js","line":52,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Fixed in patch set 3"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/options.js","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"test/mput.test.js","type":"MODIFIED","insertions":42,"deletions":0}],"sizeInsertions":49,"sizeDeletions":-2},{"number":"3","revision":"06ffaf5bbbcf6d31ee7102a666f841d14d9a4aec","parents":["bac6168d3c96c5e701ddb3033c3878d3c131afc4"],"ref":"refs/changes/05/2605/3","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1505860585,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505860612,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/options.test.js","line":85,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"These are failing for me with:\n\n./node_modules/.bin/nodeunit test/options.test.js\n\n```\noptions.test.js\nâœ– Run commands with --help with no manta URL specified\n\nVError: exec \"/Users/trentm/joy/node-manta/bin/mchattr --help\": exited with status 127\n    at interpretChildProcessResult (/Users/trentm/joy/node-manta/node_modules/forkexec/lib/forkexec.js:163:15)\n    at onChildExited (/Users/trentm/joy/node-manta/node_modules/forkexec/lib/forkexec.js:75:9)\n    at /Users/trentm/joy/node-manta/node_modules/forkexec/lib/forkexec.js:53:4\n    at ChildProcess.exithandler (child_process.js:209:5)\n    at emitTwo (events.js:87:13)\n    at ChildProcess.emit (events.js:172:7)\n...\n```"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"bin/mchattr","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mchmod","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"bin/mfind","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/minfo","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mln","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mlogin","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mls","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mmd5","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mrm","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mrmdir","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/msign","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"lib/options.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"test/options.test.js","type":"ADDED","insertions":107,"deletions":0}],"sizeInsertions":180,"sizeDeletions":-12},{"number":"4","revision":"db26e1bc598de7e9b1fc20649f03cf9d2b4bc272","parents":["bac6168d3c96c5e701ddb3033c3878d3c131afc4"],"ref":"refs/changes/05/2605/4","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1506012702,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1506012730,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1506029726,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1506029726,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1506092198,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/mchattr","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mchmod","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"bin/mfind","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/minfo","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mln","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mlogin","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mls","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mmd5","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mrm","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/mrmdir","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"bin/msign","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"lib/options.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"test/options.test.js","type":"ADDED","insertions":109,"deletions":0}],"sizeInsertions":182,"sizeDeletions":-12}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}]}