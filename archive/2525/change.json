{"project":"joyent/sdc-vmapi","branch":"master","topic":"tritonnfs","id":"Ia60a380f3329afad073fdbb387000cb8378032a0","number":"2525","subject":"DOCKER-863: Create shared volume when mounting nonexistent volume DOCKER-881: docker start should provision shared volume only if required VOLAPI-26: wf-runner crashes with: Uncaught AssertionError: \"string\" \u003d\u003d \"object\" VOLAPI-9 Implement asynchronous NFS","owner":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"url":"https://cr.joyent.us/2525","commitMessage":"DOCKER-863: Create shared volume when mounting nonexistent volume\nDOCKER-881: docker start should provision shared volume only if required\nVOLAPI-26: wf-runner crashes with: Uncaught AssertionError: \"string\" \u003d\u003d \"object\"\nVOLAPI-9 Implement asynchronous NFS shared volume creation\nVOLAPI-6: Deleting a tritonnfs volume used by an active Docker container should fail\nVOLAPI-27 Divergence in `docker create -v` behavior; volume is not created until `docker start`\nVOLAPI-54 Custom errors\u0027 rest codes should follow engineering guide\u0027s guidelines\nVOLAPI-55 After enabling volapi, a sdcadm update without volapi fails\nDOCKER-1034 support docker volume ls -f dangling\u003dtrue\nVOLAPI-65 rename required_nfs_volumes VM objects\u0027 property to volumes\nTOOLS-1830 replace sdcadm experimental nfs-volumes with cloudapi-nfs-volumes/docker-nfs-volumes subcommands\nZAPI-796 NFS volumes provisioning tasks chain broken by switch from node-uuid to uuid module in sdc-workflow\nDOCKER-1088 sdc-docker should not modify VMs\u0027 internal docker:nfsvolumes metadata\nPUBAPI-1420 Add ability to mount NFS volumes with CreateMachine endpoint\nZAPI-794 remove_volume_references task in destroy workflow should not error\n","createdOn":1504882858,"lastUpdated":1510339206,"open":false,"status":"MERGED","comments":[{"timestamp":1504882858,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 1."},{"timestamp":1504882878,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Topic set to tritonnfs"},{"timestamp":1504882890,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1506199865,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\n(6 comments)"},{"timestamp":1506383988,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 2."},{"timestamp":1506384023,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1506546511,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 3."},{"timestamp":1506546563,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1506623517,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 4."},{"timestamp":1506623541,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 3:\n\n(6 comments)"},{"timestamp":1506623550,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1506623571,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 3:\n\n(3 comments)"},{"timestamp":1506642112,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4:\n\n(14 comments)\n\nMost of my comments are nitty/minor things. I think the changes here look good! I\u0027m especially glad to see us using semantic versioning with Restify APIs! :)"},{"timestamp":1506986216,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1507056380,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 4:\n\n(15 comments)"},{"timestamp":1507057436,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4:\n\n(4 comments)"},{"timestamp":1507059907,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1507062991,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1507064013,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 5."},{"timestamp":1507064042,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507065316,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 5: Code-Review+1\n\n(1 comment)"},{"timestamp":1507067346,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1507070653,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 6."},{"timestamp":1507070697,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507137068,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1507142463,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1507247202,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 7."},{"timestamp":1507247242,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507247254,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 7:\n\nFWIW: latest change is very minor. Just compare patch set #6 with patch set #7 and it\u0027s basically a one line change."},{"timestamp":1507597822,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1507833438,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 8."},{"timestamp":1507833474,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507833521,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1507845897,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1508894083,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 9."},{"timestamp":1508894117,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1508901239,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 10."},{"timestamp":1508901272,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509665798,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 10: Code-Review+1"},{"timestamp":1509748062,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 11."},{"timestamp":1509748090,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509749405,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 11:\n\n(2 comments)"},{"timestamp":1509752191,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 11:\n\n(2 comments)"},{"timestamp":1509752216,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 12."},{"timestamp":1509752244,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509752265,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 12: Code-Review+1"},{"timestamp":1510101848,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 12: Code-Review+1"},{"timestamp":1510126084,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 13."},{"timestamp":1510126113,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 13: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1510176933,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 13: Code-Review+1"},{"timestamp":1510337586,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 14."},{"timestamp":1510337616,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 14: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1510337848,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 14: Code-Review+1"},{"timestamp":1510338913,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 14: Integration-Approval+1"},{"timestamp":1510339039,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 14:\n\nTesting notes: I ran all the CloudAPI and sdc-docker volume related tests with those changes in my COAL and they all passed.\n\nI also ran the full VMAPI tests suite with no VOLAPI service setup in nightly-1 and they all passed."},{"timestamp":1510339206,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Julien Gilli"}],"currentPatchSet":{"number":"14","revision":"a60a380f3329afad073fdbb387000cb8378032a0","parents":["131eada3251fb7e558e9e84cd89a9b6c63e5f4c5"],"ref":"refs/changes/25/2525/14","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1510337586,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1510337616,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1510337848,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1510338913,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"SUBM","value":"1","grantedOn":1510339206,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":21,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":110,"deletions":-2},{"file":"lib/workflows/destroy.js","type":"MODIFIED","insertions":33,"deletions":-4},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"lib/workflows/nfs-volumes/index.js","type":"ADDED","insertions":736,"deletions":0},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":114,"deletions":-23},{"file":"lib/workflows/start.js","type":"MODIFIED","insertions":16,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":3,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":100,"deletions":-7},{"file":"test/lib/uuid.js","type":"ADDED","insertions":13,"deletions":0},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":90,"deletions":-91},{"file":"test/vms.volumes.test.js","type":"ADDED","insertions":322,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1552,"sizeDeletions":-139},"patchSets":[{"number":"1","revision":"27d352f524cda0ce8f21a4ef137fa24002205857","parents":["e5daac418002d851d11f280ac12331c7d6c779c6"],"ref":"refs/changes/25/2525/1","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1504882858,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1504882890,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/common/validation.js","line":529,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Errr ... shouldn\u0027t be \"options.re.test(value)\"? Otherwise this is hardcoded to the VOLUME_NAME_RE constant despite of what you pass to the function."},{"file":"lib/common/validation.js","line":529,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Yes it should, good catch, will fix!\n\nThis whole block is also a leftover from a now irrelevant change, so I\u0027ll drop that entirely."},{"file":"lib/common/validation.js","line":529,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/workflows/destroy.js","line":8,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"2017"},{"file":"lib/workflows/destroy.js","line":8,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/workflows/destroy.js","line":217,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"typo"},{"file":"lib/workflows/destroy.js","line":217,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/workflows/nfs-volumes/index.js","line":103,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"In case we get an error from vmapi.getVm, shouldn\u0027t we return this callback(err) call before we go through all this process? I\u0027m thinking that waiting to this point to call the callback with an hypothetical error could means that we\u0027ll never reach this point b/c on the cases where we have such error, we don\u0027t get a \"vm\" and would be returning ```new Error(\u0027Could not get VM with uuid \u0027 + vmUuid)``` and hiding the cause for the lack of such value."},{"file":"lib/workflows/nfs-volumes/index.js","line":103,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Absolutely, will fix!"},{"file":"lib/workflows/nfs-volumes/index.js","line":103,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/workflows/provision.js","line":25,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"I\u0027d personally go with at least \"7.6.0\" if not \"8.0.0\". Not a tiny change, though"},{"file":"lib/workflows/provision.js","line":25,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Sounds good, I\u0027ll update to 8.0.0 even if it seems it doesn\u0027t really matter today because we use checksums to determine whether the workflow code changed?"},{"file":"lib/workflows/provision.js","line":25,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/workflows/start.js","line":8,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"2017"},{"file":"lib/workflows/start.js","line":8,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":19,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":153,"deletions":-4},{"file":"lib/common/vm-common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/workflows/destroy.js","type":"MODIFIED","insertions":26,"deletions":-3},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"lib/workflows/nfs-volumes/index.js","type":"ADDED","insertions":770,"deletions":0},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":89,"deletions":-31},{"file":"lib/workflows/start.js","type":"MODIFIED","insertions":16,"deletions":-9},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"test/common.js","type":"MODIFIED","insertions":108,"deletions":-7},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":88,"deletions":-90},{"file":"test/vms.volumes.test.js","type":"ADDED","insertions":308,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1595,"sizeDeletions":-148},{"number":"2","revision":"9e1010743afe863ad3fd7d8618427ebd298b746c","parents":["e5daac418002d851d11f280ac12331c7d6c779c6"],"ref":"refs/changes/25/2525/2","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1506383988,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1506384023,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/workflows/nfs-volumes/index.js","line":41,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"extra _\"_ character."},{"file":"lib/workflows/nfs-volumes/index.js","line":41,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/workflows/nfs-volumes/index.js","line":57,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Is VError accessible from inside workflows? I cant find any previous examples, but if so, it would be nice to use it here."},{"file":"lib/workflows/nfs-volumes/index.js","line":57,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Good point, I believe verror is available from workflow jobs. Will fix."},{"file":"lib/workflows/nfs-volumes/index.js","line":183,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"s/exists/exist/"},{"file":"lib/workflows/nfs-volumes/index.js","line":183,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/workflows/nfs-volumes/index.js","line":204,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Should this maybe be:\n\n\n    \u0027workflow/\u0027 + job.name\n\n(Or is this already a convention?)"},{"file":"lib/workflows/nfs-volumes/index.js","line":204,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"No convention I\u0027m aware of, I like your suggestion, so will change to that."},{"file":"lib/workflows/nfs-volumes/index.js","line":311,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"s/exits/exists/"},{"file":"lib/workflows/nfs-volumes/index.js","line":311,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/workflows/nfs-volumes/index.js","line":316,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"s/exists/exist/"},{"file":"lib/workflows/nfs-volumes/index.js","line":316,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/workflows/nfs-volumes/index.js","line":437,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"If there\u0027s an error here, too, should we log it with job.log.error()?"},{"file":"lib/workflows/nfs-volumes/index.js","line":437,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Yes, will fix!"},{"file":"lib/workflows/nfs-volumes/index.js","line":448,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Sends"},{"file":"lib/workflows/nfs-volumes/index.js","line":448,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"This function itself doesn\u0027t send the request. The request is sent using \"common.zoneAction\". This block comment says below:\n\nThis function only sets the request up. The request is performed later by subsequent tasks in the same workflow. The next task with a body equal to \u0027common.zoneAction\u0027 sends the request, and the task after with a body of \u0027common.waitTask\u0027 waits for it to complete.\n\nIs that too confusing?"},{"file":"lib/workflows/nfs-volumes/index.js","line":448,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Ah, I see. I was confused by the \"Sets a request to CNAPI\" phrasing. How about something like \"Prepares a request to CNAPI\"?"},{"file":"lib/workflows/nfs-volumes/index.js","line":448,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"That sounds better indeed, will change!"},{"file":"lib/workflows/nfs-volumes/index.js","line":656,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"If you move this earlier, you could then check its length above. Maybe something like:\n\n    var createdVolumeUuids \u003d [];\n    if (job.createdVolumes) {\n        createdVolumeUuids \u003d Object.keys(job.createdVolumes);\n    }\n\n    if (createdVolumeUuids.length \u003d\u003d\u003d 0) {\n        callback(null,\n            \u0027No created NFS volume to which a reference needs to be added\u0027);\n        return;\n    }"},{"file":"lib/workflows/nfs-volumes/index.js","line":656,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"It seems equivalent to what\u0027s currently here, or am I missing something?"},{"file":"lib/workflows/nfs-volumes/index.js","line":656,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I was thinking that it would help this function avoid calling Object.keys() twice. It\u0027s not a big deal, but it seemed like it would be better to do it only once."},{"file":"lib/workflows/nfs-volumes/index.js","line":656,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Ah ok, yes that makes sense, will change!"},{"file":"lib/workflows/provision.js","line":330,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Do you want to wrap this in a try/catch, and error out the workflow when nfsVolumesInternalMetadata contains a bad JSON string?"},{"file":"lib/workflows/provision.js","line":330,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Yes, that\u0027s a good point. Will fix."},{"file":"sapi_manifests/vmapi/template","line":65,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Move \"moray\" onto its own line for readability."},{"file":"sapi_manifests/vmapi/template","line":65,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Of course, will fix."},{"file":"test/common.js","line":192,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Move this return onto its own line, and remove the other two, to match the style in waitForValue()?"},{"file":"test/common.js","line":192,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Yep, that\u0027s from code moved from somewhere else, but I\u0027ll take this opportunity to fix it."},{"file":"test/vms.volumes.test.js","line":28,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Maybe use .slice()/.substr() instead?"},{"file":"test/vms.volumes.test.js","line":28,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Using split(\u0027-\u0027)[0] is more intuitive to me, but I understand it\u0027s subjective. I\u0027d be happy to change it to your suggestion though if you can help me understand the benefits better."},{"file":"test/vms.volumes.test.js","line":28,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I was mostly thinking that it should match how this is done below, like:\n\nhttps://cr.joyent.us/#/c/2525/2/test/vms.volumes.test.js@176\n\nI\u0027d be fine with those being updated to match this, or all of them being updated to use a generateShortId() or similar helper function that makes it using either method."},{"file":"test/vms.volumes.test.js","line":28,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"That makes sense, I\u0027ll create a test/lib/uuid.js module that exports a generateShortId function and make those call sites use it."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":20,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":153,"deletions":-4},{"file":"lib/common/vm-common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/workflows/destroy.js","type":"MODIFIED","insertions":26,"deletions":-3},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"lib/workflows/nfs-volumes/index.js","type":"ADDED","insertions":771,"deletions":0},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":115,"deletions":-31},{"file":"lib/workflows/start.js","type":"MODIFIED","insertions":16,"deletions":-9},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"test/common.js","type":"MODIFIED","insertions":108,"deletions":-7},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":88,"deletions":-90},{"file":"test/vms.volumes.test.js","type":"ADDED","insertions":308,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1622,"sizeDeletions":-148},{"number":"3","revision":"fc00013b1d56246490c81597fc0d48df43115e50","parents":["e5daac418002d851d11f280ac12331c7d6c779c6"],"ref":"refs/changes/25/2525/3","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1506546511,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1506546563,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":21,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":153,"deletions":-4},{"file":"lib/common/vm-common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/workflows/destroy.js","type":"MODIFIED","insertions":33,"deletions":-4},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"lib/workflows/nfs-volumes/index.js","type":"ADDED","insertions":815,"deletions":0},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":115,"deletions":-31},{"file":"lib/workflows/start.js","type":"MODIFIED","insertions":16,"deletions":-9},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"test/common.js","type":"MODIFIED","insertions":108,"deletions":-7},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":88,"deletions":-90},{"file":"test/vms.volumes.test.js","type":"ADDED","insertions":308,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1673,"sizeDeletions":-149},{"number":"4","revision":"d65925542b812527b8db404242c6cfa359e06c22","parents":["e5daac418002d851d11f280ac12331c7d6c779c6"],"ref":"refs/changes/25/2525/4","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1506623517,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1506623550,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507059907,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}}],"comments":[{"file":"lib/common/validation.js","line":877,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Can we use the RegExp object defined on line 51 here?"},{"file":"lib/common/validation.js","line":877,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Good catch! Will fix."},{"file":"lib/workflows/destroy.js","line":231,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Reading this makes me wonder: IIRC, VMs sometimes have their status changed to \u0027deleted\u0027 briefly by vm-agent when ops migrates VMs between CNs, but they then get updated to \u0027running\u0027 again once the migration finishes, since the vm-agent on the destination CN picks it up. Will that affect VOLAPI in some way? Should it wait some amount of time (10 minutes? an hour?) before assuming it\u0027s fully gone?"},{"file":"lib/workflows/destroy.js","line":231,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Great question!\n\nWe don\u0027t want to wait 10 minutes or an hour to consider a VM fully gone because we want to allow users to delete their volumes as soon as the latest VM that was mounting it is gone.\n\nThe VM migration use case is not covered currently. What would happen is that there would be a window of time when a VM being migrated would not reference the volumes it mounts, and in that window users could delete the volumes that this VM mounts.\n\nIf the volumes that VM mounts were deleted, then when the VM comes back, it would not be able to mount them.\n\nIf the volumes that VM mounts were not deleted, then when the VM comes back, a new reference from that VM to those volumes would be added and users would not be able to delete the volumes it mounts.\n\nSo I think this can be considered an edge case for the \"master integration\" milestone, but I\u0027ll create a ticket to track this.\n\nThoughts?"},{"file":"lib/workflows/destroy.js","line":231,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Ah, I misunderstood how the references worked. I\u0027d thought that when the reference count dropped to 0, it was removed, but it sounds like it just allows the owner to then delete it through VOLAPI? In that case, this seems like an edge case that we don\u0027t need to worry about until we actually implement and support user-driven migrations in the product."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":21,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":118,"deletions":-3},{"file":"lib/common/vm-common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/workflows/destroy.js","type":"MODIFIED","insertions":33,"deletions":-4},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"lib/workflows/nfs-volumes/index.js","type":"ADDED","insertions":821,"deletions":0},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":115,"deletions":-31},{"file":"lib/workflows/start.js","type":"MODIFIED","insertions":16,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"test/common.js","type":"MODIFIED","insertions":108,"deletions":-7},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":88,"deletions":-90},{"file":"test/vms.volumes.test.js","type":"ADDED","insertions":308,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1644,"sizeDeletions":-149},{"number":"5","revision":"1562f2b190cf23e8bb179e8c30bbd99ecbf10e22","parents":["e5daac418002d851d11f280ac12331c7d6c779c6"],"ref":"refs/changes/25/2525/5","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1507064013,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507065316,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507064042,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/workflows/nfs-volumes/index.js","line":809,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Do you need to add VError to the modules here, too?"},{"file":"lib/workflows/nfs-volumes/index.js","line":809,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Good catch! Will fix."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":21,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":117,"deletions":-3},{"file":"lib/common/vm-common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/workflows/destroy.js","type":"MODIFIED","insertions":33,"deletions":-4},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"lib/workflows/nfs-volumes/index.js","type":"ADDED","insertions":835,"deletions":0},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":122,"deletions":-31},{"file":"lib/workflows/start.js","type":"MODIFIED","insertions":16,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":8,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":109,"deletions":-7},{"file":"test/lib/uuid.js","type":"ADDED","insertions":13,"deletions":0},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":90,"deletions":-91},{"file":"test/vms.volumes.test.js","type":"ADDED","insertions":309,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1681,"sizeDeletions":-149},{"number":"6","revision":"7a563ad9f59ebfb5575760fddaa13bfb346e9b3e","parents":["e5daac418002d851d11f280ac12331c7d6c779c6"],"ref":"refs/changes/25/2525/6","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1507070653,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507137068,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507070697,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507142463,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":21,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":117,"deletions":-3},{"file":"lib/common/vm-common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/workflows/destroy.js","type":"MODIFIED","insertions":33,"deletions":-4},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"lib/workflows/nfs-volumes/index.js","type":"ADDED","insertions":832,"deletions":0},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":114,"deletions":-23},{"file":"lib/workflows/start.js","type":"MODIFIED","insertions":16,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":8,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":109,"deletions":-7},{"file":"test/lib/uuid.js","type":"ADDED","insertions":13,"deletions":0},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":90,"deletions":-91},{"file":"test/vms.volumes.test.js","type":"ADDED","insertions":309,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1670,"sizeDeletions":-141},{"number":"7","revision":"79e52aba68a28204f3cd752e4695a5b5d00e87a5","parents":["e5daac418002d851d11f280ac12331c7d6c779c6"],"ref":"refs/changes/25/2525/7","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1507247202,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507597822,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507247242,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":21,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":117,"deletions":-3},{"file":"lib/common/vm-common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/workflows/destroy.js","type":"MODIFIED","insertions":33,"deletions":-4},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"lib/workflows/nfs-volumes/index.js","type":"ADDED","insertions":832,"deletions":0},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":114,"deletions":-23},{"file":"lib/workflows/start.js","type":"MODIFIED","insertions":16,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":8,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":109,"deletions":-7},{"file":"test/lib/uuid.js","type":"ADDED","insertions":13,"deletions":0},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":90,"deletions":-91},{"file":"test/vms.volumes.test.js","type":"ADDED","insertions":309,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1670,"sizeDeletions":-141},{"number":"8","revision":"ea05e061b1906f884ef77e34a4ee47dc7ae69745","parents":["e4a103b63811c7042f89e8d608cf47d463cdad57"],"ref":"refs/changes/25/2525/8","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1507833438,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507833521,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507833474,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507845897,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":21,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":117,"deletions":-3},{"file":"lib/common/vm-common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/workflows/destroy.js","type":"MODIFIED","insertions":33,"deletions":-4},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"lib/workflows/nfs-volumes/index.js","type":"ADDED","insertions":832,"deletions":0},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":114,"deletions":-23},{"file":"lib/workflows/start.js","type":"MODIFIED","insertions":16,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":8,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":109,"deletions":-7},{"file":"test/lib/uuid.js","type":"ADDED","insertions":13,"deletions":0},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":90,"deletions":-91},{"file":"test/vms.volumes.test.js","type":"ADDED","insertions":309,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1670,"sizeDeletions":-141},{"number":"9","revision":"1b110fb731326b4a62fca2685dbb8be53bcbab72","parents":["537b4b18ca98e88636862313ab903374bfda1546"],"ref":"refs/changes/25/2525/9","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1508894083,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1508894117,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":21,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":116,"deletions":-3},{"file":"lib/common/vm-common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/workflows/destroy.js","type":"MODIFIED","insertions":33,"deletions":-4},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"lib/workflows/nfs-volumes/index.js","type":"ADDED","insertions":832,"deletions":0},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":114,"deletions":-23},{"file":"lib/workflows/start.js","type":"MODIFIED","insertions":16,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":8,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":109,"deletions":-7},{"file":"test/lib/uuid.js","type":"ADDED","insertions":13,"deletions":0},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":90,"deletions":-91},{"file":"test/vms.volumes.test.js","type":"ADDED","insertions":309,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1656,"sizeDeletions":-141},{"number":"10","revision":"244818e957cea8348056f737311303783962b422","parents":["537b4b18ca98e88636862313ab903374bfda1546"],"ref":"refs/changes/25/2525/10","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1508901239,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509665798,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1508901272,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":21,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":116,"deletions":-3},{"file":"lib/common/vm-common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/workflows/destroy.js","type":"MODIFIED","insertions":33,"deletions":-4},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"lib/workflows/nfs-volumes/index.js","type":"ADDED","insertions":734,"deletions":0},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":114,"deletions":-23},{"file":"lib/workflows/start.js","type":"MODIFIED","insertions":16,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":8,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":109,"deletions":-7},{"file":"test/lib/uuid.js","type":"ADDED","insertions":13,"deletions":0},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":90,"deletions":-91},{"file":"test/vms.volumes.test.js","type":"ADDED","insertions":309,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1558,"sizeDeletions":-141},{"number":"11","revision":"a5ab3e0f7db67e28043d945c0757acf91388afdc","parents":["537b4b18ca98e88636862313ab903374bfda1546"],"ref":"refs/changes/25/2525/11","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1509748062,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509748090,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"package.json","line":24,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Is the plan to do a new sdc-clients release at some point before integrating this CR, and then update to that version here?"},{"file":"package.json","line":24,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Yes, I actually just released node-sdc-clients 10.4.0, I\u0027ll update this ref now."},{"file":"test/vms.volumes.test.js","line":28,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I think it might be better to make this work like what we did in NAPI-387, and only skip these tests when something like VMAPITEST_SKIP_VOLUMES\u003dtrue. Then we can set that in Jenkins for nightly2 or wherever we decide to skip them."},{"file":"test/vms.volumes.test.js","line":28,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"As discussed in private, this is not feasible currently since NFS volume support is not going to be enabled by default for at least a while. Once NFS volumes support is enabled by default, we\u0027ll definitely use a similar technique  to what NAPI uses."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":21,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":116,"deletions":-3},{"file":"lib/common/vm-common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/workflows/destroy.js","type":"MODIFIED","insertions":33,"deletions":-4},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"lib/workflows/nfs-volumes/index.js","type":"ADDED","insertions":734,"deletions":0},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":114,"deletions":-23},{"file":"lib/workflows/start.js","type":"MODIFIED","insertions":16,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":3,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":100,"deletions":-7},{"file":"test/lib/uuid.js","type":"ADDED","insertions":13,"deletions":0},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":90,"deletions":-91},{"file":"test/vms.volumes.test.js","type":"ADDED","insertions":322,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1557,"sizeDeletions":-141},{"number":"12","revision":"7bd9991de200d08b10ab03298de4303fe856fd80","parents":["537b4b18ca98e88636862313ab903374bfda1546"],"ref":"refs/changes/25/2525/12","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1509752216,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509752265,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509752244,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1510101848,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":21,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":116,"deletions":-3},{"file":"lib/common/vm-common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/workflows/destroy.js","type":"MODIFIED","insertions":33,"deletions":-4},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"lib/workflows/nfs-volumes/index.js","type":"ADDED","insertions":734,"deletions":0},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":114,"deletions":-23},{"file":"lib/workflows/start.js","type":"MODIFIED","insertions":16,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":3,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":100,"deletions":-7},{"file":"test/lib/uuid.js","type":"ADDED","insertions":13,"deletions":0},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":90,"deletions":-91},{"file":"test/vms.volumes.test.js","type":"ADDED","insertions":322,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1557,"sizeDeletions":-141},{"number":"13","revision":"be5ed1bf1c3b1bd4fbb28392b43e3e9e5cad85b5","parents":["131eada3251fb7e558e9e84cd89a9b6c63e5f4c5"],"ref":"refs/changes/25/2525/13","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1510126084,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1510176933,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1510126113,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":21,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":110,"deletions":-2},{"file":"lib/workflows/destroy.js","type":"MODIFIED","insertions":33,"deletions":-4},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"lib/workflows/nfs-volumes/index.js","type":"ADDED","insertions":734,"deletions":0},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":114,"deletions":-23},{"file":"lib/workflows/start.js","type":"MODIFIED","insertions":16,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":3,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":100,"deletions":-7},{"file":"test/lib/uuid.js","type":"ADDED","insertions":13,"deletions":0},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":90,"deletions":-91},{"file":"test/vms.volumes.test.js","type":"ADDED","insertions":322,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1550,"sizeDeletions":-139},{"number":"14","revision":"a60a380f3329afad073fdbb387000cb8378032a0","parents":["131eada3251fb7e558e9e84cd89a9b6c63e5f4c5"],"ref":"refs/changes/25/2525/14","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1510337586,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1510337848,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1510337616,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1510338913,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"SUBM","value":"1","grantedOn":1510339206,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":21,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":110,"deletions":-2},{"file":"lib/workflows/destroy.js","type":"MODIFIED","insertions":33,"deletions":-4},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"lib/workflows/nfs-volumes/index.js","type":"ADDED","insertions":736,"deletions":0},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":114,"deletions":-23},{"file":"lib/workflows/start.js","type":"MODIFIED","insertions":16,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":3,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":100,"deletions":-7},{"file":"test/lib/uuid.js","type":"ADDED","insertions":13,"deletions":0},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":90,"deletions":-91},{"file":"test/vms.volumes.test.js","type":"ADDED","insertions":322,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1552,"sizeDeletions":-139}],"allReviewers":[{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}]}