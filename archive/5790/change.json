{"project":"joyent/sdc-vmapi","branch":"master","id":"I3b6e1f86b68649f34ffd87bc289235de48310d93","number":"5790","subject":"TRITON-764 Remove DAPI logic from vmapi provision workflow Reviewed by: Cody Peter Mello \u003cmelloc@writev.io\u003e Reviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e Approved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e","owner":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"url":"https://cr.joyent.us/5790","commitMessage":"TRITON-764 Remove DAPI logic from vmapi provision workflow\nReviewed by: Cody Peter Mello \u003cmelloc@writev.io\u003e\nReviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\nApproved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\n","createdOn":1552498759,"lastUpdated":1554307956,"open":false,"status":"MERGED","comments":[{"timestamp":1552498759,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 1."},{"timestamp":1552498795,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1552499065,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 2."},{"timestamp":1552499100,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1552499225,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 3."},{"timestamp":1552499258,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1552607163,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3:\n\n(8 comments)"},{"timestamp":1552659562,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 4."},{"timestamp":1552659589,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 3:\n\n(7 comments)\n\nThanks for taking a look Cody."},{"timestamp":1552659599,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1552659743,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 5."},{"timestamp":1552659779,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1552932093,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 6."},{"timestamp":1552932128,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1552968624,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 6:\n\n(2 comments)"},{"timestamp":1553003782,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 7."},{"timestamp":1553003787,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 6:\n\n(2 comments)"},{"timestamp":1553003817,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1553175334,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 7:\n\n(28 comments)\n\nMost of this is bikeshed, but I\u0027m quite interested in the TRITON-9 question in allocateServer()."},{"timestamp":1553292003,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 8."},{"timestamp":1553292022,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 8:\n\n(28 comments)"},{"timestamp":1553292040,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1553292253,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 8: Code-Review-1\n\nKind of pushed the patchset a bit early.  I still need to test the getTicket changes.  Standby."},{"timestamp":1553294971,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 9."},{"timestamp":1553295006,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1553295070,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 9: -Code-Review\n\nTests passing.\n\n1..2354\n# tests 2354\n# pass  2354\n\n# ok\n\n# test output:\n/var/tmp/vmapitest/vmapi.tap\n\n# test results:\n# Completed in 722 seconds.\n# PASS: 2354 / 2354"},{"timestamp":1553355784,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 10."},{"timestamp":1553355819,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1553547945,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 10:\n\n(6 comments)\n\nThere\u0027s a lot going on here, but LGTM. Only thing is the job version in add-nics."},{"timestamp":1553619252,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 10:\n\n(6 comments)"},{"timestamp":1553619285,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 11."},{"timestamp":1553619319,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1553621219,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 11: Code-Review+1"},{"timestamp":1553639526,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 11:\n\n1..2410\n# tests 2410\n# pass  2410\n\n# ok\n\n# test output:\n/var/tmp/vmapitest/vmapi.tap\n\n# test results:\n# Completed in 1050 seconds.\n# PASS: 2410 / 2410"},{"timestamp":1554127008,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 11: Integration-Approval+1"},{"timestamp":1554131636,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 12."},{"timestamp":1554131676,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1554138062,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 12:\n\n(2 comments)"},{"timestamp":1554138971,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 13."},{"timestamp":1554139006,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 13: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1554140944,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 14."},{"timestamp":1554140983,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 14: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1554158612,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 14: Code-Review+1"},{"timestamp":1554210909,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 14:\n\n(2 comments)\n\nRe-ran changefeed test after these:\n# test results:\n# Completed in 64 seconds.\n# PASS: 56 / 56"},{"timestamp":1554306647,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 15: Patch Set 14 was rebased."},{"timestamp":1554306682,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 15:\n\n\"make check\" passed ok"},{"timestamp":1554306729,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 15: Code-Review+1 Integration-Approval+1"},{"timestamp":1554307930,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 16: Commit message was updated."},{"timestamp":1554307956,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Rui"}],"currentPatchSet":{"number":"16","revision":"3b6e1f86b68649f34ffd87bc289235de48310d93","parents":["84994f40e0a930991a0175f8e7291d04209fe552"],"ref":"refs/changes/90/5790/16","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1554307930,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1554140983,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1554158612,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1554306729,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1554306729,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"SUBM","value":"1","grantedOn":1554307956,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/apis/wfapi.js","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"lib/changefeed.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":726,"deletions":-163},{"file":"lib/workflows/add-nics.js","type":"MODIFIED","insertions":2,"deletions":-32},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":19,"deletions":-417},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":11,"deletions":-157},{"file":"server.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"test/vms.disks.test.js","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":815,"sizeDeletions":-799},"patchSets":[{"number":"1","revision":"c56e7963db16a3cd39a87e51f6a0d31134d74155","parents":["6ae243d0e15f1d42f1d5c3b63a61cea162bec336"],"ref":"refs/changes/90/5790/1","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1552498759,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1552498795,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/wfapi.js","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"lib/changefeed.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":650,"deletions":-109},{"file":"lib/workflows/add-nics.js","type":"MODIFIED","insertions":0,"deletions":-30},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":18,"deletions":-414},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":10,"deletions":-156},{"file":"server.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":2,"deletions":-9},{"file":"test/vms.disks.test.js","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":720,"sizeDeletions":-745},{"number":"2","revision":"531fbe45d43dd0713c063188f99c857f3ec83ea6","parents":["6ae243d0e15f1d42f1d5c3b63a61cea162bec336"],"ref":"refs/changes/90/5790/2","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1552499065,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1552499100,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/wfapi.js","type":"MODIFIED","insertions":11,"deletions":-3},{"file":"lib/changefeed.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":650,"deletions":-109},{"file":"lib/workflows/add-nics.js","type":"MODIFIED","insertions":1,"deletions":-31},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":19,"deletions":-415},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":11,"deletions":-157},{"file":"server.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":3,"deletions":-10},{"file":"test/vms.disks.test.js","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":4,"deletions":-4}],"sizeInsertions":726,"sizeDeletions":-752},{"number":"3","revision":"f43d9a81c94b8b5aea28d051cb1c67eb0b82d27b","parents":["6ae243d0e15f1d42f1d5c3b63a61cea162bec336"],"ref":"refs/changes/90/5790/3","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1552499225,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1552499258,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/endpoints/vms.js","line":309,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Can you add a message to this .debug() call? Something like \"listVms() failed\"."},{"file":"lib/endpoints/vms.js","line":309,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"how about req.log.error()?  Seems more appropriate, no?"},{"file":"lib/endpoints/vms.js","line":1442,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Maybe make this:\n\n    assert.array(networks, \u0027networks\u0027);\n    assert.equal(macs, undefined);"},{"file":"lib/endpoints/vms.js","line":1442,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":1552,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Some more detail would be good:\n\n\u003e It\u0027s better to preprovision NICs up front so that issues like running out of IP addresses or being unable to provide an explicitly requested IP address can be reported back to the customer, instead of silently disappearing in the workflow job\u0027s details."},{"file":"lib/endpoints/vms.js","line":1706,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"next() is called a second time here. It looks like the second call is the one that should be removed."},{"file":"lib/endpoints/vms.js","line":1706,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"An incomplete attempt at consistent return. Fixed."},{"file":"lib/endpoints/vms.js","line":1823,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"This needs to call \"next(err)\" before returning.\n\nAlternatively, if we fail to release the ticket, is it okay to just drive on and it gets released later? I\u0027ve never dealt with the waitlist tickets, so someone else should probably chime in here."},{"file":"lib/endpoints/vms.js","line":1823,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Good catch.\n\nI would also appreciate some guidance here. I think the tickets eventually expire.  If we short-circuit here we should clean up properly, but if we don\u0027t the VM should still be able to complete provisioning.\n\nCurrent code also has a missing callback, but does \"ignore\" the error.\nhttps://github.com/joyent/sdc-vmapi/blob/master/lib/workflows/job-common.js#L1481\n\nI am inclined, without further guidance, to log the warning and drive on."},{"file":"lib/endpoints/vms.js","line":1930,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"We can use req.cnapi here instead of making a new client, right? It looks like VMAPI\u0027s wrapper has a .getServer()."},{"file":"lib/endpoints/vms.js","line":1930,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"test/vms.changefeed.test.js","line":437,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Since CloudAPI will normally provision using \"uuid\", it might be best to leave this test the way it was."},{"file":"test/vms.changefeed.test.js","line":437,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"I think I was testing this on RAN early on and it was getting stuck here.  I changed it back."},{"file":"test/vms.full.test.js","line":828,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Why did you change this test? It looks like it\u0027s meant to pass through here:\n\nhttps://github.com/joyent/sdc-designation/blob/master/lib/algorithms/hard-filter-force-failure.js#L36"},{"file":"test/vms.full.test.js","line":828,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"This tests to see if we properly clean up NICs after a DAPI provision failure.  \n\nWith my changes we do DAPI allocation first, and then provision NICs.  So triggering a DAPI failure would occur before we try to provision NICs, and not properly test preprovision NIC cleanup."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/wfapi.js","type":"MODIFIED","insertions":11,"deletions":-3},{"file":"lib/changefeed.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":650,"deletions":-109},{"file":"lib/workflows/add-nics.js","type":"MODIFIED","insertions":1,"deletions":-31},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":19,"deletions":-415},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":11,"deletions":-157},{"file":"server.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":3,"deletions":-10},{"file":"test/vms.disks.test.js","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":4,"deletions":-4}],"sizeInsertions":726,"sizeDeletions":-752},{"number":"4","revision":"0c045f776067100a3144aec99a269c2fa5d9519f","parents":["6ae243d0e15f1d42f1d5c3b63a61cea162bec336"],"ref":"refs/changes/90/5790/4","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1552659562,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1552659599,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/wfapi.js","type":"MODIFIED","insertions":11,"deletions":-3},{"file":"lib/changefeed.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":648,"deletions":-111},{"file":"lib/workflows/add-nics.js","type":"MODIFIED","insertions":1,"deletions":-31},{"file":"lib/workflows/fabric-common.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":19,"deletions":-415},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":11,"deletions":-157},{"file":"server.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/vms.disks.test.js","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":4,"deletions":-4}],"sizeInsertions":724,"sizeDeletions":-746},{"number":"5","revision":"43640fba862c0914eb196a3e2bba581b1051bc9c","parents":["6ae243d0e15f1d42f1d5c3b63a61cea162bec336"],"ref":"refs/changes/90/5790/5","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1552659743,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1552659779,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/wfapi.js","type":"MODIFIED","insertions":11,"deletions":-3},{"file":"lib/changefeed.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":648,"deletions":-111},{"file":"lib/workflows/add-nics.js","type":"MODIFIED","insertions":1,"deletions":-31},{"file":"lib/workflows/fabric-common.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":19,"deletions":-415},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":11,"deletions":-157},{"file":"server.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/vms.disks.test.js","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":4,"deletions":-4}],"sizeInsertions":722,"sizeDeletions":-744},{"number":"6","revision":"5d9a46a0db9e1c34d77c9168f33f976e14dc06ce","parents":["6ae243d0e15f1d42f1d5c3b63a61cea162bec336"],"ref":"refs/changes/90/5790/6","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1552932093,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1552932128,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/workflows/fabric-common.js","line":83,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"This array is to handle the case where a VM has been provisioned on the same fabric network multiple times. If it has, then we\u0027ll skip pushing the second and onwards NICs on the network into the \"nics\" array."},{"file":"lib/workflows/fabric-common.js","line":83,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"I see.  I saw this in passing, and left a note to check back.  Looks like I forgot to do that."},{"file":"lib/workflows/job-common.js","line":635,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"The method of adding NICs by passing the MAC addresses is primarily used by CloudAPI (although it\u0027s also used by manta-adm for example). CloudAPI does it because it wants to return the NIC information to the user, and it isn\u0027t currently able to do that by specifying network UUIDs without digging around in the job status. Because CloudAPI returns once VMAPI returns the job UUID, if the job fails there\u0027s nothing to clean up the NICs that were created."},{"file":"lib/workflows/job-common.js","line":635,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"That seems like a valid case but I think we are still going to have the side effect I mention.  Although maybe that is not as common (or possible via supported APIs)?"},{"file":"lib/workflows/job-common.js","line":635,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Yes, it\u0027s not currently possible through our user-facing APIs to create a NIC, and then later assign it to a VM."},{"file":"lib/workflows/job-common.js","line":635,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/wfapi.js","type":"MODIFIED","insertions":11,"deletions":-3},{"file":"lib/changefeed.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":683,"deletions":-136},{"file":"lib/workflows/add-nics.js","type":"MODIFIED","insertions":1,"deletions":-31},{"file":"lib/workflows/fabric-common.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":21,"deletions":-415},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":11,"deletions":-157},{"file":"server.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/vms.disks.test.js","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":4,"deletions":-4}],"sizeInsertions":759,"sizeDeletions":-769},{"number":"7","revision":"cdc798803c45029a80033587e3bafa382c71927e","parents":["6ae243d0e15f1d42f1d5c3b63a61cea162bec336"],"ref":"refs/changes/90/5790/7","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1553003782,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1553003817,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/apis/wfapi.js","line":506,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Since this line is changing, might as well name the function."},{"file":"lib/apis/wfapi.js","line":506,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/apis/wfapi.js","line":542,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"RUI?"},{"file":"lib/apis/wfapi.js","line":542,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"This was intended for my own debugging, clearly, but I think it might be a good addition for the DEBUG level logging..."},{"file":"lib/endpoints/vms.js","line":116,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Name func"},{"file":"lib/endpoints/vms.js","line":116,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":117,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Ditto"},{"file":"lib/endpoints/vms.js","line":117,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":135,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Name func"},{"file":"lib/endpoints/vms.js","line":135,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":716,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I think this name is confusing in light of what addNics() does. This function loads nic objects into req.add_nics, while addNics() kicks off a job."},{"file":"lib/endpoints/vms.js","line":716,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"I\u0027m open to suggestions."},{"file":"lib/endpoints/vms.js","line":716,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"loadNicsByMac?"},{"file":"lib/endpoints/vms.js","line":716,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":726,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"lib/endpoints/vms.js","line":726,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":790,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"lib/endpoints/vms.js","line":790,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":1401,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":", \u0027macs\u0027);"},{"file":"lib/endpoints/vms.js","line":1401,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":1637,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Why are we getting something we just created?\n\nAs far as I can tell, we\u0027re solely doing a GET call so we can check the status in waitOnAllocationTicket(), but calling cnapi.waitlistTicketWait() directly achieves what we want anyway? It\u0027s the same number of calls in the best case, and one extra call in the worst for the existing code.\n\nSeems unnecessary, unless I missed something."},{"file":"lib/endpoints/vms.js","line":1637,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":1653,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Used heavily within allocateServer(); assign to its own var at allocateServer()\u0027s outermost scope."},{"file":"lib/endpoints/vms.js","line":1653,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":1676,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"req.params.server_uuid?"},{"file":"lib/endpoints/vms.js","line":1676,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":1711,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Might be worth assigning to its own var."},{"file":"lib/endpoints/vms.js","line":1711,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":1774,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Same question as with the allocationTicket GET."},{"file":"lib/endpoints/vms.js","line":1774,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":1779,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Worth assigning to own var, particularly if that req.vmTicket below is a typo.\n\nAlso, under which circumstances is this expression true?"},{"file":"lib/endpoints/vms.js","line":1779,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Asserted now."},{"file":"lib/endpoints/vms.js","line":1788,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"vmTicket? Or allocationTicket?"},{"file":"lib/endpoints/vms.js","line":1788,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"that\u0027s what happens when one copies code ;) \n\nFixed."},{"file":"lib/endpoints/vms.js","line":1802,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"ticket"},{"file":"lib/endpoints/vms.js","line":1802,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":1806,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Under what circumstances is this true?"},{"file":"lib/endpoints/vms.js","line":1806,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"This has changed, but in the new code:\n\nWhen any func before \"allocateServer()\" in the createVm pipeline fails, or anything prior to \"acquireVMTicket()\" in \"allocateServer()\" fails"},{"file":"lib/endpoints/vms.js","line":1828,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Part of TRITON-9 requires that the VM be updated with server_uuid before any other dapi executions (aka before the release of allocationTicket).\n\nIt looks like only the local copy of vm is updated with server_uuid before release, not the object in moray?"},{"file":"lib/endpoints/vms.js","line":1828,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":1830,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Complicated enough to deserve a name."},{"file":"lib/endpoints/vms.js","line":1830,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":1840,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Maybe just pass \"callback\" directly?"},{"file":"lib/endpoints/vms.js","line":1840,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":1871,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Could potentially do:\n\nnicTags.forEach(function (tag) {\n    serverTags[tag] \u003d true;\n});\n\nThis is a total bikeshed, but I think the intent is clearer."},{"file":"lib/endpoints/vms.js","line":1871,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":1981,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"You might be able to replace this with:\n\nvar satisfied  \u003d req.nicTagReqs.filter(function (req) {\n    return serverTags[req];\n})[0];"},{"file":"lib/endpoints/vms.js","line":1981,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"but then it would require iterating over the entire array, whereas in this case it short circuits upon satisfaction."},{"file":"lib/endpoints/vms.js","line":2047,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Worth naming too."},{"file":"lib/endpoints/vms.js","line":2047,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":2410,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name me :D"},{"file":"lib/endpoints/vms.js","line":2410,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/workflows/job-common.js","line":1058,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"ticket\n\nmo typin, mo problems"},{"file":"lib/workflows/job-common.js","line":1058,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/workflows/job-common.js","line":1063,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Since this is used three times in this func, probably worth assigning to its own var.\n\nEvery time we get an attribute value, that\u0027s a chance for a typo and an undefined to creep in."},{"file":"lib/workflows/job-common.js","line":1063,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/workflows/job-common.js","line":1082,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Likewise."},{"file":"lib/workflows/job-common.js","line":1082,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/wfapi.js","type":"MODIFIED","insertions":11,"deletions":-3},{"file":"lib/changefeed.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":683,"deletions":-136},{"file":"lib/workflows/add-nics.js","type":"MODIFIED","insertions":1,"deletions":-31},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":21,"deletions":-415},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":11,"deletions":-157},{"file":"server.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/vms.disks.test.js","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":4,"deletions":-4}],"sizeInsertions":758,"sizeDeletions":-769},{"number":"8","revision":"f8329fee742f6b16099d06672b0d9346362d63d5","parents":["6ae243d0e15f1d42f1d5c3b63a61cea162bec336"],"ref":"refs/changes/90/5790/8","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1553292003,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1553292040,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1553292253,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/wfapi.js","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"lib/changefeed.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":773,"deletions":-163},{"file":"lib/workflows/add-nics.js","type":"MODIFIED","insertions":1,"deletions":-31},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":27,"deletions":-417},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":11,"deletions":-157},{"file":"server.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":13,"deletions":-1},{"file":"test/vms.disks.test.js","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":4,"deletions":-4}],"sizeInsertions":868,"sizeDeletions":-799},{"number":"9","revision":"f0f1f9d46d080e33cf1499f5226e66a5076e7fee","parents":["6ae243d0e15f1d42f1d5c3b63a61cea162bec336"],"ref":"refs/changes/90/5790/9","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1553294971,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1553295006,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/wfapi.js","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"lib/changefeed.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":753,"deletions":-163},{"file":"lib/workflows/add-nics.js","type":"MODIFIED","insertions":1,"deletions":-31},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":27,"deletions":-417},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":11,"deletions":-157},{"file":"server.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":13,"deletions":-1},{"file":"test/vms.disks.test.js","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":4,"deletions":-4}],"sizeInsertions":848,"sizeDeletions":-799},{"number":"10","revision":"5ffcd2fcd11622c14e8e9afd7a200894de7cb87b","parents":["6ae243d0e15f1d42f1d5c3b63a61cea162bec336"],"ref":"refs/changes/90/5790/10","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1553355784,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1553355819,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/endpoints/vms.js","line":1518,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Could just be:\n\nvar networks \u003d req.filteredNetworks.networks;"},{"file":"lib/endpoints/vms.js","line":1518,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":1587,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Could assign to its own var, since used three times."},{"file":"lib/endpoints/vms.js","line":1587,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":1681,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Superfluous newline?"},{"file":"lib/endpoints/vms.js","line":1681,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/endpoints/vms.js","line":2534,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Oh my. How do we end up with empty strings here?"},{"file":"lib/endpoints/vms.js","line":2534,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"https://github.com/joyent/sdc-vmapi/blob/master/lib/common/validation.js#L1179-L1183"},{"file":"lib/workflows/add-nics.js","line":26,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This should change."},{"file":"lib/workflows/add-nics.js","line":26,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/wfapi.js","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"lib/changefeed.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":722,"deletions":-163},{"file":"lib/workflows/add-nics.js","type":"MODIFIED","insertions":1,"deletions":-31},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":27,"deletions":-417},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":11,"deletions":-157},{"file":"server.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":13,"deletions":-1},{"file":"test/vms.disks.test.js","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":4,"deletions":-4}],"sizeInsertions":817,"sizeDeletions":-799},{"number":"11","revision":"3c1d84fc7ce28367c8199e670f5a8fac0d1d431d","parents":["6ae243d0e15f1d42f1d5c3b63a61cea162bec336"],"ref":"refs/changes/90/5790/11","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1553619285,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1553619319,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553621219,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1554127008,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/wfapi.js","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"lib/changefeed.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":721,"deletions":-163},{"file":"lib/workflows/add-nics.js","type":"MODIFIED","insertions":2,"deletions":-32},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":27,"deletions":-417},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":11,"deletions":-157},{"file":"server.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":13,"deletions":-1},{"file":"test/vms.disks.test.js","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":4,"deletions":-4}],"sizeInsertions":817,"sizeDeletions":-800},{"number":"12","revision":"3509cfee62960fac3196f015e9fb2c2f46718597","parents":["6ae243d0e15f1d42f1d5c3b63a61cea162bec336"],"ref":"refs/changes/90/5790/12","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1554131636,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1554131676,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/vms.changefeed.test.js","line":283,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"You may want to set jobLocation to null inside this test, in case anyone ever adds a new test before here that also sets and uses the variable."},{"file":"test/vms.changefeed.test.js","line":283,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/wfapi.js","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"lib/changefeed.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":723,"deletions":-163},{"file":"lib/workflows/add-nics.js","type":"MODIFIED","insertions":2,"deletions":-32},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":27,"deletions":-417},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":11,"deletions":-157},{"file":"server.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":13,"deletions":-1},{"file":"test/vms.disks.test.js","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":4,"deletions":-4}],"sizeInsertions":819,"sizeDeletions":-800},{"number":"13","revision":"217f6fe725d5095fbd802fcf3c6c6e5d4ed9d914","parents":["6ae243d0e15f1d42f1d5c3b63a61cea162bec336"],"ref":"refs/changes/90/5790/13","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1554138971,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1554139006,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/wfapi.js","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"lib/changefeed.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":723,"deletions":-163},{"file":"lib/workflows/add-nics.js","type":"MODIFIED","insertions":2,"deletions":-32},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":19,"deletions":-417},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":11,"deletions":-157},{"file":"server.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"test/vms.disks.test.js","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":4,"deletions":-4}],"sizeInsertions":813,"sizeDeletions":-800},{"number":"14","revision":"5099754676e1c5d288a6e3e67d3bc043d0084373","parents":["6ae243d0e15f1d42f1d5c3b63a61cea162bec336"],"ref":"refs/changes/90/5790/14","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1554140944,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1554158612,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1554140983,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/wfapi.js","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"lib/changefeed.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":726,"deletions":-163},{"file":"lib/workflows/add-nics.js","type":"MODIFIED","insertions":2,"deletions":-32},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":19,"deletions":-417},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":11,"deletions":-157},{"file":"server.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"test/vms.disks.test.js","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":4,"deletions":-4}],"sizeInsertions":816,"sizeDeletions":-800},{"number":"15","revision":"0e8a4f1cd098e40489a356af9558a327a7394fef","parents":["84994f40e0a930991a0175f8e7291d04209fe552"],"ref":"refs/changes/90/5790/15","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1554306647,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1554158612,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1554140983,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1554306729,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1554306729,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/wfapi.js","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"lib/changefeed.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":726,"deletions":-163},{"file":"lib/workflows/add-nics.js","type":"MODIFIED","insertions":2,"deletions":-32},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":19,"deletions":-417},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":11,"deletions":-157},{"file":"server.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"test/vms.disks.test.js","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":815,"sizeDeletions":-799},{"number":"16","revision":"3b6e1f86b68649f34ffd87bc289235de48310d93","parents":["84994f40e0a930991a0175f8e7291d04209fe552"],"ref":"refs/changes/90/5790/16","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1554307930,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1554158612,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1554140983,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1554306729,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1554306729,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"SUBM","value":"1","grantedOn":1554307956,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/apis/wfapi.js","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"lib/changefeed.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":726,"deletions":-163},{"file":"lib/workflows/add-nics.js","type":"MODIFIED","insertions":2,"deletions":-32},{"file":"lib/workflows/job-common.js","type":"MODIFIED","insertions":19,"deletions":-417},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":11,"deletions":-157},{"file":"server.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"test/vms.disks.test.js","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"test/vms.full.test.js","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":815,"sizeDeletions":-799}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Pedro Palazn Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}]}