From 30bddea3fb4ccc908e05bbe12f29916da22b9b73 Mon Sep 17 00:00:00 2001
From: John Levon <john.levon@joyent.com>
Date: Fri, 12 Jul 2019 16:05:23 +0000
Subject: [PATCH] OS-7685 smartos-live overlay should be merged into
 illumos-joyent OS-7888 clean up altexec CTF

---
 .gitignore                                    |    3 -
 Makefile                                      |   27 +-
 README.md                                     |   39 +-
 configure                                     |   73 +-
 default.configure-build                       |    1 -
 overlay/generic/.smartdc_version              |    1 -
 overlay/generic/boot/forth/menu.rc            |  116 -
 overlay/generic/etc/bash/bash_completion      | 9417 -----------------
 .../generic/etc/bash/bash_completion.d/dladm  |   34 -
 .../etc/bash/bash_completion.d/machines       |   19 -
 .../generic/etc/bash/bash_completion.d/vms    |   62 -
 .../generic/etc/bash/bash_completion.d/zones  |   41 -
 overlay/generic/etc/bash/bashrc.example       |   77 -
 overlay/generic/etc/bash/inputrc.example      |  338 -
 overlay/generic/etc/cron.d/crontabs/root      |   18 -
 overlay/generic/etc/crypto/pkcs11.conf        |   43 -
 overlay/generic/etc/default/be                |    1 -
 overlay/generic/etc/default/init              |   38 -
 overlay/generic/etc/default/login             |   98 -
 overlay/generic/etc/default/passwd            |   71 -
 overlay/generic/etc/dispadmin.conf            |    1 -
 overlay/generic/etc/driver_aliases            | 1438 ---
 overlay/generic/etc/driver_classes            |   30 -
 overlay/generic/etc/dumpadm.conf              |   11 -
 overlay/generic/etc/group                     |   28 -
 overlay/generic/etc/inet/ntp.conf             |   16 -
 overlay/generic/etc/inet/services             |  653 --
 overlay/generic/etc/inittab                   |   40 -
 overlay/generic/etc/ipf/smartos_version       |    1 -
 overlay/generic/etc/issue                     |   14 -
 overlay/generic/etc/logadm.conf               |   59 -
 overlay/generic/etc/minor_perm                |  273 -
 overlay/generic/etc/motd                      |    1 -
 overlay/generic/etc/name_to_major             |  309 -
 overlay/generic/etc/nodename                  |    1 -
 overlay/generic/etc/notices/COPYRIGHT         |   37 -
 overlay/generic/etc/nsswitch.conf             |   54 -
 overlay/generic/etc/opasswd                   |   26 -
 overlay/generic/etc/ouser_attr                |   22 -
 overlay/generic/etc/passwd                    |   26 -
 overlay/generic/etc/path_to_inst              |    3 -
 overlay/generic/etc/ppt_matches               |    1 -
 overlay/generic/etc/profile                   |   66 -
 overlay/generic/etc/resolv.conf               |    0
 overlay/generic/etc/rsyslog.conf              |   25 -
 overlay/generic/etc/rtc_config                |    2 -
 overlay/generic/etc/security/device_policy    |   28 -
 overlay/generic/etc/shadow                    |   26 -
 overlay/generic/etc/skel/.bashrc              |    7 -
 overlay/generic/etc/ssh/sshd_config           |  140 -
 overlay/generic/etc/svc/profile/generic.xml   |  392 -
 overlay/generic/etc/svc/profile/platform.xml  |   36 -
 overlay/generic/etc/syslog.conf               |   60 -
 overlay/generic/etc/system                    |  163 -
 overlay/generic/etc/user_attr                 |   37 -
 overlay/generic/etc/vfstab                    |   10 -
 overlay/generic/etc/zones/Joyent.xml          |   32 -
 overlay/generic/etc/zones/SUNWdefault.xml     |   32 -
 overlay/generic/etc/zshrc                     |   31 -
 overlay/generic/kernel/drv/buildstamp.conf    |    1 -
 overlay/generic/kernel/drv/intel_nhmex.conf   |   35 -
 overlay/generic/kernel/drv/mpt_sas.conf       |    7 -
 overlay/generic/kernel/drv/sd.conf            |   83 -
 overlay/generic/lib/sdc/config.sh             |  266 -
 overlay/generic/lib/sdc/network.sh            |  195 -
 overlay/generic/lib/sdc/usb-key.sh            |  208 -
 overlay/generic/lib/sdc/zone.sh               |  207 -
 .../lib/svc/manifest/network/ipfilter.xml     |  489 -
 .../manifest/network/network-early-admin.xml  |   73 -
 .../svc/manifest/network/network-location.xml |  238 -
 .../svc/manifest/network/network-physical.xml |  112 -
 .../lib/svc/manifest/system/auditd.xml        |  343 -
 .../lib/svc/manifest/system/console-login.xml |  549 -
 .../lib/svc/manifest/system/coreadm.xml       |  134 -
 .../manifest/system/filesystem/joyent-fs.xml  |   85 -
 .../manifest/system/filesystem/minimal-fs.xml |   93 -
 .../generic/lib/svc/manifest/system/mdata.xml |   39 -
 .../svc/manifest/system/smartdc-config.xml    |  145 -
 .../lib/svc/manifest/system/smartdc-init.xml  |  124 -
 .../lib/svc/manifest/system/smartdc-ur.xml    |   62 -
 .../lib/svc/manifest/system/sysidtool.xml     |  161 -
 overlay/generic/lib/svc/method/console-login  |  110 -
 overlay/generic/lib/svc/method/fs-joyent      |  288 -
 overlay/generic/lib/svc/method/fs-root        |   98 -
 overlay/generic/lib/svc/method/fs-usr         |   36 -
 overlay/generic/lib/svc/method/identity-node  |  189 -
 overlay/generic/lib/svc/method/ipfilter       |  307 -
 .../generic/lib/svc/method/manifest-import    |  517 -
 overlay/generic/lib/svc/method/mdata-execute  |   53 -
 overlay/generic/lib/svc/method/mdata-fetch    |  477 -
 .../generic/lib/svc/method/net-early-admin    |  214 -
 overlay/generic/lib/svc/method/net-physical   |  845 --
 overlay/generic/lib/svc/method/smartdc-config |  211 -
 overlay/generic/lib/svc/method/smartdc-init   |  246 -
 overlay/generic/lib/svc/method/smartdc-ur     |   79 -
 overlay/generic/lib/svc/method/sshd           |  132 -
 overlay/generic/lib/svc/method/svc-cron       |   84 -
 .../generic/lib/svc/method/svc-resource-mgmt  |   48 -
 overlay/generic/lib/svc/method/svc-zones      |  312 -
 overlay/generic/lib/svc/method/sysidtool-net  |    2 -
 .../generic/lib/svc/method/sysidtool-system   |    2 -
 overlay/generic/lib/svc/method/system-log     |  186 -
 overlay/generic/mancheck.conf                 |   15 -
 overlay/generic/manifest                      |  194 -
 overlay/generic/root/.bash_profile            |   12 -
 overlay/generic/root/.bashrc                  |   57 -
 overlay/generic/root/.profile                 |   14 -
 overlay/generic/smartdc/bin/sdc-factoryreset  |   78 -
 overlay/generic/smartdc/bin/sdc-lastcomm      |  122 -
 .../generic/smartdc/bin/sdc-zfs-io-throttle.d |   35 -
 .../smartdc/lib/smartos_prompt_config.sh      | 1345 ---
 .../generic/smartdc/man/man1/sdc-lastcomm.1   |  106 -
 .../smartdc/man/man1/sdc-zfs-io-throttle.1    |   20 -
 .../generic/smartdc/vm-upgrade/001_upgrade    |   49 -
 overlay/generic/usr/bin/json                  | 1326 ---
 overlay/generic/usr/include/usb.h             |  332 -
 overlay/generic/usr/lib/brand/README.smf      |  107 -
 overlay/generic/usr/lib/brand/jcommon/cattach |   63 -
 overlay/generic/usr/lib/brand/jcommon/cdetach |   50 -
 .../generic/usr/lib/brand/jcommon/cinstall    |  183 -
 .../generic/usr/lib/brand/jcommon/cuninstall  |   74 -
 .../usr/lib/brand/jcommon/libhooks.ksh        |   96 -
 .../generic/usr/lib/brand/jcommon/poststate   |   34 -
 .../generic/usr/lib/brand/jcommon/prestate    |   34 -
 overlay/generic/usr/lib/brand/jcommon/query   |   52 -
 .../generic/usr/lib/brand/jcommon/statechange |  906 --
 .../usr/lib/brand/joyent-minimal/config.xml   |  115 -
 .../usr/lib/brand/joyent-minimal/jattach      |   26 -
 .../usr/lib/brand/joyent-minimal/jdetach      |   19 -
 .../usr/lib/brand/joyent-minimal/jinstall     |   32 -
 .../usr/lib/brand/joyent-minimal/juninstall   |   25 -
 .../usr/lib/brand/joyent-minimal/manifests    |  127 -
 .../usr/lib/brand/joyent-minimal/platform.xml |  171 -
 .../usr/lib/brand/joyent-minimal/poststate    |   19 -
 .../usr/lib/brand/joyent-minimal/prestate     |   19 -
 .../usr/lib/brand/joyent-minimal/statechange  |   42 -
 .../generic/usr/lib/brand/joyent/config.xml   |  115 -
 overlay/generic/usr/lib/brand/joyent/jattach  |   26 -
 overlay/generic/usr/lib/brand/joyent/jdetach  |   19 -
 overlay/generic/usr/lib/brand/joyent/jinstall |   31 -
 .../generic/usr/lib/brand/joyent/juninstall   |   25 -
 .../generic/usr/lib/brand/joyent/manifests    |  176 -
 .../generic/usr/lib/brand/joyent/platform.xml |  168 -
 .../generic/usr/lib/brand/joyent/poststate    |   19 -
 overlay/generic/usr/lib/brand/joyent/prestate |   19 -
 .../generic/usr/lib/brand/joyent/statechange  |   42 -
 overlay/generic/usr/lib/brand/kvm/config.xml  |   77 -
 overlay/generic/usr/lib/brand/kvm/kattach     |   26 -
 overlay/generic/usr/lib/brand/kvm/kdetach     |   19 -
 overlay/generic/usr/lib/brand/kvm/kinstall    |   31 -
 overlay/generic/usr/lib/brand/kvm/kuninstall  |   23 -
 .../generic/usr/lib/brand/kvm/platform.xml    |  145 -
 overlay/generic/usr/lib/brand/kvm/poststate   |   19 -
 overlay/generic/usr/lib/brand/kvm/prestate    |   19 -
 overlay/generic/usr/lib/brand/kvm/statechange |   36 -
 overlay/generic/usr/lib/brand/lx/config.xml   |  111 -
 .../usr/lib/brand/lx/lx_boot_zone_docker      |   17 -
 overlay/generic/usr/lib/brand/lx/lx_install   |   62 -
 overlay/generic/usr/lib/brand/lx/lx_uninstall |   23 -
 overlay/generic/usr/lib/brand/lx/poststate    |   19 -
 overlay/generic/usr/lib/brand/lx/prestate     |   19 -
 overlay/generic/usr/lib/brand/lx/statechange  |   41 -
 .../usr/lib/localedef/extensions/UTF-8.x      |  114 -
 overlay/generic/usr/sbin/fssstat              |  128 -
 overlay/generic/usr/sbin/zonememstat          |  243 -
 overlay/generic/usr/sbin/zonemon              |  260 -
 overlay/generic/usr/share/bhyve/README        |    6 -
 .../generic/usr/share/bhyve/uefi-csm-rom.bin  |  Bin 1048576 -> 0 bytes
 overlay/generic/usr/share/bhyve/uefi-rom.bin  |  Bin 1048576 -> 0 bytes
 overlay/generic/usr/share/man/man1/json.1     |  917 --
 .../generic/usr/share/man/man1m/fssstat.1m    |   21 -
 overlay/generic/var/log/vmactions.debug       |    0
 overlay/generic/var/log/vmactions.log         |    0
 tools/build_changelog                         |    9 +-
 tools/build_live                              |   23 +-
 tools/builder/Makefile                        |    2 +-
 tools/mancf/Makefile                          |    6 +-
 tools/mancheck/Makefile                       |    6 +-
 tools/tzcheck/Makefile                        |    6 +-
 tools/ucodecheck/Makefile                     |    6 +-
 180 files changed, 82 insertions(+), 31624 deletions(-)
 delete mode 100644 overlay/generic/.smartdc_version
 delete mode 100644 overlay/generic/boot/forth/menu.rc
 delete mode 100755 overlay/generic/etc/bash/bash_completion
 delete mode 100644 overlay/generic/etc/bash/bash_completion.d/dladm
 delete mode 100644 overlay/generic/etc/bash/bash_completion.d/machines
 delete mode 100644 overlay/generic/etc/bash/bash_completion.d/vms
 delete mode 100644 overlay/generic/etc/bash/bash_completion.d/zones
 delete mode 100755 overlay/generic/etc/bash/bashrc.example
 delete mode 100755 overlay/generic/etc/bash/inputrc.example
 delete mode 100644 overlay/generic/etc/cron.d/crontabs/root
 delete mode 100644 overlay/generic/etc/crypto/pkcs11.conf
 delete mode 100644 overlay/generic/etc/default/be
 delete mode 100644 overlay/generic/etc/default/init
 delete mode 100644 overlay/generic/etc/default/login
 delete mode 100644 overlay/generic/etc/default/passwd
 delete mode 100644 overlay/generic/etc/dispadmin.conf
 delete mode 100644 overlay/generic/etc/driver_aliases
 delete mode 100644 overlay/generic/etc/driver_classes
 delete mode 100644 overlay/generic/etc/dumpadm.conf
 delete mode 100644 overlay/generic/etc/group
 delete mode 100644 overlay/generic/etc/inet/ntp.conf
 delete mode 100644 overlay/generic/etc/inet/services
 delete mode 100644 overlay/generic/etc/inittab
 delete mode 100644 overlay/generic/etc/ipf/smartos_version
 delete mode 100644 overlay/generic/etc/issue
 delete mode 100644 overlay/generic/etc/logadm.conf
 delete mode 100644 overlay/generic/etc/minor_perm
 delete mode 100644 overlay/generic/etc/motd
 delete mode 100644 overlay/generic/etc/name_to_major
 delete mode 100644 overlay/generic/etc/nodename
 delete mode 100644 overlay/generic/etc/notices/COPYRIGHT
 delete mode 100644 overlay/generic/etc/nsswitch.conf
 delete mode 100644 overlay/generic/etc/opasswd
 delete mode 100644 overlay/generic/etc/ouser_attr
 delete mode 100644 overlay/generic/etc/passwd
 delete mode 100644 overlay/generic/etc/path_to_inst
 delete mode 100644 overlay/generic/etc/ppt_matches
 delete mode 100644 overlay/generic/etc/profile
 delete mode 100644 overlay/generic/etc/resolv.conf
 delete mode 100644 overlay/generic/etc/rsyslog.conf
 delete mode 100644 overlay/generic/etc/rtc_config
 delete mode 100644 overlay/generic/etc/security/device_policy
 delete mode 100644 overlay/generic/etc/shadow
 delete mode 100644 overlay/generic/etc/skel/.bashrc
 delete mode 100644 overlay/generic/etc/ssh/sshd_config
 delete mode 100644 overlay/generic/etc/svc/profile/generic.xml
 delete mode 100644 overlay/generic/etc/svc/profile/platform.xml
 delete mode 100644 overlay/generic/etc/syslog.conf
 delete mode 100644 overlay/generic/etc/system
 delete mode 100644 overlay/generic/etc/user_attr
 delete mode 100644 overlay/generic/etc/vfstab
 delete mode 100644 overlay/generic/etc/zones/Joyent.xml
 delete mode 100644 overlay/generic/etc/zones/SUNWdefault.xml
 delete mode 100644 overlay/generic/etc/zshrc
 delete mode 100644 overlay/generic/kernel/drv/buildstamp.conf
 delete mode 100644 overlay/generic/kernel/drv/intel_nhmex.conf
 delete mode 100644 overlay/generic/kernel/drv/mpt_sas.conf
 delete mode 100644 overlay/generic/kernel/drv/sd.conf
 delete mode 100644 overlay/generic/lib/sdc/config.sh
 delete mode 100644 overlay/generic/lib/sdc/network.sh
 delete mode 100644 overlay/generic/lib/sdc/usb-key.sh
 delete mode 100644 overlay/generic/lib/sdc/zone.sh
 delete mode 100644 overlay/generic/lib/svc/manifest/network/ipfilter.xml
 delete mode 100644 overlay/generic/lib/svc/manifest/network/network-early-admin.xml
 delete mode 100644 overlay/generic/lib/svc/manifest/network/network-location.xml
 delete mode 100644 overlay/generic/lib/svc/manifest/network/network-physical.xml
 delete mode 100644 overlay/generic/lib/svc/manifest/system/auditd.xml
 delete mode 100644 overlay/generic/lib/svc/manifest/system/console-login.xml
 delete mode 100644 overlay/generic/lib/svc/manifest/system/coreadm.xml
 delete mode 100644 overlay/generic/lib/svc/manifest/system/filesystem/joyent-fs.xml
 delete mode 100644 overlay/generic/lib/svc/manifest/system/filesystem/minimal-fs.xml
 delete mode 100644 overlay/generic/lib/svc/manifest/system/mdata.xml
 delete mode 100644 overlay/generic/lib/svc/manifest/system/smartdc-config.xml
 delete mode 100644 overlay/generic/lib/svc/manifest/system/smartdc-init.xml
 delete mode 100644 overlay/generic/lib/svc/manifest/system/smartdc-ur.xml
 delete mode 100644 overlay/generic/lib/svc/manifest/system/sysidtool.xml
 delete mode 100755 overlay/generic/lib/svc/method/console-login
 delete mode 100755 overlay/generic/lib/svc/method/fs-joyent
 delete mode 100755 overlay/generic/lib/svc/method/fs-root
 delete mode 100755 overlay/generic/lib/svc/method/fs-usr
 delete mode 100755 overlay/generic/lib/svc/method/identity-node
 delete mode 100755 overlay/generic/lib/svc/method/ipfilter
 delete mode 100755 overlay/generic/lib/svc/method/manifest-import
 delete mode 100755 overlay/generic/lib/svc/method/mdata-execute
 delete mode 100755 overlay/generic/lib/svc/method/mdata-fetch
 delete mode 100644 overlay/generic/lib/svc/method/net-early-admin
 delete mode 100644 overlay/generic/lib/svc/method/net-physical
 delete mode 100755 overlay/generic/lib/svc/method/smartdc-config
 delete mode 100755 overlay/generic/lib/svc/method/smartdc-init
 delete mode 100755 overlay/generic/lib/svc/method/smartdc-ur
 delete mode 100755 overlay/generic/lib/svc/method/sshd
 delete mode 100644 overlay/generic/lib/svc/method/svc-cron
 delete mode 100644 overlay/generic/lib/svc/method/svc-resource-mgmt
 delete mode 100644 overlay/generic/lib/svc/method/svc-zones
 delete mode 100755 overlay/generic/lib/svc/method/sysidtool-net
 delete mode 100755 overlay/generic/lib/svc/method/sysidtool-system
 delete mode 100644 overlay/generic/lib/svc/method/system-log
 delete mode 100644 overlay/generic/mancheck.conf
 delete mode 100644 overlay/generic/manifest
 delete mode 100644 overlay/generic/root/.bash_profile
 delete mode 100644 overlay/generic/root/.bashrc
 delete mode 100644 overlay/generic/root/.profile
 delete mode 100755 overlay/generic/smartdc/bin/sdc-factoryreset
 delete mode 100755 overlay/generic/smartdc/bin/sdc-lastcomm
 delete mode 100755 overlay/generic/smartdc/bin/sdc-zfs-io-throttle.d
 delete mode 100755 overlay/generic/smartdc/lib/smartos_prompt_config.sh
 delete mode 100644 overlay/generic/smartdc/man/man1/sdc-lastcomm.1
 delete mode 100644 overlay/generic/smartdc/man/man1/sdc-zfs-io-throttle.1
 delete mode 100755 overlay/generic/smartdc/vm-upgrade/001_upgrade
 delete mode 100755 overlay/generic/usr/bin/json
 delete mode 100644 overlay/generic/usr/include/usb.h
 delete mode 100644 overlay/generic/usr/lib/brand/README.smf
 delete mode 100644 overlay/generic/usr/lib/brand/jcommon/cattach
 delete mode 100644 overlay/generic/usr/lib/brand/jcommon/cdetach
 delete mode 100644 overlay/generic/usr/lib/brand/jcommon/cinstall
 delete mode 100644 overlay/generic/usr/lib/brand/jcommon/cuninstall
 delete mode 100644 overlay/generic/usr/lib/brand/jcommon/libhooks.ksh
 delete mode 100644 overlay/generic/usr/lib/brand/jcommon/poststate
 delete mode 100644 overlay/generic/usr/lib/brand/jcommon/prestate
 delete mode 100755 overlay/generic/usr/lib/brand/jcommon/query
 delete mode 100644 overlay/generic/usr/lib/brand/jcommon/statechange
 delete mode 100644 overlay/generic/usr/lib/brand/joyent-minimal/config.xml
 delete mode 100755 overlay/generic/usr/lib/brand/joyent-minimal/jattach
 delete mode 100755 overlay/generic/usr/lib/brand/joyent-minimal/jdetach
 delete mode 100755 overlay/generic/usr/lib/brand/joyent-minimal/jinstall
 delete mode 100755 overlay/generic/usr/lib/brand/joyent-minimal/juninstall
 delete mode 100644 overlay/generic/usr/lib/brand/joyent-minimal/manifests
 delete mode 100644 overlay/generic/usr/lib/brand/joyent-minimal/platform.xml
 delete mode 100755 overlay/generic/usr/lib/brand/joyent-minimal/poststate
 delete mode 100755 overlay/generic/usr/lib/brand/joyent-minimal/prestate
 delete mode 100755 overlay/generic/usr/lib/brand/joyent-minimal/statechange
 delete mode 100644 overlay/generic/usr/lib/brand/joyent/config.xml
 delete mode 100755 overlay/generic/usr/lib/brand/joyent/jattach
 delete mode 100755 overlay/generic/usr/lib/brand/joyent/jdetach
 delete mode 100755 overlay/generic/usr/lib/brand/joyent/jinstall
 delete mode 100755 overlay/generic/usr/lib/brand/joyent/juninstall
 delete mode 100644 overlay/generic/usr/lib/brand/joyent/manifests
 delete mode 100644 overlay/generic/usr/lib/brand/joyent/platform.xml
 delete mode 100755 overlay/generic/usr/lib/brand/joyent/poststate
 delete mode 100755 overlay/generic/usr/lib/brand/joyent/prestate
 delete mode 100755 overlay/generic/usr/lib/brand/joyent/statechange
 delete mode 100644 overlay/generic/usr/lib/brand/kvm/config.xml
 delete mode 100755 overlay/generic/usr/lib/brand/kvm/kattach
 delete mode 100755 overlay/generic/usr/lib/brand/kvm/kdetach
 delete mode 100755 overlay/generic/usr/lib/brand/kvm/kinstall
 delete mode 100755 overlay/generic/usr/lib/brand/kvm/kuninstall
 delete mode 100644 overlay/generic/usr/lib/brand/kvm/platform.xml
 delete mode 100755 overlay/generic/usr/lib/brand/kvm/poststate
 delete mode 100755 overlay/generic/usr/lib/brand/kvm/prestate
 delete mode 100755 overlay/generic/usr/lib/brand/kvm/statechange
 delete mode 100644 overlay/generic/usr/lib/brand/lx/config.xml
 delete mode 100755 overlay/generic/usr/lib/brand/lx/lx_boot_zone_docker
 delete mode 100755 overlay/generic/usr/lib/brand/lx/lx_install
 delete mode 100755 overlay/generic/usr/lib/brand/lx/lx_uninstall
 delete mode 100755 overlay/generic/usr/lib/brand/lx/poststate
 delete mode 100755 overlay/generic/usr/lib/brand/lx/prestate
 delete mode 100755 overlay/generic/usr/lib/brand/lx/statechange
 delete mode 100644 overlay/generic/usr/lib/localedef/extensions/UTF-8.x
 delete mode 100755 overlay/generic/usr/sbin/fssstat
 delete mode 100755 overlay/generic/usr/sbin/zonememstat
 delete mode 100755 overlay/generic/usr/sbin/zonemon
 delete mode 100644 overlay/generic/usr/share/bhyve/README
 delete mode 100755 overlay/generic/usr/share/bhyve/uefi-csm-rom.bin
 delete mode 100755 overlay/generic/usr/share/bhyve/uefi-rom.bin
 delete mode 100644 overlay/generic/usr/share/man/man1/json.1
 delete mode 100644 overlay/generic/usr/share/man/man1m/fssstat.1m
 delete mode 100644 overlay/generic/var/log/vmactions.debug
 delete mode 100644 overlay/generic/var/log/vmactions.log

diff --git a/.gitignore b/.gitignore
index 7a242004..38320ad8 100644
--- a/.gitignore
+++ b/.gitignore
@@ -90,8 +90,5 @@ manifest.gen
 boot.manifest.d/
 manifest.d/
 mancheck.conf.d/
-overlay/order
-overlay/sdc
-overlay/smartos
 pkgsrc/*.tgz
 .*.swp
diff --git a/Makefile b/Makefile
index 12559ad7..ad9d5c71 100644
--- a/Makefile
+++ b/Makefile
@@ -65,7 +65,6 @@ endif
 ENGBLD_REQUIRE := $(shell git submodule update --init deps/eng)
 
 LOCAL_SUBDIRS :=	$(shell ls projects/local)
-OVERLAYS :=	$(shell cat overlay/order)
 PKGSRC =	$(ROOT)/pkgsrc
 MANIFEST =	manifest.gen
 BOOT_MANIFEST =	boot.manifest.gen
@@ -81,12 +80,10 @@ CTFBINDIR = \
 	$(ROOT)/projects/illumos/usr/src/tools/proto/*/opt/onbld/bin/i386
 CTFMERGE =	$(CTFBINDIR)/ctfmerge
 CTFCONVERT =	$(CTFBINDIR)/ctfconvert
-ALTCTFCONVERT =	$(CTFBINDIR)/ctfconvert
 
 SUBDIR_DEFS = \
 	CTFMERGE=$(CTFMERGE) \
 	CTFCONVERT=$(CTFCONVERT) \
-	ALTCTFCONVERT=$(ALTCTFCONVERT) \
 	MAX_JOBS=$(MAX_JOBS)
 
 ADJUNCT_TARBALL :=	$(shell ls `pwd`/illumos-adjunct*.tgz 2>/dev/null \
@@ -110,12 +107,9 @@ BOOT_MANIFESTS := \
 	$(BOOT_MPROTO)/illumos.manifest
 
 SUBDIR_MANIFESTS :=	$(LOCAL_SUBDIRS:%=$(MPROTO)/%.sd.manifest)
-OVERLAY_MANIFESTS :=	$(OVERLAYS:$(ROOT)/overlay/%=$(MPROTO)/%.ov.manifest)
 
 SUBDIR_MANCHECK_CONFS := \
 	$(LOCAL_SUBDIRS:%=$(MCPROTO)/%.sd.mancheck.conf)
-OVERLAY_MANCHECK_CONFS := \
-	$(OVERLAYS:$(ROOT)/overlay/%=$(MCPROTO)/%.ov.mancheck.conf)
 
 BOOT_VERSION :=	boot-$(shell [[ -f $(ROOT)/configure-buildver ]] && \
     echo $$(head -n1 $(ROOT)/configure-buildver)-)$(shell head -n1 $(STAMPFILE))
@@ -141,12 +135,11 @@ world: 0-strap-stamp 0-illumos-stamp 0-extra-stamp 0-livesrc-stamp \
 	$(TOOLS_TARGETS) sdcman
 
 live: world manifest mancheck_conf boot sdcman $(TOOLS_TARGETS) $(MANCF_FILE)
-	@echo $(OVERLAY_MANIFESTS)
 	@echo $(SUBDIR_MANIFESTS)
 	mkdir -p ${ROOT}/log
-	ALTCTFCONVERT=$(ALTCTFCONVERT) ./tools/build_live \
+	CTFCONVERT=$(CTFCONVERT) ./tools/build_live \
 	    -m $(ROOT)/$(MANIFEST) -o $(ROOT)/output $(PLATFORM_PASSWORD_OPT) \
-	    $(OVERLAYS) $(ROOT)/proto $(ROOT)/man/man
+	    $(ROOT)/proto $(ROOT)/man/man
 
 boot: $(BOOT_TARBALL)
 
@@ -159,7 +152,7 @@ $(BOOT_TARBALL): world manifest
 	mkdir -p $(BOOT_PROTO)/etc/version/
 	mkdir -p $(ROOT)/output
 	pfexec ./tools/builder/builder $(ROOT)/$(BOOT_MANIFEST) \
-	    $(BOOT_PROTO) $(OVERLAYS) $(ROOT)/proto
+	    $(BOOT_PROTO) $(ROOT)/proto
 	cp $(STAMPFILE) $(BOOT_PROTO)/etc/version/boot
 	(cd $(BOOT_PROTO) && pfexec gtar czf $(ROOT)/$@ .)
 
@@ -183,7 +176,8 @@ images-tar: $(IMAGES_TARBALL)
 # in $(MPROTO) before running the manifest tool.  One each comes from
 # illumos, illumos-extra, and the root of live (covering mainly what's in src).
 # Additional manifests come from each of $(LOCAL_SUBDIRS), which may choose
-# to construct them programmatically, and $(OVERLAYS), which must be static.
+# to construct them programmatically.
+#
 # These all end up in $(MPROTO), where we tell tools/build_manifest to look;
 # it will pick up every file in that directory and treat it as a manifest.
 #
@@ -194,8 +188,7 @@ images-tar: $(IMAGES_TARBALL)
 #
 manifest: $(MANIFEST) $(BOOT_MANIFEST)
 
-mancheck_conf: $(WORLD_MANCHECK_CONFS) $(SUBDIR_MANCHECK_CONFS) \
-    $(OVERLAY_MANCHECK_CONFS)
+mancheck_conf: $(WORLD_MANCHECK_CONFS) $(SUBDIR_MANCHECK_CONFS)
 
 dump_mancheck_conf: manifest mancheck_conf $(MANCHECK)
 	args=; for x in $(MCPROTO)/*.mancheck.conf; do \
@@ -251,13 +244,7 @@ $(MCPROTO)/%.sd.mancheck.conf: FRC | $(MCPROTO)
 		    mancheck_conf; \
 	    fi
 
-$(MPROTO)/%.ov.manifest: $(MPROTO) $(ROOT)/overlay/%/manifest
-	cp $(ROOT)/overlay/$*/manifest $@
-
-$(MCPROTO)/%.ov.mancheck.conf: $(ROOT)/overlay/%/mancheck.conf | $(MCPROTO)
-	cp $(ROOT)/overlay/$*/mancheck.conf $@
-
-$(MANIFEST): $(WORLD_MANIFESTS) $(SUBDIR_MANIFESTS) $(OVERLAY_MANIFESTS)
+$(MANIFEST): $(WORLD_MANIFESTS) $(SUBDIR_MANIFESTS)
 	-rm -f $@
 	./tools/build_manifest $(MPROTO) | ./tools/sorter > $@
 
diff --git a/README.md b/README.md
index 605e32f3..bc04a5e9 100644
--- a/README.md
+++ b/README.md
@@ -15,9 +15,8 @@ ls output/
 This repository is smartos-live, which builds a SmartOS platform image
 containing the illumos core OS components; a set of "extra" mostly
 third-party software required by illumos, by other SmartOS software, or
-for system management; a collection of utilities comprising
-SmartOS-specific functionality found in `projects/local/`; and
-implementation-specific overlays that deliver additional files verbatim.
+for system management; and a collection of utilities comprising
+SmartOS-specific functionality found in `projects/local/`.
 
 ## Contents
 
@@ -41,28 +40,6 @@ components that make up SmartOS and has components that are specific to
 the SmartOS live image environment. For example, it has tools like
 `vmadm` and `imgadm`.
 
-#### overlay
-
-In smartos-live, there is a directory called [overlay](/overlay) that
-contains two different things:
-
-1. Files that we use in place of the standard ones provided by another
-part of the system. This is often done for files that come from
-illumos-joyent so as to minimize the differences we have from upstream.
-For example, we have replacements for the `/etc/name_to_major` and
-`/etc/driver_aliases` files.
-
-2. There are some additional files that are found here that don't
-currently have another, better home.
-
-Historically, there were multiple overlays that were switched between
-when building the SmartOS platform for use in Triton or as a standalone
-image. Today, there is only one overlay used, the
-[generic](/overlay/generic) overlay.
-
-When the platform image is built, the generic overlay directory is
-searched for files ahead of the normal proto area used by builder.
-
 ### illumos-joyent
 
 The [illumos-joyent](https://github.com/joyent/illumos-joyent)
@@ -459,7 +436,6 @@ SUNW_SPRO12_URL="https://download.joyent.com/pub/build/SunStudio.tar.bz2"
 ON_CLOSED_BINS_URL="https://download.joyent.com/pub/build/illumos/on-closed-bins.i386.tar.bz2"
 ON_CLOSED_BINS_ND_URL="https://download.joyent.com/pub/build/illumos/on-closed-bins-nd.i386.tar.bz2"
 ILLUMOS_ADJUNCT_TARBALL_URL="https://download.joyent.com/pub/build/adjuncts/"
-OVERLAYS="generic"
 ```
 
 #### Debug Builds
@@ -611,7 +587,6 @@ $ cd projects/illumos-extra/binutils
 $ STRAP= \
   CTFMERGE=/home/rm/src/mdb_v8/projects/illumos/usr/src/tools/proto/*/opt/onbld/bin/i386/ctfmerge \
   CTFCONVERT=/home/rm/src/mdb_v8/projects/illumos/usr/src/tools/proto/*/opt/onbld/bin/i386/ctfconvert \
-  ALTCTFCONVERT=/home/rm/src/mdb_v8/projects/illumos/usr/src/tools/proto/*/opt/onbld/bin/i386/ctfconvert-altexec \
   gmake DESTDIR=/home/rm/src/mdb_v8/proto install
 ```
 
@@ -695,16 +670,6 @@ illumos-joyent and not any other repository. Keeping them separate this
 way allows us to minimize build-time flag days that require updating
 multiple repositories at once.
 
-#### Device Drivers
-
-Device drivers represent a slight exception to the normal rules. While
-they should be added to the standard manifest directory, they also need
-to be added to two files in smartos-live. Specifically, the driver
-should be listed in `overlay/generic/etc/name_to_major` and assigned the
-next free major number. Any aliases for the driver, devices which the
-driver should attach to, should be added to
-`overlay/generic/etc/driver_aliases`.
-
 ## Testing and Things to Think About
 
 A large part of development in the platform should be focused around
diff --git a/configure b/configure
index 208b4510..0dd41630 100755
--- a/configure
+++ b/configure
@@ -283,19 +283,6 @@ function fetch_adjuncts
 	[[ $? -eq 0 ]] || fatal "failed to fetch adjuncts tarball"
 }
 
-function setup_overlays
-{
-	local of="overlay/order"
-	[[ -z "$OVERLAYS" ]] && fatal \
-	    "OVERLAYS variable missing from configure.*"
-	rm -f $of
-	touch $of || fail "failed to create $of"
-	for o in $OVERLAYS; do
-		echo -n "$conf_root/overlay/$o " >> $of || fatal \
-		    "failed to append to $of"
-	done
-}
-
 function fetch_closed
 {
 	local ildir="projects/illumos"
@@ -453,6 +440,63 @@ EOF
 	[[ $? -eq 0 ]] || fatal "failed to write illumos nightly env file"
 }
 
+function update_git
+{
+	local path=$1
+	local branch=$2
+	local cur
+
+	[[ -d "$path" ]] || fatal "can't find directory $path"
+	[[ -z "$branch" ]] && fatal "unspecified branch"
+
+	cd $path >/dev/null 2>&1 || fatal "can't cd into $path"
+	cur=$(git branch | grep "^*" | awk 'BEGIN{ FS=" " } { print $2 }')
+	[[ $? -ne 0 || -z "$cur" ]] && fatal "failed to get current branch"
+	[[ "$cur " == "$branch" ]] && return
+	git checkout $branch >/dev/null || fatal "failed to checkout $branch"
+	cd - >/dev/null 2>&1 || fatal "can't return to previous directory"
+}
+
+function update_branches
+{
+	local line repo branch
+
+	[[ ! -f "configure-branches" ]] && return
+
+	while read line; do
+		line=$(echo $line | sed -e 's/#.*$//')
+		[[ $? -eq 0 ]] || fatal \
+		    "failed to remove comments in configure-branches"
+
+		[[ -z "$line" ]] && continue
+
+		repo=${line%%:*}
+		branch=${line##*:}
+
+		[[ -z "$repo" ]] && fatal \
+		    "missing repository entry in line: [$line]"
+		[[ -z "$branch" ]] && fatal \
+		    "missing branch entry in line: [$branch]"
+
+		# Lots of "configure.smartos" out there with "illumos-live"
+		if [[ "$repo" == "smartos-live" ||
+		    "$repo" == "illumos-live" ]]; then
+			warn "configure-branches can't update smartos-live"
+			warn "ignoring and continuing on..."
+			continue
+		fi
+		if [[ "$repo" == "illumos-joyent" ]]; then
+			update_git "projects/illumos" $branch && continue
+		elif  [[ "$repo" == "illumos-extra" ]]; then
+			update_git "projects/illumos-extra" $branch && continue
+		else
+			[[ -d "projects/local/$repo" ]] && update_git \
+			    "projects/local/$repo" $branch && continue
+		fi
+		fatal "failed to update $repo to $branch"
+	done < "configure-branches"
+}
+
 #
 # This construction lets us place a block of text verbatim into $usage.
 #
@@ -546,9 +590,6 @@ echo "done."
 echo "Fetching adjuncts tgz... \c "
 fetch_adjuncts
 echo "done."
-echo "Configuring overlays... \c "
-setup_overlays
-echo "done."
 echo "Fetching and extracting closed bins ... \c "
 fetch_closed
 echo "done."
diff --git a/default.configure-build b/default.configure-build
index 76cf7acb..930a273c 100644
--- a/default.configure-build
+++ b/default.configure-build
@@ -4,4 +4,3 @@ SUNW_SPRO12_URL="https://download.joyent.com/pub/build/SunStudio.tar.bz2"
 ON_CLOSED_BINS_URL="https://download.joyent.com/pub/build/illumos/on-closed-bins.i386.tar.bz2"
 ON_CLOSED_BINS_ND_URL="https://download.joyent.com/pub/build/illumos/on-closed-bins-nd.i386.tar.bz2"
 ILLUMOS_ADJUNCT_TARBALL_URL="https://download.joyent.com/pub/build/adjuncts/"
-OVERLAYS="generic"
diff --git a/overlay/generic/.smartdc_version b/overlay/generic/.smartdc_version
deleted file mode 100644
index 4fedf1d2..00000000
--- a/overlay/generic/.smartdc_version
+++ /dev/null
@@ -1 +0,0 @@
-7.0
diff --git a/overlay/generic/boot/forth/menu.rc b/overlay/generic/boot/forth/menu.rc
deleted file mode 100644
index 38f3b9b5..00000000
--- a/overlay/generic/boot/forth/menu.rc
+++ /dev/null
@@ -1,116 +0,0 @@
-\ Menu.rc
-\
-\ Load required Forth modules
-include /boot/forth/version.4th
-include /boot/forth/brand.4th
-include /boot/forth/menu.4th
-include /boot/forth/menu-commands.4th
-include /boot/forth/shortcuts.4th
-
-\ Screen prep
-clear         \ clear the screen (see `screen.4th')
-print_version \ print version string (bottom-right; see `version.4th')
-draw-beastie  \ draw freebsd mascot (on right; see `beastie.4th')
-draw-brand    \ draw the FreeBSD title (top-left; see `brand.4th')
-menu-init     \ initialize the menu area (see `menu.4th')
-
-\ Initialize main menu constructs (see `menu.4th')
-\ NOTE: To use `non-ansi' variants, add `loader_color=0' to loader.conf(5)
-\ NOTE: ANSI variants can use `^' in place of literal `Esc' (ASCII 27)
-
-\
-\ MAIN MENU
-\
-
-set menuset_name1="main"
-
-set mainmenu_init[1]="init_boot"
-
-set mainmenu_caption[1]="Boot SmartOS [Enter]"
-set mainansi_caption[1]="^[1mB^[moot SmartOS ^[1m[Enter]^[m"
-set mainmenu_command[1]="boot"
-\ keycode set by init_boot
-
-set mainmenu_caption[2]="[Esc]ape to loader prompt"
-set mainmenu_command[2]="goto_prompt"
-set mainmenu_keycode[2]=27
-set mainansi_caption[2]="^[1mEsc^[mape to loader prompt"
-
-\ Enable built-in "Reboot" trailing menuitem
-\ NOTE: appears before menu_options if configured
-\
-set mainmenu_reboot
-
-\ Enable "Options:" separator. When set to a numerical value (1-8), a visual
-\ separator is inserted before that menuitem number.
-\
-set mainmenu_options=4
-
-set mainmenu_caption[4]="Configure Boot [O]ptions..."
-set mainmenu_command[4]="2 goto_menu"
-set mainmenu_keycode[4]=111
-set mainansi_caption[4]="Configure Boot ^[1mO^[mptions..."
-
-\
-\ BOOT OPTIONS MENU
-\
-
-set menuset_name2="options"
-
-set optionsmenu_caption[1]="Back to Main Menu [Backspace]"
-set optionsmenu_command[1]="1 goto_menu"
-set optionsmenu_keycode[1]=8
-set optionsansi_caption[1]="Back to Main Menu ^[1m[Backspace]^[m"
-
-set optionsmenu_options=2
-set optionsmenu_optionstext="Boot Options:"
-
-set optionsmenu_osconsole=2
-set optionsmenu_command[2]="cycle_osconsole"
-set optionsmenu_keycode[2]=99
-
-set optionsmenu_init[3]="init_verbose"
-set optionsmenu_caption[3]="[V]erbose............. Off"
-set optionstoggled_text[3]="[V]erbose............. On"
-set optionsmenu_command[3]="toggle_verbose"
-set optionsmenu_keycode[3]=118
-set optionsansi_caption[3]="^[1mV^[merbose............... ^[34;1mOff^[m"
-set optionstoggled_ansi[3]="^[1mV^[merbose............... ^[32;7mOn^[m"
-
-set optionsmenu_init[4]="init_kmdb"
-set optionsmenu_caption[4]="k[m]db................ Off"
-set optionstoggled_text[4]="k[m]db................ On"
-set optionsmenu_command[4]="toggle_kmdb"
-set optionsmenu_keycode[4]=109
-set optionsansi_caption[4]="k^[1mm^[mdb.................. ^[34;1mOff^[m"
-set optionstoggled_ansi[4]="k^[1mm^[mdb.................. ^[32;7mOn^[m"
-
-set optionsmenu_init[5]="init_debug"
-set optionsmenu_caption[5]="[D]ebug............... Off"
-set optionstoggled_text[5]="[D]ebug............... On"
-set optionsmenu_command[5]="toggle_debug"
-set optionsmenu_keycode[5]=100
-set optionsansi_caption[5]="^[1mD^[mebug................. ^[34;1mOff^[m"
-set optionstoggled_ansi[5]="^[1mD^[mebug................. ^[32;7mOn^[m"
-
-set optionsmenu_init[6]="init_rescue"
-set optionsmenu_caption[6]="[R]escue Mode......... Off"
-set optionstoggled_text[6]="[R]escue Mode......... On"
-set optionsmenu_command[6]="toggle_rescue"
-set optionsmenu_keycode[6]=114
-set optionsansi_caption[6]="^[1mR^[mescue Mode........... ^[34;1mOff^[m"
-set optionstoggled_ansi[6]="^[1mR^[mescue Mode........... ^[32;7mOn^[m"
-
-\ Enable automatic booting (add ``autoboot_delay=N'' to loader.conf(5) to
-\ customize the timeout; default is 10-seconds)
-\
-set menu_timeout_command="boot"
-
-\ Include optional elements defined in a local file
-\
-try-include /boot/menu.rc.local
-
-\ Display the main menu (see `menu.4th')
-set menuset_initial=1
-menuset-loadinitial
-menu-display
diff --git a/overlay/generic/etc/bash/bash_completion b/overlay/generic/etc/bash/bash_completion
deleted file mode 100755
index 71f3e9e6..00000000
--- a/overlay/generic/etc/bash/bash_completion
+++ /dev/null
@@ -1,9417 +0,0 @@
-#
-# This file contains an example set of shell completions that can be used with
-# bash(1).  These completions allow a user to complete filenames, commands
-# name, command line options, and command line arguments using the [tab] key.
-# The completions defined here are specific to the GNU command set, as a result
-# they will provide the choice of GNU command line options in response to the
-# [tab] key.  For the completed options to match the command implementation,
-# you may have to have /usr/gnu/bin at the head of your PATH.
-#
-# These completions are not included in the default bash(1) environment.  To
-# include them in the default environment, it is recommended that this file be
-# copied to /etc/bash/bash_completion and be sourced from either a system wide
-# bashrc in /etc/bash/bashrc or individual bashrcs in ~/.bashrc via
-#	[ -f /etc/bash/bash_completion ] && . /etc/bash/bash_completion
-#
-
-#   bash_completion - programmable completion functions for bash 3.x
-#		      (backwards compatible with bash 2.05b)
-#
-#   $Id: bash_completion,v 1.872 2006/03/01 16:20:18 ianmacd Exp $
-#
-#   Copyright (C) Ian Macdonald <ian@caliban.org>
-#
-#   This program is free software; you can redistribute it and/or modify
-#   it under the terms of the GNU General Public License as published by
-#   the Free Software Foundation; either version 2, or (at your option)
-#   any later version.
-#
-#   This program is distributed in the hope that it will be useful,
-#   but WITHOUT ANY WARRANTY; without even the implied warranty of
-#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-#   GNU General Public License for more details.
-#
-#   You should have received a copy of the GNU General Public License
-#   along with this program; if not, write to the Free Software Foundation,
-#   Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
-#
-#   The latest version of this software can be obtained here:
-#
-#   http://www.caliban.org/bash/index.shtml#completion
-#
-#   RELEASE: 20060301
-
-if [[ $- == *v* ]]; then
-	BASH_COMPLETION_ORIGINAL_V_VALUE="-v"
-else
-	BASH_COMPLETION_ORIGINAL_V_VALUE="+v"
-fi
-
-if [[ -n $BASH_COMPLETION_DEBUG ]]; then
-	set -v
-else
-	set +v
-fi
-
-# Alter the following to reflect the location of this file.
-#
-[ -n "$BASH_COMPLETION" ] || BASH_COMPLETION=/etc/bash/bash_completion
-[ -n "$BASH_COMPLETION_DIR" ] || BASH_COMPLETION_DIR=/etc/bash/bash_completion.d
-readonly BASH_COMPLETION BASH_COMPLETION_DIR
-
-# Set a couple of useful vars
-#
-UNAME=$( uname -s )
-# strip OS type and version under Cygwin (e.g. CYGWIN_NT-5.1 => Cygwin)
-UNAME=${UNAME/CYGWIN_*/Cygwin}
-RELEASE=$( uname -r )
-
-# features supported by bash 2.05 and higher
-if [ ${BASH_VERSINFO[0]} -eq 2 ] && [[ ${BASH_VERSINFO[1]} > 04 ]] ||
-   [ ${BASH_VERSINFO[0]} -gt 2 ]; then
-	declare -r bash205=$BASH_VERSION 2>/dev/null || :
-	default="-o default"
-	dirnames="-o dirnames"
-	filenames="-o filenames"
-fi
-# features supported by bash 2.05b and higher
-if [ ${BASH_VERSINFO[0]} -eq 2 ] && [[ ${BASH_VERSINFO[1]} = "05b" ]] ||
-   [ ${BASH_VERSINFO[0]} -gt 2 ]; then
-	declare -r bash205b=$BASH_VERSION 2>/dev/null || :
-	nospace="-o nospace"
-fi
-# features supported by bash 3.0 and higher
-if [ ${BASH_VERSINFO[0]} -gt 2 ]; then
-	declare -r bash3=$BASH_VERSION 2>/dev/null || :
-	bashdefault="-o bashdefault"
-	plusdirs="-o plusdirs"
-fi
-
-# Turn on extended globbing and programmable completion
-shopt -s extglob progcomp
-
-# A lot of the following one-liners were taken directly from the
-# completion examples provided with the bash 2.04 source distribution
-
-# Make directory commands see only directories
-complete -d pushd
-
-# The following section lists completions that are redefined later
-# Do NOT break these over multiple lines.
-#
-# START exclude -- do NOT remove this line
-complete -f -X '!*.?(t)bz?(2)' bunzip2 bzcat bzcmp bzdiff bzegrep bzfgrep bzgrep
-complete -f -X '!*.@(zip|ZIP|jar|JAR|exe|EXE|pk3|war|wsz|ear|zargo|xpi|sxw|ott)' unzip zipinfo
-complete -f -X '*.Z' compress znew
-complete -f -X '!*.@(Z|gz|tgz|Gz|dz)' gunzip zcmp zdiff zcat zegrep zfgrep zgrep zless zmore
-complete -f -X '!*.Z' uncompress
-complete -f -X '!*.@(gif|jp?(e)g|miff|tif?(f)|pn[gm]|p[bgp]m|bmp|xpm|ico|xwd|tga|pcx|GIF|JP?(E)G|MIFF|TIF?(F)|PN[GM]|P[BGP]M|BMP|XPM|ICO|XWD|TGA|PCX)' ee display
-complete -f -X '!*.@(gif|jp?(e)g|tif?(f)|png|p[bgp]m|bmp|x[bp]m|rle|rgb|pcx|fits|pm|GIF|JPG|JP?(E)G|TIF?(F)|PNG|P[BGP]M|BMP|X[BP]M|RLE|RGB|PCX|FITS|PM)' xv qiv
-complete -f -X '!*.@(@(?(e)ps|?(E)PS|pdf|PDF)?(.gz|.GZ|.bz2|.BZ2|.Z))' gv ggv kghostview
-complete -f -X '!*.@(dvi|DVI)?(.@(gz|Z|bz2))' xdvi
-complete -f -X '!*.@(dvi|DVI)?(.@(gz|bz2))' kdvi
-complete -f -X '!*.@(dvi|DVI)' dvips dviselect dvitype dvipdf advi dvipdfm dvipdfmx
-complete -f -X '!*.@(pdf|PDF)' acroread gpdf xpdf
-complete -f -X '!*.@(?(e)ps|?(E)PS|pdf|PDF)' kpdf
-complete -f -X '!*.@(@(?(e)ps|?(E)PS|pdf|PDF)?(.gz|.GZ)|cb(r|z)|CB(R|Z)|djv?(u)|DJV?(U)||dvi|DVI|gif|jp?(e)g|miff|tif?(f)|pn[gm]|p[bgp]m|bmp|xpm|ico|xwd|tga|pcx|GIF|JP?(E)G|MIFF|TIF?(F)|PN[GM]|P[BGP]M|BMP|XPM|ICO|XWD|TGA|PCX)' evince
-complete -f -X '!*.@(?(e)ps|?(E)PS)' ps2pdf
-complete -f -X '!*.texi*' makeinfo texi2html
-complete -f -X '!*.@(?(la)tex|?(LA)TEX|texi|TEXI|dtx|DTX|ins|INS)' tex latex slitex jadetex pdfjadetex pdftex pdflatex texi2dvi
-complete -f -X '!*.@(mp3|MP3)' mpg123 mpg321 madplay
-complete -f -X '!*.@(mp?(e)g|MP?(E)G|wma|avi|AVI|asf|vob|VOB|bin|dat|divx|DIVX|vcd|ps|pes|fli|flv|FLV|viv|rm|ram|yuv|mov|MOV|qt|QT|wmv|mp3|MP3|m4v|M4V|ogg|OGG|ogm|OGM|mp4|MP4|wav|WAV|asx|ASX|mng|MNG|srt)' xine aaxine fbxine kaffeine
-complete -f -X '!*.@(avi|asf|wmv)' aviplay
-complete -f -X '!*.@(rm?(j)|ra?(m)|smi?(l))' realplay
-complete -f -X '!*.@(mpg|mpeg|avi|mov|qt)' xanim
-complete -f -X '!*.@(ogg|OGG|m3u|flac|spx)' ogg123
-complete -f -X '!*.@(mp3|MP3|ogg|OGG|pls|m3u)' gqmpeg freeamp
-complete -f -X '!*.fig' xfig
-complete -f -X '!*.@(mid?(i)|MID?(I))' playmidi
-complete -f -X '!*.@(mid?(i)|MID?(I)|rmi|RMI|rcp|RCP|[gr]36|[GR]36|g18|G18|mod|MOD|xm|XM|it|IT|x3m|X3M)' timidity
-complete -f -X '*.@(o|so|so.!(conf)|a|rpm|gif|GIF|jp?(e)g|JP?(E)G|mp3|MP3|mp?(e)g|MPG|avi|AVI|asf|ASF|ogg|OGG|class|CLASS)' vi vim gvim rvim view rview rgvim rgview gview
-complete -f -X '*.@(o|so|so.!(conf)|a|rpm|gif|GIF|jp?(e)g|JP?(E)G|mp3|MP3|mp?(e)g|MPG|avi|AVI|asf|ASF|ogg|OGG|class|CLASS)' emacs
-complete -f -X '!*.@(exe|EXE|com|COM|scr|SCR|exe.so)' wine
-complete -f -X '!*.@(zip|ZIP|z|Z|gz|GZ|tgz|TGZ)' bzme
-complete -f -X '!*.@(?([xX]|[sS])[hH][tT][mM]?([lL]))' netscape mozilla lynx opera galeon curl dillo elinks amaya
-complete -f -X '!*.@(sxw|stw|sxg|sgl|doc|dot|rtf|txt|htm|html|odt|ott|odm)' oowriter
-complete -f -X '!*.@(sxi|sti|pps|ppt|pot|odp|otp)' ooimpress
-complete -f -X '!*.@(sxc|stc|xls|xlw|xlt|csv|ods|ots)' oocalc
-complete -f -X '!*.@(sxd|std|sda|sdd|odg|otg)' oodraw
-complete -f -X '!*.@(sxm|smf|mml|odf)' oomath
-complete -f -X '!*.odb' oobase
-complete -f -X '!*.rpm' rpm2cpio
-# FINISH exclude -- do not remove this line
-
-# start of section containing compspecs that can be handled within bash
-
-# user commands see only users
-complete -u su usermod userdel passwd chage write chfn groups slay w sux
-
-# group commands see only groups
-[ -n "$bash205" ] && complete -g groupmod groupdel newgrp 2>/dev/null
-
-# bg completes with stopped jobs
-complete -A stopped -P '%' bg
-
-# other job commands
-complete -j -P '%' fg jobs disown
-
-# readonly and unset complete with shell variables
-complete -v readonly unset
-
-# set completes with set options
-complete -A setopt set
-
-# shopt completes with shopt options
-complete -A shopt shopt
-
-# helptopics
-complete -A helptopic help
-
-# unalias completes with aliases
-complete -a unalias
-
-# bind completes with readline bindings (make this more intelligent)
-complete -A binding bind
-
-# type and which complete on commands
-complete -c command type which
-
-# builtin completes on builtins
-complete -b builtin
-
-# start of section containing completion functions called by other functions
-
-# This function checks whether we have a given program on the system.
-# No need for bulky functions in memory if we don't.
-#
-have()
-{
-    unset -v have
-    PATH=/usr/gnu/bin:$PATH:/sbin:/usr/sbin type $1 &>/dev/null &&
-    have="yes"
-}
-
-# use GNU sed if we have it, since its extensions are still used in our code
-#
-[ $UNAME != Linux ] && have gsed && alias sed=gsed
-
-# This function checks whether a given readline variable
-# is `on'.
-#
-_rl_enabled() 
-{
-    [[ "$( bind -v )" = *$1+([[:space:]])on* ]]
-}
-
-# This function shell-quotes the argument
-quote()
-{
-	echo \'${1//\'/\'\\\'\'}\' #'# Help vim syntax highlighting
-}
-
-# This function quotes the argument in a way so that readline dequoting
-# results in the original argument
-quote_readline()
-{
-	local t="${1//\\/\\\\}"
-	echo \'${t//\'/\'\\\'\'}\' #'# Help vim syntax highlighting
-}
-
-# This function shell-dequotes the argument
-dequote()
-{
-	eval echo "$1"
-}
-
-
-# Get the word to complete
-# This is nicer than ${COMP_WORDS[$COMP_CWORD]}, since it handles cases
-# where the user is completing in the middle of a word.
-# (For example, if the line is "ls foobar",
-# and the cursor is here -------->   ^
-# it will complete just "foo", not "foobar", which is what the user wants.)
-_get_cword()
-{
-	if [[ "${#COMP_WORDS[COMP_CWORD]}" -eq 0 ]] || [[ "$COMP_POINT" == "${#COMP_LINE}" ]]; then
-		echo "${COMP_WORDS[COMP_CWORD]}"
-	else
-		local i
-		local cur="$COMP_LINE"
-		local index="$COMP_POINT"
-		for (( i = 0; i <= COMP_CWORD; ++i )); do
-			while [[ "${#cur}" -ge ${#COMP_WORDS[i]} ]] && [[ "${cur:0:${#COMP_WORDS[i]}}" != "${COMP_WORDS[i]}" ]]; do
-				cur="${cur:1}"
-				index="$(( index - 1 ))"
-			done
-			if [[ "$i" -lt "$COMP_CWORD" ]]; then
-				local old_size="${#cur}"
-				cur="${cur#${COMP_WORDS[i]}}"
-				local new_size="${#cur}"
-				index="$(( index - old_size + new_size ))"
-			fi
-		done
-
-		if [[ "${COMP_WORDS[COMP_CWORD]:0:${#cur}}" != "$cur" ]]; then
-			# We messed up! At least return the whole word so things keep working
-			echo "${COMP_WORDS[COMP_CWORD]}"
-		else
-			echo "${cur:0:$index}"
-		fi
-	fi
-}
-
-
-# This function performs file and directory completion. It's better than
-# simply using 'compgen -f', because it honours spaces in filenames.
-# If passed -d, it completes only on directories. If passed anything else,
-# it's assumed to be a file glob to complete on.
-#
-_filedir()
-{
-	local IFS=$'\t\n' xspec
-
-	_expand || return 0
-
-	local toks=( ) tmp
-	while read -r tmp; do
-		[[ -n $tmp ]] && toks[${#toks[@]}]=$tmp
-	done < <( compgen -d -- "$(quote_readline "$cur")" )
-
-	if [[ "$1" != -d ]]; then
-		xspec=${1:+"!*.$1"}
-		while read -r tmp; do
-			[[ -n $tmp ]] && toks[${#toks[@]}]=$tmp
-		done < <( compgen -f -X "$xspec" -- "$(quote_readline "$cur")" )
-	fi
-
-	COMPREPLY=( "${COMPREPLY[@]}" "${toks[@]}" )
-}
-
-# This function completes on signal names
-#
-_signals()
-{
-	local i
-
-	# standard signal completion is rather braindead, so we need
-	# to hack around to get what we want here, which is to
-	# complete on a dash, followed by the signal name minus
-	# the SIG prefix
-	COMPREPLY=( $( compgen -A signal SIG${cur#-} ))
-	for (( i=0; i < ${#COMPREPLY[@]}; i++ )); do
-		COMPREPLY[i]=-${COMPREPLY[i]#SIG}
-	done
-}
-
-# This function completes on configured network interfaces
-#
-_configured_interfaces()
-{
-	if [ -f /etc/debian_version ]; then
-		# Debian system
-		COMPREPLY=( $( sed -ne 's|^iface \([^ ]\+\).*$|\1|p' \
-			       /etc/network/interfaces ) )
-	elif [ -f /etc/SuSE-release ]; then
-		# SuSE system
-		COMPREPLY=( $( command ls \
-			/etc/sysconfig/network/ifcfg-* | \
-			sed -ne 's|.*ifcfg-\('$cur'.*\)|\1|p' ) )
-	elif [ -f /etc/pld-release ]; then
-		# PLD Linux
-		COMPREPLY=( $( command ls -B \
-			/etc/sysconfig/interfaces | \
-			sed -ne 's|.*ifcfg-\('$cur'.*\)|\1|p' ) )
-	else
-		# Assume Red Hat
-		COMPREPLY=( $( command ls \
-			/etc/sysconfig/network-scripts/ifcfg-* | \
-			sed -ne 's|.*ifcfg-\('$cur'.*\)|\1|p' ) )
-	fi
-}
-
-# This function completes on all available network interfaces
-# -a: restrict to active interfaces only
-# -w: restrict to wireless interfaces only
-#
-_available_interfaces()
-{
-	local cmd
-
-	if [ "${1:-}" = -w ]; then
-		cmd="iwconfig"
-	elif [ "${1:-}" = -a ]; then
-		cmd="ifconfig"
-	else
-		cmd="ifconfig -a"
-	fi
-
-	COMPREPLY=( $( eval $cmd 2>/dev/null | \
-		sed -ne 's|^\('$cur'[^[:space:][:punct:]]\{1,\}\).*$|\1|p') )
-}
-
-# This function expands tildes in pathnames
-#
-_expand()
-{
-	# FIXME: Why was this here?
-	# [ "$cur" != "${cur%\\}" ] && cur="$cur\\"
-
-	# expand ~username type directory specifications
-	if [[ "$cur" == \~*/* ]]; then
-		eval cur=$cur
-	elif [[ "$cur" == \~* ]]; then
-		cur=${cur#\~}
-		COMPREPLY=( $( compgen -P '~' -u $cur ) )
-		return ${#COMPREPLY[@]}
-	fi
-}
-
-# This function completes on process IDs.
-# AIX and Solaris ps prefers X/Open syntax.
-[ $UNAME = SunOS -o $UNAME = AIX ] &&
-_pids()
-{
-	COMPREPLY=( $( compgen -W '$( command ps -efo pid | sed 1d )' -- $cur ))
-} ||
-_pids()
-{
-	COMPREPLY=( $( compgen -W '$( command ps axo pid | sed 1d )' -- $cur ) )
-}
-
-# This function completes on process group IDs.
-# AIX and SunOS prefer X/Open, all else should be BSD.
-[ $UNAME = SunOS -o $UNAME = AIX ] &&
-_pgids()
-{
-	COMPREPLY=( $( compgen -W '$( command ps -efo pgid | sed 1d )' -- $cur ))
-} ||
-_pgids()
-{
-	COMPREPLY=( $( compgen -W '$( command ps axo pgid | sed 1d )' -- $cur ))
-}
-
-# This function completes on user IDs
-#
-_uids()
-{
-	if type getent &>/dev/null; then
-	    COMPREPLY=( $( getent passwd | \
-			    awk -F: '{if ($3 ~ /^'$cur'/) print $3}' ) )
-	elif type perl &>/dev/null; then
-	    COMPREPLY=( $( compgen -W '$( perl -e '"'"'while (($uid) = (getpwent)[2]) { print $uid . "\n" }'"'"' )' -- $cur ) )
-	else
-	    # make do with /etc/passwd
-	    COMPREPLY=( $( awk 'BEGIN {FS=":"} {if ($3 ~ /^'$cur'/) print $3}'\
-			    /etc/passwd ) )
-	fi
-}
-
-# This function completes on group IDs
-#
-_gids()
-{
-	if type getent &>/dev/null; then
-	    COMPREPLY=( $( getent group | \
-			    awk -F: '{if ($3 ~ /^'$cur'/) print $3}' ) )
-	elif type perl &>/dev/null; then
-	    COMPREPLY=( $( compgen -W '$( perl -e '"'"'while (($gid) = (getgrent)[2]) { print $gid . "\n" }'"'"' )' -- $cur ) )
-	else
-	    # make do with /etc/group
-	    COMPREPLY=( $( awk 'BEGIN {FS=":"} {if ($3 ~ /^'$cur'/) print $3}'\
-			    /etc/group ) )
-	fi
-}
-
-# This function completes on services
-#
-_services()
-{
-	local sysvdir famdir
-	[ -d /etc/rc.d/init.d ] && sysvdir=/etc/rc.d/init.d || sysvdir=/etc/init.d
-	famdir=/etc/xinetd.d
-	COMPREPLY=( $( builtin echo $sysvdir/!(*.rpmsave|*.rpmorig|*~|functions)) )
-
-	if [ -d $famdir ]; then
-		COMPREPLY=( "${COMPREPLY[@]}" $( builtin echo $famdir/!(*.rpmsave|*.rpmorig|*~)) )
-	fi
-
-	COMPREPLY=( $( compgen -W '${COMPREPLY[@]#@($sysvdir|$famdir)/}' -- $cur ) )
-}
-
-# This function complete on modules
-#
-_modules()
-{
-	local modpath
-	modpath=/lib/modules/$1
-	COMPREPLY=( $( command ls -R $modpath | \
-			sed -ne 's/^\('$cur'.*\)\.k\?o\(\|.gz\)$/\1/p') )
-}
-
-# this function complete on user:group format
-#
-_usergroup()
-{
-	local IFS=$'\n'
-	cur=${cur//\\\\ / }
-	if [[ $cur = *@(\\:|.)* ]] && [ -n "$bash205" ]; then
-		user=${cur%%*([^:.])}
-		COMPREPLY=( $(compgen -P ${user/\\\\} -g -- ${cur##*[.:]}) )
-	elif [[ $cur = *:* ]] && [ -n "$bash205" ]; then
-		COMPREPLY=( $( compgen -g -- ${cur##*[.:]} ) )
-	else
-		COMPREPLY=( $( compgen -S : -u -- $cur ) )
-	fi
-}
-
-# this function count the number of mandatory args
-#
-_count_args()
-{
-	args=1
-	for (( i=1; i < COMP_CWORD; i++ )); do
-		if [[ "${COMP_WORDS[i]}" != -* ]]; then
-			args=$(($args+1))
-		fi
-	done
-}
-
-# start of section containing completion functions for bash built-ins
-
-# bash alias completion
-#
-_alias()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=${COMP_WORDS[$COMP_CWORD]}
-
-	case "$COMP_LINE" in
-	*[^=])
-		COMPREPLY=( $( compgen -A alias -S '=' -- $cur ) )
-		;;
-	*=)
-		COMPREPLY=( "$( alias ${cur%=} 2>/dev/null | \
-			     sed -e 's|^alias '$cur'\(.*\)$|\1|' )" )
-		;;
-	esac
-}
-complete -F _alias $nospace alias
-
-# bash export completion
-#
-_export()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=${COMP_WORDS[$COMP_CWORD]}
-
-	case "$COMP_LINE" in
-	*=\$*)
-		COMPREPLY=( $( compgen -v -P '$' -- ${cur#*=\$} ) )
-		;;
-	*[^=])
-		COMPREPLY=( $( compgen -v -S '=' -- $cur ) )
-		;;
-	*=)
-		COMPREPLY=( "$( eval echo -n \"$`echo ${cur%=}`\" |
-			( echo -n \'
-			  sed -e 's/'\''/'\''\\\'\'''\''/g'
-			  echo -n \' ) )" )
-		;;
-	esac
-}
-complete -F _export $default $nospace export
-
-# bash shell function completion
-#
-_function()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	if [[ $1 == @(declare|typeset) ]]; then
-		if [ "$prev" = -f ]; then
-			COMPREPLY=( $( compgen -A function -- $cur ) )
-		elif [[ "$cur" == -* ]]; then
-			COMPREPLY=( $( compgen -W '-a -f -F -i -r -x -p' -- \
-				       $cur ) )
-		fi
-	elif [ $COMP_CWORD -eq 1 ]; then
-		COMPREPLY=( $( compgen -A function -- $cur ) )
-	else
-		COMPREPLY=( "() $( type -- ${COMP_WORDS[1]} | sed -e 1,2d )" )
-	fi
-}
-complete -F _function function declare typeset
-
-# bash complete completion
-#
-_complete()
-{
-	local cur prev options
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case $prev in
-		-o)
-			options="default dirnames filenames"
-			[ -n "$bash205b" ] && options="$options nospace"
-			[ -n "$bash3" ] && options="$options bashdefault plusdirs"
-			COMPREPLY=( $( compgen -W "$options" -- $cur ) )
-			return 0
-			;;
-
-		-A)
-			COMPREPLY=( $( compgen -W 'alias arrayvar binding \
-				builtin command directory disabled enabled \
-				export file function group helptopic hostname \
-				job keyword running service setopt shopt \
-				signal stopped user variable' -- $cur ) )
-			return 0
-			;;
-
-		-C)
-			COMPREPLY=( $( compgen -A command -- $cur ) )
-			return 0
-			;;
-		-F)
-			COMPREPLY=( $( compgen -A function -- $cur ) )
-			return 0
-			;;
-		-@(p|r))
-			COMPREPLY=( $( complete -p | sed -e 's|.* ||' | \
-					grep "^$cur" ) )
-			return 0
-			;;
-
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		# relevant options completion
-		options="-a -b -c -d -e -f -g -j -k -s -v -u -A -G -W -P -S -X -F -C"
-		[ -n "$bash205" ] && options="$options -o"
-		COMPREPLY=( $( compgen -W "$options" -- $cur ) )
-	else
-		COMPREPLY=( $( compgen -A command -- $cur ) )
-	fi
-}
-complete -F _complete complete
-
-# start of section containing completion functions for external programs
-
-# a little help for FreeBSD ports users
-[ $UNAME = FreeBSD ] && complete -W 'index search fetch fetch-list \
-	extract patch configure build install reinstall \
-	deinstall clean clean-depends kernel buildworld' make
-
-# This completes on a list of all available service scripts for the
-# 'service' command and/or the SysV init.d directory, followed by
-# that script's available commands
-#
-{ have service || [ -d /etc/init.d/ ]; } &&
-_service()
-{
-	local cur sysvdir
-
-	COMPREPLY=()
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-	cur=`_get_cword`
-
-	# don't complete for things like killall, ssh and mysql if it's
-	# the standalone command, rather than the init script
-	[[ ${COMP_WORDS[0]} != @(*init.d/!(functions|~)|service) ]] && return 0
-
-	# don't complete past 2nd token
-	[ $COMP_CWORD -gt 2 ] && return 0
-
-	[ -d /etc/rc.d/init.d ] && sysvdir=/etc/rc.d/init.d \
-				|| sysvdir=/etc/init.d
-
-	if [[ $COMP_CWORD -eq 1 ]] && [[ $prev == "service" ]]; then
-		_services
-	else
-		COMPREPLY=( $( compgen -W '`sed -ne "y/|/ /; \
-				s/^.*Usage.*{\(.*\)}.*$/\1/p" \
-				$sysvdir/${prev##*/} 2>/dev/null`' -- $cur ) )
-	fi
-
-	return 0
-} &&
-complete -F _service service
-[ -d /etc/init.d/ ] && complete -F _service $default \
-	$(for i in /etc/init.d/*; do echo ${i##*/}; done)
-
-# chown(1) completion
-#
-_chown()
-{
-	local cur
-	cur=`_get_cword`
-
-	# options completion
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-c -h -f -R -v --changes \
-		--dereference --no-dereference --from= --silent --quiet \
-		--reference= --recursive --verbose --help --version' -- $cur ) )
-	else
-		_count_args
-
-		case $args in
-			1)
-				_usergroup
-				;;
-			*)
-				_filedir
-				;;
-		esac
-	fi
-}
-complete -F _chown $filenames chown
-
-# chgrp(1) completion
-#
-_chgrp()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	cur=${cur//\\\\/}
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	# options completion
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-c -h -f -R -v --changes \
-		--dereference --no-dereference --silent --quiet \
-		--reference= --recursive --verbose --help --version' -- $cur ) )
-		return 0
-	fi
-
-	# first parameter on line or first since an option?
-	if [ $COMP_CWORD -eq 1 ] && [[ "$cur" != -* ]] || \
-	   [[ "$prev" == -* ]] && [ -n "$bash205" ]; then
-		local IFS=$'\n'
-		COMPREPLY=( $( compgen -g $cur 2>/dev/null ) )
-	else
-		_filedir || return 0
-	fi
-
-	return 0
-}
-complete -F _chgrp $filenames chgrp
-
-# umount(8) completion. This relies on the mount point being the third
-# space-delimited field in the output of mount(8)
-#
-_umount()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	OLDIFS="$IFS"
-	IFS="\n"
-	COMPREPLY=( $( compgen -W '$( mount | cut -d" " -f 3 )' -- $cur ) )
-	IFS="$OLDIFS"
-
-	return 0
-}
-complete -F _umount $dirnames umount
-
-# mount(8) completion. This will pull a list of possible mounts out of
-# /etc/{,v}fstab, unless the word being completed contains a ':', which
-# would indicate the specification of an NFS server. In that case, we
-# query the server for a list of all available exports and complete on
-# that instead.
-#
-_mount()
-{       local cur i sm host
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	[[ "$cur" == \\ ]] && cur="/"
-
-	for i in {,/usr}/{,s}bin/showmount; do [ -x $i ] && sm=$i && break; done
-
-	if [ -n "$sm" ] && [[ "$cur" == *:* ]]; then
-		COMPREPLY=( $( $sm -e ${cur%%:*} | sed 1d | \
-			       grep ^${cur#*:} | awk '{print $1}' ) )
-	elif [[ "$cur" == //* ]]; then
-		host=${cur#//}
-		host=${host%%/*}
-		if [ -n "$host" ]; then
-			COMPREPLY=( $( compgen -W "$( echo $( smbclient -d 0 -NL $host 2>/dev/null|
-			sed -ne '/^['"$'\t '"']*Sharename/,/^$/p' |
-			sed -ne '3,$s|^[^A-Za-z]*\([^'"$'\t '"']*\).*$|//'$host'/\1|p' ) )" -- "$cur" ) )
-		fi
-	elif [ -r /etc/vfstab ]; then
-		# Solaris
-		COMPREPLY=( $( awk '! /^[ \t]*#/ {if ($3 ~ /\//) print $3}' \
-				/etc/vfstab | grep "^$cur" ) )
-	elif [ ! -e /etc/fstab ]; then
-		# probably Cygwin
-		COMPREPLY=( $( mount | awk '! /^[ \t]*#/ {if ($3 ~ /\//) print $3}' \
-				 | grep "^$cur" ) )
-	else
-		# probably Linux
-		COMPREPLY=( $( awk '! /^[ \t]*#/ {if ($2 ~ /\//) print $2}' \
-				/etc/fstab | grep "^$cur" ) )
-	fi
-
-	return 0
-}
-complete -F _mount $default $filenames mount
-
-# Linux rmmod(8) completion. This completes on a list of all currently
-# installed kernel modules.
-#
-have rmmod && {
-_rmmod()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	COMPREPLY=( $( /sbin/lsmod | \
-		  awk '{if (NR != 1 && $1 ~ /^'$cur'/) print $1}' 2>/dev/null ))
-	return 0
-}
-complete -F _rmmod rmmod
-
-# Linux insmod(8), modprobe(8) and modinfo(8) completion. This completes on a
-# list of all available modules for the version of the kernel currently
-# running.
-#
-_insmod()
-{
-	local cur prev modpath
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	# behave like lsmod for modprobe -r
-	if [ $1 = "modprobe" ] &&
-	   [ "${COMP_WORDS[1]}" = "-r" ]; then
-		COMPREPLY=( $( /sbin/lsmod | \
-				awk '{if (NR != 1 && $1 ~ /^'$cur'/) print $1}' ) )
-		return 0
-	fi
-
-	# do filename completion if we're giving a path to a module
-	if [[ "$cur" == */* ]]; then
-		_filedir '@(?(k)o?(.gz))'
-		return 0
-	fi
-
-	if [ $COMP_CWORD -gt 1 ] && 
-	   [[ "${COMP_WORDS[COMP_CWORD-1]}" != -* ]]; then
-		# do module parameter completion
-		COMPREPLY=( $( /sbin/modinfo -p ${COMP_WORDS[1]} 2>/dev/null | \
-		       awk '{if ($1 ~ /^parm:/ && $2 ~ /^'$cur'/) { print $2 } \
-			else if ($1 !~ /:/ && $1 ~ /^'$cur'/) { print $1 }}' ) )
-	else
-		_modules $(uname -r)
-	fi
-
-	return 0
-}
-complete -F _insmod $filenames insmod modprobe modinfo
-}
-
-# man(1) completion
-#
-[ $UNAME = GNU -o $UNAME = Linux -o $UNAME = Darwin \
-  -o $UNAME = FreeBSD -o $UNAME = SunOS -o $UNAME = Cygwin \
-  -o $UNAME = OpenBSD ] &&
-_man()
-{
-	local cur prev sect manpath UNAME
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	_expand || return 0
-
-	# default completion if parameter contains /
-	if [[ "$cur" == */* ]]; then
-		_filedir
-		return 0
-	fi
-
-	UNAME=$( uname -s )
-	# strip OS type and version under Cygwin
-	UNAME=${UNAME/CYGWIN_*/Cygwin}
-	if [ $UNAME = GNU -o $UNAME = Linux -o $UNAME = FreeBSD \
-	     -o $UNAME = Cygwin ]; then
-		manpath=$( manpath 2>/dev/null || command man --path )
-	else
-		manpath=$MANPATH
-	fi
-
-	if [ -z "$manpath" ]; then
-		COMPREPLY=( $( compgen -c -- $cur ) )
-		return 0
-	fi
-
-	# determine manual section to search
-	[[ "$prev" == [0-9ln] ]] && sect=$prev || sect='*'
-
-	manpath=$manpath:
-	if [ -n "$cur" ]; then
-		manpath="${manpath//://*man$sect/$cur* } ${manpath//://*cat$sect/$cur* }"
-	else
-		manpath="${manpath//://*man$sect/ } ${manpath//://*cat$sect/ }"
-	fi
-		
-	# redirect stderr for when path doesn't exist
-	COMPREPLY=( $( eval command ls "$manpath" 2>/dev/null ) )
-	# weed out directory path names and paths to man pages
-	COMPREPLY=( ${COMPREPLY[@]##*/?(:)} )
-	# strip suffix from man pages
-	COMPREPLY=( ${COMPREPLY[@]%.@(gz|bz2)} )
-	COMPREPLY=( $( compgen -W '${COMPREPLY[@]%.*}' -- "${cur//\\\\/}" ) )
-
-	[[ "$prev" != [0-9ln] ]] && _filedir '[0-9ln]'
-
-	return 0
-}
-[ $UNAME = GNU -o $UNAME = Linux -o $UNAME = Darwin \
-  -o $UNAME = FreeBSD -o $UNAME = SunOS -o $UNAME = Cygwin \
-  -o $UNAME = OpenBSD ] && \
-complete -F _man $filenames man apropos whatis
-
-# renice(8) completion
-#
-_renice()
-{
-	local command cur curopt i
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	command=$1
-
-	i=0
-	# walk back through command line and find last option
-	while [ $i -le $COMP_CWORD -a ${#COMPREPLY[@]} -eq 0 ]; do
-		curopt=${COMP_WORDS[COMP_CWORD-$i]}
-		case "$curopt" in
-		-u)
-			COMPREPLY=( $( compgen -u -- $cur ) )
-			;;
-		-g)
-			_pgids
-			;;
-		-p|$command)
-			_pids
-			;;
-		esac
-		i=$(( ++i ))
-	done
-}
-complete -F _renice renice
-
-# kill(1) completion
-#
-_kill()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [ $COMP_CWORD -eq 1 ] && [[ "$cur" == -* ]]; then
-		# return list of available signals
-		_signals
-	else
-		# return list of available PIDs
-		_pids
-	fi
-}
-complete -F _kill kill
-
-# Linux and FreeBSD killall(1) completion.
-#
-[ $UNAME = Linux -o $UNAME = FreeBSD ] &&
-_killall()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [ $COMP_CWORD -eq 1 ] && [[ "$cur" == -* ]]; then
-		_signals
-	else
-		COMPREPLY=( $( compgen -W '$( command ps axo command | \
-			      sed -ne "1d; s/^\[\?\([^-][^] ]*\).*$/\1/p" | \
-			      sed -e "s/.*\///" )' -- $cur ) )
-	fi
-
-	return 0
-}
-[ $UNAME = Linux -o $UNAME = FreeBSD ] && complete -F _killall killall pkill
-
-# Linux and FreeBSD pgrep(1) completion.
-#
-[ $UNAME = Linux -o $UNAME = FreeBSD ] &&
-_pgrep()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	COMPREPLY=( $( compgen -W '$( command ps axo command | \
-		      sed -ne "1d; s/^\[\?\([^-][^] ]*\).*$/\1/p" | \
-		      sed -e "s/.*\///" )' -- $cur ) )
-
-	return 0
-}
-[ $UNAME = Linux -o $UNAME = FreeBSD ] && complete -F _pgrep pgrep
-# Linux pidof(8) completion.
-[ $UNAME = Linux ] && complete -F _pgrep pidof
-
-# GNU find(1) completion. This makes heavy use of ksh style extended
-# globs and contains Linux specific code for completing the parameter
-# to the -fstype option.
-#
-_find()
-{
-	local cur prev i exprfound onlyonce
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-	-@(max|min)depth)
-		COMPREPLY=( $( compgen -W '0 1 2 3 4 5 6 7 8 9' -- $cur ) )
-		return 0
-		;;
-	-?(a|c)newer|-fls|-fprint?(0|f)|-?(i)?(l)name|-?(i)wholename)
-		_filedir
-		return 0
-		;;
-	-fstype)
-		# this is highly non-portable
-		[ -e /proc/filesystems ] &&
-		COMPREPLY=( $( cut -d$'\t' -f 2 /proc/filesystems | \
-				grep "^$cur" ) )
-		return 0
-		;;
-	-gid)
-		_gids
-		return 0
-		;;
-	-group)
-		if [ -n "$bash205" ]; then
-			COMPREPLY=( $( compgen -g -- $cur 2>/dev/null) )
-		fi
-		return 0
-		;;
-	-?(x)type)
-		COMPREPLY=( $( compgen -W 'b c d p f l s' -- $cur ) )
-		return 0
-		;;
-	-uid)
-		_uids
-		return 0
-		;;
-	-user)
-		COMPREPLY=( $( compgen -u -- $cur ) )
-		return 0
-		;;
-	-exec|-ok)
-		COMP_WORDS=(COMP_WORDS[0] $cur)
-		COMP_CWORD=1
-		_command
-		return 0
-		;;
-	-[acm]min|-[acm]time|-?(i)?(l)name|-inum|-?(i)path|-?(i)regex| \
-	-links|-perm|-size|-used|-printf)
-		# do nothing, just wait for a parameter to be given
-		return 0
-		;;
-	esac
-
-	_expand || return 0
-
-	# set exprfound to 1 if there is already an expression present
-	for i in ${COMP_WORDS[@]}; do
-		[[ "$i" = [-\(\),\!]* ]] && exprfound=1 && break
-	done
-
-	# handle case where first parameter is not a dash option
-	if [ "$exprfound" != 1 ] && [[ "$cur" != [-\(\),\!]* ]]; then
-		_filedir -d
-		return 0
-	fi
-
-	# complete using basic options
-	COMPREPLY=( $( compgen -W '-daystart -depth -follow -help -maxdepth \
-			-mindepth -mount -noleaf -version -xdev -amin -anewer \
-			-atime -cmin -cnewer -ctime -empty -false -fstype \
-			-gid -group -ilname -iname -inum -ipath -iregex \
-			-wholename \
-			-links -lname -mmin -mtime -name -newer -nouser \
-			-nogroup -perm -regex -size -true -type -uid -used \
-			-user -xtype -exec -fls -fprint -fprint0 -fprintf -ok \
-			-print -print0 -printf -prune -ls' -- $cur ) )
-
-	# this removes any options from the list of completions that have
-	# already been specified somewhere on the command line, as long as
-	# these options can only be used once (in a word, "options", in
-	# opposition to "tests" and "actions", as in the find(1) manpage).
-	onlyonce=' -daystart -depth -follow -help -maxdepth -mindepth -mount \
-		   -noleaf -version -xdev '
-	COMPREPLY=( $( echo "${COMP_WORDS[@]}" | \
-		       (while read -d ' ' i; do
-			    [ "$i" == "" ] ||
-			    [ "${onlyonce/ ${i%% *} / }" == "$onlyonce" ] &&
-			    continue
-			    # flatten array with spaces on either side,
-			    # otherwise we cannot grep on word boundaries of
-			    # first and last word
-			    COMPREPLY=" ${COMPREPLY[@]} "
-			    # remove word from list of completions
-			    COMPREPLY=( ${COMPREPLY/ ${i%% *} / } )
-			done
-			echo "${COMPREPLY[@]}")
-		  ) )
-	
-	_filedir
-	
-	return 0
-}
-complete -F _find $filenames find
-
-# Linux iwconfig(8) completion
-#
-[ $UNAME = Linux ] && have iwconfig &&
-_iwconfig()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-	
-	case $prev in
-		mode)
-			COMPREPLY=( $( compgen -W 'managed ad-hoc master \
-				repeater secondary monitor' -- $cur ) )
-			return 0
-			;;
-		essid)
-			COMPREPLY=( $( compgen -W 'on off any' -- $cur ) )
-			if [ -n "${COMP_IWLIST_SCAN:-}" ]; then
-				COMPREPLY=( "${COMPREPLY[@]}" \
-					$( iwlist ${COMP_WORDS[1]} scan | \
-					awk -F '"' '/ESSID/ {print $2}' | \
-					grep "^$cur" ))
-			fi
-			return 0
-			;;
-		nwid)
-			COMPREPLY=( $( compgen -W 'on off' -- $cur ) )
-			return 0
-			;;
-		channel)
-			COMPREPLY=( $( iwlist ${COMP_WORDS[1]} channel | \
-				awk '/^[[:space:]]*Channel/ {print $2}' | \
-				grep "^$cur" ) )
-			return 0
-			;;
-
-		freq)
-			COMPREPLY=( $( iwlist ${COMP_WORDS[1]} channel | \
-				awk '/^[[:space:]]*Channel/ {print $4"G"}' | \
-				grep "^$cur" ) )
-			return 0
-			;;
-		ap)
-			COMPREPLY=( $( compgen -W 'on off any' -- $cur ) )
-			if [ -n "${COMP_IWLIST_SCAN:-}" ]; then
-				COMPREPLY=( "${COMPREPLY[@]}" \
-					$( iwlist ${COMP_WORDS[1]} scan | \
-					awk -F ': ' '/Address/ {print $2}' | \
-					grep "^$cur" ) )
-			fi
-			return 0
-			;;
-		rate)
-			COMPREPLY=( $( compgen -W 'auto fixed' -- $cur ) )
-			COMPREPLY=( "${COMPREPLY[@]}" \
-				$( iwlist ${COMP_WORDS[1]} rate | \
-				awk '/^[[:space:]]*[0-9]/ {print $1"M"}' | \
-				grep "^$cur" ) )
-			return 0
-			;;
-		rts)
-			COMPREPLY=( $( compgen -W 'auto fixed off' -- $cur ) )
-			return 0
-			;;
-		frag)
-			COMPREPLY=( $( compgen -W 'auto fixed off' -- $cur ) )
-			return 0
-			;;
-		key)
-			COMPREPLY=( $( compgen -W 'off on open restricted' -- $cur ) )
-			return 0
-			;;
-		enc)
-			COMPREPLY=( $( compgen -W 'off on open restricted' -- $cur ) )
-			return 0
-			;;
-		power)
-			COMPREPLY=( $( compgen -W 'period timeout off on' -- $cur ) )
-			return 0
-			;;
-		txpower)
-			COMPREPLY=( $( compgen -W 'off on auto' -- $cur ) )
-			return 0
-			;;
-		retry)
-			COMPREPLY=( $( compgen -W 'limit lifetime' -- $cur ) )
-			return 0
-			;;
-	esac
-
-	if [ $COMP_CWORD -eq 1 ]; then
-		if [[ "$cur" == -* ]]; then
-			COMPREPLY=( $( compgen -W '--help --version' -- $cur ) ) 
-		else
-			_available_interfaces -w
-		fi
-	else
-		COMPREPLY=( $( compgen -W 'essid nwid mode freq channel sens mode \
-			ap nick rate rts frag enc key power txpower commit' -- $cur ) ) 
-	fi
-
-} &&
-complete -F _iwconfig iwconfig
-
-# Linux iwlist(8) completion
-#
-[ $UNAME = Linux ] && have iwlist &&
-_iwlist()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-	
-	if [ $COMP_CWORD -eq 1 ]; then
-		if [[ "$cur" == -* ]]; then
-			COMPREPLY=( $( compgen -W '--help --version' -- $cur ) ) 
-		else
-			_available_interfaces -w
-		fi
-	else
-		COMPREPLY=( $( compgen -W 'scan scanning freq frequency \
-			channel rate bit bitrate key enc encryption power \
-			txpower retry ap accesspoint peers event' -- $cur ) ) 
-	fi
-} &&
-complete -F _iwlist iwlist
-
-# Linux iwspy(8) completion
-#
-[ $UNAME = Linux ] && have iwspy &&
-_iwspy()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [ $COMP_CWORD -eq 1 ]; then
-		if [[ "$cur" == -* ]]; then
-			COMPREPLY=( $( compgen -W '--help --version' -- $cur ) ) 
-		else
-			_available_interfaces -w
-		fi
-	else
-		COMPREPLY=( $( compgen -W 'setthr getthr off' -- $cur ) ) 
-	fi
-} &&
-complete -F _iwspy iwspy
-
-# Linux iwpriv(8) completion
-#
-[ $UNAME = Linux ] && have iwpriv &&
-_iwpriv()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		roam)
-			COMPREPLY=( $( compgen -W 'on off' -- $cur ) )
-			return 0
-			;;
-		port)
-			COMPREPLY=( $( compgen -W 'ad-hoc managed' -- $cur ) )
-			return 0
-			;;
-	esac
-
-	if [ $COMP_CWORD -eq 1 ]; then
-		if [[ "$cur" == -* ]]; then
-			COMPREPLY=( $( compgen -W '--help --version' -- $cur ) ) 
-		else
-			_available_interfaces -w
-		fi
-	else
-		COMPREPLY=( $( compgen -W '--all roam port' -- $cur ) ) 
-	fi
-} &&
-complete -F _iwpriv iwpriv
-
-# RedHat & Debian GNU/Linux if{up,down} completion
-#
-[ $UNAME = Linux ] && { have ifup || have ifdown; } &&
-_ifupdown()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [ $COMP_CWORD -eq 1 ]; then
-		_configured_interfaces
-		COMPREPLY=( $(compgen -W '${COMPREPLY[@]}' -- "$cur") )
-       fi
-
-       return 0
-} &&
-complete -F _ifupdown ifup ifdown
-[ $UNAME = Linux ] && have ifstatus && complete -F _ifupdown ifstatus
-
-# Linux ipsec(8) completion (for FreeS/WAN)
-#
-[ $UNAME = Linux ] && have ipsec &&
-_ipsec()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	
-	if [ $COMP_CWORD -eq 1 ]; then
-		COMPREPLY=( $( compgen -W 'auto barf eroute klipsdebug look \
-					   manual pluto ranbits rsasigkey \
-					   setup showdefaults showhostkey spi \
-					   spigrp tncfg whack' -- $cur ) )
-		return 0
-	fi
-
-	case ${COMP_WORDS[1]} in
-	auto)
-		COMPREPLY=( $( compgen -W '--asynchronous --up --add --delete \
-					   --replace --down --route --unroute \
-					   --ready --status --rereadsecrets' \
-					-- $cur ) )
-		;;
-	manual)
-		COMPREPLY=( $( compgen -W '--up --down --route --unroute \
-					   --union' -- $cur ) )
-		;;
-	ranbits)
-		COMPREPLY=( $( compgen -W '--quick --continuous --bytes' \
-					  -- $cur ) )
-		;;
-	setup)
-		COMPREPLY=( $( compgen -W '--start --stop --restart' -- $cur ) )
-		;;
-
-	*)
-		;;
-	esac
-
-	return 0
-} &&
-complete -F _ipsec ipsec
-
-# Postfix completion.
-#
-have postfix && {
-# postfix(1)
-#
-_postfix()
-{
-	local cur prev
-
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	if [[ $cur == '-' ]]; then
-		COMPREPLY=(-c -D -v)
-		return 0
-	fi
-	if [[ $prev == '-c' ]]; then
-		_filedir -d
-		return 0
-	fi
-	if [[ $prev == '-D' ]]; then
-		COMPREPLY=( $( compgen -W 'start' -- "`get_cword`" ) )
-		return 0
-	fi
-	COMPREPLY=( $( compgen -W 'start stop reload abort flush check' -- \
-		"`get_cword`" ) )
-}
-complete -F _postfix postfix
-
-# postalias(1) and postmap(1)
-#
-_postmap()
-{
-	local cur prev len idx
-
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	if [[ $cur == '-' ]]; then
-		COMPREPLY=(-N -f -i -n -o -p -r -v -w -c -d -q)
-		return 0
-	fi
-	if [[ $prev == '-c' ]]; then
-		_filedir -d
-		return 0
-	fi
-	if [[ $prev == -[dq] ]]; then
-		return 0
-	fi
-
-	if [[ "$cur" == *:* ]]; then
-	       	COMPREPLY=( $( compgen -f -- ${cur#*:} ) )
-	else
-		len=${#cur}
-		idx=0
-		for pval in $( /usr/sbin/postconf -m ); do
-			if [[ "$cur" == "${pval:0:$len}" ]]; then
-				COMPREPLY[$idx]="$pval:"
-				idx=$(($idx+1))
-			fi
-		done
-		if [[ $idx -eq 0 ]]; then
-			COMPREPLY=( $( compgen -f -- "$cur" ) )
-		fi
-	fi
-	return 0
-}
-complete -F _postmap postmap postalias
-
-# postcat(1)
-#
-_postcat()
-{
-	local cur prev pval len idx qfile
-
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	if [[ $cur == '-' ]]; then
-		COMPREPLY=(-c -q -v)
-		return 0
-	fi
-	if [[ $prev == '-c' ]]; then
-		_filedir -d
-		return 0
-	fi
-
-	qfile=0
-	for idx in "${COMP_WORDS[@]}"; do
-		[[ "$idx" = -q ]] && qfile=1 && break
-	done
-	if [[ $qfile == 1 ]]; then
-		len=${#cur}
-		idx=0
-		for pval in $( mailq | \
-			sed -e '1d; $d; /^[^0-9A-Z]\|^$/d; s/[* !].*$//' ); do
-			if [[ "$cur" == "${pval:0:$len}" ]]; then
-				COMPREPLY[$idx]=$pval
-				idx=$(($idx+1))
-			fi
-		done
-		return 0
-	else
-		_filedir
-		return 0
-	fi
-}
-complete -F _postcat postcat
-
-# postconf(1)
-#
-_postconf()
-{
-	local cur prev pval len idx eqext
-
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-	if [[ $cur == '-' ]]; then
-		COMPREPLY=(-c -d -e -h -m -l -n -v)
-		return 0
-	fi
-	if [[ $prev == '-c' ]]; then
-		_filedir -d
-		return 0
-	fi
-	if [[ $prev == '-e' ]]; then
-		cur=${cur#[\"\']}
-		eqext='='
-	fi
-	len=${#cur}
-	idx=0
-	for pval in $( /usr/sbin/postconf | cut -d ' ' -f 1 ); do
-		if [[ "$cur" == "${pval:0:$len}" ]]; then
-			COMPREPLY[$idx]="$pval$eqext"
-			idx=$(($idx+1))
-		fi
-	done
-	return 0
-}
-complete -F _postconf postconf
-
-# postsuper(1)
-#
-_postsuper()
-{
-	local cur prev pval len idx
-
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	if [[ $cur == '-' ]]; then
-		COMPREPLY=(-c -d -h -H -p -r -s -v)
-		return 0
-	fi
-	case $prev in
-	-[dr])
-		len=${#cur}
-		idx=0
-		for pval in $( echo ALL; mailq | \
-			sed -e '1d; $d; /^[^0-9A-Z]\|^$/d; s/[* !].*$//' ); do
-			if [[ "$cur" == "${pval:0:$len}" ]]; then
-				COMPREPLY[$idx]=$pval
-				idx=$(($idx+1))
-			fi
-		done
-		return 0
-		;;
-	-h)
-		len=${#cur}
-		idx=0
-		for pval in $( echo ALL; mailq | \
-			sed -e '1d; $d; /^[^0-9A-Z]\|^$/d; s/[* ].*$//; /!$/d' ); do
-			if [[ "$cur" == "${pval:0:$len}" ]]; then
-				COMPREPLY[$idx]=$pval
-				idx=$(($idx+1))
-			fi
-		done
-		return 0
-		;;
-	-H)
-		len=${#cur}
-		idx=0
-		for pval in $( echo ALL; mailq | \
-			sed -e '1d; $d; /^[^0-9A-Z]\|^$/d; /^[0-9A-Z]*[* ]/d; s/!.*$//' ); do
-			if [[ "$cur" == "${pval:0:$len}" ]]; then
-				COMPREPLY[$idx]=$pval
-				idx=$(($idx+1))
-			fi
-		done
-		return 0
-		;;
-	esac
-	COMPREPLY=( $( compgen -W 'hold incoming active deferred' -- $cur ) )
-	return 0
-}
-complete -F _postsuper postsuper
-}
-
-# cvs(1) completion
-#
-have cvs && {
-set_prefix()
-{
-	[ -z ${prefix:-} ] || prefix=${cur%/*}/
-	[ -r ${prefix:-}CVS/Entries ] || prefix=""
-}
-
-get_entries()
-{
-	local IFS=$'\n'
-	[ -r ${prefix:-}CVS/Entries ] && \
-	entries=$(cut -d/ -f2 -s ${prefix:-}CVS/Entries)
-}
-
-get_modules()
-{
-	if [ -n "$prefix" ]; then 
-		COMPREPLY=( $( command ls -d ${cvsroot}/${prefix}/!(CVSROOT) ) )
-	else
-		COMPREPLY=( $( command ls -d ${cvsroot}/!(CVSROOT) ) )
-	fi
-}
-
-_cvs()
-{
-	local cur count mode i cvsroot cvsroots pwd
-	local -a flags miss files entries changed newremoved
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	count=0
-	for i in "${COMP_WORDS[@]}"; do
-		[ $count -eq $COMP_CWORD ] && break
-		# Last parameter was the CVSROOT, now go back to mode selection
-		if [ "${COMP_WORDS[((count))]}" == "$cvsroot" -a "$mode" == "cvsroot" ]; then
-			mode=""
-		fi
-		if [ -z "$mode" ]; then
-			case $i in
-			-d)
-				mode=cvsroot
-				cvsroot=${COMP_WORDS[((count+1))]}
-				;;
-			@(ad?(d)|new))
-				mode=add
-				;;
-			@(adm?(in)|rcs))
-				mode=admin
-				;;
-			ann?(notate))
-				mode=annotate
-				;;
-			@(checkout|co|get))
-				mode=checkout
-				;;
-			@(com?(mit)|ci))
-				mode=commit
-				;;
-			di?(f?(f)))
-				mode=diff
-				;;
-			ex?(p?(ort)))
-				mode=export
-				;;
-			?(un)edit)
-				mode=$i
-				;;
-			hi?(s?(tory)))
-				mode=history
-				;;
-			im?(p?(ort)))
-				mode=import
-				;;
-			re?(l?(ease)))
-				mode=release
-				;;
-			?(r)log)
-				mode=log
-				;;
-			@(rdiff|patch))
-				mode=rdiff
-				;;
-			@(remove|rm|delete))
-				mode=remove
-				;;
-			@(rtag|rfreeze))
-				mode=rtag
-				;;
-			st?(at?(us)))
-				mode=status
-				;;
-			@(tag|freeze))
-				mode=tag
-				;;
-			up?(d?(ate)))
-				mode=update
-				;;
-			*)
-				;;
-			esac
-		elif [[ "$i" = -* ]]; then
-			flags=( "${flags[@]}" $i )
-		fi
-		count=$((++count))
-	done
-
-	case "$mode" in
-	add)
-		if [[ "$cur" != -* ]]; then
-			set_prefix
-			if [ $COMP_CWORD -gt 1 -a -r ${prefix:-}CVS/Entries ]; then
-				get_entries
-				[ -z "$cur" ] && \
-				files=$( command ls -Ad !(CVS) ) || \
-				files=$( command ls -d ${cur}* 2>/dev/null )
-				for i in "${entries[@]}"; do
-					files=( ${files[@]/#$i//} )
-				done
-				COMPREPLY=( $( compgen -W '${files[@]}' -- \
-					       $cur ) )
-			fi
-		else
-			COMPREPLY=( $( compgen -W '-k -m' -- $cur ) )
-		fi
-		;;
-	admin)
-		if [[ "$cur" = -* ]]; then
-			COMPREPLY=( $( compgen -W '-i -a -A -e -b -c -k -l -u \
-						   -L -U -m -M -n -N -o -q -I \
-						   -s -t -t- -T -V -x -z' -- \
-					$cur ) )
-		fi
-		;;
-	annotate)
-		if [[ "$cur" = -* ]]; then
-			COMPREPLY=( $( compgen -W '-D -F -f -l -R -r' -- $cur ) )
-		else
-			get_entries
-			COMPREPLY=( $( compgen -W '${entries[@]}' -- $cur ) )
-		fi
-		;;
-	checkout)
-		if [[ "$cur" != -* ]]; then
-			[ -z "$cvsroot" ] && cvsroot=$CVSROOT
-			COMPREPLY=( $( cvs -d "$cvsroot" co -c 2> /dev/null | \
-					awk '{print $1}' ) )
-			COMPREPLY=( $( compgen -W '${COMPREPLY[@]}' -- $cur ) )
-		else
-			COMPREPLY=( $( compgen -W '-A -N -P -R -c -f -l -n -p \
-						  -s -r -D -d -k -j' -- $cur ) )
-		fi
-		;;
-	commit)
-		set_prefix
-
-		if [[ "$cur" != -* ]] && [ -r ${prefix:-}CVS/Entries ]; then
-			# if $COMP_CVS_REMOTE is not null, 'cvs commit' will
-			# complete on remotely checked-out files (requires
-			# passwordless access to the remote repository
-			if [ -n "${COMP_CVS_REMOTE:-}" ]; then
-				# this is the least computationally intensive
-				# way found so far, but other changes
-				# (something other than changed/removed/new)
-				# may be missing
-				changed=( $( cvs -q diff --brief 2>&1 | \
-				sed -ne 's/^Files [^ ]* and \([^ ]*\) differ$/\1/p' ) )
-				newremoved=( $( cvs -q diff --brief 2>&1 | \
-				sed -ne 's/^cvs diff: \([^ ]*\) .*, no comparison available$/\1/p' ) )
-				COMPREPLY=( $( compgen -W '${changed[@]:-} \
-						   ${newremoved[@]:-}' -- $cur ) )
-			else
-				_filedir
-			fi
-		else
-			COMPREPLY=( $( compgen -W '-n -R -l -f -F -m -r' -- \
-				       $cur ) )
-		fi
-		;;
-	cvsroot)
-		if [ -r ~/.cvspass ]; then
-			# Ugly escaping because of bash treating ':' specially
-			cvsroots=$( sed 's/^[^ ]* //; s/:/\\:/g' ~/.cvspass )
-			COMPREPLY=( $( compgen -W '$cvsroots' -- $cur ) )
-		fi
-		;;
-	export)
-		if [[ "$cur" != -* ]]; then
-			[ -z "$cvsroot" ] && cvsroot=$CVSROOT
-			COMPREPLY=( $( cvs -d "$cvsroot" co -c | awk '{print $1}' ) )
-			COMPREPLY=( $( compgen -W '${COMPREPLY[@]}' -- $cur ) )
-		else
-			COMPREPLY=( $( compgen -W '-N -f -l -R -n \
-						  -r -D -d -k' -- $cur ) )
-		fi
-		;;
-	diff)
-		if [[ "$cur" == -* ]]; then
-			_longopt diff
-		else
-			get_entries
-			COMPREPLY=( $( compgen -W '${entries[@]:-}' -- $cur ) )
-		fi
-		;;
-	remove)
-		if [[ "$cur" != -* ]]; then
-			set_prefix
-			if [ $COMP_CWORD -gt 1 -a -r ${prefix:-}CVS/Entries ]; then
-				get_entries
-				# find out what files are missing
-				for i in "${entries[@]}"; do
-					[ ! -r "$i" ] && miss=( "${miss[@]}" $i )
-				done
-				COMPREPLY=( $(compgen -W '${miss[@]:-}' -- $cur) )
-			fi
-		else
-			COMPREPLY=( $( compgen -W '-f -l -R' -- $cur ) )
-		fi
-		;;
-	import)
-		if [[ "$cur" != -* ]]; then
-			# starts with same algorithm as checkout
-			[ -z "$cvsroot" ] && cvsroot=$CVSROOT
-			prefix=${cur%/*}
-			if [ -r ${cvsroot}/${prefix} ]; then
-				get_modules
-				COMPREPLY=( ${COMPREPLY[@]#$cvsroot} )
-				COMPREPLY=( ${COMPREPLY[@]#\/} )
-			fi
-			pwd=$( pwd )
-			pwd=${pwd##*/}
-			COMPREPLY=( $( compgen -W '${COMPREPLY[@]} $pwd' -- \
-				       $cur ) )
-		else
-			COMPREPLY=( $( compgen -W '-d -k -I -b -m -W' -- $cur ))
-		fi
-		;;
-	update)
-		if [[ "$cur" = -* ]]; then
-			COMPREPLY=( $( compgen -W '-A -P -C -d -f -l -R -p \
-						   -k -r -D -j -I -W' -- \
-						   $cur ) )
-		fi
-		;;
-	"")
-		COMPREPLY=( $( compgen -W 'add admin annotate checkout ci co \
-					   commit diff delete edit export \
-					   freeze get history import log new \
-					   patch rcs rdiff release remove \
-					   rfreeze rlog rm rtag stat status \
-					   tag unedit up update -H -Q -q -b \
-					   -d -e -f -l -n -t -r -v -w -x -z \
-					   --help --version' -- $cur ) )
-		;;
-	*)
-		;;
-	esac
-	
-	return 0
-}
-complete -F _cvs $default cvs
-}
-
-have rpm && {
-# helper functions for rpm completion
-#
-_rpm_installed_packages()
-{
-	local ver nodig nosig
-
-	if [ -r /var/log/rpmpkgs -a \
-		/var/log/rpmpkgs -nt /var/lib/rpm/Packages ]; then
-		# using RHL 7.2 or later - this is quicker than querying the DB
-		COMPREPLY=( $( sed -ne \
-		's|^\('$cur'.*\)-[0-9a-zA-Z._]\+-[0-9a-z.@]\+.*\.rpm$|\1|p' \
-				/var/log/rpmpkgs ) )
-	else
-		nodig=""
-		nosig=""
-		ver=$(rpm --version)
-		ver=${ver##* }
-	  
-		if [[ "$ver" > "4.0.4" ]]; then
-			nodig="--nodigest"
-		fi
-		if [[ "$ver" > "4.0.99" ]]; then
-			nosig="--nosignature"
-		fi
-
-		COMPREPLY=( $( rpm -qa $nodig $nosig | sed -ne \
-		's|^\('$cur'.*\)-[0-9a-zA-Z._]\+-[0-9a-z.@]\+$|\1|p' ) )
-	fi
-}
-
-_rpm_groups()
-{
-	local IFS=$'\t'
-	# remove trailing backslash, or grep will complain
-	cur=${cur%"\\"}
-	COMPREPLY=( $( rpm -qa $nodig $nosig --queryformat '%{group}\n' | \
-		       grep "^$cur" ) )
-	# backslash escape spaces and translate newlines to tabs
-	COMPREPLY=( $( echo "${COMPREPLY[@]}" | sed 's/ /\\ /g' | tr '\n' '\t' ) )
-}
-
-# rpm(8) completion
-# 
-_rpm()
-{
-	local cur prev ver nodig nosig
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-	nodig=""
-	nosig=""
-	ver=$(rpm --version); ver=${ver##* }
-  
-	if [[ "$ver" > "4.0.4" ]]; then
-		nodig="--nodigest"
-	fi
-	if [[ "$ver" > "4.0.99" ]]; then
-		nosig="--nosignature"
-	fi
-
-	if [ $COMP_CWORD -eq 1 ]; then
-		# first parameter on line
-		case "$cur" in
-		-b*)
-			COMPREPLY=( $( compgen -W '-ba -bb -bc -bi -bl -bp -bs'\
-				       -- $cur ) )
-			;;
-		-t*)
-			COMPREPLY=( $( compgen -W '-ta -tb -tc -ti -tl -tp -ts'\
-				       -- $cur ) )
-			;;
-		--*)
-			COMPREPLY=( $( compgen -W '--help --version --initdb \
-			--checksig --recompile --rebuild --resign --addsign \
-			--rebuilddb --showrc --setperms --setugids --tarbuild \
-			--eval --install --upgrade --query --freshen --erase \
-			--verify --querytags --rmsource --rmspec --clean \
-			--import' -- $cur ) )
-			;;
-		*)
-			COMPREPLY=( $( compgen -W '-b -e -F -i -q -t -U -V' \
-				       -- $cur ) )
-			;;
-		esac
-
-	return 0
-	fi
-
-	case "$prev" in
-	--@(@(db|exclude)path|prefix|relocate|root))
-		_filedir -d
-		return 0
-		;;
-	--eval)
-		# get a list of macros
-		COMPREPLY=( $( sed -ne 's|^\(%'${cur#\%}'[^ '$'\t'']*\).*$|\1|p' \
-			       /usr/lib/rpm/macros ) )
-		return 0
-		;;
-	--pipe)
-		COMPREPLY=( $( compgen -c -- $cur ) )
-		return 0
-		;;
-	--rcfile)
-		_filedir
-		return 0
-		;;
-	--specfile)
-		# complete on .spec files
-		_filedir spec
-		return 0
-		;;
-	--whatprovides)
-		if [[ "$cur" == */* ]]; then
-			_filedir
-		else
-		# complete on capabilities
-			COMPREPLY=( $( rpm -qa $nodig $nosig --queryformat \
-					'%{providename}\n' | grep "^$cur" ) )
-		fi
-		return 0
-		;;
-	--whatrequires)
-		# complete on capabilities
-		COMPREPLY=( $( rpm -qa $nodig $nosig --queryformat \
-				'%{requirename}\n' | grep "^$cur" ) )
-		return 0
-		;;
-	esac
-
-	case "${COMP_WORDS[1]}" in
-	-@([iFU]*|-install|-freshen|-upgrade))
-		if [[ "$cur" == -* ]]; then
-			COMPREPLY=( $( compgen -W '--percent --force --test \
-			--replacepkgs --replacefiles --root --excludedocs \
-			--includedocs --noscripts --rcfile --ignorearch \
-			--dbpath --prefix --ignoreos --nodeps --allfiles \
-			--ftpproxy --ftpport --justdb --httpproxy --httpport \
-			--noorder --relocate --badreloc --notriggers \
-			--excludepath --ignoresize --oldpackage --define \
-			--eval --pipe --queryformat --repackage --nosuggests \
-			--nodigest --nosignature' -- $cur ) )
-		else
-			_filedir 'rpm'
-		fi
-		;;
-	-@(e|-erase))
-		if [[ "$cur" == -* ]]; then
-			COMPREPLY=( $( compgen -W '--allmatches --noscripts \
-			--notriggers --nodeps --test --repackage' -- $cur ) )
-		else
-			_rpm_installed_packages
-		fi
-		;;
-	-@(q*|-query))
-		# check whether we're doing file completion
-		if [ "${COMP_LINE#* -*([^ -])f}" != "$COMP_LINE" ]; then
-		    if [[ "$cur" == -* ]]; then
-			COMPREPLY=( $( compgen -W '--scripts --root \
-				--rcfile --requires --ftpport --ftpproxy \
-				--httpproxy --httpport --provides --triggers \
-				--dump --changelog --dbpath \
-				--last --filesbypkg \
-				--info --list --state \
-				--docfiles --configfiles --queryformat \
-				--conflicts --obsoletes \
-				--nodigest --nosignature \
-				--triggerscripts' -- $cur ) )
-		    else
-			_filedir
-		    fi
-		elif [ "${COMP_LINE#* -*([^ -])g}" != "$COMP_LINE" ]; then
-			_rpm_groups
-		elif [ "${COMP_LINE#* -*([^ -])p}" != "$COMP_LINE" ]; then
-			# uninstalled package completion
-			if [[ "$cur" == -* ]]; then
-				COMPREPLY=( $( compgen -W '--scripts --root \
-				--rcfile --whatprovides --whatrequires \
-				--requires --triggeredby --ftpport --ftpproxy \
-				--httpproxy --httpport --provides --triggers \
-				--dump --changelog --dbpath --filesbypkg \
-				--define --eval --pipe --showrc --info --list \
-				--state --docfiles --configfiles --queryformat\
-				--conflicts --obsoletes --nodigest \
-				--nosignature' -- $cur ) )
-			else
-				_filedir 'rpm'
-			fi
-		else
-			# installed package completion
-			if [[ "$cur" == -* ]]; then
-				COMPREPLY=( $( compgen -W '--scripts --root \
-				--rcfile --whatprovides --whatrequires \
-				--requires --triggeredby --ftpport --ftpproxy \
-				--httpproxy --httpport --provides --triggers \
-				--dump --changelog --dbpath --specfile \
-				--querybynumber --last --filesbypkg --define \
-				--eval --pipe --showrc --info --list --state \
-				--docfiles --configfiles --queryformat \
-				--conflicts --obsoletes --pkgid --hdrid \
-				--fileid --tid --nodigest --nosignature \
-				--triggerscripts' -- $cur ) )
-			elif [ "${COMP_LINE#* -*([^ -])a}" == "$COMP_LINE" ]; then
-				_rpm_installed_packages
-			fi
-		fi
-		;;
-	-@(K*|-checksig))
-		if [[ "$cur" == -* ]]; then
-			COMPREPLY=( $( compgen -W '--nopgp --nogpg --nomd5 \
-					--nodigest --nosignature' -- $cur ) )
-		else
-			_filedir 'rpm'
-		fi
-		;;
-	-@([Vy]*|-verify))
-		if [[ "$cur" == -* ]]; then
-			COMPREPLY=( $( compgen -W '--root --rcfile --dbpath \
-			--nodeps --nogroup --nolinkto --nomode --nomtime \
-			--nordev --nouser --nofiles --noscripts --nomd5 \
-			--querytags --specfile --whatrequires --whatprovides \
-			--nodigest --nosignature' -- $cur ) )
-		# check whether we're doing file completion
-		elif [ "${COMP_LINE#* -*([^ -])f}" != "$COMP_LINE" ]; then
-			_filedir
-		elif [ "${COMP_LINE#* -*([^ -])g}" != "$COMP_LINE" ]; then
-			_rpm_groups
-		elif [ "${COMP_LINE#* -*([^ -])p}" != "$COMP_LINE" ]; then
-			_filedir 'rpm'
-		else
-			_rpm_installed_packages
-		fi
-		;;
-	-[bt]*)
-		if [[ "$cur" == -* ]]; then
-			COMPREPLY=( $( compgen -W '--short-circuit --timecheck \
-			--clean --rmsource --rmspec --test --sign --buildroot \
-			--target -- buildarch --buildos --nobuild --nodeps \
-			--nodirtokens' -- $cur ) )
-		elif [[ ${COMP_WORDS[1]} == -b* ]]; then
-			_filedir 'spec'
-		else
-			_filedir '@(tgz|tar.@(gz|bz2))'
-		fi
-		;;
-	--re@(build|compile))
-		if [[ "$cur" == -* ]]; then
-			COMPREPLY=( $( compgen -W '--nodeps --rmsource \
-			  --rmspec --sign --nodirtokens --target' -- $cur ) )
-		else
-			_filedir '?(no)src.rpm'
-		fi
-		;;
-	--tarbuild)
-		_filedir '@(tgz|tar.@(gz|bz2))'
-		;;
-	--@(re|add)sign)
-		_filedir 'rpm'
-		;;
-	--set@(perms|gids))
-		_rpm_installed_packages
-		;;
-	--@(clean|rms@(ource|pec)))
-		if [[ "$cur" == -* ]]; then
-			COMPREPLY=( $( compgen -W '--clean --rmsource \
-					--rmspec' -- $cur ) )
-		else
-			_filedir 'spec'
-		fi
-		;;
-	--@(import|dbpath|root))
-		if [[ "$cur" == -* ]]; then
-			COMPREPLY=( $( compgen -W '--import --dbpath --root' \
-					-- $cur ) )
-		else
-			_filedir
-		fi
-		;;
-	esac
-
-	return 0
-}
-complete -F _rpm $filenames rpm rpmbuild
-}
-
-# Debian apt-get(8) completion.
-#
-have apt-get &&
-_apt_get()
-{
-	local cur prev special i
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	for (( i=0; i < ${#COMP_WORDS[@]}-1; i++ )); do
-		if [[ ${COMP_WORDS[i]} == @(install|remove|purge|source|build-dep) ]]; then
-			special=${COMP_WORDS[i]}
-		fi
-	done
-
-	if [ -n "$special" ]; then
-		case $special in
-		remove|purge)
-			if [ -f /etc/debian_version ]; then
-				# Debian system
-				COMPREPLY=( $( _comp_dpkg_installed_packages \
-						$cur ) )
-			else
-				# assume RPM based
-				_rpm_installed_packages
-			fi
-			return 0
-			;;
-		*)
-			COMPREPLY=( $( apt-cache pkgnames $cur 2> /dev/null ) )
-			return 0
-			;;
-
-		esac
-	fi
-
-	case "$prev" in
-	    -@(c|-config-file))
- 		     _filedir
-		     return 0
-		     ;;
-
-	    -@(t|-target-release|-default-release))
-		     COMPREPLY=( $( apt-cache policy | \
-				    grep "release.o=Debian,a=$cur" | \
-				    sed -e "s/.*a=\(\w*\).*/\1/" | uniq 2> /dev/null) )
-		     return 0
-		     ;;
- 
-	esac
-
-	if [[ "$cur" == -* ]]; then
-
-		COMPREPLY=( $( compgen -W '-d -f -h -v -m -q -s -y \
-				-u -t -b -c -o --download-only --fix-broken \
-				--help --version --ignore-missing \
-				--fix-missing --no-download --quiet --simulate \
-				--just-print --dry-run --recon --no-act --yes \
-				--assume-yes --show-upgraded --only-source \
-				--compile --build --ignore-hold \
-				--target-release --no-upgrade --force-yes \
-				--print-uris --purge --reinstall \
-				--list-cleanup --default-release \
-				--trivial-only --no-remove --diff-only \
-				--tar-only --config-file --option --auto-remove' -- $cur ) )
-	else
-
-		COMPREPLY=( $( compgen -W 'update upgrade dselect-upgrade \
-				dist-upgrade install remove purge source \
-				build-dep check clean autoclean autoremove' \
-				-- $cur ) )
-
-	fi
-
-
-	return 0
-} &&
-complete -F _apt_get $filenames apt-get
-
-# Debian apt-cache(8) completion.
-#
-have apt-cache &&
-_apt_cache()
-{
-	local cur prev special i
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	
-	if [ "$cur" != show ]; then
-	    for (( i=0; i < ${#COMP_WORDS[@]}-1; i++ )); do
-		if [[ ${COMP_WORDS[i]} == @(add|depends|dotty|policy|rdepends|madison|show?(pkg|src|)) ]]; then
-		    special=${COMP_WORDS[i]}
-		fi
-	    done
-	fi
-
-
-	if [ -n "$special" ]; then
-	    case $special in
-		add)
-		    _filedir
-		    return 0
-		    ;;
-		
- 		*)
-		    COMPREPLY=( $( apt-cache pkgnames $cur 2> /dev/null ) )
-		    return 0
-		    ;;
-		
-	    esac
-	fi
-
-
-	case "$prev" in
-	     -@(c|p|s|-config-file|-@(pkg|src)-cache))
-		     _filedir
-		     return 0
-		     ;;
-	     search)
-		     if [[ "$cur" != -* ]]; then
-			    return 0
-		     fi
-		     ;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-
-		COMPREPLY=( $( compgen -W '-h -v -p -s -q -i -f -a -g -c \
-				-o --help --version --pkg-cache --src-cache \
-				--quiet --important --full --all-versions \
-				--no-all-versions --generate --no-generate \
-				--names-only --all-names --recurse \
-				--config-file --option' -- $cur ) )
-	else
-
-		COMPREPLY=( $( compgen -W 'add gencaches show showpkg showsrc \
-				stats dump dumpavail unmet search search \
-				depends rdepends pkgnames dotty xvcg \
-				policy madison' -- $cur ) )
-
-	fi
-
-
-	return 0
-} &&
-complete -F _apt_cache $filenames apt-cache
-
-
-# Debian aptitude(1) completion
-#
-have aptitude && {
-have grep-status && {
-_comp_dpkg_hold_packages()
-{
-	grep-status -P -e "^$1" -a -FStatus 'hold' -n -s Package
-}
-} || {
-_comp_dpkg_hold_packages()
-{
-	grep -B 2 'hold' /var/lib/dpkg/status | grep "Package: $1" \
-		| cut -d\  -f2
-}
-}
-
-_aptitude()
-{
-	local cur dashoptions prev special i
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-
-	dashoptions='-S -u -i -h --help --version -s --simulate -d \
-		     --download-only -P --prompt -y --assume-yes -F \
-		     --display-format -O --sort -w --width -f -r -g \
-		     --with-recommends --with-suggests -R -G \
-		     --without-recommends --without-suggests -t \
-		     --target-release -V --show-versions -D --show-deps\
-		     -Z -v --verbose --purge-unused'
-
-	for (( i=0; i < ${#COMP_WORDS[@]}-1; i++ )); do
-	    if [[ ${COMP_WORDS[i]} == @(install|reinstall|hold|unhold|markauto|unmarkauto|dist-upgrade|full-upgrade|download|show|forbid-version|purge|remove|changelog|why|why-not|keep|keep-all) ]]; then
-		special=${COMP_WORDS[i]}
-	    fi
-	    #exclude some mutually exclusive options
-	    [[ ${COMP_WORDS[i]} == '-u' ]] && dashoptions=${dashoptions/-i}
-	    [[ ${COMP_WORDS[i]} == '-i' ]] && dashoptions=${dashoptions/-u}
-	done
-
-	if [[ -n "$special" ]]; then
-	   case $special in
-	       @(install|hold|markauto|unmarkauto|dist-upgrade|full-upgrade|download|show|changelog|why|why-not))
-		   COMPREPLY=( $( apt-cache pkgnames $cur 2> /dev/null ) )
-		   return 0
-		   ;;
-	       @(purge|remove|reinstall|forbid-version))
-  		   COMPREPLY=( $( _comp_dpkg_installed_packages $cur ) )
-		   return 0
-		   ;;
-	       unhold)
-  		   COMPREPLY=( $( _comp_dpkg_hold_packages $cur ) )
-		   return 0
-		   ;;
-
-	   esac
-	fi
-
-	case $prev in
-	    # don't complete anything if these options are found
-	    @(autoclean|clean|forget-new|search|upgrade|safe-upgrade|update|keep-all))
-		return 0
-		;;
-
-	    -S)
-		_filedir
-		return 0
-		;;
-
-	    -@(t|-target-release|-default-release))
-		COMPREPLY=( $( apt-cache policy | \
-		    grep "release.o=Debian,a=$cur" | \
-		    sed -e "s/.*a=\(\w*\).*/\1/" | uniq 2> /dev/null ) )
-		return 0
-		;;
-
-	esac
-
-	if [[ "$cur" == -* ]]; then
-	    COMPREPLY=( $( compgen -W "$dashoptions" -- $cur ) )
-	else
-	    COMPREPLY=( $( compgen -W 'update upgrade safe-upgrade forget-new clean \
-				       autoclean install reinstall remove \
-				       hold unhold purge markauto unmarkauto why why-not \
-				       dist-upgrade full-upgrade download search show \
-				       forbid-version changelog keep-all' -- $cur ) )
-	fi
-
-
-	return 0
-}
-complete -F _aptitude $default aptitude
-}
-
-# Debian apt-build(1) completion.
-#
-have apt-build &&
-_apt_build()
-{
-	local cur prev special i
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	for (( i=0; i < ${#COMP_WORDS[@]}-1; i++ )); do
-		if [[ ${COMP_WORDS[i]} == @(install|remove|source|info|clean) ]]; then
-			special=${COMP_WORDS[i]}
-		fi
-	done
-
-	if [ -n "$special" ]; then
-		case $special in
-		@(install|source|info))
-			COMPREPLY=( $( apt-cache pkgnames $cur 2> /dev/null ) )
-			return 0
-			;;
-		remove)
-			COMPREPLY=( $( _comp_dpkg_installed_packages \
-					$cur ) )
-			return 0
-			;;
-		*)
-			return 0
-			;;
-		esac
-	fi
-
-	case "$prev" in
-
-	     --@(patch|build-dir|repository-dir))
-		   _filedir
-		   return 0
-		   ;;
- 
-	     -@(h|-help))
-		   return 0
-		   ;;
-
-	esac
-
-	if [[ "$cur" == -* ]]; then
-	    COMPREPLY=( $( compgen -W '--help --show-upgraded -u --build-dir \
-				  --repository-dir --build-only \
-				  --build-command --reinstall --rebuild \
-				  --remove-builddep --no-wrapper --purge \
-				  --patch --patch-strip -p --yes -y \
-				  --version -v --no-source' -- $cur ) )
-
-	else
-	    COMPREPLY=( $( compgen -W 'update upgrade install remove \
-				  source dist-upgrade world clean info \
-				  clean-build update-repository ' -- $cur ) )
-	fi
-
-
-	return 0
-} &&
-complete -F _apt_build $filenames apt-build
-
-# chsh(1) completion
-#
-_chsh()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	if [ "$prev" = "-s" ]; then
-	  if [ -f /etc/debian_version ]; then
-	    COMPREPLY=( $( </etc/shells ) )
-	  else
-	    COMPREPLY=( $( chsh -l | grep "^$cur" ) )
-	  fi
-	else
-	  COMPREPLY=( $( compgen -u -- $cur ) )
-	fi
-
-	return 0
-}
-complete -F _chsh chsh
-
-# chkconfig(8) completion
-#
-have chkconfig &&
-_chkconfig()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-	@([1-6]|--@(list|add|del)))
-		_services
-		return 0
-		;;
-	--level)
-		COMPREPLY=( $( compgen -W '1 2 3 4 5 6' -- $cur ) )
-		return 0
-		;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '--list --add --del --level' -- $cur ) )
-	else
-		if [ $COMP_CWORD -eq 2 -o $COMP_CWORD -eq 4 ]; then
-			COMPREPLY=( $( compgen -W 'on off reset' -- $cur ) )
-		else
-			_services
-		fi
-	fi
-} &&
-complete -F _chkconfig chkconfig
-
-# This function provides simple user@host completion
-#
-_user_at_host() {
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [[ $cur == *@* ]]; then
-		_known_hosts
-	else
-		COMPREPLY=( $( compgen -u -- "$cur" ) )
-	fi
-
-	return 0
-}
-shopt -u hostcomplete && complete -F _user_at_host $nospace talk ytalk finger
-
-# This function performs host completion based on ssh's known_hosts files,
-# defaulting to standard host completion if they don't exist.
-#
-_known_hosts()
-{
-       local cur curd ocur user suffix aliases global_kh user_kh hosts i host
-       local -a kh khd config
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	ocur=$cur
-
-	[ "$1" = -a ] || [ "$2" = -a ] && aliases='yes'
-	[ "$1" = -c ] || [ "$2" = -c ] && suffix=':'
-	[[ $cur == *@* ]] && user=${cur%@*}@ && cur=${cur#*@}
-	kh=()
-
-	# ssh config files
-	[ -r /etc/ssh/ssh_config ] &&
-	  config=( "${config[@]}" "/etc/ssh/ssh_config" )
-	[ -r "${HOME}/.ssh/config" ] &&
-	  config=( "${config[@]}" "${HOME}/.ssh/config" )
-	[ -r "${HOME}/.ssh2/config" ] &&
-	  config=( "${config[@]}" "${HOME}/.ssh2/config" )
-
-	if [ ${#config[@]} -gt 0 ]; then
-	    # expand path (if present) to global known hosts file
-	    global_kh=$( eval echo $( sed -ne 's/^[ \t]*[Gg][Ll][Oo][Bb][Aa][Ll][Kk][Nn][Oo][Ww][Nn][Hh][Oo][Ss][Tt][Ss][Ff][Ii][Ll][Ee]['"$'\t '"']*\(.*\)$/\1/p' "${config[@]}" ) )
-	    # expand path (if present) to user known hosts file
-	    user_kh=$( eval echo $( sed -ne 's/^[ \t]*[Uu][Ss][Ee][Rr][Kk][Nn][Oo][Ww][Nn][Hh][Oo][Ss][Tt][Ss][Ff][Ii][Ll][Ee]['"$'\t '"']*\(.*\)$/\1/p' "${config[@]}" ) )
-	fi
-
-	# Global known_hosts files
-	[ -r "$global_kh" ] &&
-	    kh=( "${kh[@]}" "$global_kh" )
-	[ -r /etc/ssh/ssh_known_hosts ] &&
-	    kh=( "${kh[@]}" /etc/ssh/ssh_known_hosts )
-	[ -r /etc/ssh/ssh_known_hosts2 ] &&
-	    kh=( "${kh[@]}" /etc/ssh/ssh_known_hosts2 )
-	[ -r /etc/known_hosts ] &&
-	    kh=( "${kh[@]}" /etc/known_hosts )
-	[ -r /etc/known_hosts2 ] &&
-	    kh=( "${kh[@]}" /etc/known_hosts2 )
-	[ -d /etc/ssh2/knownhosts ] &&
-	    khd=( "${khd[@]}" /etc/ssh2/knownhosts/*pub )
-
-	# User known_hosts files
-	[ -r "$user_kh" ] &&
-	    kh=( "${kh[@]}" "$user_kh" )
-	[ -r ~/.ssh/known_hosts ] &&
-	    kh=( "${kh[@]}" ~/.ssh/known_hosts )
-	[ -r ~/.ssh/known_hosts2 ] &&
-	    kh=( "${kh[@]}" ~/.ssh/known_hosts2 )
-	[ -d ~/.ssh2/hostkeys ] &&
-	    khd=( "${khd[@]}" ~/.ssh2/hostkeys/*pub )
-
-	# If we have known_hosts files to use
-	if [ ${#kh[@]} -gt 0 -o ${#khd[@]} -gt 0 ]; then
-	    # Escape slashes and dots in paths for awk
-	    cur=${cur//\//\\\/}
-	    cur=${cur//\./\\\.}
-	    curd=$cur
-
-	    if [[ "$cur" == [0-9]*.* ]]; then
-		# Digits followed by a dot - just search for that
-		cur="^$cur.*"
-	    elif [[ "$cur" == [0-9]* ]]; then
-		# Digits followed by no dot - search for digits followed
-		# by a dot
-		cur="^$cur.*\."
-	    elif [ -z "$cur" ]; then
-		# A blank - search for a dot or an alpha character
-		cur="[a-z.]"
-	    else
-		cur="^$cur"
-	    fi
-
-	    if [ ${#kh[@]} -gt 0 ]; then
-
-		# FS needs to look for a comma separated list
-		COMPREPLY=( $( awk 'BEGIN {FS=","}
-				/^[^|]/ {for (i=1; i<=2; ++i) { \
-				       gsub(" .*$", "", $i); \
-				       if ($i ~ /'$cur'/) {print $i} \
-				}}' "${kh[@]}" 2>/dev/null ) )
-	    fi
-	    if [ ${#khd[@]} -gt 0 ]; then
-		# Needs to look for files called
-		# .../.ssh2/key_22_<hostname>.pub
-		# dont fork any processes, because in a cluster environment, 
-		# there can be hundreds of hostkeys
-		for i in "${khd[@]}" ; do
-		    if [[ "$i" == *key_22_$curd*.pub ]] && [ -r "$i" ] ; then
-			host=${i/#*key_22_/}
-			host=${host/%.pub/}
-			COMPREPLY=( "${COMPREPLY[@]}" $host )
-		    fi
-		done
-	    fi
-
-	    # append any available aliases from config files
-	    if [ ${#config[@]} -gt 0 ] && [ -n "$aliases" ]; then
-		local host_aliases=$( sed -ne 's/^[Hh][Oo][Ss][Tt]\([Nn][Aa][Mm][Ee]\)\?['"$'\t '"']\+\([^*?]*\)$/\2/p' "${config[@]}" )
-		hosts=$( compgen -W "$host_aliases" -- $ocur )
-		COMPREPLY=( "${COMPREPLY[@]}" $hosts )
-	    fi
-
-	    # Now add results of normal hostname completion
-	    COMPREPLY=( "${COMPREPLY[@]}" $( compgen -A hostname -- $ocur ) )
-
-	    # apply suffix
-	    for (( i=0; i < ${#COMPREPLY[@]}; i++ )); do
-		COMPREPLY[i]=$user${COMPREPLY[i]}$suffix
-	    done
-	else
-	    # Just do normal hostname completion
-	    COMPREPLY=( $( compgen -A hostname -S "$suffix" -- $cur ) )
-	fi
-
-	return 0
-}
-complete -F _known_hosts traceroute traceroute6 tracepath tracepath6 \
-	ping ping6 fping fping6 telnet host nslookup rsh rlogin ftp dig ssh-installkeys mtr
-
-# ssh(1) completion
-#
-have ssh && {
-_ssh()
-{
-	local cur prev
-	local -a config
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-	-*c)
-	    COMPREPLY=( $( compgen -W 'blowfish 3des 3des-cbc blowfish-cbc \
-			   arcfour cast128-cbc' -- $cur ) )
-	    ;;
-	-*i)
-	    _filedir
-	    ;;
-	-*l)
-	    COMPREPLY=( $( compgen -u -- $cur ) )
-	    ;;
-	*)
-	    _known_hosts -a
-
-	    [ $COMP_CWORD -eq 1 ] || \
-		COMPREPLY=( "${COMPREPLY[@]}" $( compgen -c -- $cur ) )
-	esac
-
-	return 0
-}
-shopt -u hostcomplete && complete -F _ssh ssh slogin sftp xhost autossh
-
-# scp(1) completion
-#
-_scp()
-{
-	local cur userhost path
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	_expand || return 0
-
-	if [[ "$cur" == *:* ]]; then
-		local IFS=$'\t\n'
-		# remove backslash escape from :
-		cur=${cur/\\:/:}
-		userhost=${cur%%?(\\):*}
-		path=${cur#*:}
-		# unescape spaces
-		path=${path//\\\\\\\\ / }
-		if [ -z "$path" ]; then
-			# default to home dir of specified user on remote host
-			path=$(ssh -o 'Batchmode yes' $userhost pwd 2>/dev/null)
-		fi
-		# escape spaces; remove executables, aliases, pipes and sockets;
-		# add space at end of file names
-		COMPREPLY=( $( ssh -o 'Batchmode yes' $userhost \
-			       command ls -aF1d "$path*" 2>/dev/null | \
-			       sed -e "s/[][(){}<>\",:;^&!$&=?\`|\\ ']/\\\\\\\\\\\\&/g" \
-				   -e 's/[*@|=]$//g' -e 's/[^\/]$/& /g' ) )
-		return 0
-	fi
-
-	[[ "$cur" == */* ]] || _known_hosts -c -a
-		local IFS=$'\t\n'
-		COMPREPLY=( "${COMPREPLY[@]}" $( command ls -aF1d $cur* \
-			    2>/dev/null | sed \
-			    -e "s/[][(){}<>\",:;^&!$&=?\`|\\ ']/\\\\&/g" \
-			    -e 's/[*@|=]$//g' -e 's/[^\/]$/& /g' ) )
-	return 0
-}
-complete -F _scp $nospace scp
-}
-
-# rsync(1) completion
-#
-have rsync &&
-_rsync()
-{
-	local cur prev shell i userhost path
- 
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	_expand || return 0
-
-	case "$prev" in
-	--@(config|password-file|include-from|exclude-from))
-		_filedir
-		return 0
-		;;
-	-@(T|-temp-dir|-compare-dest))
-		_filedir -d
-		return 0
-		;;
-	-@(e|-rsh))
-		COMPREPLY=( $( compgen -W 'rsh ssh' -- $cur ) )
-		return 0
-		;;
-	esac
- 
-	case "$cur" in
-	-*)
-		COMPREPLY=( $( compgen -W '-v -q  -c -a -r -R -b -u -l -L -H \
-				-p -o -g -D -t -S -n -W -x -B -e -C -I -T -P \
-				-z -h -4 -6 --verbose --quiet --checksum \
-				--archive --recursive --relative --backup \
-				--backup-dir --suffix= --update --links \
-				--copy-links --copy-unsafe-links --safe-links \
-				--hard-links --perms --owner --group --devices\
-				--times --sparse --dry-run --whole-file \
-				--no-whole-file --one-file-system \
-				--block-size= --rsh= --rsync-path= \
-				--cvs-exclude --existing --ignore-existing \
-				--delete --delete-excluded --delete-after \
-				--ignore-errors --max-delete= --partial \
-				--force --numeric-ids --timeout= \
-				--ignore-times --size-only --modify-window= \
-				--temp-dir= --compare-dest= --compress \
-				--exclude= --exclude-from= --include= \
-				--include-from= --version --daemon --no-detach\
-				--address= --config= --port= --blocking-io \
-				--no-blocking-io --stats --progress \
-				--log-format= --password-file= --bwlimit= \
-				--write-batch= --read-batch= --help' -- $cur ))
-		;;
-	*:*)
-		# find which remote shell is used
-		shell=rsh
-		for (( i=1; i < COMP_CWORD; i++ )); do
-			if [[ "${COMP_WORDS[i]}" == -@(e|-rsh) ]]; then
-				shell=${COMP_WORDS[i+1]}
-				break
-			fi
-		done
-		if [[ "$shell" == ssh ]]; then
-			# remove backslash escape from :
-			cur=${cur/\\:/:}
-			userhost=${cur%%?(\\):*}
-			path=${cur#*:}
-			# unescape spaces
-			path=${path//\\\\\\\\ / }
-			if [ -z "$path" ]; then
-				# default to home dir of specified
-				# user on remote host
-				path=$(ssh -o 'Batchmode yes' \
-					$userhost pwd 2>/dev/null)
-			fi
-			# escape spaces; remove executables, aliases, pipes
-			# and sockets; add space at end of file names
-			COMPREPLY=( $( ssh -o 'Batchmode yes' $userhost \
-				command ls -aF1d "$path*" 2>/dev/null | \
-				sed -e 's/ /\\\\\\\ /g' -e 's/[*@|=]$//g' \
-				-e 's/[^\/]$/& /g' ) )
-		fi
-		;;
-	*)
-		_known_hosts -c -a
-		_filedir
-		;;
-	esac
- 
-	return 0
-} &&
-complete -F _rsync $nospace $filenames rsync
-
-# Linux route(8) completion
-#
-[ $UNAME = Linux ] &&
-_route()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	if [ "$prev" = dev ]; then
-	    COMPREPLY=( $( ifconfig -a | sed -ne 's|^\('$cur'[^ ]*\).*$|\1|p' ))
-	    return 0
-	fi
-
-	COMPREPLY=( $( compgen -W 'add del -host -net netmask metric mss \
-				   window irtt reject mod dyn reinstate dev \
-				   default gw' -- $cur ) )
-
-	COMPREPLY=( $( echo " ${COMP_WORDS[@]}" | \
-		       (while read -d ' ' i; do
-			   [ "$i" == "" ] && continue
-			   # flatten array with spaces on either side,
-			   # otherwise we cannot grep on word
-			   # boundaries of first and last word
-			   COMPREPLY=" ${COMPREPLY[@]} "
-			   # remove word from list of completions
-			   COMPREPLY=( ${COMPREPLY/ $i / } )
-			done
-		       echo "${COMPREPLY[@]}")
-		  ) )
-	return 0
-}
-[ $UNAME = Linux ] && complete -F _route route
-
-# GNU make(1) completion
-#
-have make || have gmake || have gnumake || have pmake &&
-_make()
-{
-	local file makef makef_dir="." makef_inc cur prev i
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	# --name value style option
-	case $prev in
-		-@(f|o|W))
-			_filedir
-			return 0
-			;;
-		-@(I|C))
-			_filedir -d
-			return 0
-			;;
-	esac
-
-	# --name=value style option
-	if [[ "$cur" == *=* ]]; then
-		prev=${cur/=*/}
-		cur=${cur/*=/}
-		case "$prev" in
-			--@(file|makefile))
-				_filedir
-				return 0
-				;;
-			--@(directory|include-dir))
-				_filedir -d
-				return 0
-				;;
-		esac
-	fi
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-b -m -B -C -d -e -f -h -i -I\
-			-j -l -k -n -o -p -q -r -R - s -S -t -v -w -W \
-			--always-make --directory= --debug \
-			--environment-overrides --file= --makefile= --help \
-			--ignore-errors --include-dir= --jobs --load-average \
-			--max-load --keep-going --just-print --dry-run \
-			--recon --old-file= --assume-old= --print-data-base \
-			--question --no-builtin-rules --no-builtin-variables \
-			--silent --quiet --no-keep-goind --stop --touch \
-			--version --print-directory --no-print-directory \
-			--what-if= --new-file= --assume-new= \
-			--warn-undefined-variables' -- $cur ) )
-	else
-		# before we check for makefiles, see if a path was specified
-		# with -C
-		for (( i=0; i < ${#COMP_WORDS[@]}; i++ )); do
-			if [[ ${COMP_WORDS[i]} == -C ]]; then
-				# eval for tilde expansion
-				eval makef_dir=${COMP_WORDS[i+1]}
-				break
-			fi
-		done
-
-		# make reads `GNUmakefile', then `makefile', then `Makefile'
-		if [ -f ${makef_dir}/GNUmakefile ]; then
-			makef=${makef_dir}/GNUmakefile
-		elif [ -f ${makef_dir}/makefile ]; then
-			makef=${makef_dir}/makefile
-		elif [ -f ${makef_dir}/Makefile ]; then
-			makef=${makef_dir}/Makefile
-		else
-			makef=${makef_dir}/*.mk	       # local convention
-		fi
-
-		# before we scan for targets, see if a Makefile name was
-		# specified with -f
-		for (( i=0; i < ${#COMP_WORDS[@]}; i++ )); do
-			if [[ ${COMP_WORDS[i]} == -f ]]; then
-				# eval for tilde expansion
-				eval makef=${COMP_WORDS[i+1]}
-				break
-			fi
-		done
-
-		[ ! -f $makef ] && return 0
-
-		# deal with included Makefiles
- 		makef_inc=$( grep -E '^-?include' $makef | sed -e "s,^.* ,"$makef_dir"/," )
-
- 		for file in $makef_inc; do
- 			[ -f $file ] && makef="$makef $file"
- 		done
-
-		COMPREPLY=( $( awk -F':' '/^[a-zA-Z0-9][^$#\/\t=]*:([^=]|$)/ \
-				{split($1,A,/ /);for(i in A)print A[i]}' \
-				$makef 2>/dev/null | command grep "^$cur" ))
-	fi
-} &&
-complete -f -F _make $filenames make gmake gnumake pmake
-
-# GNU tar(1) completion
-#
-_tar()
-{
-	local cur ext regex tar untar
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [ $COMP_CWORD -eq 1 ]; then
-		COMPREPLY=( $( compgen -W 'c t x u r d A' -- $cur ) )
-		return 0
-	fi
-
-	case "${COMP_WORDS[1]}" in
-	?(-)[cr]*f)
-		_filedir
-		return 0
-		;;
-	+([^IZzjy])f)
-		ext='t@(ar?(.@(Z|gz|bz?(2)))|gz|bz?(2))'
-		regex='t\(ar\(\.\(Z\|gz\|bz2\?\)\)\?\|gz\|bz2\?\)'
-		;;
-	*[Zz]*f)
-		ext='t?(ar.)@(gz|Z)'
-		regex='t\(ar\.\)\?\(gz\|Z\)'
-		;;
-	*[Ijy]*f)
-		ext='t?(ar.)bz?(2)'
-		regex='t\(ar\.\)\?bz2\?'
-		;;
-	*)
-		_filedir
-		return 0
-		;;
-		
-	esac
-
-	if [[ "$COMP_LINE" == *$ext' ' ]]; then
-		# complete on files in tar file
-		#
-		# get name of tar file from command line
-		tar=$( echo "$COMP_LINE" | \
-			sed -e 's/^.* \([^ ]*'$regex'\) .*$/\1/' )
-		# devise how to untar and list it
-		untar=t${COMP_WORDS[1]//[^Izjyf]/}
-
-		COMPREPLY=( $( compgen -W "$( echo $( tar $untar $tar \
-				2>/dev/null ) )" -- "$cur" ) )
-		return 0
-	fi
-
-	# file completion on relevant files
-	_filedir "$ext"
-
-	return 0
-}
-[ -n "${COMP_TAR_INTERNAL_PATHS:-}" ] && complete -F _tar $dirnames tar ||
-	complete -F _tar $filenames tar
-
-# jar(1) completion
-#
-have jar &&
-_jar()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [ $COMP_CWORD = 1 ]; then
-		COMPREPLY=( $( compgen -W 'c t x u' -- $cur ) )
-		return 0
-	fi
-
-	case "${COMP_WORDS[1]}" in
-		*c*f)
-			_filedir
-			;;
-		*f)
-			_filedir '?(e|j|w)ar'
-			;;
-		*)
-			_filedir
-			;;
-	esac
-} &&
-complete -F _jar $filenames jar
-
-# Linux iptables(8) completion
-#
-have iptables &&
-_iptables()
-{
-	local cur prev table chain
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-	chain='s/^Chain \([^ ]\+\).*$/\1/p'
-
-	if [[ $COMP_LINE == *-t\ *filter* ]]; then
-		table="-t filter"
-	elif [[ $COMP_LINE == *-t\ *nat* ]]; then
-		table="-t nat"
-	elif [[ $COMP_LINE == *-t\ *mangle* ]]; then
-		table="-t mangle"
-	fi
-
-	case "$prev" in
-	-*[AIDRPFXLZ])
-		COMPREPLY=( $( compgen -W '`iptables $table -nL | \
-			    sed -ne "s/^Chain \([^ ]\+\).*$/\1/p"`' -- $cur ) )
-		;;
-	-*t)
-		COMPREPLY=( $( compgen -W 'nat filter mangle' -- $cur ) )
-		;;
-	-j)
-		if [ "$table" = "-t filter" -o "$table" = "" ]; then
-		    COMPREPLY=( $( compgen -W 'ACCEPT DROP LOG ULOG REJECT \
-		    `iptables $table -nL | sed -ne "$chain" \
-		    -e "s/INPUT|OUTPUT|FORWARD|PREROUTING|POSTROUTING//"`' -- \
-		    $cur ) )
-		elif [ "$table" = "-t nat" ]; then
-		    COMPREPLY=( $( compgen -W 'ACCEPT DROP LOG ULOG REJECT \
-		    MIRROR SNAT DNAT MASQUERADE `iptables $table -nL | \
-		    sed -ne "$chain" -e "s/OUTPUT|PREROUTING|POSTROUTING//"`' \
-		    -- $cur ) )
-		elif [ "$table" = "-t mangle" ]; then
-		    COMPREPLY=( $( compgen -W 'ACCEPT DROP LOG ULOG REJECT \
-		    MARK TOS `iptables $table -nL | sed -ne "$chain" \
-		    -e "s/INPUT|OUTPUT|FORWARD|PREROUTING|POSTROUTING//"`' -- \
-		    $cur ) )
-		fi
-		;;
-	*)
-		if [[ "$cur" == -* ]]; then
-		    COMPREPLY=( $( compgen -W '-i -o -s -d -p -f -m --append \
-		    --delete --insert --replace --list --flush --zero --new \
-		    --delete-chain --policy --rename-chain --proto --source \
-		    --destination --in-interface --jump --match --numeric \
-		    --out-interface --table --verbose --line-numbers --exact \
-		    --fragment --modprobe= --set-counters --version' -- "$cur") )
-		fi
-		;;
-	esac
-
-} &&
-complete -F _iptables iptables
-
-# tcpdump(8) completion
-#
-have tcpdump &&
-_tcpdump()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(r|w|F))
-			_filedir
-			return 0
-			;;
-		-i)
-			_available_interfaces -a
-			return 0
-			;;
-	esac
-
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-a -d -e -f -l -n -N -O -p \
-			-q -R -S -t -u -v -x -C -F -i -m -r -s -T -w \
-			-E' -- $cur ) )
-	fi
-
-} &&
-complete -F _tcpdump tcpdump
-
-# autorpm(8) completion
-#
-have autorpm &&
-_autorpm()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	COMPREPLY=( $( compgen -W '--notty --debug --help --version \
-				   auto add fullinfo info help install list \
-				   remove set' -- $cur ) )
-
-} &&
-complete -F _autorpm autorpm
-
-# This meta-cd function observes the CDPATH variable, so that cd additionally
-# completes on directories under those specified in CDPATH.
-#
-_cd()
-{
-	local IFS=$'\t\n' cur=`_get_cword` i j k
-
-	# try to allow variable completion
-	if [[ "$cur" == ?(\\)\$* ]]; then
-		COMPREPLY=( $( compgen -v -P '$' -- "${cur#?(\\)$}" ) )
-		return 0
-	fi
-
-	# Use standard dir completion if no CDPATH or parameter starts with /,
-	# ./ or ../
-	if [ -z "${CDPATH:-}" ] || [[ "$cur" == ?(.)?(.)/* ]]; then
-		_filedir -d
-		return 0
-	fi
-
-	local -r mark_dirs=$(_rl_enabled mark-directories && echo y)
-	local -r mark_symdirs=$(_rl_enabled mark-symlinked-directories && echo y)
-
-	# we have a CDPATH, so loop on its contents
-	for i in ${CDPATH//:/$'\t'}; do
-		# create an array of matched subdirs
-		k="${#COMPREPLY[@]}"
-		for j in $( compgen -d $i/$cur ); do
-			if [[ ( $mark_symdirs && -h $j || $mark_dirs && ! -h $j ) && ! -d ${j#$i/} ]]; then
-				j="${j}/"
-			fi
-			COMPREPLY[k++]=${j#$i/}
-		done
-	done
-
-	_filedir -d
-
-	if [[ ${#COMPREPLY[@]} -eq 1 ]]; then
-	    i=${COMPREPLY[0]}
-	    if [ "$i" == "$cur" ] && [[ $i != "*/" ]]; then
-		COMPREPLY[0]="${i}/"
-	    fi
-	fi
-	    
-	return 0
-}
-if shopt -q cdable_vars; then
-    complete -v -F _cd $nospace $filenames cd
-else
-    complete -F _cd $nospace $filenames cd
-fi
-
-_remove_comp_word()
-{
-	if [[ COMP_CWORD -eq 0 ]]; then
-		return
-	elif [[ ${#COMP_WORDS[@]} -ge 2 ]]; then
-		local old_cw0="${COMP_WORDS[0]}"
-		local new_cw0="${COMP_WORDS[1]}"
-		local old_length="${#COMP_LINE}"
-		COMP_LINE=${COMP_LINE#${old_cw0}}
-		local head=${COMP_LINE:0:${#new_cw0}}
-		local i=1
-		while [[ $head != $new_cw0 ]]; do
-			COMP_LINE=${COMP_LINE:1}
-			head=${COMP_LINE:0:${#new_cw0}}
-			if (( ++i > 10 )); then
-				break
-			fi
-		done
-		local new_length="${#COMP_LINE}"
-		COMP_POINT=$(( COMP_POINT + new_length - old_length))
-
-		COMP_CWORD=$(( COMP_CWORD - 1 ))
-		for (( i=0; i < ${#COMP_WORDS[@]} - 1; ++i )); do
-			COMP_WORDS[i]="${COMP_WORDS[i+1]}"
-		done
-		unset COMP_WORDS[${#COMP_WORDS[@]}-1]
-	else
-		return
-	fi
-}
-
-# A meta-command completion function for commands like sudo(8), which need to
-# first complete on a command, then complete according to that command's own
-# completion definition - currently not quite foolproof (e.g. mount and umount
-# don't work properly), but still quite useful.
-#
-_command()
-{
-	local cur func cline cspec noglob cmd done i \
-	      _COMMAND_FUNC _COMMAND_FUNC_ARGS
-
-	_remove_comp_word
-	COMPREPLY=()
-	cur=`_get_cword`
-	# If the the first arguments following our meta-command-invoker are
-	# switches, get rid of them. Most definitely not foolproof.
-	done=
-	while [ -z $done ] ; do
-	    cmd=${COMP_WORDS[0]}
-	    if [[ "$cmd" == -* ]] && [ $COMP_CWORD -ge 1 ]; then
-	        _remove_comp_word
-	    elif [[ "$cmd" == -* ]] && [[ $COMP_CWORD -eq 0 ]]; then
-		return
-	    else 
-		done=1
-	    fi
-	done
-
-	if [ $COMP_CWORD -eq 0 ]; then
-		COMPREPLY=( $( compgen -c -- $cur ) )
-	elif complete -p $cmd &>/dev/null; then
-		cspec=$( complete -p $cmd )
-		if [ "${cspec#* -F }" != "$cspec" ]; then
-			# COMP_CWORD and COMP_WORDS() are not read-only,
-			# so we can set them before handing off to regular
-			# completion routine
-
-			# get function name
-			func=${cspec#*-F }
-			func=${func%% *}
-
-			if [[ ${#COMP_WORDS[@]} -ge 2 ]]; then
-				$func $cmd "${COMP_WORDS[${#COMP_WORDS[@]}-1]}" "${COMP_WORDS[${#COMP_WORDS[@]}-2]}"
-			else
-				$func $cmd "${COMP_WORDS[${#COMP_WORDS[@]}-1]}"
-			fi
-
-			# remove any \: generated by a command that doesn't
-			# default to filenames or dirnames (e.g. sudo chown)
-			# FIXME: I'm pretty sure this does not work!
-			if [ "${cspec#*-o }" != "$cspec" ]; then
-				cspec=${cspec#*-o }
-				cspec=${cspec%% *}
-				if [[ "$cspec" != @(dir|file)names ]]; then
-					COMPREPLY=("${COMPREPLY[@]//\\\\:/:}")
-				fi
-			fi
-		elif [ -n "$cspec" ]; then
-			cspec=${cspec#complete};
-			cspec=${cspec%%$cmd};
-			COMPREPLY=( $( eval compgen "$cspec" -- "$cur" ) );
-		fi
-	fi
-
-	[ ${#COMPREPLY[@]} -eq 0 ] && _filedir
-}
-complete -F _command $filenames nohup exec nice eval strace time ltrace then \
-	else do vsound command xargs
-
-_root_command()
-{
-	PATH=/usr/gnu/bin:$PATH:/sbin:/usr/sbin _command $1 $2 $3
-}
-complete -F _root_command $filenames sudo fakeroot really
-
-# ant(1) completion
-#
-have ant && {
-_ant()
-{
-	local cur prev buildfile i
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-buildfile|-f)
-			_filedir 'xml'
-			return 0
-			;;
-		-logfile)
-			_filedir
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		# relevant options completion
-		COMPREPLY=( $( compgen -W '-help -projecthelp -version -quiet \
-			       -verbose -debug -emacs -logfile -logger \
-			       -listener -buildfile -f -D -find' -- $cur ) )
-	else
-		# available targets completion
-		# find which buildfile to use
-		buildfile=build.xml
-		for (( i=1; i < COMP_CWORD; i++ )); do
-			if [[ "${COMP_WORDS[i]}" == -buildfile ]]; then
-				buildfile=${COMP_WORDS[i+1]}
-				break
-			fi
-		done
-		[ ! -f $buildfile ] && return 0
-
-		# parse buildfile for targets
-		COMPREPLY=( $( awk -F'"' '/<target name="/ {print $2}' \
-				$buildfile | grep "^$cur" )
-			    $( awk -F"'" "/<target name='/ "'{print $2}' \
-				$buildfile | grep "^$cur" )
-			    $( awk -F'"' '/<target [^n]/ {if ($1 ~ /name=/) { print $2 } else if ($3 ~ /name=/) {print $4} else if ($5 ~ /name=/) {print $6}}' \
-				$buildfile | grep "^$cur" ) )
-	fi
-}
-have complete-ant-cmd.pl && \
-     complete -C complete-ant-cmd.pl -F _ant $filenames ant || \
-     complete -F _ant $filenames ant
-}
-
-have nslookup &&
-_nslookup()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=${COMP_WORDS[COMP_CWORD]#-}
-
-	COMPREPLY=( $( compgen -P '-' -W 'all class= debug d2 domain= \
-			       srchlist= defname search port= querytype= \
-			       type= recurse retry root timeout vc \
-			       ignoretc' -- $cur ) )
-} &&
-complete -F _nslookup nslookup
-
-# mysqladmin(1) completion
-#
-have mysqladmin &&
-_mysqladmin()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-	-u)
-		COMPREPLY=( $( compgen -u -- $cur ) )
-		return 0
-		;;
-	*)
-		;;
-	esac
-
-	COMPREPLY=( $( compgen -W '-# -f -? -C -h -p -P -i -r -E -s -S -t -u \
-					      -v -V -w' -- $cur ) )
-
-	COMPREPLY=( "${COMPREPLY[@]}" \
-		    $( compgen -W 'create drop extended-status flush-hosts \
-				   flush-logs flush-status flush-tables \
-				   flush-threads flush-privileges kill \
-				   password ping processlist reload refresh \
-				   shutdown status variables version' \
-		       -- $cur ) )
-} &&
-complete -F _mysqladmin mysqladmin
-
-# gzip(1) completion
-#
-have gzip &&
-_gzip()
-{
-	local cur prev xspec IFS=$'\t\n'
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-c -d -f \
-			-h -l -L -n -N -q -r -S -t -v -V \
-			-1 -2 -3 -4 -5 -6 -7 -8 -9 \
-			--stdout --decompress --force --help --list \
-			--license --no-name --name --quiet --recursive \
-			--suffix --test --verbose --version --fast \
-			--best' -- $cur ) )
-		return 0
-	fi
-
-	xspec="*.?(t)gz"
-	if [[ "$prev" == --* ]]; then
-		[[ "$prev" == --decompress || \
-			"$prev" == --list || \
-			"$prev" == --test ]] && xspec="!"$xspec
-		[[ "$prev" == --force ]] && xspec=
-	elif [[ "$prev" == -* ]]; then
-		[[ "$prev" == -*[dlt]* ]] && xspec="!"$xspec
-		[[ "$prev" == -*f* ]] && xspec=
-	elif [ "$prev" = '>' ]; then
-		xspec=
-	elif [ "$prev" = '<' ]; then
-		xspec=
-	fi
-
-	_expand || return 0
-
-	COMPREPLY=( $( compgen -f -X "$xspec" -- $cur ) \
-		    $( compgen -d -- $cur ) )
-} &&
-complete -F _gzip $filenames gzip
-
-# bzip2(1) completion
-#
-have bzip2 &&
-_bzip2()
-{
-	local cur prev xspec IFS=$'\t\n'
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-c -d -f -h -k -L -q -s \
-			-t -v -V -z -1 -2 -3 -4 -5 -6 -7 -8 -9 \
-			--help --decompress --compress --keep --force \
-			--test --stdout --quiet --verbose --license \
-			--version --small --fast --best' -- $cur ) )
-		return 0
-	fi
-
-	xspec="*.bz2"
-	if [[ "$prev" == --* ]]; then
-		[[ "$prev" == --decompress || \
-			"$prev" == --list || \
-			"$prev" == --test ]] && xspec="!"$xspec
-		[[ "$prev" == --compress ]] && xspec=
-	elif [[ "$prev" == -* ]]; then
-		[[ "$prev" == -*[dt]* ]] && xspec="!"$xspec
-		[[ "$prev" == -*z* ]] && xspec=
-	fi
-
-	_expand || return 0
-
-	COMPREPLY=( $( compgen -f -X "$xspec" -- $cur ) \
-		    $( compgen -d -- $cur ) )
-} &&
-complete -F _bzip2 $filenames bzip2
-
-# openssl(1) completion
-#
-have openssl && {
-_openssl_sections()
-{
-	local config
-
-	config=/etc/ssl/openssl.cnf
-	[ ! -f $config ] && config=/usr/share/ssl/openssl.cnf
-	for (( i=2; i < COMP_CWORD; i++ )); do
-		if [[ "${COMP_WORDS[i]}" == -config ]]; then
-			config=${COMP_WORDS[i+1]}
-			break
-		fi
-	done
-	[ ! -f $config ] && return 0
-
-	COMPREPLY=( $( awk '/\[.*\]/ {print $2} ' $config | grep "^$cur" ) )
-}
-
-_openssl()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [ $COMP_CWORD -eq 1 ]; then
-		COMPREPLY=( $( compgen -W 'asn1parse ca ciphers crl crl2pkcs7 \
-			dgst dh dhparam dsa dsaparam enc errstr gendh gendsa \
-			genrsa nseq passwd pkcs12 pkcs7 pkcs8 rand req rsa \
-			rsautl s_client s_server s_time sess_id smime speed \
-			spkac verify version x509 md2 md4 md5 mdc2 rmd160 sha \
-			sha1 base64 bf bf-cbc bf-cfb bf-ecb bf-ofb cast \
-			cast-cbc cast5-cbc cast5-cfb cast5-ecb cast5-ofb des \
-			des-cbc des-cfb des-ecb des-ede des-ede-cbc \
-			des-ede-cfb des-ede-ofb des-ede3 des-ede3-cbc \
-			des-ede3-cfb des-ede3-ofb des-ofb des3 desx rc2 \
-			rc2-40-cbc rc2-64-cbc rc2-cbc rc2-cfb rc2-ecb rc2-ofb \
-			rc4 rc4-40' -- $cur ) )
-	else
-		prev=${COMP_WORDS[COMP_CWORD-1]}
-		case ${COMP_WORDS[1]} in
-			asn1parse)
-				case $prev in
-					-inform)
-						COMPREPLY=( $( compgen -W 'DER PEM' -- $cur ) )
-						return 0
-						;;
-					-@(in|out|oid))
-						_filedir
-						return 0
-						;;
-					esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-inform -in -out -noout -offset \
-						-length -i -oid -strparse' -- $cur ) )
-				fi
-				;;
-			ca)
-				case $prev in
-					-@(config|revoke|cert|in|out|spkac|ss_cert))
-						_filedir
-						return 0
-						;;
-					-outdir)
-						_filedir -d
-						return 0
-						;;
-					-@(name|crlexts|extensions))
-						_openssl_sections
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-verbose -config -name \
-						-gencrl -revoke -crldays -crlhours -crlexts \
-						-startdate -enddate -days -md -policy -keyfile \
-						-key -passin -cert -in -out -notext -outdir \
-						-infiles -spkac -ss_cert -preserveDN -batch \
-						-msie_hack -extensions' -- $cur ) )
-				fi
-				;;
-			ciphers)
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-v -ssl2 -ssl3 -tls1' -- $cur ) )
-				fi
-				;;
-			crl)
-				case $prev in
-					-@(in|out)form)
-						COMPREPLY=( $( compgen -W 'DER PEM' -- $cur ) )
-						return 0
-						;;
-					-@(in|out|CAfile))
-						_filedir
-						return 0
-						;;
-					-CAPath)
-						_filedir -d
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-inform -outform -text -in -out -noout \
-						-hash -issuer -lastupdate -nextupdate -CAfile -CApath' -- $cur ) )
-				fi
-				;;
-			crl2pkcs7)
-				case $prev in
-					-@(in|out)form)
-						COMPREPLY=( $( compgen -W 'DER PEM' -- $cur ) )
-						return 0
-						;;
-					-@(in|out))
-						_filedir
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-inform -outform -in -out -print_certs' -- $cur ) )
-				fi
-				;;
-			dgst)
-				case $prev in
-					-@(out|sign|verify|prvrify|signature))
-						_filedir
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-md5 -md4 -md2 -sha1 -sha -mdc2 -ripemd160 -dss1 \
-						-c -d -hex -binary -out -sign -verify -prverify -signature' -- $cur ) )
-				else
-						_filedir
-				fi
-			       ;;
-			dsa)
-				case $prev in
-					-@(in|out)form)
-						COMPREPLY=( $( compgen -W 'DER PEM' -- $cur ) )
-						return 0
-						;;
-					-@(in|out))
-						_filedir
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-inform -outform -in -passin -out -passout -des -des3 -idea -text -noout \
-						-modulus -pubin -pubout' -- $cur ) )
-				fi
-				;;
-			dsaparam)
-				case $prev in
-					-@(in|out)form)
-						COMPREPLY=( $( compgen -W 'DER PEM' -- $cur ) )
-						return 0
-						;;
-					-@(in|out|rand))
-						_filedir
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-inform -outform -in -out -noout \
-						-text -C -rand -genkey' -- $cur ) )
-				fi
-				;;
-			enc)
-				case $prev in
-					-@(in|out|kfile))
-						_filedir
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-ciphername -in -out -pass \
-						-e -d -a -A -k -kfile -S -K -iv -p -P -bufsize -debug' -- $cur ) )
-				fi
-				;;
-			dhparam)
-				case $prev in
-					-@(in|out)form)
-						COMPREPLY=( $( compgen -W 'DER PEM' -- $cur ) )
-						return 0
-						;;
-					-@(in|out|rand))
-						_filedir
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-inform -outform -in -out -dsaparam -noout \
-						-text -C -2 -5 -rand' -- $cur ) )
-				fi
-				;;
-			gendsa)
-				case $prev in
-					-@(out|rand))
-						_filedir
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-out -des -des3 -idea -rand' -- $cur ) )
-				else
-						_filedir
-				fi
-				;;
-			genrsa)
-				case $prev in
-					-@(out|rand))
-						_filedir
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-out -passout -des -des3 -idea -f4 -3 -rand' -- $cur ) )
-				fi
-				;;
-			pkcs7)
-				case $prev in
-					-@(in|out)form)
-						COMPREPLY=( $( compgen -W 'DER PEM' -- $cur ) )
-						return 0
-						;;
-					-@(in|out))
-						_filedir
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-inform -outform -in -out -print_certs -text -noout' -- $cur ) )
-				fi
-				;;
-			rand)
-				case $prev in
-					-@(out|rand))
-						_filedir
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-out -rand -base64' -- $cur ) )
-				fi
-				;;
-			req)
-				case "$prev" in
-					-@(in|out|key)form)
-						COMPREPLY=( $( compgen -W 'DER PEM' -- $cur ) )
-						return 0
-						;;
-
-					-@(in|out|rand|key|keyout|config))
-						_filedir
-						return 0
-						;;
-					-extensions)
-						_openssl_sections
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-inform -outform -in \
-						-passin -out -passout -text -noout -verify \
-						-modulus -new -rand -newkey -newkey -nodes \
-						-key -keyform -keyout -md5 -sha1 -md2 -mdc2 \
-						-config -x509 -days -asn1-kludge -newhdr \
-						-extensions -reqexts section' -- $cur ) )
-				fi
-				;;
-			rsa)
-				case $prev in
-					-@(in|out)form)
-						COMPREPLY=( $( compgen -W 'DER NET PEM' -- $cur ) )
-						return 0
-						;;
-					-@(in|out))
-						_filedir
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-inform -outform -in -passin -out -passout \
-						-sgckey -des -des3 -idea -text -noout -modulus -check -pubin \
-						-pubout -engine' -- $cur ) )
-				fi
-				;;
-			rsautl)
-				case $prev in
-					-@(in|out|inkey))
-						_filedir
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-in -out -inkey -pubin -certin -sign -verify \
-						-encrypt -decrypt -pkcs -ssl -raw -hexdump -asn1parse' -- $cur ) )
-				fi
-				;;
-			s_client)
-				case $prev in
-					-connect)
-						_known_hosts
-						return 0
-						;;
-					-@(cert|key|CAfile|rand))
-						_filedir
-						return 0
-						;;
-					-CApath)
-						_filedir -d
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-connect -verify -cert -key -CApath -CAfile \
-						-reconnect -pause -showcerts -debug -msg -nbio_test -state -nbio \
-						-crlf -ign_eof -quiet -ssl2 -ssl3 -tls1 -no_ssl2 -no_ssl3 -no_tls1 \
-						-bugs -cipher -starttls -engine -rand' -- $cur ) )
-				fi
-				;;
-			s_server)
-				case $prev in
-					-@(cert|key|dcert|dkey|dhparam|CAfile|rand))
-						_filedir
-						return 0
-						;;
-					-CApath)
-						_filedir -d
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-accept -context -verify -Verify -cert -key \
-						 -dcert -dkey -dhparam -nbio -nbio_test -crlf -debug -msg -state -CApath \
-						 -CAfile -nocert -cipher -quiet -no_tmp_rsa -ssl2 -ssl3 -tls1 -no_ssl2 \
-						 -no_ssl3 -no_tls1 -no_dhe -bugs -hack -www -WWW -HTTP -engine -id_prefix \
-						 -rand' -- $cur ) )
-				 fi
-				 ;;
-			s_time)
-				case $prev in
-					-connect)
-						_known_hosts
-						return 0
-						;;
-					-@(cert|key|CAfile))
-						_filedir
-						return 0
-						;;
-					-CApath)
-						_filedir -d
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-connect -www -cert -key -CApath -CAfile -reuse \
-						-new -verify -nbio -time -ssl2 -ssl3 -bugs -cipher' -- $cur ) )
-				fi
-				;;
-
-			sess_id) 
-				case $prev in
-					-@(in|out)form)
-						COMPREPLY=( $( compgen -W 'DER PEM' -- $cur ) )
-						return 0
-						;;
-					-@(in|out))
-						_filedir
-						return 0
-						;;
-				esac
-
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-inform -outform -in -out -text -noout \
-						-context ID' -- $cur ) )
-				fi
-				;;
-			smime)
-				case $prev in
-					-@(in|out)form)
-						COMPREPLY=( $( compgen -W 'SMIME DER PEM' -- $cur ) )
-						return 0
-						;;
-					-@(in|out|certfile|signer|recip|inkey|content|rand))
-						_filedir
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-encrypt -decrypt -sign -verify -pk7out -des -des3 \
-						-rc2-40 -rc2-64 -rc2-128 -aes128 -aes192 -aes256 -in -certfile -signer \
-						-recip -inform -passin -inkey -out -outform -content -to -from -subject \
-						-text -rand' -- $cur ) )
-				else
-						_filedir
-				fi
-				;;
-			speed)
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-engine' -- $cur ) )
-				else
-					COMPREPLY=( $( compgen -W 'md2 mdc2 md5 hmac sha1 rmd160 idea-cbc \
-						rc2-cbc rc5-cbc bf-cbc des-cbc des-ede3 rc4 rsa512 rsa1024 rsa2048 \
-						rsa4096 dsa512 dsa1024 dsa2048 idea rc2 des rsa blowfish' -- $cur ) )
-				fi
-				;;
-			verify)
-				case $prev in
-					-@(CAfile|untrusted))
-						_filedir
-						return 0
-						;;
-					-CApath)
-						_filedir -d
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-CApath -CAfile -purpose -untrusted -help -issuer_checks \
-						-verbose -certificates' -- $cur ) )
-				else
-						_filedir
-				fi
-				;;
-			x509)
-				case "$prev" in
-					-@(in|out|CA|CAkey|CAserial|extfile))
-						_filedir
-						return 0
-						;;
-					-@(in|out)form)
-						COMPREPLY=( $( compgen -W 'DER PEM NET' -- $cur ) )
-						return 0
-						;;
-					-@(key|CA|CAkey)form)
-						COMPREPLY=( $( compgen -W 'DER PEM' -- $cur ) )
-						return 0
-						;;
-					-extensions)
-						_openssl_sections
-						return 0
-						;;
-				esac
-
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-inform -outform \
-						-keyform -CAform -CAkeyform -in -out \
-						-serial -hash -subject -issuer -nameopt \
-						-email -startdate -enddate -purpose \
-						-dates -modulus -fingerprint -alias \
-						-noout -trustout -clrtrust -clrreject \
-						-addtrust -addreject -setalias -days \
-						-set_serial -signkey -x509toreq -req \
-						-CA -CAkey -CAcreateserial -CAserial \
-						-text -C -md2 -md5 -sha1 -mdc2 -clrext \
-						-extfile -extensions -engine' -- $cur ) )
-				fi
-				;;
-			@(md5|md4|md2|sha1|sha|mdc2|ripemd160))
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-c -d' -- $cur ) )
-				else
-						_filedir
-				fi
-				;;
-		esac
-	fi
-
-	return 0
-}
-complete -F _openssl $default openssl
-}
-
-# screen(1) completion
-#
-have screen &&
-_screen()
-{
-	local cur prev preprev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	[ "$COMP_CWORD" -ge 2 ] && preprev=${COMP_WORDS[COMP_CWORD-2]}
-
-	if [ "$preprev" = "-d" -o "$preprev" = "-D" -a "$prev" = "-r" -o \
-	     "$prev" = "-R" ]; then
-		# list all
-		COMPREPLY=( $( command screen -ls | \
-				sed -ne 's|^['$'\t'']\+\('$cur'[0-9]\+\.[^'$'\t'']\+\).*$|\1|p' ) )
-	else
-		case "$prev" in
-		-[rR])
-			# list detached
-			COMPREPLY=( $( command screen -ls | \
-					sed -ne 's|^['$'\t'']\+\('$cur'[0-9]\+\.[^'$'\t'']\+\).*Detached.*$|\1|p' ) )
-			;;
-		-[dDx])
-			# list attached
-			COMPREPLY=( $( command screen -ls | \
-					sed -ne 's|^['$'\t'']\+\('$cur'[0-9]\+\.[^'$'\t'']\+\).*Attached.*$|\1|p' ) )
-			;;
-		-s)
-			# shells
-			COMPREPLY=( $( grep ^${cur:-[^#]} /etc/shells ) )
-			;;
-		*)
-			;;
-		esac
-	fi
-
-	return 0
-} &&
-complete -F _screen $default screen
-
-# lftp(1) bookmark completion
-#
-have lftp &&
-_lftp()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [ $COMP_CWORD -eq 1 ] && [ -f ~/.lftp/bookmarks ]; then
-	    COMPREPLY=( $( compgen -W '$( sed -ne "s/^\(.*\)'$'\t''.*$/\1/p" \
-			   ~/.lftp/bookmarks )' -- $cur ) )
-	fi
-
-	return 0
-} &&
-complete -F _lftp $default lftp
-
-# ncftp(1) bookmark completion
-#
-have ncftp &&
-_ncftp()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [ $COMP_CWORD -eq 1 ] && [ -f ~/.ncftp/bookmarks ]; then
-	    COMPREPLY=( $( compgen -W '$( sed -ne "s/^\([^,]\{1,\}\),.*$/\1/p" \
-			   ~/.ncftp/bookmarks )' -- $cur ) )
-	fi
-
-	return 0
-} &&
-complete -F _ncftp $default ncftp
-
-# gdb(1) completion
-#
-have gdb &&
-_gdb()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	if [ $COMP_CWORD -eq 1 ]; then
-		COMPREPLY=( $( compgen -c -- $cur ) )
-	elif [ $COMP_CWORD -eq 2 ]; then
-		prev=${prev##*/}
-		COMPREPLY=( $( compgen -fW "$( command ps axo comm,pid | \
-				awk '{if ($1 ~ /^'"$prev"'/) print $2}' ) )" \
-				-- "$cur" ) )
-	fi
-} &&
-complete -F _gdb $filenames gdb
-
-# Postgresql completion
-#
-have psql && {
-_pg_databases() 
-{
-	return
-	COMPREPLY=( $( psql -l 2>/dev/null | \
-			sed -e '1,/^-/d' -e '/^(/,$d' | \
-			awk '{print $1}' | grep "^$cur" ) )
-}
-
-_pg_users()
-{
-	#COMPREPLY=( $( psql -qtc 'select usename from pg_user' template1 2>/dev/null | \
-	#		grep "^ $cur" ) )
-	#[ ${#COMPREPLY[@]} -eq 0 ] &&
-	COMPREPLY=( $( compgen -u -- $cur ) )
-}
-
-# createdb(1) completion
-#
-_createdb() 
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-	-@(h|-host=)) 
-		_known_hosts
-		return 0
-		;;
-	-@(U|-username=))
-		_pg_users
-		return 0
-		;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-D -T -E -h -p -U -W -e -q \
-			--location= --template= --encoding= --host= --port= \
-			--username= --password --echo --quiet --help' -- $cur ))
-	else
-		_pg_databases
-	fi
-}
-complete -F _createdb $default createdb
-
-# dropdb(1) completion
-#
-_dropdb() 
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-	-@(h|-host=)) 
-		_known_hosts
-		return 0
-		;;
-	-@(U|-username=))
-		_pg_users
-		return 0
-		;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-h -p -U -W -e -q \
-				--host= --port= --username= --password \
-				--interactive --echo --quiet --help' -- $cur ) )
-	else
-		_pg_databases
-	fi
-}
-complete -F _dropdb $default dropdb
-
-# psql(1) completion
-#
-_psql() 
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-	-h|--host) 
-		_known_hosts
-		return 0
-		;;
-	-U|--username)
-		_pg_users
-		return 0
-		;;
-	-d|--dbname)
-		_pg_databases
-		return 0
-		;;
-	-@(o|f)|--output|--file)
-		_filedir
-		return 0
-		;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		# return list of available options
-		COMPREPLY=( $( compgen -W '-a --echo-all -A --no-align \
-			-c --command -d --dbname -e --echo-queries \
-			-E --echo-hidden -f --file -F --filed-separator \
-			-h --host -H --html -l --list -n -o --output \
-			-p --port -P --pset -q -R --record-separator \
-			-s --single-step -S --single-line -t --tuples-only \
-			-T --table-attr -U --username -v --variable \
-			-V --version -W --password -x --expanded -X --nopsqlrc \
-			-? --help ' -- $cur ) )
-	else
-		# return list of available databases
-		_pg_databases
-	fi
-}
-complete -F _psql $default psql
-}
-
-_longopt()
-{
-	local cur opt
-
-	cur=`_get_cword`
-
-	if [[ "$cur" == --*=* ]]; then
-		opt=${cur%%=*}
-		# cut backslash that gets inserted before '=' sign
-		opt=${opt%\\*}
-		cur=${cur#*=}
-		_filedir
-		COMPREPLY=( $( compgen -P "$opt=" -W '${COMPREPLY[@]}' -- $cur))
-		return 0
-	fi
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( $1 --help 2>&1 | sed -e '/--/!d' \
-				-e 's/.*\(--[-A-Za-z0-9]\+=\?\).*/\1/' | \
-			       command grep "^$cur" | sort -u ) )
-	elif [[ "$1" == @(mk|rm)dir ]]; then
-		_filedir -d
-	else
-		_filedir
-	fi
-}
-# makeinfo and texi2dvi are defined elsewhere.
-for i in a2ps autoconf automake bc gprof ld nm objcopy objdump readelf strip \
-	 bison cpio diff patch enscript cp df dir du ln ls mkfifo mknod mv rm \
-	 touch vdir awk gperf grep grub indent less m4 sed shar date \
-	 tee who texindex cat csplit cut expand fmt fold head \
-	 md5sum nl od paste pr ptx sha1sum sort split tac tail tr unexpand \
-	 uniq wc ldd bash id irb mkdir rmdir; do
-  have $i && complete -F _longopt $filenames $i
-done
-
-# These commands use filenames, so '-o filenames' is not needed.
-for i in env netstat seq uname units wget; do
-  have $i && complete -F _longopt $default $i
-done
-unset i
-
-# gcc(1) completion
-#
-# The only unusual feature is that we don't parse "gcc --help -v" output
-# directly, because that would include the options of all the other backend
-# tools (linker, assembler, preprocessor, etc) without any indication that
-# you cannot feed such options to the gcc driver directly.  (For example, the
-# linker takes a -z option, but you must type -Wl,-z for gcc.)  Instead, we
-# ask the driver ("g++") for the name of the compiler ("cc1"), and parse the
-# --help output of the compiler.
-#
-have gcc &&
-_gcc()
-{
-	local cur cc backend
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	_expand || return 0
-
-	case "$1" in
-	gcj)
-		backend=jc1
-		;;
-	gpc)
-		backend=gpc1
-		;;
-	*77)
-		backend=f771
-		;;
-	*)
-		backend=cc1	# (near-)universal backend
-		;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		cc=$( $1 -print-prog-name=$backend )
-		# sink stderr:
-		# for C/C++/ObjectiveC it's useless
-		# for FORTRAN/Java it's an error
-		COMPREPLY=( $( $cc --help 2>/dev/null | tr '\t' ' ' | \
-			       sed -e '/^  *-/!d' -e 's/ *-\([^ ]*\).*/-\1/' | \
-			       command grep "^$cur" | sort -u ) )
-	else
-		_filedir
-	fi
-} &&
-complete $filenames -F _gcc gcc g++ c++ g77 gcj gpc
-[ $UNAME = GNU -o $UNAME = Linux -o $UNAME = Cygwin ] && \
-[ -n "${have:-}" ] && complete $filenames -F _gcc cc
-
-# Linux cardctl(8) completion
-#
-have cardctl &&
-_cardctl()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [ $COMP_CWORD -eq 1 ]; then
-		COMPREPLY=( $( compgen -W 'status config ident suspend \
-					   resume reset eject insert scheme' \
-			       -- $cur ) )
-	fi
-} &&
-complete -F _cardctl cardctl
-
-# This function is required by _dpkg() and _dpkg-reconfigure()
-#
-have dpkg && {
-_comp_dpkg_installed_packages()
-{
-	grep -A 1 "Package: $1" /var/lib/dpkg/status | \
-		grep -B 1 -E "ok installed|half-installed|unpacked| \
-       			      half-configured|config-files" | \
-	        grep "Package: $1" | cut -d\  -f2
-}
-
-# Debian dpkg(8) completion
-#
-_dpkg()
-{
-	local cur prev i
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-	i=$COMP_CWORD
-
-	_expand || return 0
-
-	# find the last option flag
-	if [[ $cur != -* ]]; then
-		while [[ $prev != -* && $i != 1 ]]; do
-			i=$((i-1))
-			prev=${COMP_WORDS[i-1]}
-		done
-	fi
-
-	case "$prev" in 
-	-@(c|i|A|I|f|e|x|X|-@(install|unpack|record-avail|contents|info|fsys-tarfile|field|control|extract)))
-		_filedir '?(u)deb'
-		return 0
-		;;
-	-@(b|-build))
-		_filedir -d
-		return 0
-		;;
-   	-@(s|p|l|-@(status|print-avail|list)))
-		COMPREPLY=( $( apt-cache pkgnames $cur 2>/dev/null ) )
-		return 0
-		;;
-	-@(S|-search))
-		_filedir
-		return 0
-		;;
-	-@(r|L|P|-@(remove|purge|listfiles)))
-		COMPREPLY=( $( _comp_dpkg_installed_packages $cur ) )
-		return 0
-		;;
-	*)
-
-	COMPREPLY=( $( compgen -W '-i --install --unpack -A --record-avail \
-			--configure -r --remove -P --purge --get-selections \
-			--set-selections --update-avail --merge-avail \
-			--clear-avail  --command-fd --forget-old-unavail -s \
-			--status -p --print-avail -L --listfiles -l --list \
-			-S --search -C --audit --print-architecture \
-			--print-gnu-build-architecture \
-			--print-installation-architecture \
-			--compare-versions --help --version --force-help \
-			--force-all --force-auto-select --force-downgrade \
-			--force-configure-any --force-hold --force-bad-path \
-			--force-not-root --force-overwrite \
-			--force-overwrite-diverted --force-bad-verify \
-			--force-depends-version --force-depends \
-			--force-confnew --force-confold --force-confdef \
-			--force-confmiss --force-conflicts --force-architecture\
-			--force-overwrite-dir --force-remove-reinstreq \
-			--force-remove-essential -Dh \
-			--debug=help --licence --admindir= --root= --instdir= \
-			-O --selected-only -E --skip-same-version \
-			-G --refuse-downgrade -B --auto-deconfigure \
-			--no-debsig --no-act -D --debug= --status-fd \
-			-b --build -I --info -f --field -c --contents \
-			-x --extract -X --vextract --fsys-tarfile -e --control \
-			--ignore-depends= --abort-after' -- $cur ) )
-		;;
-	esac
-
-
-}
-complete -F _dpkg $filenames dpkg dpkg-deb
-}
-
-# Debian GNU dpkg-reconfigure(8) completion
-#
-have dpkg-reconfigure &&
-_dpkg_reconfigure()
-{
-	local cur prev opt
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-
-	case "$prev" in
-	    -@(f|-frontend))
-		opt=( $( echo /usr/share/perl5/Debconf/FrontEnd/* ) )
-		opt=( ${opt[@]##*/} )
-		opt=( ${opt[@]%.pm} )
-		COMPREPLY=( $( compgen -W '${opt[@]}' -- $cur ) )
-		return 0
-		;;
-	    -@(p|-priority))
-  		COMPREPLY=( $( compgen -W 'low medium high critical' -- $cur ) )
-		return 0
-		;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-	    COMPREPLY=( $( compgen -W '-f --frontend -p --priority -a --all \
-				       -u --unseen-only -h --help -s --showold \
-				       --force --terse' -- $cur ) )
-	else
-	    COMPREPLY=( $( _comp_dpkg_installed_packages $cur ) )
-	fi
-} &&
-complete -F _dpkg_reconfigure $default dpkg-reconfigure
-
-# Debian dpkg-source completion
-#
-have dpkg-source &&
-_dpkg_source()
-{
-	local cur prev options work i action packopts unpackopts
-
-	packopts="-c -l -F -V -T -D -U -W -E -sa -i -I -sk -sp -su -sr -ss -sn -sA -sK -sP -sU -sR"
-	unpackopts="-sp -sn -su"
-	options=`echo "-x -b $packopts $unpackopts" | xargs echo | sort -u | xargs echo`
-
-	COMPREPLY=()
-	if [ "$1" != "dpkg-source" ]; then
-		exit 1
-	fi
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-	action="options"
-	for (( i=0; i < ${#COMP_WORDS[@]}-1; i++ )); do
-		if [[ ${COMP_WORDS[$i]} == "-x" ]]; then
-			action=unpack
-		elif [[ ${COMP_WORDS[$i]} == "-b" ]]; then
-			action=pack
-		elif [[ ${COMP_WORDS[$i]} == "-h" ]]; then
-			action=help
-		fi
-	done
-	# if currently seeing a complete option, return just itself.
-	for i in $options; do
-		if [ "$cur" = "$i" ]; then
-			COMPREPLY=( "$cur" )
-			return 0
-		fi
-	done
-	case "$action" in
-		"unpack")
-			if [ "$cur" = "-" -o "$cur" = "-s" ]; then
-				COMPREPLY=( $unpackots )
-				return 0
-			fi
-			case "$prev" in
-				"-x")
-					COMPREPLY=( $( compgen -d -- "$cur" ) \
-						    $( compgen -f -X '!*.dsc' -- "$cur" ) )
-					return 0
-					;;
-				*)
-					COMPREPLY=( $unpackopts $(compgen -d -f -- "$cur" ) )
-					return 0
-					;;
-			esac
-			return 0
-			;;
-		"pack")
-			if [ "$cur" = "-" ]; then
-				COMPREPLY=( $packopts )
-				return 0
-			fi
-			if [ "$cur" = "-s" ]; then
-				COMPREPLY=( "-sa" "-sk" "-sp" "-su" "-sr" "-ss" "-sn" \
-			    		"-sA" "-sK" "-sP" "-sU" "-sR" )
-				return 0
-			fi
-			case "$prev" in
-				"-b")
-					COMPREPLY=( $( compgen -d -- "$cur" ) )
-					return 0
-					;;
-				"-c"|"-l"|"-T"|"-i"|"-I")
-					# -c: get controlfile
-					# -l: get per-version info from this file
-					# -T: read variables here, not debian/substvars
-					# -i: <regexp> filter out files to ignore diffs of.
-					# -I: filter out files when building tarballs.
-					# return directory names and file names
-					COMPREPLY=( $( compgen -d -f ) )
-					return 0
-					;;
-				"-F")
-					# -F: force change log format
-					COMPREPLY=( $( ( cd /usr/lib/dpkg/parsechangelog; compgen -f "$cur" ) ) )
-					return 0
-					;;
-				"-V"|"-D")
-					# -V: set a substitution variable
-					# we don't know anything about possible variables or values
-					# so we don't try to suggest any completion.
-					COMPREPLY=()
-					return 0
-					;;
-				"-D")
-					# -D: override or add a .dsc field and value
-					# if $cur doesn't contain a = yet, suggest variable names
-					if echo -- "$cur" | grep -q "="; then
-						# $cur contains a "="
-						COMPREPLY=()
-						return 0
-					else
-						COMPREPLY=( Format Source Version Binary Maintainer Uploader Architecture Standards-Version Build-Depends Files )
-						return 0
-					fi
-					;;
-				"-U")
-					# -U: remove a field
-					# Suggest possible fieldnames
-					COMPREPLY=( Format Source Version Binary Maintainer Uploader Architecture Standards-Version Build-Depends Files )
-					return 0
-					;;
-				*)
-					COMPREPLY=( $packopts )
-					return 0
-					;;
-			esac
-			return 0
-			;;
-		*)
-			# if seeing a partial option, return possible completions.
-			if [ "$cur" = "-s" ]; then
-				COMPREPLY=( "-sa" "-sk" "-sp" "-su" "-sr" "-ss" "-sn" \
-			    		"-sA" "-sK" "-sP" "-sU" "-sR" )
-				return 0
-			fi
-			# else return all possible options.
-			COMPREPLY=( $options )
-			return 0
-			;;
-	esac
-} &&
-complete -F _dpkg_source dpkg-source
-
-# Debian Linux dselect(8) completion.
-#
-have dselect &&
-_dselect()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-	     --admindir)
-		  _filedir -d
-		  return 0
-		  ;;
-
-	     -@(D|debug))
-		  _filedir
-		  return 0
-		  ;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-	    COMPREPLY=( $( compgen -W '--admindir --help --version --licence \
-				  --license --expert --debug' -- $cur ) )
-	else
-	    COMPREPLY=( $( compgen -W 'access update select install config \
-				  remove quit' -- $cur ) )
-	fi
-
-
-	return 0
-} &&
-complete -F _dselect $filenames dselect
-
-# Java completion
-#
-
-# available path elements completion
-have java && {
-_java_path()
-{
-	cur=${cur##*:}
-	_filedir '@(jar|zip)'
-}
-
-# exact classpath determination
-_java_find_classpath()
-{
-	local i
-
-	# search first in current options
-	for (( i=1; i < COMP_CWORD; i++ )); do
-		if [[ "${COMP_WORDS[i]}" == -@(cp|classpath) ]]; then
-			classpath=${COMP_WORDS[i+1]}
-			break
-		fi
-	done
-
-	# default to environment
-	[ -z "$classpath" ] && classpath=$CLASSPATH
-
-	# default to current directory
-	[ -z "$classpath" ] && classpath=.
-}
-
-# exact sourcepath determination
-_java_find_sourcepath()
-{
-	local i
-
-	# search first in current options
-	for (( i=1; i < COMP_CWORD; i++ )); do
-		if [[ "${COMP_WORDS[i]}" == -sourcepath ]]; then
-			sourcepath=${COMP_WORDS[i+1]}
-			break
-		fi
-	done
-
-	# default to classpath
-	[ -z "$sourcepath" ] && _java_find_classpath
-	sourcepath=$classpath
-}
-
-# available classes completion
-_java_classes()
-{
-	local classpath i
-
-	# find which classpath to use
-	_java_find_classpath
-
-	# convert package syntax to path syntax
-	cur=${cur//.//}
-	# parse each classpath element for classes
-	for i in ${classpath//:/ }; do
-		if [ -r $i ] && [[ "$i" == *.@(jar|zip) ]]; then
-			if type zipinfo &> /dev/null; then
-				COMPREPLY=( "${COMPREPLY[@]}" $( zipinfo -1 \
-				"$i" | grep "^$cur" | grep '\.class$' | \
-				grep -v "\\$" ) )
-			else
-				COMPREPLY=( "${COMPREPLY[@]}" $( jar tf "$i" \
-				"$cur" | grep "\.class$" | grep -v "\\$" ) )
-			fi
-
-		elif [ -d $i ]; then
-			i=${i%/}
-			COMPREPLY=( "${COMPREPLY[@]}" $( find "$i" -type f \
-			-path "$i/$cur*.class" 2>/dev/null | \
-			grep -v "\\$" | sed -e "s|^$i/||" ) )
-		fi
-	done
-
-	# remove class extension
-	COMPREPLY=( ${COMPREPLY[@]%.class} )
-	# convert path syntax to package syntax
-	COMPREPLY=( ${COMPREPLY[@]//\//.} )
-}
-
-# available packages completion
-_java_packages()
-{
-	local sourcepath i
-
-	# find wich sourcepath to use
-	_java_find_sourcepath
-
-	# convert package syntax to path syntax
-	cur=${cur//.//}
-	# parse each sourcepath element for packages
-	for i in ${sourcepath//:/ }; do
-		if [ -d $i ]; then
-			COMPREPLY=( "${COMPREPLY[@]}" $( command ls -F -d \
-				$i/$cur* 2>/dev/null | sed -e 's|^'$i'/||' ) )
-		fi
-	done
-	# keep only packages
-	COMPREPLY=( $( echo "${COMPREPLY[@]}" | tr " " "\n" | grep "/$" ) )
-	# remove packages extension
-	COMPREPLY=( ${COMPREPLY[@]%/} )
-	# convert path syntax to package syntax
-	cur=${COMPREPLY[@]//\//.}
-}
-
-# java completion
-#
-_java()
-{
-	local cur prev i
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	for ((i=1; i < $COMP_CWORD; i++)); do
-		case ${COMP_WORDS[$i]} in
-		    -cp|-classpath)
-			((i++))	# skip the classpath string.
-			;;
-		    -*)
-			# this is an option, not a class/jarfile name.
-			;;
-		    *)
-			# once we've seen a class, just do filename completion
-			_filedir
-			return 0
-			;;
-		esac
-	done
-
-	case $prev in
-		-@(cp|classpath))
-			_java_path
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		# relevant options completion
-		COMPREPLY=( $( compgen -W '-client -hotspot -server -classic \
-				-cp -classpath -D -verbose -verbose:class \
-				-verbose:gc -version:jni -version \
-				-showversion -? -help -X -jar \
-				-ea -enableassertions -da -disableassertions \
-				-esa -enablesystemassertions \
-				-dsa -disablesystemassertions ' -- $cur ) )
-	else
-		if [[ "$prev" == -jar ]]; then
-			# jar file completion
-			_filedir jar
-		else
-			# classes completion
-			_java_classes
-		fi
-	fi
-}
-complete -F _java $filenames java
-}
-
-# javadoc completion
-#
-have javadoc &&
-_javadoc()
-{
-	COMPREPLY=()
-	local cur prev
-
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case $prev in
-		-@(overview|helpfile|stylesheetfile))
-			_filedir
-			return 0
-			;;
-		-d)
-			_filedir -d
-			return 0
-			;;
-		-@(classpath|bootclasspath|docletpath|sourcepath|extdirs))
-			_java_path
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		# relevant options completion
-		COMPREPLY=( $( compgen -W '-overview -public -protected \
-				-package -private -help -doclet -docletpath \
-				-sourcepath -classpath -exclude -subpackages \
-				-breakiterator -bootclasspath -source -extdirs \
-				-verbose -locale -encoding -J -d -use -version \
-				-author -docfilessubdirs -splitindex \
-				-windowtitle -doctitle -header -footer -bottom \
-				-link -linkoffline -excludedocfilessubdir \
-				-group -nocomment -nodeprecated -noqualifier \
-				-nosince -nodeprecatedlist -notree -noindex \
-				-nohelp -nonavbar -quiet -serialwarn -tag \
-				-taglet -tagletpath -charset -helpfile \
-				-linksource -stylesheetfile -docencoding' -- \
-				$cur ) )
-	else
-		# source files completion
-		_filedir java
-		# packages completion
-		_java_packages
-	fi
-} &&
-complete -F _javadoc $filenames javadoc
-
-# javac completion
-#
-have javac &&
-_javac()
-{
-	COMPREPLY=()
-	local cur prev
-
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case $prev in
-		-d)
-			_filedir -d
-			return 0
-			;;
-		-@(classpath|bootclasspath|sourcepath|extdirs))
-			_java_path
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		# relevant options completion
-		COMPREPLY=( $( compgen -W '-g -g:none -g:lines -g:vars\
-		-g:source -O -nowarn -verbose -deprecation -classpath\
-		-sourcepath -bootclasspath -extdirs -d -encoding -source\
-		-target -help' -- $cur ) )
-	else
-		# source files completion
-		_filedir java
-	fi
-} &&
-complete -F _javac $filenames javac
-
-# PINE address-book completion
-#
-have pine &&
-_pineaddr()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	COMPREPLY=( $( compgen -W '$( awk "{print \$1}" ~/.addressbook 2>/dev/null)' \
-			-- $cur ) )
-} &&
-complete -F _pineaddr $default pine
-
-# mutt completion
-#
-# Mutt doesn't have an "addressbook" like Pine, but it has aliases and
-# a "query" function to retrieve addresses, so that's what we use here.
-have mutt || have muttng && {
-_muttaddr()
-{
-	_muttaliases
-	_muttquery
-	return 0
-}
-
-_muttconffiles()
-{
-	local file sofar
-	local -a newconffiles
-
-	sofar=" $1 "
-	shift
-	while [[ "$1" ]]; do
-	    newconffiles=( $(sed -rn 's|^source[[:space:]]+([^[:space:]]+).*$|\1|p' $(eval echo $1) ) )
-	    for file in "${newconffiles[@]}"; do
-		[[ ! "$file" ]] || [[ "${sofar/ ${file} / }" != "$sofar" ]] &&
-		    continue
-		sofar="$sofar $file"
-		sofar=" $(eval _muttconffiles \"$sofar\" $file) "
-	    done
-	    shift
-	done
-	echo $sofar
-}
-
-_muttaliases()
-{
-	local cur muttrc
-	local -a conffiles aliases
-	cur=`_get_cword`
-
-	[ -f ~/.${muttcmd}/${muttcmd}rc ] && muttrc="~/.${muttcmd}/${muttcmd}rc"
-	[ -f ~/.${muttcmd}rc ] && muttrc="~/.${muttcmd}rc"
-	[ -z "$muttrc" ] && return 0
-
-	conffiles=( $(eval _muttconffiles $muttrc $muttrc) )
-	aliases=( $( sed -rn 's|^alias[[:space:]]+([^[:space:]]+).*$|\1|p' \
-			$(eval echo "${conffiles[@]}") ) )
-	COMPREPLY=( "${COMPREPLY[@]}" $( compgen -W "${aliases[*]}" -- $cur ) )
-
-	return 0
-}
-
-_muttquery()
-{
-	local cur querycmd
-	local -a queryresults
-	cur=`_get_cword`
-
-	querycmd="$( $muttcmd -Q query_command  | sed -r 's|^query_command=\"(.*)\"$|\1|; s|%s|'$cur'|' )"
-	if [ -z "$cur" -o -z "$querycmd" ]; then
-	    queryresults=()
-	else 
-	    queryresults=( $( $querycmd | \
-	      sed -nr '2,$s|^([^[:space:]]+).*|\1|p' ) )
-	fi
-
-	COMPREPLY=( "${COMPREPLY[@]}" $( compgen -W "${queryresults[*]}" \
-			-- $cur ) )
-
-	return 0
-}
-
-_muttfiledir()
-{
-	local cur folder spoolfile
-	cur=`_get_cword`
-
-	# This is currently not working so well. Perhaps this function should
-	# just call _filedir() for the moment.
-	if [[ $cur == [=+]* ]]; then
-		folder="$( $muttcmd -Q folder | sed -r 's|^folder=\"(.*)\"$|\1|' )"
-		: folder:=~/Mail
-
-		# Match any file in $folder beginning with $cur
-		# (minus the leading '=' sign).
-		COMPREPLY=( $( compgen -f -- "$folder/${cur:1}" ) )
-		COMPREPLY=( ${COMPREPLY[@]#$folder/} )
-		return 0
-	elif [ "$cur" == !* ]; then
-		spoolfile="$( $muttcmd -Q spoolfile | sed -r 's|^spoolfile=\"(.*)\"$|\1|' )"
-		[ ! -z "$spoolfile" ] && eval cur="${cur/^!/$spoolfile}";
-	fi
-	_filedir
-
-	return 0
-}
-
-_mutt()
-{
-	local cur prev
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	COMPREPLY=()
-	
-	[ ${COMP_WORDS[0]} == muttng ] && muttcmd="muttng" || muttcmd="mutt"
-
-	case "$cur" in
-	-*)
-		COMPREPLY=( $( compgen -W '-A -a -b -c -e -f -F -H -i -m -n \
-					    -p -Q -R -s -v -x -y -z -Z -h' \
-					    -- $cur ) )
-		return 0
-		;;
-	*)
-	    case "$prev" in
-	    -@(a|f|F|H|i))
-		    _muttfiledir
-		    return 0
-		    ;;
-	    -A)
-		    _muttaliases
-		    return 0
-		    ;;
-	    -@(e|m|Q|s|h|p|R|v|y|z|Z))
-		    return 0
-		    ;;
-	    *)
-		    _muttaddr
-		    return 0
-		    ;;
-	    esac
-	    ;;
-	esac
-	
-}
-complete -F _mutt $default $filenames mutt muttng
-}
-
-_configure_func()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	# if $COMP_CONFIGURE_HINTS is not null, then completions of the form
-	# --option=SETTING will include 'SETTING' as a contextual hint
-	[[ "$cur" != -* ]] && return 0
-
-	if [ -n "$COMP_CONFIGURE_HINTS" ]; then
-		COMPREPLY=( $( $1 --help | awk '/^  --[A-Za-z]/ { print $1; if ($2 ~ /--[A-Za-z]/) print $2 }' | sed -e 's/[[,].*//g' | grep ^$cur ) )
-
-	else
-		COMPREPLY=( $( $1 --help | awk '/^  --[A-Za-z]/ { print $1; if ($2 ~ /--[A-Za-z]/) print $2 }' | sed -e 's/[[,=].*//g' | grep ^$cur ) )
-	fi
-}
-complete -F _configure_func $default configure
-
-# Debian reportbug(1) completion
-#
-have reportbug &&
-_reportbug()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-	    -f|--filename|-i|--include|--mta|-o|--output)
-		_filedir
-		return 0
-		;;
-	    -B|--bts)
-		COMPREPLY=( $( compgen -W "debian guug kde mandrake help" -- \
-			       $cur ))
-		return 0
-		;;
-	    -e|--editor|--mua)
-		COMP_WORDS=(COMP_WORDS[0] $cur)
-		COMP_CWORD=1
-		_command
-		return 0
-		;;
-	    --mode)
-		COMPREPLY=( $( compgen -W "novice standard expert" -- $cur ) )
-		return 0
-		;;
-	    -S|--severity)
-		COMPREPLY=( $( compgen -W "grave serious important normal \
-					   minor wishlist" -- $cur ) )
-		return 0
-		;;
-	    -u|--ui|--interface)
-		COMPREPLY=( $( compgen -W "newt text gnome" -- $cur ) )
-		return 0
-		;;
-	    -t|--type)
-		COMPREPLY=( $( compgen -W "gnats debbugs" -- $cur ) )
-		return 0
-		;;
-	    -T|--tags)
-		COMPREPLY=( $( compgen -W "none patch security upstream sid \
-					   woody potato sarge fixed" -- $cur ))
-		return 0
-		;;
-	    *)
-		;;
-	esac
-	
-	COMPREPLY=($( compgen -W '-h --help -v --version -a --af -b \
-			--no-query-bts --query-bts -B --bts -c --configure \
-			--no-config-files --check-available -d --debug \
-			--no-check-available -e --editor --email -f \
-			--filename -g --gnupg -H --header -i --include -j \
-			--justification -l --ldap --no-ldap -L --list-cc -m \
-			--maintonly --mode --mua --mta --mutt -n --mh --nmh \
-			-o --output -p --print -P --pgp --proxy --http_proxy\
-			-q --quiet -Q --query-only --realname --report-quiet \
-			--reply-to --replyto -s --subject -S --severity \
-			--smtphost -t --type -T --tags --template -V -x \
-			--no-cc --package-version -z --no-compress \
-			--ui --interface -u \
-			wnpp boot-floppies kernel-image' -- $cur ) \
-	    		$( apt-cache pkgnames -- $cur 2> /dev/null ) )
-	_filedir
-	return 0
-} &&
-complete -F _reportbug $filenames reportbug
-
-# Debian querybts(1) completion
-#
-have querybts &&
-_querybts()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-	    -B|--bts)
-		COMPREPLY=( $( compgen -W "debian guug kde mandrake help" -- \
-			       $cur ))
-		return 0
-		;;
-	    -u|--ui|--interface)
-		COMPREPLY=($( compgen -W "newt text gnome" -- $cur ))
-		return 0
-		;;
-	    *)
-		;;
-	esac
-
-	COMPREPLY=($( compgen -W '-h --help -v --version -A --archive \
-			-B --bts -l --ldap --no-ldap --proxy= --http_proxy= \
-			-s --source -w --web -u --ui --interface \
-			wnpp boot-floppies' -- $cur ) \
-	    		$( apt-cache pkgnames -- $cur 2> /dev/null ) )
-} &&
-complete -F _querybts $filenames querybts
-
-# update-alternatives completion
-#
-have update-alternatives && {
-installed_alternatives()
-{
-	local admindir
-	# find the admin dir
-	for i in alternatives dpkg/alternatives rpm/alternatives; do
-		[ -d /var/lib/$i ] && admindir=/var/lib/$i && break
-	done
-	for (( i=1; i < COMP_CWORD; i++ )); do
-		if [[ "${COMP_WORDS[i]}" == --admindir ]]; then
-			admindir=${COMP_WORDS[i+1]}
-			break
-		fi
-	done
-	COMPREPLY=( $( command ls $admindir | grep "^$cur" ) )
-}
-
-_update_alternatives()
-{
-	local cur prev mode args i
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-	--@(altdir|admindir))
-		_filedir -d
-		return 0
-		;;
-	--@(help|version))
-		return 0
-		;;
-	esac
-
-	# find wich mode to use and how many real args used so far
-	for (( i=1; i < COMP_CWORD; i++ )); do
-		if [[ "${COMP_WORDS[i]}" == --@(install|remove|auto|display|config|remove-all) ]]; then
-			mode=${COMP_WORDS[i]}
-			args=$(($COMP_CWORD - i))
-			break
-		fi
-	done
-
-	case $mode in
-	--install)
-		case $args in
-		1)
-			_filedir
-			;;
-		2)
-			installed_alternatives
-			;;
-		3)
-			_filedir
-			;;
-		esac
-		;;
-	--remove)
-		case $args in
-		1)
-			installed_alternatives
-			;;
-		2)
-			_filedir
-			;;
-		esac
-		;;
-	--auto)
-		installed_alternatives
-		;;
-	--remove-all)
-		installed_alternatives
-		;;
-	--display)
-		installed_alternatives
-		;;
-	--config)
-		installed_alternatives
-		;;
-	*)
-		COMPREPLY=( $( compgen -W '--verbose --quiet --help --version \
-			       --altdir --admindir' -- $cur ) \
-			    $( compgen -W '--install --remove --auto --display \
-			       --config' -- $cur ) )
-	esac
-}
-complete -F _update_alternatives update-alternatives
-}
-
-# Python completion
-#
-have python &&
-_python()
-{
-	local prev cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]##*/}
-
-	case "$prev" in
-	-Q)
-		COMPREPLY=( $( compgen -W "old new warn warnall" -- $cur ) )
-		return 0
-		;;
-	-W)
-		COMPREPLY=( $( compgen -W "ignore default all module once error" -- $cur ) )
-		return 0
-		;;
-	-c)
-		_filedir '@(py|pyc|pyo)'
-		return 0
-		;;
-	!(python|-?))
-		[[ ${COMP_WORDS[COMP_CWORD-2]} != -@(Q|W) ]] && _filedir
-		;;
-	esac
-
-
-	# if '-c' is already given, complete all kind of files.
-	for (( i=0; i < ${#COMP_WORDS[@]}-1; i++ )); do
-		if [[ ${COMP_WORDS[i]} == -c ]]; then
-			_filedir
-		fi
-	done
-
-
-	if [[ "$cur" != -* ]]; then
-		_filedir '@(py|pyc|pyo)'
-	else
-		COMPREPLY=( $( compgen -W "- -d -E -h -i -O -Q -S -t -u \
-					   -U -v -V -W -x -c" -- $cur ) )
-	fi
-
-
-
-	return 0
-} &&
-complete -F _python $filenames python
-
-# Perl completion
-#
-have perl &&
-{
-_perlmodules()
-{
-    COMPREPLY=( $( compgen -P "$prefix" -W "$( perl -e 'sub mods { my ($base,$dir)=@_; return if  $base !~ /^\Q$ENV{cur}/; chdir($dir) or return; for (glob(q[*.pm])) {s/\.pm$//; print qq[$base$_\n]}; mods(/^(?:[.\d]+|$Config{archname}-$Config{osname}|auto)$/ ? undef : qq[${base}${_}\\\\:\\\\:],qq[$dir/$_]) for grep {-d} glob(q[*]); } mods(undef,$_) for @INC;' )" -- $cur ) )
-}
-
-_perl()
-{
-    local cur prev prefix temp
-
-    COMPREPLY=()
-    cur=`_get_cword`
-    prev=${COMP_WORDS[COMP_CWORD-1]}
-    prefix=""
-
-    # completing an option (may or may not be separated by a space)
-    if [[ "$cur" == -?* ]]; then
-	temp=$cur
-	prev=${temp:0:2}
-	cur=${temp:2}
-	prefix=$prev
-    fi
-
-    # only handle module completion for now
-    case "$prev" in
-    	-I|-x)
-	    COMPREPLY=( $( compgen -d -P "$prev" -- "$cur" ) )
-	    return 0
-	    ;;
-	-m|-M)
-	    _perlmodules
-	    return 0
-	    ;;
-    esac
-
-    # handle case where first parameter is not a dash option
-    if [[ "${COMP_WORDS[COMP_CWORD]}" != -* ]]; then
-	_filedir
-	return 0
-    fi
-
-    # complete using basic options
-    COMPREPLY=( $( compgen -W '-C -s -T -u -U -W -X -h -v -V -c -w -d -D -p \
-			-n -a -F -l -0 -I -m -M -P -S -x -i -e ' -- $cur ) )
-    return 0
-}
-complete -F _perl $filenames perl
-
-_perldoc()
-{
-    local cur prev prefix temp
-
-    COMPREPLY=()
-    cur=`_get_cword`
-    prev=${COMP_WORDS[COMP_CWORD-1]}
-    prefix=""
-
-    # completing an option (may or may not be separated by a space)
-    if [[ "$cur" == -?* ]]; then
-	temp=$cur
-	prev=${temp:0:2}
-	cur=${temp:2}
-	prefix=$prev
-    fi
-
-    # complete builtin perl functions
-    case $prev in
-	-f)
-	    COMPREPLY=( $( compgen -W 'chomp chop chr crypt hex index lc \
-	    lcfirst length oct ord pack q qq reverse rindex sprintf \
-	    substr tr uc ucfirst y m pos quotemeta s split study qr abs \
-	    atan2 cos exp hex int log oct rand sin sqrt srand pop push \
-	    shift splice unshift grep join map qw reverse sort unpack \
-	    delete each exists keys values binmode close closedir \
-	    dbmclose dbmopen die eof fileno flock format getc print \
-	    printf read readdir rewinddir seek seekdir select syscall \
-	    sysread sysseek syswrite tell telldir truncate warn write \
-	    pack read syscall sysread syswrite unpack vec -X chdir chmod \
-	    chown chroot fcntl glob ioctl link lstat mkdir open opendir \
-	    readlink rename rmdir stat symlink umask unlink utime caller \
-	    continue do dump eval exit goto last next redo return \
-	    sub wantarray caller import local my our package use defined \
-	    formline reset scalar undef \
-	    alarm exec fork getpgrp getppid getpriority kill pipe qx \
-	    setpgrp setpriority sleep system times wait waitpid \
-	    import no package require use bless dbmclose dbmopen package \
-	    ref tie tied untie use accept bind connect getpeername \
-	    getsockname getsockopt listen recv send setsockopt shutdown \
-	    socket socketpair msgctl msgget msgrcv msgsnd semctl semget \
-	    semop shmctl shmget shmread shmwrite endgrent endhostent \
-	    endnetent endpwent getgrent getgrgid getgrnam getlogin \
-	    getpwent getpwnam getpwuid setgrent setpwent endprotoent \
-	    endservent gethostbyaddr gethostbyname gethostent \
-	    getnetbyaddr getnetbyname getnetent getprotobyname \
-	    getprotobynumber getprotoent getservbyname getservbyport \
-	    getservent sethostent setnetent setprotoent setservent \
-	    gmtime localtime time times' -- $cur ) )
-	    return 0
-	    ;;
-    esac
-
-    case $cur in
-	-*)
-	    COMPREPLY=( $( compgen -W '-h -v -t -u -m -l -F -X -f -q' -- $cur ))
-	    return 0
-	    ;;
-	*/*)
-	    return 0
-	    ;;
-	*)
-	    _perlmodules
-	    COMPREPLY=( "${COMPREPLY[@]}" $( compgen -W '$( PAGER=cat man perl 2>/dev/null | sed -ne "/perl.*Perl overview/,/perlwin32/s/^[^a-z0-9]*\([a-z0-9]*\).*$/\1/p")' -- $cur ) )
-
-	    return 0
-	    ;;
-    esac
-}
-complete -F _perldoc $default perldoc
-}
-
-# rcs(1) completion
-#
-have rcs &&
-_rcs()
-{
-	local cur prev file dir i
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	file=${cur##*/}
-	dir=${cur%/*}
-
-	# deal with relative directory
-	[ "$file" = "$dir" ] && dir=.
-
-	COMPREPLY=( $( compgen -f "$dir/RCS/$file" ) )
-
-	for (( i=0; i < ${#COMPREPLY[@]}; i++ )); do
-		file=${COMPREPLY[$i]##*/}
-		dir=${COMPREPLY[$i]%RCS/*}
-		COMPREPLY[$i]=$dir$file
-	done
-	
-	COMPREPLY=( "${COMPREPLY[@]}" $( compgen -G "$dir/$file*,v" ) )
-
-	for (( i=0; i < ${#COMPREPLY[@]}; i++ )); do
-		COMPREPLY[$i]=${COMPREPLY[$i]%,v}
-	done
-
-	# default to files if nothing returned and we're checking in.
-	# otherwise, default to directories
-	[ ${#COMPREPLY[@]} -eq 0 -a $1 = ci ] && _filedir || _filedir -d
-} &&
-complete -F _rcs $filenames ci co rlog rcs rcsdiff
-
-# lilo(8) completion
-#
-have lilo && {
-_lilo_labels()
-{
-	COMPREPLY=( $( awk -F'=' '/label/ {print $2}' \
-		/etc/lilo.conf | sed -e 's/"//g' | grep "^$cur" ) )
-}
-
-_lilo()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case $prev in
-		-@(C|i|m|s|S))
-			_filedir
-			return 0
-			;;
-		-r)
-			_filedir -d
-			return 0
-			;;
-		-@(I|D|R))
-			# label completion
-			_lilo_labels
-			return 0
-			;;
-		-@(A|b|M|u|U))
-			# device completion
-			cur=${cur:=/dev/}
-			_filedir
-			return 0
-			;;
-		-T)
-			# topic completion
-			COMPREPLY=( $( compgen -W 'help ChRul EBDA geom geom= \
-					table= video' -- $cur ) )
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		# relevant options completion
-		COMPREPLY=( $( compgen -W '-A -b -c -C -d -f -g -i -I -l -L -m \
-			-M -p -P -q -r -R -s -S -t -T -u -U -v -V -w -x -z' -- \
-			$cur ) )
-	fi
-}
-complete -F _lilo lilo
-}
-
-# links completion
-#
-have links &&
-_links()
-{
-	local cur
-  
-	COMPREPLY=()
-	cur=`_get_cword`
-  
-	case "$cur" in
-	    --*)
-		COMPREPLY=( $( compgen -W '--help' -- $cur ) )
-		;;
-	    -*)
-		COMPREPLY=( $( compgen -W '-async-dns -max-connections \
-				-max-connections-to-host -retries \
-				-receive-timeout -unrestartable-receive-timeout\
-				-format-cache-size -memory-cache-size \
-				-http-proxy -ftp-proxy -download-dir \
-				-assume-codepage -anonymous -dump -no-connect \
-				-source -version -help' -- $cur ) )
-		;;
-	    *)
-		if [ -r ~/.links/links.his ]; then
-		    COMPREPLY=( $( compgen -W '$( < ~/.links/links.his )' \
-				   -- $cur ) )
-		fi
-				_filedir '@(htm|html)'
-				return 0
-		;;
-	esac
-  
-	return 0
-} &&
-complete -F _links $filenames links
-
-[ $UNAME = FreeBSD ] && {
-# FreeBSD package management tool completion
-#
-_pkg_delete()
-{
-	local cur pkgdir prev
-
-	pkgdir=${PKG_DBDIR:-/var/db/pkg}/
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	[ "$prev" = "-o" -o "$prev" = "-p" -o "$prev" = "-W" ] && return 0
-
-	COMPREPLY=( $( compgen -d $pkgdir$cur ) )
-	COMPREPLY=( ${COMPREPLY[@]#$pkgdir} )
-
-	return 0
-}
-complete -F _pkg_delete $dirnames pkg_delete pkg_info
-have pkg_deinstall && complete -F _pkg_delete $dirnames pkg_deinstall
-
-# FreeBSD kernel module commands
-#
-_kldload()
-{
-	local cur moddir
-
-	moddir=/modules/
-	[ -d $moddir ] || moddir=/boot/kernel/
-	cur=`_get_cword`
-
-	COMPREPLY=( $( compgen -f $moddir$cur ) )
-	COMPREPLY=( ${COMPREPLY[@]#$moddir} )
-	COMPREPLY=( ${COMPREPLY[@]%.ko} )
-
-	return 0
-}
-complete -F _kldload $filenames kldload
-
-_kldunload()
-{
-	local cur
-	cur=`_get_cword`
-	COMPREPLY=( $(kldstat | sed -ne "s/^.*[ \t]\+\($cur[a-z_]\+\).ko$/\1/p") )
-}
-complete -F _kldunload $filenames kldunload
-}
-
-# FreeBSD portupgrade completion
-#
-have portupgrade &&
-_portupgrade()
-{
-	local cur pkgdir prev
-
-	pkgdir=${PKG_DBDIR:-/var/db/pkg}/
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	[ "$prev" = "-l" -o "$prev" = "-L" -o "$prev" = "-o" ] && return 0
-
-	COMPREPLY=( $( compgen -d $pkgdir$cur ) )
-	COMPREPLY=( ${COMPREPLY[@]#$pkgdir} )
-	COMPREPLY=( ${COMPREPLY[@]%-*} )
-
-	return 0
-} &&
-complete -F _portupgrade $dirnames portupgrade
-
-# FreeBSD portinstall completion
-#
-have portinstall &&
-_portinstall()
-{
-	local cur portsdir prev indexfile
-	local -a COMPREPLY2
-
-	portsdir=${PORTSDIR:-/usr/ports}/
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-	# First try INDEX-5
-	indexfile=$portsdir/INDEX-5
-	# Then INDEX if INDEX-5 does not exist or system is not FreeBSD 5.x
-	[ "${OSTYPE%.*}" = "freebsd5" -a -f $indexfile ] ||
-	  indexfile=$portsdir/INDEX
-
-	[ "$prev" = "-l" -o "$prev" = "-L" -o "$prev" = "-o" ] && return 0
-
-	COMPREPLY=( $( egrep "^$cur" < $indexfile | cut -d'|' -f1 ) )
-	COMPREPLY2=( $( egrep "^[^\|]+\|$portsdir$cur" < $indexfile | \
-			cut -d'|' -f2 ) )
-	COMPREPLY2=( ${COMPREPLY2[@]#$portsdir} )
-	COMPREPLY=( "${COMPREPLY[@]}" "${COMPREPLY2[@]}" )
-
-	return 0
-} &&
-complete -F _portinstall $dirnames portinstall
-
-# Slackware Linux removepkg completion
-#
-have removepkg && [ -f /etc/slackware-version ] &&
-_removepkg()
-{
-	local packages cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	COMPREPLY=( $( (cd /var/log/packages; compgen -f -- "$cur") ) )
-} &&
-complete -F _removepkg $filenames removepkg &&
-	complete $dirnames -f -X '!*.tgz' installpkg upgradepkg explodepkg
-
-# look(1) completion
-#
-have look && 
-_look()
-{
-	local cur
-  
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [ $COMP_CWORD = 1 ]; then
-		COMPREPLY=( $( compgen -W '$(look $cur)' ) )
-	fi
-} &&
-complete -F _look $default look
-
-# ypcat(1) and ypmatch(1) completion
-#
-have ypmatch &&
-_ypmatch()
-{
-	local cur map
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	[ $1 = ypcat ] && [ $COMP_CWORD -gt 1 ] && return 0
-	[ $1 = ypmatch ] && [ $COMP_CWORD -gt 2 ] && return 0
-
-	if [ $1 = ypmatch ] && [ $COMP_CWORD -eq 1 ] && \
-	   [ ${#COMP_WORDS[@]} -eq 3 ]; then
-		map=${COMP_WORDS[2]}
-		COMPREPLY=( $( compgen -W '$( ypcat $map | \
-						cut -d':' -f 1 )' -- $cur) )
-	else
-		[ $1 = ypmatch ] && [ $COMP_CWORD -ne 2 ] && return 0
-		COMPREPLY=( $( compgen -W \
-			      '$( echo $(ypcat -x | cut -d"\"" -f 2))' -- $cur))
-	fi
-
-	return 0
-} &&
-complete -F _ypmatch ypmatch ypcat
-
-# mplayer(1) completion
-#
-have mplayer && {
-_mplayer_options_list()
-{
-	cur=${cur%\\}
-	COMPREPLY=( $( $1 $2 help 2> /dev/null | \
-		sed -e '1,/^Available/d' | awk '{print $1}' | \
-		sed -e 's/:$//' -e 's/^'${2#-}'$//' -e 's/<.*//' | \
-		grep "^$cur" ) )
-}
-
-_mplayer()
-{
-	local cmd cur prev skinsdir IFS=$' \t\n' i j k=0
-
-	COMPREPLY=()
-	cmd=${COMP_WORDS[0]}
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(ac|afm|vc|vfm|ao|vo|vop|fstype))
-			_mplayer_options_list mplayer $prev
-			return 0
-			;;
-		-@(oac|ovc|of))
-			_mplayer_options_list mencoder $prev
-			return 0
-			;;
-		-audiofile)
-			_filedir '@(mp3|MP3|mpg|MPG|ogg|OGG|wav|WAV|mid|MID|flac|FLAC|mka|MKA)'
-			return 0
-			;;
-		-font)
-			_filedir '@(desc|ttf)'
-			return 0
-			;;
-		-sub)
-			_filedir '@(srt|SRT|sub|SUB|txt|TXT|utf|UTF|rar|RAR|mpsub|smi|js|ssa|SSA|aas|AAS)'
-			return 0
-			;;
-		-vobsub)
-			_filedir '@(idx|IDX|ifo|IFO|sub|SUB)'
-			IFS=$'\t\n' 
-			COMPREPLY=( $( for i in "${COMPREPLY[@]}"; do
-						if [ -f $i -a -r $i ]; then
-							echo ${i%.*}
-						else
-							echo $i
-						fi
-				       done ) )
-			IFS=$' \t\n' 
-			return 0
-			;;
-		-ifo)
-			_filedir '@(ifo|IFO)'
-			return 0
-			;;
-		-cuefile)
-			_filedir '@(bin|BIN|cue|CUE)'
-			return 0
-			;;
-		-skin)
-			# if you don't have installed mplayer in /usr you
-			# may want to set the MPLAYER_SKINS_DIR global variable
-			if [ -n "$MPLAYER_SKINS_DIR" ]; then
-				skinsdir=$MPLAYER_SKINS_DIR
-			else
-				skinsdir=/usr/share/mplayer/Skin
-			fi
-
-			IFS=$'\t\n' 
-			for i in ~/.mplayer/Skin $skinsdir; do
-				if [ -d $i -a -r $i ]; then
-					for j in $( compgen -d $i/$cur ); do
-						COMPREPLY[$k]=${j#$i/}
-						k=$((++k))
-					done
-				fi
-			done
-			IFS=$' \t\n' 
-			return 0
-			;;
-		-@(mixer|@(cdrom|dvd)-device|dvdauth|fb|zrdev))
-			cur=${cur:=/dev/}
-			_filedir
-			return 0
-			;;
-		-@(edl?(out)|lircconf|menu-cfg|playlist|csslib|dumpfile)| \
-		-@(subfile|vobsub|aofile|fbmodeconfig|include|o|dvdkey)| \
-		-passlogfile)
-			_filedir
-			return 0
-			;;
-		-@(auto@(q|sync)|loop|menu-root|speed|sstep|aid|alang)| \
-		-@(?(@(audio|sub)-)demuxer|bandwidth|cache|chapter)| \
-		-@(dvd?(angle)|fps|frames|mc|passwd|user|sb|srate|ss|vcd)| \
-		-@(vi?(d|vo)|ffactor|sid|slang|spu@(align|aa|gauss))| \
-		-@(vobsubid|delay|bpp|brightness|contrast|dfbopts|display)| \
-		-@(fbmode|geometry|guiwid|hue|icelayer|screen[wh]|wid)| \
-		-@(monitor@(aspect|-@(dotclock|[hv]freq))|panscan|saturation)| \
-		-@(xineramascreen|zr@(crop|norm|quality|[xy]doff|[vh]dec))| \
-		-@(aspect|pp|x|y|xy|z|stereo|audio-@(density|delay|preload))| \
-		-@(endpos|osdlevel|ffourcc|sws|channels|skiplimit|format)| \
-		-@(ofps|aa@(driver|@(osd|sub)color)|vobsubout?(i@(ndex|d)))| \
-		-sub@(-bg-@(alpha|color)|cp|delay|fps|pos|align|width)| \
-		-sub@(font-@(blur|outline|autoscale|encoding|@(osd|text)-scale)))
-			return 0
-			;;
-		-lavdopts)
-			COMPREPLY=( $( compgen -W 'ec er= bug= idct= gray' \
-					-- $cur ) )
-			return 0
-			;;
-		-lavcopts)
-			COMPREPLY=( $( compgen -W 'vcodec= vqmin= vqscale= \
-					vqmax= mbqmin= mbqmax= vqdiff= \
-					vmax_b_frames= vme= vhq v4mv \
-					keyint= vb_strategy= vpass= \
-					aspect= vbitrate= vratetol= \
-					vrc_maxrate= vrc_minrate= \
-					vrc_buf_size= vb_qfactor= vi_qfactor= \
-					vb_qoffset= vi_qoffset= vqblur= \
-					vqcomp= vrc_eq= vrc_override= \
-					vrc_init_cplx= vqsquish= vlelim= \
-					vcelim= vstrict= vdpart vpsize= gray \
-					vfdct= idct= lumi_mask= dark_mask= \
-					tcplx_mask= scplx_mask= naq ildct \
-					format= pred qpel precmp= cmp= \
-					subcmp= predia= dia= trell last_pred= \
-					preme= subq= psnr mpeg_quant aic umv' \
-					-- $cur ) )
-			return 0
-			;;
-		-ssf)
-			COMPREPLY=( $( compgen -W 'lgb= cgb= ls= cs= chs= \
-					cvs=' -- $cur ) )
-			return 0
-			;;
-		-jpeg)
-			COMPREPLY=( $( compgen -W 'noprogressive progressive \
-					nobaseline baseline optimize= \
-					smooth= quality= outdir=' -- $cur ) )
-			return 0
-			;;
-		-xvidopts)
-			COMPREPLY=( $( compgen -W 'dr2 nodr2' -- $cur ) )
-			return 0
-			;;
-		-xvidencopts)
-			COMPREPLY=( $( compgen -W 'pass= bitrate= \
-					fixed_quant= me_quality= 4mv \
-					rc_reaction_delay_factor= \
-					rc_averaging_period= rc_buffer= \
-					quant_range= min_key_interval= \
-					max_key_interval= mpeg_quant \
-					mod_quant lumi_mask hintedme \
-					hintfile debug keyframe_boost= \
-					kfthreshold= kfreduction=' -- $cur ) )
-			return 0
-			;;
-		-divx4opts)
-			COMPREPLY=( $( compgen -W 'br= key= deinterlace q= \
-					min_quant= max_quant= rc_period= \
-					rc_reaction_period= crispness= \
-					rc_reaction_ratio= pass= vbrpass= \
-					help' -- $cur ) )
-			return 0
-			;;
-		-info)
-			COMPREPLY=( $( compgen -W 'name= artist= genre= \
-					subject= copyright= srcform= \
-					comment= help' -- $cur ) )
-			return 0
-			;;
-		-lameopts)
-			COMPREPLY=( $( compgen -W 'vbr= abr cbr br= q= aq= \
-					ratio= vol= mode= padding= fast \
-					preset= help' -- $cur ) )
-			return 0
-			;;
-		-rawaudio)
-			COMPREPLY=( $( compgen -W 'on channels= rate= \
-					samplesize= format=' -- $cur ) )
-			return 0
-			;;
-		-rawvideo)
-			COMPREPLY=( $( compgen -W 'on fps= sqcif qcif cif \
-					4cif pal ntsc w= h= y420 yv12 yuy2 \
-					y8 format= size=' -- $cur ) )
-			return 0
-			;;
-		-aop)
-			COMPREPLY=( $( compgen -W 'list= delay= format= fout= \
-					volume= mul= softclip' -- $cur ) )
-			return 0
-			;;
-		-dxr2)
-			COMPREPLY=( $( compgen -W 'ar-mode= iec958-encoded \
-					iec958-decoded mute ucode= 75ire bw \
-					color interlaced macrovision= norm= \
-					square-pixel ccir601-pixel cr-left= \
-					cr-right= cr-top= cr-bot= ck-rmin= \
-					ck-gmin= ck-bmin= ck-rmax= ck-gmax= \
-					ck-bmax= ck-r= ck-g= ck-b= \
-					ignore-cache= ol-osd= olh-cor= \
-					olw-cor= olx-cor= oly-cor= overlay \
-					overlay-ratio= update-cache' -- $cur ))
-			return 0
-			;;
-		-tv)
-			COMPREPLY=( $( compgen -W 'on noaudio driver= device= \
-					input= freq= outfmt= width= height= \
-					buffersize= norm= channel= chanlist= \
-					audiorate= forceaudio alsa amode= \
-					forcechan= adevice= audioid= volume= \
-					bass= treble= balance= fps= \
-					channels= immediatemode=' -- $cur ) )
-			return 0
-			;;
-		-mf)
-			COMPREPLY=( $( compgen -W 'on w= h= fps= type=' \
-					-- $cur ) )
-			return 0
-			;;
-		-cdda)
-			COMPREPLY=( $( compgen -W 'speed= paranoia= \
-					generic-dev= sector-size= overlap= \
-					toc-bias toc-offset= skip noskip' \
-					-- $cur ) )
-			return 0
-			;;
-		-input)
-			COMPREPLY=( $( compgen -W 'conf= ar-delay ar-rate \
-					keylist cmdlist js-dev file' -- $cur ) )
-			return 0
-			;;
-		-af)
-			COMPREPLY=( $( compgen -W 'resample resample= \
-					channels channels= format format= \
-					volume volume= delay delay= pan \
-					pan= sub sub= surround surround=' \
-					-- $cur ) )
-			return 0
-			;;
-		-af-adv)
-			COMPREPLY=( $( compgen -W 'force= list=' -- $cur ) )
-			return 0
-			;;
-	esac
-
-	case "$cur" in
-		-*)
-			COMPREPLY=( $( compgen -W '-aid -alang -audio-demuxer \
-					-audiofile -cdrom-device -cache -cdda \
-					-channels -chapter -csslib -demuxer \
-					-dvd -dvd-device -dvdangle -dvdauth \
-					-dvdkey -dvdnav -forceidx -fps -frames \
-					-hr-mp3-seek -idx -mc -mf -ni -nobps \
-					-passwd -rawaudio -rtsp-stream-over-tcp\
-					-skipopening -sb -srate -ss -tv -user \
-					-vcd -vid -vivo -ifo -ffactor -font \
-					-noautosub -nooverlapsub -sid -slang \
-					-sub -subcc -subcp -sub-demuxer \
-					-subdelay -subfont-autoscale \
-					-subfont-blur -subfont-encoding \
-					-subfont-osd-scale -subfont-outline \
-					-subfont-text-scale -subfps -subfile \
-					-subpos -unicode -utf8 -vobsub \
-					-vobsubid -ac -afm -aspect -flip \
-					-lavdopts -noaspect -nosound -pp -ssf \
-					-stereo -sws -vc -vfm -vop -xvidopts\
-					-xy -zoom -bandwidth -cuefile \
-					-noextbased -rawvideo -overlapsub \
-					-sub-bg-alpha -sub-bg-color -subalign \
-					-subwidth -sub-no-text-pp -spualign \
-					-spuaa -spugauss -pphelp -verbose -v \
-					-noni -noidx -nohr-mp3-seek -extbased \
-					-bps -oldpp -nozoom -noflip -nounicode \
-					-noutf8' -- $cur ) )
-			# add mplayer specific options
-			[[ "$cmd" == @(?(g)mplayer) ]] && COMPREPLY=( "${COMPREPLY[@]}" \
-				$(compgen -W '-autoq -autosync -benchmark \
-					-framedrop -h -help -hardframedrop \
-					-identify -input -lircconf -loop \
-					-nojoystick -nolirc -nortc -playlist \
-					-quiet -really-quiet -rnd -sdp -skin \
-					-slave -softsleep -speed -sstep \
-					-use-stdin -dumpaudio -dumpfile \
-					-dumpstream -dumpvideo -dumpmicrodvdsub\
-					-dumpmpsub -dumpsrtsub -dumpjacosub \
-					-dumpsami -dumpsub -osdlevel -af \
-					-af-adv -ao -aofile -aop -delay -mixer \
-					-nowaveheader -bpp -brightness \
-					-contrast -display -double -dr -dxr2 \
-					-fb -fbmode -fbmodeconfig -forcexv -fs \
-					-geometry -hue -icelayer -jpeg \
-					-monitor-dotclock -monitor-hfreq \
-					-monitor-vfreq -monitoraspect \
-					-nograbpointer -noslices -panscan \
-					-rootwin -saturation -screenw -screenh \
-					-stop-xscreensaver -vm -vo -vsync -wid \
-					-xineramascreen -z -zrbw -zrcrop \
-					-zrdev -zrfd -zrhelp -zrnorm -zrquality \
-					-zrvdec -zrhdec -zrxdoff -zrydoff -y \
-					-edl -edlout -enqueue -fixed-vo \
-					-menu -menu-root -menu-cfg -shuffle \
-					-format -aahelp -dfbopts -fstype \
-					-guiwid -nokeepaspect -x --help \
-					-aaosdcolor -aasubcolor -aadriver \
-					-aaextended -aaeight' -- $cur) )
-			# add mencoder specific options
-			[[ "$cmd" = mencoder ]] && COMPREPLY=( "${COMPREPLY[@]}" \
-				$(compgen -W '-audio-density -audio-delay \
-					-audio-preload -divx4opts -endpos \
-					-ffourcc -include -info -lameopts \
-					-lavcopts -noskip -o -oac -ofps -ovc \
-					-passlogfile -skiplimit -vobsubout \
-					-vobsuboutindex -vobsuboutid \
-					-xvidencopts -of --verbose' -- $cur) )
-			;;
-		*)
-			_filedir '@(mp?(e)g|MP?(E)G|wm[av]|WM[AV]|avi|AVI|asf|ASF|vob|VOB|bin|BIN|dat|DAT|vcd|VCD|ps|PS|pes|PES|fli|FLI|flv|FLV|viv|VIV|rm?(j)|RM?(J)|ra?(m)|RA?(M)|yuv|YUV|mov|MOV|qt|QT|mp[34]|MP[34]|m4v|M4V|og[gm]|OG[GM]|wav|WAV|dump|DUMP|mk[av]|MK[AV]|m4a|M4A|aac|AAC|m2v|M2V|dv|DV|rmvb|RMVB|mid|MID|ts|TS|3gp|mpc|MPC|flac|FLAC|flv|FLV|divx|DIVX)'
-			;;
-	esac
-
-	return 0
-}
-complete $filenames -F _mplayer mplayer mencoder gmplayer kplayer
-}
-
-# KDE dcop completion
-#
-have dcop &&
-_dcop()
-{
-	local cur compstr
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	if [ -z $cur ]; then
-	    compstr=${COMP_WORDS[*]}
-	else
-	    compstr=$( command echo ${COMP_WORDS[*]} | sed "s/ $cur$//" )
-	fi
-	COMPREPLY=( $( compgen -W '$( command $compstr | sed s/\(.*\)// )'  -- $cur ) )
-} &&
-complete -F _dcop dcop
-
-# wvdial(1) completion
-#
-have wvdial &&
-_wvdial()
-{
-	local cur prev config i IFS=$'\t\n'
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case $prev in
-		--config)
-			_filedir
-			return 0
-			;;
-	esac
-
-	case $cur in
-		-*)
-			COMPREPLY=( $( compgen -W '--config --chat \
-				--remotename --help --version --no-syslog' \
-				-- $cur ) )
-			;;
-		*)
-			# start with global and personal config files
-		       	config="/etc/wvdial.conf"$'\t'"$HOME/.wvdialrc"
-			# replace with command line config file if present
-			for (( i=1; i < COMP_CWORD; i++ )); do
-				if [[ "${COMP_WORDS[i]}" == "--config" ]]; then
-					config=${COMP_WORDS[i+1]}
-					break
-				fi
-			done
-			# parse config files for sections and
-			# remove default section
-			COMPREPLY=( $( sed -ne \
-				    "s|^\[Dialer \($cur.*\)\]$|\1|p" \
-				    $config 2>/dev/null |grep -v '^Defaults$'))
-			# escape spaces
-			COMPREPLY=${COMPREPLY// /\\ }
-			;;
-	esac
-
-} &&
-complete -F _wvdial wvdial
-
-# gpg(1) completion
-#
-have gpg &&
-_gpg() 
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-	-@(s|-sign|-clearsign|-decrypt-files|-load-extension)) 
-		_filedir
-		return 0
-		;;
-	--@(export|@(?(l|nr|nrl)sign|edit)-key)) 
-		# return list of public keys
-		COMPREPLY=( $( compgen -W "$( gpg --list-keys 2>/dev/null | sed -ne 's@^pub.*/\([^ ]*\).*\(<\([^>]*\)>\).*$@\1 \3@p')" -- "$cur" ))
-		return 0
-		;;
-	-@(r|-recipient))
-		COMPREPLY=( $( compgen -W "$( gpg --list-keys 2>/dev/null | sed -ne 's@^pub.*<\([^>]*\)>.*$@\1@p')" -- "$cur" ))
-		if [ -e ~/.gnupg/gpg.conf ]; then
-			COMPREPLY=( "${COMPREPLY[@]}" $( compgen -W "$( sed -ne 's@^[ \t]*group[ \t][ \t]*\([^=]*\).*$@\1@p' ~/.gnupg/gpg.conf  )" -- "$cur") )
-		fi
-		return 0
-		;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-s -b -e -f -c -d -a -r -u -Z -o -v\
-				-q -n -N $(gpg --dump-options)' -- $cur ) )
-	 fi
-
-} &&
-complete -F _gpg $default gpg
-
-# iconv(1) completion
-#
-have iconv &&
-_iconv()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(f|t|-@(from|to)-code))
-			COMPREPLY=( $( compgen -W \
-			    '$( iconv --list | sed -e "s@//@@;" )' -- "$cur" ) )
-			return 0
-			;;
-	esac
-
-
-	if [[ "$cur" = -* ]]; then
-		COMPREPLY=( $( compgen -W '--from-code -f --to-code -t --list
-		--output -o --verbose' -- "$cur" ) )
-		return 0
-	fi
-} &&
-complete -F _iconv $default iconv
-
-# dict(1) completion
-#
-{ have dict || have rdict; } && {
-_dictdata()
-{
-	dict $host $port $1 2>/dev/null | sed -ne \
-	    's/^['$'\t '']['$'\t '']*\([^'$'\t '']*\).*$/\1/p'
-}
-
-_dict()
-{
-	local cur prev host port db dictfile
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-	dictfile=/usr/share/dict/words
-
-	for (( i=1; i < COMP_CWORD; i++ )); do
-		case "${COMP_WORDS[i]}" in
-		-@(h|--host))
-			host=${COMP_WORDS[i+1]}
-			[ -n "$host" ] && host="-h $host"
-			i=$((++i))
-			;;
-		-@(p|-port))
-			port=${COMP_WORDS[i+1]}
-			[ -n "$port" ] && port="-p $port"
-			i=$((++i))
-			;;
-		-@(d|-database))
-			db=${COMP_WORDS[i+1]}
-			[ -n "$db" ] && host="-d $db"
-			i=$((++i))
-			;;
-		*)
-			;;
-		esac
-	done
-
-	if [[ "$cur" = -* ]]; then
-		COMPREPLY=( $( compgen -W '-h --host -p --port -d --database \
-			       -m --match -s --strategy -c --config -C \
-			       --nocorrect -D --dbs -S --strats -H \
-			       --serverhelp -i --info -I --serverinfo \
-			       -a --noauth -u --user -k --key -V --version \
-			       -L --license --help -v --verbose -r --raw \
-			       -P --pager --debug --html --pipesize --client' \
-			       -- "$cur" ) )
-		return 0
-	fi
-
-	case "$prev" in
-	-@(d|-database|i|info))
-		COMPREPLY=( $( compgen -W '$( _dictdata -D )' -- "$cur" ) )
-		return 0
-		;;
-	-@(s|-strategy))
-		COMPREPLY=( $( compgen -W '$( _dictdata -S )' -- "$cur" ) )
-		return 0
-		;;
-	*)
-		;;
-	esac
-
-	[ -r $dictfile ] && \
-		COMPREPLY=( $( compgen -W '$( cat $dictfile )' -- "$cur" ) )
-}
-complete -F _dict $default dict rdict
-}
-
-# cdrecord(1) completion
-#
-have cdrecord &&
-_cdrecord()
-{
-	local cur prev i generic_options track_options track_mode
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	# foo=bar style option
-	if [[ "$cur" == *=* ]]; then
-		prev=${cur/=*/}
-		cur=${cur/*=/}
-		case "$prev" in
-			@(text|cue)file)
-				_filedir
-				return 0
-				;;
-			blank)
-				COMPREPLY=( $( compgen -W 'help all fast \
-				track unreserve trtail unclose session' \
-				-- $cur ) )
-				return 0
-				;;
-			driveropts)
-				COMPREPLY=( $( compgen -W 'burnfree noburnfree\
-				  varirec= audiomaster forcespeed noforcespeed\
-				  speedread nospeedread singlesession \
-				  nosinglesession hidecdr nohidecdr tattooinfo\
-				  tattoofile=' -- $cur ) )
-				return 0
-				;;
-		esac
-	fi
-
-	generic_options=(-version -v -V -d -silent -s -force -immed -dummy \
-			 -dao -raw -raw96r -raw96p -raw16 -multi -msinfo -toc \
-			 -atip -fix -nofix -waiti -load -lock -eject -format \
-			 -setdropts -checkdrive -prcap -inq -scanbus -reset \
-			 -abort -overburn -ignsize -useinfo -packet -noclose \
-			 -text debug= kdebug= kd= minbuf= speed= blank= fs= \
-			 dev= gracetime= timeout= driver= driveropts= \
-			 defpregap= pktsize= mcn= textfile= cuefile=)
-	track_options=(-audio -swab -data -mode2 -xa -xa1 -xa2 -xamix -cdi \
-		       -isosize -pad padsize= -nopad -shorttrack -noshorttrack\
-		       pregap= -preemp -nopreemp -copy -nocopy -scms tcsize= \
-		       isrc= index=)
-	# look if previous was either a file or a track option
-	track_mode=0
-	if [ $COMP_CWORD -gt 1 ]; then
-		if [ -f "$prev" ]; then
-			track_mode=1
-		else
-			for (( i=0; i < ${#track_options[@]}; i++ )); do
-				if [[ "${track_options[i]}" == "$prev" ]]; then
-					track_mode=1
-					break
-				fi
-			done
-		fi
-	fi
-
-	# files are always eligible completion
-	_filedir
-	# track options are always available
-	COMPREPLY=( "${COMPREPLY[@]}" $( compgen -W '${track_options[@]}' -- $cur ) )
-	# general options are no more available after file or track option
-	if [ $track_mode -eq 0 ]; then
-		COMPREPLY=( "${COMPREPLY[@]}" \
-			    $( compgen -W '${generic_options[@]}' -- $cur ) )
-	fi
-
-} &&
-complete -F _cdrecord $filenames cdrecord
-
-# mkisofs(8) completion
-#
-have mkisofs &&
-_mkisofs()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(o|abstract|biblio|check-session|copyright|log-file|root-info|prep-boot|*-list))
-			_filedir
-			return 0
-			;;
-		-*-charset)
-			COMPREPLY=( $( mkisofs -input-charset help 2>&1 | \
-					tail +3 | grep "^$cur") )
-			return 0
-			;;
-		-uid)
-			_uids
-			return 0
-			;;
-		-gid)
-			_gids
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-abstract -A -allow-lowercase \
-				-allow-multidot -biblio -cache-inodes \
-				-no-cache-inodes -b -eltorito-alt-boot -B -G \
-				-hard-disk-boot -no-emul-boot -no-boot \
-				-boot-load-seg -boot-load-size \
-				-boot-info-table -C -c -check-oldname \
-				-check-session -copyright -d -D -dir-mode \
-				-dvd-video -f -file-mode -gid -gui \
-				-graft-points -hide -hide-list -hidden \
-				-hidden-list -hide-joliet -hide-joliet-list \
-				-hide-joliet-trans-tbl -hide-rr-moved \
-				-input-charset -output-charset -iso-level -J \
-				-joliet-long -jcharset -l -L -log-file -m \
-				-exclude-list -max-iso9660-filenames -M -N \
-				-new-dir-mode -nobak -no-bak -force-rr -no-rr \
-				-no-split-symlink-components \
-				-no-split-symlink-fields -o -pad -no-pad \
-				-path-list -P -p -print-size -quiet -R -r \
-				-relaxed-filenames -sort -split-output \
-				-stream-media-size -stream-file-name -sysid -T\
-				-table-name -ucs-level -udf -uid \
-				-use-fileversion -U -no-iso-translate -V \
-				-volset -volset-size -volset-seqno -v -x -z \
-				-hfs -apple -map -magic -hfs-creator \
-				-hfs-type -probe -no-desktop -mac-name \
-				-boot-hfs-file -part -auto -cluster-size \
-				-hide-hfs -hide-hfs-list -hfs-volid \
-				-icon-position -root-info -prep-boot \
-				-input-hfs-charset -output-hfs-charset \
-				-hfs-unlock -hfs-bless -hfs-parms --cap \
-				--netatalk --double --ethershare --ushare \
-				--exchange --sgi --xinet --macbin --single \
-				--dave --sfm --osx-double --osx-hfs' -- $cur ))
-	else
-		_filedir
-	fi
-
-} &&
-complete -F _mkisofs $filenames mkisofs
-
-# mc(1) completion
-#
-have mc &&
-_mc()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	# -name value style option
-	case "$prev" in
-		-@(e|v|l|P))
-			_filedir
-			return 0
-			;;
-	esac
-
-	# --name=value style option
-	if [[ "$cur" == *=* ]]; then
-		prev=${cur/=*/}
-		cur=${cur/*=/}
-		case "$prev" in
-			--@(edit|view|ftplog|printwd))
-				_filedir
-				return 0
-				;;
-		esac
-	fi
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-a --stickchars -b --nocolor -c \
-			--color -C --colors= -d --nomouse -e --edit= -f \
-			--datadir -k --resetsoft -l --ftplog= -P --printwd= \
-			-s --slow -t --termcap -u --nosubshell -U --subshell \
-			-v --view= -V --version -x --xterm -h --help' -- $cur ) )
-	else
-		_filedir -d
-	fi
-} &&
-complete -F _mc $filenames mc
-
-# yum(8) completion
-#
-have yum && {
-_yum()
-{
-	local cur prev special
-	
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	for (( i=0; i < ${#COMP_WORDS[@]}-1; i++ )); do
-		if [[ ${COMP_WORDS[i]} == @(install|update|upgrade|remove|erase|deplist) ]]; then
-			special=${COMP_WORDS[i]}
-		fi
-	done
-
-	if [ -n "$special" ]; then
-	    case $special in
-		install|deplist)
-		    COMPREPLY=( $( compgen -W '$( yum -C list | cut -d" " -f1 )' -- $cur ) )
-		    return 0
-		    ;;
-		*)
-		    _rpm_installed_packages
-		    return 0
-		    ;;
-		esac
-	fi
-
-	case $cur in
-	    --*)
-		COMPREPLY=( $( compgen -W '--installroot --version --help --enablerepo --disablerepo --exclude --obsoletes --noplugins' -- $cur ) )
-		return 0
-		;;
-	    -*)
-		COMPREPLY=( $( compgen -W '-c -e -d -y -t -R -C -h' -- $cur ) )
-		return 0
-		;;
-	esac
-
-	case $prev in
-	    list)
-		COMPREPLY=( $( compgen -W 'all available updates installed extras obsoletes recent' -- $cur ) )
-		;;
-	    clean)
-		COMPREPLY=( $( compgen -W 'packages headers metadata cache dbcache all' -- $cur ) )
-		;;
-	    localinstall)
-		_filedir rpm
-		;;
-	    -c)
-		_filedir
-		;;
-	    --installroot)
-		_filedir -d
-		;;
-	    *)
-		COMPREPLY=( $( compgen -W 'install update check-update upgrade remove list \
-						search info provides clean groupinstall groupupdate \
-						grouplist deplist erase groupinfo groupremove \
-						localinstall localupdate makecache resolvedep \
-						shell whatprovides' -- $cur ) )
-		;;
-	esac
-}
-complete -F _yum $filenames yum
-
-# yum-arch(8) completion
-#
-_yum_arch()
-{
-    local cur
-    COMPREPLY=()
-    cur=`_get_cword`
-
-    case "$cur" in
-	-*)
-	    COMPREPLY=( $( compgen -W '-d -v -vv -n -c -z -s -l -q' -- $cur ) )
-	    ;;
-	*)
-	    _filedir -d
-	    ;;
-    esac
-
-    return 0
-
-}
-complete -F _yum_arch $filenames yum-arch
-}
-
-# ImageMagick completion
-#
-have convert && {
-_ImageMagick()
-{
-	local prev
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-channel)
-			COMPREPLY=( $( compgen -W 'Red Green Blue Opacity \
-				Matte Cyan Magenta Yellow Black' -- $cur ) )
-			return 0
-			;;
-		-colormap)
-			COMPREPLY=( $( compgen -W 'shared private' -- $cur ) )
-			return 0
-			;;
-		-colorspace)
-			COMPREPLY=( $( compgen -W 'GRAY OHTA RGB Transparent \
-				XYZ YCbCr YIQ YPbPr YUV CMYK' -- $cur ) )
-			return 0
-			;;
-		-compose)
-			COMPREPLY=( $( compgen -W 'Over In Out Atop Xor Plus \
-				Minus Add Subtract Difference Multiply Bumpmap\
-				Copy CopyRed CopyGreen CopyBlue CopyOpacity' \
-				-- $cur ) )
-			return 0
-			;;
-		-compress)
-			COMPREPLY=( $( compgen -W 'None BZip Fax Group4 JPEG \
-				Lossless LZW RLE Zip' -- $cur ) )
-			return 0
-			;;
-		-dispose)
-			COMPREPLY=( $( compgen -W 'Undefined None Background \
-						    Previous' -- $cur ) )
-			return 0
-			;;
-		-encoding)
-			COMPREPLY=( $( compgen -W 'AdobeCustom AdobeExpert \
-				AdobeStandard AppleRoman BIG5 GB2312 Latin2 \
-				None SJIScode Symbol Unicode Wansung' -- $cur))
-			return 0
-			;;
-		-endian)
-			COMPREPLY=( $( compgen -W 'MSB LSB' -- $cur ) )
-			return 0
-			;;
-		-filter)
-			COMPREPLY=( $( compgen -W 'Point Box Triangle Hermite \
-				Hanning Hamming Blackman Gaussian Quadratic \
-				Cubic Catrom Mitchell Lanczos Bessel Sinc' \
-				-- $cur ) )
-			return 0
-			;;
-		-format)
-			COMPREPLY=( $( convert -list format | \
-				    awk '/ [r-][w-][+-] / {print $1}' | \
-				    tr -d '*' | tr [:upper:] [:lower:] | \
-				    grep "^$cur" ) )
-			return 0
-			;;
-		-gravity)
-			COMPREPLY=( $( compgen -W 'Northwest North NorthEast \
-				West Center East SouthWest South SouthEast' \
-				-- $cur ) )
-			return 0
-			;;
-		-intent)
-			COMPREPLY=( $( compgen -W 'Absolute Perceptual \
-					Relative Saturation' -- $cur ) )
-			return 0
-			;;
-		-interlace)
-			COMPREPLY=( $( compgen -W 'None Line Plane Partition' \
-					-- $cur ) )
-			return 0
-			;;
-		-limit)
-			COMPREPLY=( $( compgen -W 'Disk File Map Memory' \
-					-- $cur ) )
-			return 0
-			;;
-		-list)
-			COMPREPLY=( $( compgen -W 'Delegate Format Magic \
-					Module Resource Type' -- $cur ) )
-			return 0
-			;;
-		-map)
-			COMPREPLY=( $( compgen -W 'best default gray red \
-					green blue' -- $cur ) )
-			_filedir
-			return 0
-			;;
-		-noise)
-			COMPREPLY=( $( compgen -W 'Uniform Gaussian \
-					Multiplicative \
-				Impulse Laplacian Poisson' -- $cur ) )
-			return 0
-			;;
-		-preview)
-			COMPREPLY=( $( compgen -W 'Rotate Shear Roll Hue \
-					Saturation Brightness Gamma Spiff \
-					Dull Grayscale Quantize Despeckle \
-					ReduceNoise AddNoise Sharpen Blur \
-					Treshold EdgeDetect Spread Shade \
-					Raise Segment Solarize Swirl Implode \
-					Wave OilPaint CharcoalDrawing JPEG' \
-					-- $cur ) )
-			return 0
-			;;
-		-@(mask|profile|texture|tile|write))
-			_filedir
-			return 0
-			;;
-		-type)
-			COMPREPLY=( $( compgen -W 'Bilevel Grayscale Palette \
-					PaletteMatte TrueColor TrueColorMatte \
-					ColorSeparation ColorSeparationlMatte \
-					Optimize' -- $cur ) )
-			return 0
-			;;
-		-units)
-			COMPREPLY=( $( compgen -W 'Undefined PixelsPerInch \
-					PixelsPerCentimeter' -- $cur ) )
-			return 0
-			;;
-		-virtual-pixel)
-			COMPREPLY=( $( compgen -W 'Constant Edge mirror tile' \
-					-- $cur ) )
-			return 0
-			;;
-		-visual)
-			COMPREPLY=( $( compgen -W 'StaticGray GrayScale \
-					StaticColor PseudoColor TrueColor \
-					DirectColor defaut visualid' -- $cur ))
-			return 0
-			;;
-	esac
-}
-
-_convert()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	_ImageMagick
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-adjoin -affine -antialias -append \
-			-authenticate -average -background -black-threshold \
-			-blue-primary -blur -border -bordercolor -channel \
-			-charcoal -chop -clip -coalesce -colorize -colors \
-			-colorspace -comment -compress -contrast -convolve \
-			-crop -cycle -debug -deconstruct -delay -density \
-			-depth -despeckle -display -dispose -dither -draw \
-			-edge -emboss -encoding -endian -enhance -equalize \
-			-extract -fill -filter -flatten -flip -flop -font \
-			-frame -fuzz -gamma -gaussian -geometry \
-			-green-primary -gravity -help -implode -intent \
-			-interlace -label -lat -level -limit -list -log -loop \
-			-map -mask -matte -median -modulate -monochrome \
-			-morph -mosaic -negate -noop -noise -normalize \
-			-opaque -ordered-dither -page -paint -ping -pointsize \
-			-preview -profile -quality -raise -random-threshold \
-			-region -raise -red-primary -render -resize -resample \
-			-roll -rotate -sample -sampling-factor -scale -scene \
-			-seed -segment -shade -sharpen -shave -shear -size \
-			-solarize -spread -stroke -strokewidth -swirl \
-			-texture -threshold -thumbnail -tile -transform \
-			-transparent -treedepth -trim -type -undercolor \
-			-units -unsharp -verbose -version -view \
-			-virtual-pixel -wave -white-point -white-threshold \
-			-write' -- $cur ) )
-	elif [[ "$cur" == +* ]]; then
-		COMPREPLY=( $( compgen -W '+adjoin +append +compress \
-			+contrast +debug +dither +endian +gamma +label +map \
-			+mask +matte +negate +noise +page +raise +render \
-			+write' -- $cur ) ) 
-	else
-		_filedir
-	fi
-}
-complete -F _convert $filenames convert
-
-_mogrify()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	_ImageMagick
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-affine -antialias -authenticate \
-			-background -black-threshold -blue-primary -blur \
-			-border -bordercolor -channel -charcoal -chop \
-			-colorize -colors -colorspace -comment -compress \
-			-contrast -convolve -crop -cycle -debug -delay \
-			-density -depth -despeckle -display -dispose -dither \
-			-draw -edge -emboss -encoding -endian -enhance \
-			-equalize -extract -fill -filter -flip -flop -font \
-			-format -frame -fuzz -gamma -gaussian -geometry \
-			-green-primary -implode -interlace -help -label -lat \
-			-level -limit -list -log -loop -map -mask -matte \
-			-median -modulate -monochrome -negate -noop \
-			-normalize -opaque -page -paint -fill -ordered-dither \
-			-pointsize -profile -quality -raise -random-threshold \
-			-red-primary -region -resample -resize -roll -rotate \
-			-sample -sampling-factor -scale -scene -seed -segment \
-			-shade -sharpen -shear -size -solarize -spread \
-			-stroke -strokewidth -swirl -texture -threshold \
-			-thumbnail -tile -transform -transparent -treedepth \
-			-trim -type -undercolor -units -unsharp -verbose \
-			-version -view -virtual-pixel -wave -white-point \
-			-white-threshold' -- $cur ) )
-	elif [[ "$cur" == +* ]]; then
-		COMPREPLY=( $( compgen -W '+compress +contrast +debug +dither \
-			+endian +gamma +label +map +mask +matte +negate +page \
-			+raise' -- $cur ) ) 
-	else
-		_filedir
-	fi
-}
-complete -F _mogrify $filenames mogrify
-
-_display()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	_ImageMagick
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-authenticate -backdrop -border \
-			-colormap -colors -colorspace -comment -compress \
-			-contrast -crop -debug -delay -density -depth \
-			-despeckle -display -dispose -dither -edge -endian \
-			-enhance -extract -filter -flip -flop -frame -gamma \
-			-geometry -help -immutable -interlace -label -limit \
-			-log -map -matte -monochrome -negate -noop -page \
-			-quality -raise -remote -roll -rotate -sample \
-			-sampling-factor -scene -segment -sharpen -size \
-			-texture -treedepth -trim -update -verbose -version \
-			-virtual-pixel -window -window_group -write' -- $cur))
-	elif [[ "$cur" == +* ]]; then
-		COMPREPLY=( $( compgen -W '+compress +contrast +debug +dither \
-			+endian +gamma +label +map +matte +negate +page \
-			+raise +write' -- $cur ) ) 
-	else
-		_filedir
-	fi
-}
-complete -F _display $filenames display
-
-_animate()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	_ImageMagick
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-authenticate -backdrop -colormap \
-			-colors -colorspace -crop -debug -delay -density \
-			-depth -display -dither -extract -gamma -geometry \
-			-help -interlace -limit -log -matte -map -monochrome \
-			-noop -pause -remote -rotate -sampling-factor -scene \
-			-size -treedepth -trim -verbose -version -visual \
-			-virtual-pixel -window' -- $cur ) )
-	elif [[ "$cur" == +* ]]; then
-		COMPREPLY=( $( compgen -W '+debug +dither +gamma +map +matte' -- $cur ) ) 
-	else
-		_filedir
-	fi
-}
-complete -F _animate $filenames animate
-
-_identify()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	_ImageMagick
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-authenticate -debug -density \
-			-depth -extract -format -help -interlace -limit -list \
-			-log -size -sampling-factor -verbose -version \
-			-virtual-pixel' -- $cur ) )
-	elif [[ "$cur" == +* ]]; then
-		COMPREPLY=( $( compgen -W '+debug ' -- $cur ) ) 
-	else
-		_filedir
-	fi
-}
-complete -F _identify $filenames identify
-
-_montage()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	_ImageMagick
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-adjoin -affine -authenticate \
-			-blue-primary -blur -colors -colorspace -comment \
-			-compose -compress -crop -debug -density -depth \
-			-display -dispose -dither -draw -encoding -endian \
-			-extract -fill -filter -flip -flop -frame -gamma \
-			-geometry -gravity -green-primary -interlace -help \
-			-label -limit -log -matte -mode -monochrome -noop \
-			-page -pointsize -quality -red-primary -resize \
-			-rotate -sampling-factor -scene -shadow -size \
-			-stroke -texture -thumbnail -tile -transform \
-			-transparent -treedepth -trim -type -verbose \
-			-version -virtual-pixel -white-point' -- $cur ) )
-	elif [[ "$cur" == +* ]]; then
-		COMPREPLY=( $( compgen -W '+adjoin +compress +debug +dither \
-			+endian +gamma +label +matte +page' -- $cur ) ) 
-	else
-		_filedir
-	fi
-}
-complete -F _montage $filenames montage
-
-_composite()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	_ImageMagick
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-affine -authenticate \
-			-blue-primary -colors -colorspace -comment -compose \
-			-compress -debug -density -depth -displace -display \
-			-dispose -dissolve -dither -encoding -endian -extract \
-			-filter -font -geometry -gravity -green-primary -help \
-			-interlace -label -limit -log -matte -monochrome \
-			-negate -page -profile -quality -red-primary -rotate \
-			-resize -sampling-factor -scene -sharpen -size \
-			-stegano -stereo -thumbnail -tile -transform \
-			-treedepth -type -units -unsharp -verbose -version \
-			-virtual-pixel -watermark -white-point -write' \
-			-- $cur ) )
-	elif [[ "$cur" == +* ]]; then
-		COMPREPLY=( $( compgen -W '+compress +debug +dither +endian +label \
-			+matte +negate +page +write' -- $cur ) ) 
-	else
-		_filedir
-	fi
-}
-complete -F _composite $filenames composite
-}
-
-# dd(1) completion
-#
-have dd &&
-_dd()
-{
-	 local cur
-
-	 COMPREPLY=()
-	cur=`_get_cword`
-
-	 case "$cur" in
-	 if=*|of=*)
-		 cur=${cur#*=}
-		 _filedir
-		 return 0
-		 ;;
-	 conv=*)
-		 cur=${cur#*=}
-		 COMPREPLY=( $( compgen -W 'ascii ebcdic ibm block unblock \
-				lcase notrunc ucase swab noerror sync' \
-				-- $cur ) )
-		 return 0
-		 ;;
-	 esac
-
-	 _expand || return 0
-
-	 COMPREPLY=( $( compgen -W '--help --version' -- $cur ) \
-		     $( compgen -W 'bs cbs conv count ibs if obs of seek skip'\
-				-S '=' -- $cur ) )
-} &&
-complete -F _dd $nospace $filenames dd
-
-# CUPS cancel(1) completion
-#
-have cancel &&
-_cancel()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	COMPREPLY=( $( lpstat | cut -d' ' -f1 | grep "^$cur" ) )
-} &&
-complete -F _cancel $filenames cancel
-
-# aspell(1) completion
-#
-have aspell && {
-_aspell_dictionary()
-{
-	local datadir
-	datadir=/usr/lib/aspell
-	COMPREPLY=( $( command ls $datadir/*.@(multi|alias) ) )
-	COMPREPLY=( ${COMPREPLY[@]%.@(multi|alias)} )
-	COMPREPLY=( $( compgen -W '${COMPREPLY[@]#$datadir/}' -- $cur ) )
-}
-
-_aspell()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	# --name value style option
-	case "$prev" in
-		@(-c|-p|check))
-			_filedir
-			return 0
-			;;
-		@(dump|create|merge))
-			COMPREPLY=( $( compgen -W 'master personal repl' -- $cur ) )
-			return 0
-			;;
-		-d)
-			_aspell_dictionary
-			return 0
-			;;
-	esac
-
-	# --name=value style option
-	if [[ "$cur" == *=* ]]; then
-		prev=${cur/=*/}
-		cur=${cur/*=/}
-		case "$prev" in
-			--@(conf|personal|repl|per-conf))
-				_filedir
-				return 0
-				;;
-			--@(conf-dir|data-dir|dict-dir|home-dir|local-data-dir|prefix))
-				_filedir -d
-				return 0
-				;;
-			--master)
-				_aspell_dictionary
-				return 0
-				;;
-			--mode)
-				COMPREPLY=( $( compgen -W 'none url email sgml tex' -- $cur ) )
-				return 0
-				;; 
-			--sug-mode)
-				COMPREPLY=( $( compgen -W 'ultra fast normal bad-speller' -- $cur ) )
-				return 0
-				;;
-			--keymapping)
-				COMPREPLY=( $( compgen -W 'aspell ispell' -- $cur ) )
-				return 0
-				;;
-		esac
-	fi
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '--conf= --conf-dir= --data-dir= --dict-dir= \
-			--encoding= --add-filter= --rem-filter= --mode= -e \
-			-H -t --add-extra-dicts= --rem-extra-dicts= \
-			--home-dir= -W --ignore= --ignore-accents \
-			--dont-ignore-accents --ignore-case --dont-ignore-case \
-			--ignore-repl --dont-ignore-repl --jargon= --keyboard= \
-			--lang= --language-tag= --local-data-dir= -d --master= \
-			--module= --add-module-search-order= \
-			--rem-module-search-order= --per-conf= -p --personal= \
-			--prefix= --repl= -C -B --run-together --dont-run-together \
-			--run-together-limit= --run-together-min= --save-repl \
-			--dont-save-repl --set-prefix --dont-set-prefix --size= \
-			--spelling= --strip-accents --dont-strip-accents \
-			--sug-mode= --add-word-list-path= --rem-word-list-path= \
-			-b -x --backup -b|-x --dont-backup --reverse --dont-reverse \
-			--time --dont-time --keymapping= --add-email-quote= \
-			--rem-email-quote= --email-margin= --add-tex-command= \
-			--rem-tex-command= --tex-check-comments \
-			--dont-tex-check-comments --add-tex-extension= \
-			--rem-tex-extension= --add-sgml-check= --rem-sgml-check= \
-			--add-sgml-extension= --rem-sgml-extension=' -- $cur ) )
-	else
-		COMPREPLY=( $( compgen -W '-? help -c check -a pipe -l list \
-			config config soundslike filter -v version dump \
-			create merge' -- $cur ) )
-	fi
-
-}
-complete -F _aspell $filenames aspell
-}
-
-# xmms(1) completion
-#
-have xmms &&
-_xmms()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-h --help -r --rew -p --play \
-			-u --pause -s --stop -t --play-pause -f --fwd -e \
-			--enqueue -m --show-main-window -i --sm-client-id \
-			-v --version' -- $cur ) )
-	else
-		_filedir '@(mp[23]|MP[23]|ogg|OGG|wav|WAV|pls|m3u|xm|mod|s[3t]m|it|mtm|ult|flac)'
-
-	fi
-
-} &&
-complete -F _xmms $filenames xmms
-
-# info(1) completion
-#
-have info &&
-_info()
-{
-	local cur infopath UNAME
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	_expand || return 0
-
-	# default completion if parameter contains /
-	if [[ "$cur" == */* ]]; then
-		_filedir
-		return 0
-	fi
-
-	infopath='/usr/share/info'
-
-	if [ "${INFOPATH: -1:1}" == ':' ]; then
-		infopath=${INFOPATH}${infopath}
-	elif [ ${INFOPATH:+set} ]; then
-		infopath=$INFOPATH
-	fi
-
-	infopath=$infopath:
-	if [ -n "$cur" ]; then
-		infopath="${infopath//://$cur* }"
-	else
-		infopath="${infopath//:// }"
-	fi
-
-	# redirect stderr for when path doesn't exist
-	COMPREPLY=( $( eval command ls "$infopath" 2>/dev/null ) )
-	# weed out directory path names and paths to info pages
-	COMPREPLY=( ${COMPREPLY[@]##*/?(:)} )
-	# weed out info dir file
-	for (( i=0 ; i < ${#COMPREPLY[@]} ; ++i )); do
-		if [ "${COMPREPLY[$i]}" == 'dir' ]; then
-			unset COMPREPLY[$i];
-		fi;
-	done  
-	# strip suffix from info pages
-	COMPREPLY=( ${COMPREPLY[@]%.@(gz|bz2)} )
-	COMPREPLY=( $( compgen -W '${COMPREPLY[@]%.*}' -- "${cur//\\\\/}" ) )
-
-	return 0
-} &&
-complete -F _info $filenames info
-
-# dhclient(1) completion
-#
-have dhclient && _dhclient()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(cf|lf|pf|sf))
-			_filedir
-			return 0
-			;;
-		-s)
-			_known_hosts
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-p -d -q -1 -r -lf -pf \
-			-cf -sf -s -g -n -nw -w' -- $cur ) )
-	else
-		_available_interfaces
-	fi
-} &&
-complete -F _dhclient dhclient
-
-# lvm(8) completion
-#
-have lvm && {
-_volumegroups()
-{
-	COMPREPLY=( $(compgen -W "$( vgscan 2>/dev/null | \
-	    sed -n -e 's|.*Found.*"\(.*\)".*$|\1|p' )" -- $cur ) )
-}
-
-_physicalvolumes()
-{
-	COMPREPLY=( $(compgen -W "$( pvscan 2>/dev/null | \
-	    sed -n -e 's|^.*PV \(.*\) VG.*$|\1|p' )" -- $cur ) )
-}
-
-_logicalvolumes()
-{
-	COMPREPLY=( $(compgen -W "$( lvscan 2>/dev/null | \
-	    sed -n -e "s|^.*'\(.*\)'.*$|\1|p" )" -- $cur ) )
-}
-
-_units()
-{
-	COMPREPLY=( $( compgen -W 'h s b k m g t H K M G T' -- $cur ) )
-}
-
-_sizes()
-{
-	COMPREPLY=( $( compgen -W 'k K m M g G t T' -- $cur ) )
-}
-
-_args()
-{
-	args=0
-	if [[ "${COMP_WORDS[0]}" == lvm ]]; then
-		offset=2
-	else
-		offset=1
-	fi
-	for (( i=$offset; i < COMP_CWORD; i++ )); do
-		if [[ "${COMP_WORDS[i]}" != -* ]]; then
-			args=$(($args + 1))
-		fi
-	done
-}
-
-_lvmdiskscan()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-d --debug -h -? --help -l \
-			--lvmpartition -v --verbose --version' -- $cur ) )
-	fi
-}
-complete -F _lvmdiskscan lvmdiskscan
-
-_pvscan()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-d --debug -e \
-			--exported -n --novolumegroup -h -? \
-			--help --ignorelockingfailure -P \
-			--partial -s --short -u --uuid -v \
-			--verbose --version' -- $cur ) )
-	fi
-}
-complete -F _pvscan pvscan
-
-_pvs()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(o|O|-options|-sort))
-			COMPREPLY=( $( compgen -W 'pv_fmt pv_uuid \
-				pv_size pv_free pv_used pv_name \
-				pv_attr pv_pe_count \
-				pv_pe_alloc_count' -- $cur ) )
-			return 0
-			;;
-		--units)
-			_units
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '--aligned -a --all -d --debug \
-			-h -? --help --ignorelockingfailure --noheadings \
-			--nosuffix -o --options -O --sort \
-			--separator --unbuffered --units \
-			-v --verbose --version' -- $cur ) )
-	else
-		_physicalvolumes
-	fi
-}
-complete -F _pvs pvs
-
-_pvdisplay()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		--units)
-			_units
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-c --colon -C --columns --units \
-			-v --verbose -d --debug -h --help --version' -- $cur ) )
-	else
-		_physicalvolumes
-	fi
-}
-complete -F _pvdisplay pvdisplay
-
-_pvchange()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(A|x|-autobackup|--allocatable))
-			COMPREPLY=( $( compgen -W 'y n' -- $cur ) )
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-a --all -A --autobackup \
-			-d --debug -h --help -t --test -u --uuid -x \
-			--allocatable -v --verbose --addtag --deltag \
-			--version' -- $cur ) )
-	else
-		_physicalvolumes
-	fi
-}
-complete -F _pvchange pvchange
-
-_pvcreate()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		--restorefile)
-			_filedir
-			return 0
-			;;
-		-@(M|-metadatatype))
-			COMPREPLY=( $( compgen -W '1 2' -- $cur ) )
-			return 0
-			;;
-		--metadatacopies)
-			COMPREPLY=( $( compgen -W '0 1 2' -- $cur ) )
-			return 0
-			;;
-		--@(metadatasize|setphysicalvolumesize))
-			_sizes
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '--restorefile -d --debug -f \
-			--force -h -? --help --labelsector -M --metadatatype \
-			--metadatacopies --metadatasize \
-			--setphysicalvolumesize -t --test -u --uuid uuid -v \
-			--verbose -y --yes --version' -- $cur ) )
-	else
-		_physicalvolumes
-	fi
-}
-complete -F _pvcreate pvcreate
-
-_pvmove()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(A|-autobackup))
-			COMPREPLY=( $( compgen -W 'y n' -- $cur ) )
-			return 0
-			;;
-		-@(n|-name))
-			_logicalvolumes
-			return 0
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '--abort -A --autobackup \
-			-b --background -d --debug -f --force -h -? \
-			--help -i --interval -t --test -v --verbose \
-			--version -n --name' -- $cur ) )
-	else
-		_physicalvolumes
-	fi
-}
-complete -F _pvmove pvmove
-
-_pvremove()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-d --debug -f --force -h -? \
-			--help -y --yes -t --test -v --verbose \
-			--version' -- $cur ) )
-	else
-		_physicalvolumes
-	fi
-}
-complete -F _pvremove pvremove
-
-_vgscan()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-d --debug -h --help \
-			--ignorelockingfailure --mknodes -P \
-			--partial -v --verbose --version' -- $cur ) )
-	fi
-}
-complete -F _vgscan vgscan
-
-_vgs()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(o|O|-options|-sort))
-			COMPREPLY=( $( compgen -W 'vg_fmt vg_uuid vg_name \
-				vg_attr vg_size vg_free vg_sysid \
-				vg_extent_size vg_extent_count vg_free_count \
-				max_lv max_pv pv_count lv_count snap_count \
-				vg_seqno' -- $cur ) )
-			return 0
-			;;
-		--units)
-			_units
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '--aligned -d --debug \
-			-h --help --ignorelockingfailure --noheadings \
-			--nosuffix -o --options -O --sort -P --partial \
-			--separator --unbuffered --units \
-			-v --verbose --version' -- $cur ) )
-	else
-		_volumegroups
-	fi
-}
-complete -F _vgs vgs
-
-_vgdisplay()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		--units)
-			_units
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-c --colon -C --columns --units \
-			-P --partial -A --activevolumegroups -v --verbose \
-			-d --debug -h --help --version' -- $cur ) )
-	else
-		_volumegroups
-	fi
-}
-complete -F _vgdisplay vgdisplay
-
-_vgchange()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(a|A|x|-available|-autobackup|-resizeable))
-			COMPREPLY=( $( compgen -W 'y n' -- $cur ) )
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-A --autobackup --alloc -P \
-			--partial -d --debug -h --help --ignorelockingfailure \
-			-t --test -u --uuid -v --verbose --version -a \
-			--available -x --resizeable -l --logicalvolume \
-			--addtag --deltag' -- $cur ) )
-	else
-		_volumegroups
-	fi
-}
-complete -F _vgchange vgchange
-
-_vgcreate()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(A|-autobackup))
-			COMPREPLY=( $( compgen -W 'y n' -- $cur ) )
-			return 0
-			;;
-		-@(M|-metadatatype))
-			COMPREPLY=( $( compgen -W '1 2' -- $cur ) )
-			return 0
-			;;
-		-@(s|-physicalextentsize))
-			_sizes
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-A --autobackup --addtag \
-			--alloc -d --debug -h --help -l --maxlogicalvolumes \
-			-M --metadatatype -p --maxphysicalvolumes -s \
-			--physicalextentsize -t --test -v --verbose \
-			--version' -- $cur ) )
-	else
-		_args
-		if [ $args -eq 0 ]; then
-			_volumegroups
-		else
-			_physicalvolumes
-		fi
-	fi
-}
-complete -F _vgcreate vgcreate
-
-_vgremove()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-d --debug -h --help -t --test \
-		-v --verbose --version' -- $cur ) )
-	else
-		_volumegroups
-	fi
-}
-complete -F _vgremove vgremove
-
-_vgrename()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(A|-autobackup))
-			COMPREPLY=( $( compgen -W 'y n' -- $cur ) )
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-A --autobackup -d --debug -h \
-			-? --help -t --test -v --verbose --version' -- $cur ) )
-	else
-		_volumegroups
-	fi
-}
-complete -F _vgrename vgrename
-
-_vgreduce()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(A|-autobackup))
-			COMPREPLY=( $( compgen -W 'y n' -- $cur ) )
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-a --all -A --autobackup -d \
-			--debug -h --help --removemissing -t --test -v \
-			--verbose --version' -- $cur ) )
-
-	else
-		_args
-		if [ $args -eq 0 ]; then
-			_volumegroups
-		else
-			_physicalvolumes
-		fi
-	fi
-}
-complete -F _vgreduce vgreduce
-
-_vgextend()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(A|-autobackup))
-			COMPREPLY=( $( compgen -W 'y n' -- $cur ) )
-			return 0
-			;;
-		-@(L|-size))
-			_sizes
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-A --autobackup -d --debug -h \
-			-? --help -t --test -v --verbose --version' -- $cur ) )
-	else
-		_args
-		if [ $args -eq 0 ]; then
-			_volumegroups
-		else
-			_physicalvolumes
-		fi
-	fi
-}
-complete -F _vgextend vgextend
-
-_vgport()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-a --all -d --debug -h \
-			-? --help -v --verbose --version' -- $cur ) )
-	else
-		_volumegroups
-	fi
-}
-complete -F _vgport vgimport vgexport
-
-_vgck()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-d --debug -h \
-			-? --help -v --verbose --version' -- $cur ) )
-	else
-		_volumegroups
-	fi
-}
-complete -F _vgck vgck
-
-_vgconvert()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(M|-metadatatype))
-			COMPREPLY=( $( compgen -W '1 2' -- $cur ) )
-			return 0
-			;;
-		--metadatacopies)
-			COMPREPLY=( $( compgen -W '0 1 2' -- $cur ) )
-			return 0
-			;;
-		--metadatasize)
-			_sizes
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-d --debug -h --help --labelsector \ 
-			-M --metadatatype --metadatacopies --metadatasize \
-			-t --test -v --verbose --version' -- $cur ) )
-	else
-		_volumegroups
-	fi
-}
-complete -F _vgconvert vgconvert
-
-_vgcfgbackup()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(f|-file))
-			_filedir
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-d --debug -f --file -h --help \
-			--ignorelockingfailure -P --partial -v --verbose \
-			--version' -- $cur ) )
-	else
-		_volumegroups
-	fi
-}
-complete -F _vgcfgbackup vgcfgbackup
-
-_vgcfgrestore()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(f|-file))
-			_filedir
-			return 0
-			;;
-		-@(M|-metadatatype))
-			COMPREPLY=( $( compgen -W '1 2' -- $cur ) )
-			return 0
-			;;
-		-@(n|-name))
-			_volumegroups
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-d --debug -f --file -l --list \
-			-h --help -M --Metadatatype -n --name -t --test \
-			-v --verbose --version' -- $cur ) )
-	else
-		_volumegroups
-	fi
-}
-complete -F _vgcfgrestore vgcfgrestore
-
-_vgmerge()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(A|-autobackup))
-			COMPREPLY=( $( compgen -W 'y n' -- $cur ) )
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-A --autobackup -d --debug \
-			-h --help -l --list -t --test -v --verbose \
-			--version' -- $cur ) )
-	else
-		_volumegroups
-	fi
-}
-complete -F _vgmerge vgmerge
-
-_vgsplit()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(A|-autobackup))
-			COMPREPLY=( $( compgen -W 'y n' -- $cur ) )
-			return 0
-			;;
-		-@(M|-metadatatype))
-			COMPREPLY=( $( compgen -W '1 2' -- $cur ) )
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-A --autobackup -d --debug \
-			-h --help -l --list -M --metadatatype -t --test \
-			-v --verbose --version' -- $cur ) )
-	else
-		_args
-		if [ $args -eq 0 -o $args -eq 1 ]; then
-			_volumegroups
-		else
-			_physicalvolumes
-		fi
-	fi
-}
-complete -F _vgsplit vgsplit
-
-_vgmknodes()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-d --debug -h --help -v --verbose \
-			--version' -- $cur ) )
-	else
-		_volumegroups
-	fi
-}
-complete -F _vgmknodes vgmknodes
-
-_lvscan()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-b --blockdevice -d --debug \
-			-h -? --help --ignorelockingfailure -P \
-			--partial -v --verbose --version' -- $cur ) )
-	fi
-}
-complete -F _lvscan lvscan
-
-_lvs()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(o|O|-options|-sort))
-			COMPREPLY=( $( compgen -W 'lv_uuid lv_name \
-				lv_attr lv_minor lv_size seg_count \
-				origin snap_percent segtype stripes \
-				stripesize chunksize seg_start \
-				seg_size' -- $cur ) )
-			return 0
-			;;
-		--units)
-			_units
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '--aligned -d --debug \
-			-h --help --ignorelockingfailure --noheadings \
-			--nosuffix -o --options -O --sort -P --partial \
-			--segments --separator --unbuffered --units \
-			-v --verbose --version' -- $cur ) )
-	else
-		_logicalvolumes
-	fi
-}
-complete -F _lvs lvs
-
-_lvdisplay()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		--units)
-			_units
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-c --colon -C --columns --units \
-			-P --partial -m --maps -v --verbose -d --debug -h \
-			--help --version' -- $cur ) )
-	else
-		_logicalvolumes
-	fi
-}
-complete -F _lvdisplay lvdisplay
-
-_lvchange()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(a|A|C|M|-available|-autobackup|-continguous|-persistent))
-			COMPREPLY=( $( compgen -W 'y n' -- $cur ) )
-			return 0
-			;;
-		-@(p|-permission))
-			COMPREPLY=( $( compgen -W 'r rw' -- $cur ) )
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-A --autobackup -a --available \
-			--addtag --alloc -C --contiguous -d --debug --deltag \
-			-f --force -h --help --ignorelockingfailure -M \
-			--persistent --major major --minor minor -P --partial \
-			-p --permission -r --readahead --refresh -t --test \
-			-v --verbose --version' -- $cur ) )
-	else
-		_logicalvolumes
-	fi
-}
-complete -F _lvchange lvchange
-
-_lvcreate()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(A|C|M|Z|-autobackup|-continguous|-persistent|-zero))
-			COMPREPLY=( $( compgen -W 'y n' -- $cur ) )
-			return 0
-			;;
-		-@(L|-size))
-			_sizes
-			return 0
-			;;
-		-@(p|-permission))
-			COMPREPLY=( $( compgen -W 'r rw' -- $cur ) )
-			return 0
-			;;
-		-@(n|-name))
-			_logicalvolumes
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-A --autobackup --addtag --alloc \
-			-C --contiguous -d --debug -h -? --help -i --stripes \
-			-I --stripesize -l --extents -L --size -M --persistent \
-			--major --minor -n --name -p --permission -r \
-			--readahead -t --test --type -v --verbose -Z --zero \
-			--version' -- $cur ) )
-	else
-		_args
-		if [ $args -eq 0 ]; then
-			_volumegroups
-		else
-			_physicalvolumes
-		fi
-	fi
-}
-complete -F _lvcreate lvcreate
-
-_lvremove()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(A|-autobackup))
-			COMPREPLY=( $( compgen -W 'y n' -- $cur ) )
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-A --autobackup -d --debug -f \
-			--force -h -?  --help -t --test -v --verbose \
-			--version' -- $cur ) )
-	else
-		_logicalvolumes
-	fi
-}
-complete -F _lvremove lvremove
-
-_lvrename()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(A|-autobackup))
-			COMPREPLY=( $( compgen -W 'y n' -- $cur ) )
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-A --autobackup -d --debug -h \
-			-? --help -t --test -v --verbose --version' -- $cur ) )
-	else
-		_logicalvolumes
-	fi
-}
-complete -F _lvrename lvrename
-
-_lvreduce()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(A|-autobackup))
-			COMPREPLY=( $( compgen -W 'y n' -- $cur ) )
-			return 0
-			;;
-		-@(L|-size))
-			_sizes
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-A --autobackup -d \
-			--debug -f --force -h --help -l --extents \
-			-L --size -n --nofsck -r --resizefs -t --test \
-			-v --verbose --version' -- $cur ) )
-	else
-		_logicalvolumes
-	fi
-}
-complete -F _lvreduce lvreduce
-
-_lvresize()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(A|-autobackup))
-			COMPREPLY=( $( compgen -W 'y n' -- $cur ) )
-			return 0
-			;;
-		-@(L|-size))
-			_sizes
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-A --autobackup --alloc -d \
-			--debug -h --help -i --stripes -I --stripesize \
-			-l --extents -L --size -n --nofsck -r --resizefs \
-			-t --test --type -v --verbose --version' -- $cur ) )
-	else
-		_args
-		if [ $args -eq 0 ]; then
-			_logicalvolumes
-		else
-			_physicalvolumes
-		fi
-	fi
-}
-complete -F _lvresize lvresize
-
-_lvextend()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-		-@(A|-autobackup))
-			COMPREPLY=( $( compgen -W 'y n' -- $cur ) )
-			return 0
-			;;
-		-@(L|-size))
-			_sizes
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-A --autobackup --alloc -d \
-			--debug -h --help -i --stripes -I --stripesize \
-			-l --extents -L --size -n --nofsck -r --resizefs \
-			-t --test --type -v --verbose --version' -- $cur ) )
-	else
-		_args
-		if [ $args -eq 0 ]; then
-			_logicalvolumes
-		else
-			_physicalvolumes
-		fi
-	fi
-}
-complete -F _lvextend lvextend
-
-_lvm()
-{
-	local prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [ $COMP_CWORD -eq 1 ]; then
-		COMPREPLY=( $( compgen -W 'dumpconfig help lvchange \
-			lvcreate lvdisplay lvextend lvmchange \
-			lvmdiskscan lvmsadc lvmsar lvreduce \
-			lvremove lvrename lvresize lvs lvscan \
-			pvchange pvcreate pvdata pvdisplay pvmove \
-			pvremove pvresize pvs pvscan vgcfgbackup \
-			vgcfgrestore vgchange vgck vgconvert \
-			vgcreate vgdisplay vgexport vgextend \
-			vgimport vgmerge vgmknodes vgreduce \
-			vgremove vgrename vgs vgscan vgsplit \
-			version' -- $cur ) )
-	else
-		case ${COMP_WORDS[1]} in
-			pvchange)
-				_pvchange
-				;;
-			pvcreate)
-				_pvcreate
-				;;
-			pvdisplay)
-				_pvdisplay
-				;;
-			pvmove)
-				_pvmove
-				;;
-			pvremove)
-				_pvremove
-				;;
-			pvresize)
-				_pvresize
-				;;
-			pvs)
-				_pvs
-				;;
-			pvscan)
-				_pvscan
-				;;
-			vgcfgbackup)
-				_vgcfgbackup
-				;;
-			vgcfgrestore)
-				_vgcfgrestore
-				;;
-			vgchange)
-				_vgchange
-				;;
-			vgck)
-				_vgck
-				;;
-			vgconvert)
-				_vgconvert
-				;;
-			vgcreate)
-				_vgcreate
-				;;
-			vgdisplay)
-				_vgdisplay
-				;;
-			vgexport)
-				_vgexport
-				;;
-			vgextend)
-				_vgextend
-				;;
-			vgimport)
-				_vgimport
-				;;
-			vgmerge)
-				_vgmerge
-				;;
-			vgmknodes)
-				_vgmknodes
-				;;
-			vgreduce)
-				_vgreduce
-				;;
-			vgremove)
-				_vgremove
-				;;
-			vgrename)
-				_vgrename
-				;;
-			vgs)
-				_vgs
-				;;
-			vgscan)
-				_vgscan
-				;;
-			vgsplit)
-				_vgsplit
-				;;
-			lvchange)
-				_lvchange
-				;;
-			lvcreate)
-				_lvcreate
-				;;
-			lvdisplay)
-				_lvdisplay
-				;;
-			lvextend)
-				_lvextend
-				;;
-			lvreduce)
-				_lvreduce
-				;;
-			lvremove)
-				_lvremove
-				;;
-			lvrename)
-				_lvrename
-				;;
-			lvresize)
-				_lvresize
-				;;
-			lvs)
-				_lvs
-				;;
-			lvscan)
-				_lvscan
-				;;
-		esac
-	fi
-}
-complete -F _lvm lvm
-}
-
-# mkinitrd(8) completion
-#
-have mkinitrd &&
-_mkinitrd()
-{
-	local cur args
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	# --name value style option
-	case "$prev" in
-		--preload)
-			_modules
-			return 0
-			;;
-	esac
-
-	# --name=value style option
-	if [[ "$cur" == *=* ]]; then
-		prev=${cur/=*/}
-		cur=${cur/*=/}
-		case "$prev" in
-			--@(with|builtin))
-				_modules
-				return 0
-				;;
-			--@(fstab|dsdt))
-				_filedir
-				return 0
-				;;
-			--tmpdir)
-				_filedir -d
-				return 0
-				;;
-		esac
-	fi
-
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '--version -v -f --preload \
-			--with= --omit-scsi-modules --omit-raid-modules \
-			--images-version --fstab= --nocompress --builtin= \
-			--nopivot --noudev --allow-missing --tmpdir= \
-			--initrdfs= --dsdt= --lvm-version= --froce-usb' \
-			-- $cur ) )
-	else
-		_count_args
-
-		case $args in
-			1)
-				_filedir
-				;;
-			2)
-				COMPREPLY=( $( command ls /lib/modules | grep "^$cur" ) )
-				;;
-		esac
-	fi
-
-} &&
-complete -F _mkinitrd mkinitrd
-
-# pkgconfig(1) completion
-#
-have pkg-config &&
-_pkg_config()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [[ "$cur" == -* ]]; then
-		# return list of available options
-		COMPREPLY=( $( compgen -W '-version --modversion \
-		      --atleast-pkgconfig-version= --libs --libs-only-l \
-		      --libs-only-other --libs-only-L --cflags \
-		      --cflags-only-I --cflags-only-other --variable= \
-		      --define-variable= --exists --uninstalled \
-		      --atleast-version= --exact-version= --max-version= \
-		      --list-all --debug --print-errors --silence-errors \
-		      --errors-to-stdout -? --help --usage' -- $cur))
-	else
-		COMPREPLY=( $( pkg-config --list-all 2>/dev/null | \
-				    awk '{print $1}' | grep "^$cur" ) )
-	fi
-} &&
-complete -F _pkg_config pkg-config
-
-
-# cpio(1) completion
-#
-have cpio && {
-_cpio_format()
-{
-	COMPREPLY=( $( compgen -W 'bin odc newc crc tar ustar hpbin hpodc' -- $cur ) )
-}
-
-_cpio()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	# --name value style option
-	case $prev in
-		-H)
-			_cpio_format
-			return 0
-			;;
-		-@(E|F|I))
-			_filedir
-			return 0
-			;;
-		-R)
-			_usergroup
-			return 0
-			;;
-	esac
-
-	# --name=value style option
-	if [[ "$cur" == *=* ]]; then
-		prev=${cur/=*/}
-		cur=${cur/*=/}
-		case $prev in
-			--format)
-				_cpio_format
-				return 0
-				;;
-			--@(file|pattern-file))
-				_filedir
-				return 0
-				;;
-			--owner)
-				_usergroup
-				return 0
-				;;
-			--rsh-command)
-				COMPREPLY=( $( compgen -c -- $cur ) )
-				return 0
-				;;
-		esac
-	fi
-
-	if [ $COMP_CWORD -eq 1 ]; then
-		COMPREPLY=( $( compgen -W '-o --create -i --extract -p --pass-through' -- $cur) ) 
-	else
-		case ${COMP_WORDS[1]} in
-			-@(o|-create))
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-0 -a -c -v -A -B\
-						-L -V -C -H -M -O -F --file= --format=\
-						--message= --null --reset-access-time\
-						--verbose --dot --append --block-size=\
-						--dereference --io-size= --quiet\
-						--force-local --rsh-command= --help\
-						--version' -- $cur ) )
-				fi
-				;;
-			-@(i|-extract))
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-b -c -d -f -m -n -r\
-						-t -s -u -v -B -S -V -C -E -H -M -R -I\
-						-F --file= --make-directories\
-						--nonmatching\
-						--preserve-modification-time\
-						--numeric-uid-gid --rename -t --list\
-						--swap-bytes --swap --dot\
-						--unconditional --verbose --block-size=\
-						--swap-halfwords --io-size=\
-						--pattern-file= --format= --owner=\
-						--no-preserve-owner --message=\
-						--force-local --no-absolute-filenames\
-						--sparse --only-verify-crc --quiet\
-						--rsh-command= --help\
-						--version' -- $cur ) )
-				fi
-				;;
-			-@(p|-pass-through))
-				if [[ "$cur" == -* ]]; then
-					COMPREPLY=( $( compgen -W '-0 -a -d -l -m -u -v\
-						-L -V -R --null --reset-access-time\
-						--make-directories --link --quiet\
-						--preserve-modification-time\
-						--unconditional --verbose --dot\
-						--dereference --owner=\
-						--no-preserve-owner --sparse --help\
-						--version' -- $cur ) )
-				else
-					_filedir -d
-				fi
-				;;
-		esac
-	fi
-}
-complete -F _cpio cpio
-}
-
-# id(1) completion
-#
-have id &&
-_id()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-a -g --group -G --groups -n --name\
-			-r --real -u --user --help --version' -- $cur ) )
-	else
-		COMPREPLY=( $( compgen -u $cur  ) )
-	fi
-} &&
-complete -F _id id
-
-# getent(1) completion
-#
-have getent &&
-_getent()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case $prev in
-		passwd)
-			COMPREPLY=( $( compgen -u $cur  ) )
-			return 0
-			;;
-		group)
-			COMPREPLY=( $( compgen -g $cur  ) )
-			return 0
-			;;
-		services)
-			COMPREPLY=( $( compgen -s $cur  ) )
-			return 0
-			;;
-		hosts)
-			COMPREPLY=( $( compgen -A hostname $cur  ) )
-			return 0
-			;;
-		protocols)
-			COMPREPLY=( $( getent protocols | awk '{print $1}' | grep "^$cur" ) )
-			return 0
-			;;
-		networks)
-			COMPREPLY=( $( getent networks | awk '{print $1}' | grep "^$cur" ) )
-			return 0
-			;;
-	esac
-
-
-	if [ $COMP_CWORD -eq 1 ]; then
-		COMPREPLY=( $( compgen -W 'passwd group hosts services protocols networks' -- $cur ) )
-	fi
-} &&
-complete -F _getent getent
-
-# ntpdate(1) completion
-#
-have ntpdate &&
-_ntpdate()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case $prev in
-		-k)
-			_filedir
-			return 0
-			;;
-		-U)
-			COMPREPLY=( $( compgen -u $cur  ) )
-			return 0
-			;;
-	esac
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-4 -6 -b -B -d -Q -q -s -u -v -a\
-			-e -k -p -o -r -t' -- $cur ) )
-	else
-		_known_hosts
-	fi
-} &&
-complete -F _ntpdate ntpdate
-
-# smartctl(8) completion
-#
-have smartctl && {
-_smartctl_quietmode()
-{
-	COMPREPLY=( $( compgen -W 'errorsonly silent' -- $cur ) )
-}
-_smartctl_device()
-{
-	COMPREPLY=( $( compgen -W 'ata scsi 3ware' -- $cur ) )
-}
-_smartctl_tolerance()
-{
-	COMPREPLY=( $( compgen -W 'warn exit ignore' -- $cur ) )
-}
-_smartctl_badsum()
-{
-	COMPREPLY=( $( compgen -W 'normal conservative permissive verypermissive' -- $cur ) )
-}
-_smartctl_report()
-{
-	COMPREPLY=( $( compgen -W 'ioctl ataioctl scsiioctl' -- $cur ) )
-}
-_smartctl_feature()
-{
-	COMPREPLY=( $( compgen -W 'on off' -- $cur ) )
-}
-_smartctl_log()
-{
-	COMPREPLY=( $( compgen -W 'error selftest selective directory' -- $cur ) )
-}
-_smartctl_vendorattribute()
-{
-	COMPREPLY=( $( compgen -W 'help 9,minutes 9,seconds 9,halfminutes \
-		9,temp 192,emergencyretractcyclect 193,loadunload \
-		194,10xCelsius 194,unknown 198,offlinescanuncsectorct \
-		200,writeerrorcount 201,detectedtacount 220,temp' -- $cur ) )
-}
-_smartctl_firmwarebug()
-{
-	COMPREPLY=( $( compgen -W 'none samsung samsung2' -- $cur ) )
-}
-_smartctl_presets()
-{
-	COMPREPLY=( $( compgen -W 'use ignore show showall' -- $cur ) )
-}
-_smartctl_test()
-{
-	COMPREPLY=( $( compgen -W 'offline short long conveyance select afterselect,on afterselect,off pending' -- $cur ) )
-}
-
-_smartctl()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	# --name value style option
-	case "$prev" in
-		-q)
-			_smartctl_quietmode
-			;;
-		-d)
-			_smartctl_device
-			return 0
-			;;
-		-t)
-			_smartctl_tolerance
-			return 0
-			;;
-		-b)
-			_smartctl_badsum
-			return 0
-			;;
-		-r)
-			_smartctl_report
-			return 0
-			;;
-		-s)
-			_smartctl_feature
-			return 0
-			;;
-		-o)
-			_smartctl_feature
-			return 0
-			;;
-		-S)
-			_smartctl_feature
-			return 0
-			;;
-		-l)
-			_smartctl_log
-			return 0
-			;;
-		-v)
-			_smartctl_vendorattribute
-			return 0
-			;;
-		-F)
-			_smartctl_firmwarebug
-			return 0
-			;;
-		-P)
-			_smartctl_presets
-			return 0
-			;;
-		-t)
-			_smartctl_test
-			return 0
-			;;
-	esac
-
-	# --name=value style option
-	if [[ "$cur" == *=* ]]; then
-		prev=${cur/=*/}
-		cur=${cur/*=/}
-		case "$prev" in
-			--quietmode)
-				_smartctl_quietmode
-				return 0
-				;;
-			--device)
-				_smartctl_device
-				return 0
-				;;
-			--tolerance)
-				_smartctl_tolerance
-				return 0
-				;;
-			--badsum)
-				_smartctl_badsum
-				return 0
-				;;
-			--report)
-				_smartctl_report
-				return 0
-				;;
-			--smart)
-				_smartctl_feature
-				return 0
-				;;
-			--offlineauto)
-				_smartctl_feature
-				return 0
-				;;
-			--saveauto)
-				_smartctl_feature
-				return 0
-				;;
-			--log)
-				_smartctl_log
-				return 0
-				;;
-			--vendorattribute)
-				_smartctl_vendorattribute
-				return 0
-				;;
-			--firmwarebug)
-				_smartctl_firmwarebug
-				return 0
-				;;
-			--presets)
-				_smartctl_presets
-				return 0
-				;;
-			--test)
-				_smartctl_test
-				return 0
-				;;
-		esac
-	fi
-
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-h --help --usage -V --version \
-			--copyright --license-i --info -a --all -q \
-			--quietmode= -d --device= -T --tolerance= -b --badsum= \
-			-r --report= -s --smart= -o --offlineauto= -S \
-			--saveauto= -H --health -c --capabilities -A \
-			--attributes -l --log= -v --vendorattribute= -F \
-			--firmwarebug= -P --presets= -t --test= -C \
-			--captive -X --abort' -- $cur ) )
-	else
-		cur=${cur:=/dev/}
-		_filedir
-	fi
-}
-complete -F _smartctl smartctl
-}
-
-# vncviewer(1) completion
-#
-have vncviewer &&
-_vncviewer()
-{
-	local cur prev
-	local -a config
-    
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case "$prev" in
-	-via)
-	   _known_hosts -a
-	   ;;
-	*)
-	   # ssh into the the server, find and ping the broadcast address, then
-	   # sort and show the results.
-	   COMPREPLY=( $( ssh -o 'Batchmode yes' $prev \
-			  "ping -bnc 4 255.255.255.255" 2>/dev/null | \
-			  awk -F ' ' '{print $4}' | \
-			  sort -n | uniq | egrep '[0-9]+\.[0-9]+\.' 2>/dev/null ) )
-	esac
-								   
-	return 0
-} &&
-complete -F _vncviewer vncviewer
-
-# sysctl(8) completion
-#
-have sysctl &&
-_sysctl()
-{
-	local cur
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	COMPREPLY=( $( compgen -W "$(sysctl -N -a 2>/dev/null)" -- $cur ) )
-
-	return 0
-} &&
-complete -F _sysctl sysctl
-
-# update-rc.d(8) completion
-#
-# Copyright (C) 2004 Servilio Afre Puentes <servilio@gmail.com>
-#
-have update-rc.d &&
-_update_rc_d()
-{
-    local cur prev sysvdir services options valid_options
-
-    cur=`_get_cword`
-    prev=${COMP_WORDS[COMP_CWORD-1]}
-
-    [ -d /etc/rc.d/init.d ] && sysvdir=/etc/rc.d/init.d \
-	|| sysvdir=/etc/init.d
-
-    services=( $(echo $sysvdir/!(README*|*.sh|*.dpkg*|*.rpm*)) )
-    services=( ${services[@]#$sysvdir/} )
-    options=( -f -n )
-
-    if [[ $COMP_CWORD -eq 1 || "$prev" == -* ]]; then
-	valid_options=( $( \
-	    echo "${COMP_WORDS[@]} ${options[@]}" \
-	    | tr " " "\n" \
-	    | sed -ne "/$( echo "${options[@]}" | sed "s/ /\\|/g" )/p" \
-	    | sort | uniq -u \
-	    ) )
-	COMPREPLY=( $( compgen -W '${options[@]} ${services[@]}' \
-	    -X '$( echo ${COMP_WORDS[@]} | tr " " "|" )' -- $cur ) )
-    elif [[ "$prev" == ?($( echo ${services[@]} | tr " " "|" )) ]]; then
-	COMPREPLY=( $( compgen -W 'remove defaults start stop' -- $cur ) )
-    elif [[ "$prev" == defaults && "$cur" == [0-9] ]]; then
-	COMPREPLY=( 0 1 2 3 4 5 6 7 8 9 )
-    elif [[ "$prev" == defaults && "$cur" == [sk]?([0-9]) ]]; then
-	COMPREPLY=( 0 1 2 3 4 5 6 7 8 9 )
-    elif [[ "$prev" == defaults && -z "$cur" ]]; then
-	COMPREPLY=( 0 1 2 3 4 5 6 7 8 9 s k )
-    elif [[ "$prev" == ?(start|stop) ]]; then
-	if [[ "$cur" == [0-9] || -z "$cur" ]]; then 
-	    COMPREPLY=( 0 1 2 3 4 5 6 7 8 9 )
-	elif [[ "$cur" == [0-9][0-9] ]]; then 
-	    COMPREPLY=( $cur )
-	else
-	    COMPREPLY=()
-	fi
-    elif [[ "$prev" == ?([0-9][0-9]|[0-6S]) ]]; then
-	if [[ -z "$cur" ]]; then
-	    if [[ $prev == [0-9][0-9] ]]; then
-		COMPREPLY=( 0 1 2 3 4 5 6 S )
-	    else
-		COMPREPLY=( 0 1 2 3 4 5 6 S . )
-	    fi
-	elif [[ "$cur" == [0-6S.] ]]; then 
-	    COMPREPLY=( $cur )
-	else
-	    COMPREPLY=()
-	fi
-    elif [[ "$prev" == "." ]]; then
-	COMPREPLY=( $(compgen -W "start stop" -- $cur) )
-    else
-	COMPREPLY=()
-    fi
-
-    return 0
-} &&
-complete -F _update_rc_d update-rc.d
-
-# invoke-rc.d(8) completion
-#
-# Copyright (C) 2004 Servilio Afre Puentes <servilio@gmail.com>
-#
-have invoke-rc.d &&
-_invoke_rc_d()
-{
-    local cur prev sysvdir services options valid_options
-
-    cur=`_get_cword`
-    prev=${COMP_WORDS[COMP_CWORD-1]}
-
-    [ -d /etc/rc.d/init.d ] && sysvdir=/etc/rc.d/init.d \
-	|| sysvdir=/etc/init.d
-
-    services=( $(echo $sysvdir/!(README*|*.sh|*.dpkg*|*.rpm*)) )
-    services=( ${services[@]#$sysvdir/} )
-    options=( --help --quiet --force --try-anyway --disclose-deny --query --no-fallback )
-
-    if [[ ($COMP_CWORD -eq 1) || ("$prev" == --* ) ]]; then
-	valid_options=( $( \
-	    echo ${COMP_WORDS[@]} ${options[@]} \
-	    | tr " " "\n" \
-	    | sed -ne "/$( echo ${options[@]} | sed "s/ /\\\\|/g" )/p" \
-	    | sort | uniq -u \
-	    ) )
-	COMPREPLY=( $( compgen -W '${valid_options[@]} ${services[@]}' -- \
-	    $cur ) )
-    elif [ -x $sysvdir/$prev ]; then
-	COMPREPLY=( $( compgen -W '`sed -ne "y/|/ /; \
-					    s/^.*Usage:[ ]*[^ ]*[ ]*{*\([^}\"]*\).*$/\1/p" \
-					    $sysvdir/$prev`' -- \
-	    $cur ) )
-    else
-	COMPREPLY=()
-    fi
-
-    return 0
-} &&
-complete -F _invoke_rc_d invoke-rc.d
-
-# minicom(1) completion
-#
-have minicom &&
-_minicom()
-{
-	local cur prev
-
-	COMPREPLY=()
-	cur=`_get_cword`
-	prev=${COMP_WORDS[COMP_CWORD-1]}
-
-	case $prev in
-		-@(a|c))
-			COMPREPLY=( $( compgen -W 'on off' -- $cur ) )
-			return 0
-			;;
-		-@(S|C))
-			_filedir
-			return 0
-			;;
-		-P)
-			COMPREPLY=( $( command ls /dev/tty* ) )
-			COMPREPLY=( $( compgen -W '${COMPREPLY[@]} ${COMPREPLY[@]#/dev/}' -- $cur ) )
-			return 0
-			;;
-	esac
-
-
-	if [[ "$cur" == -* ]]; then
-		COMPREPLY=( $( compgen -W '-s -o -m -M -z -l -L -w -a -t \
-			-c -S -d -p -C -T -8' -- $cur ) )
-	else
-		COMPREPLY=( $( command ls /etc/minicom/minirc.* 2>/dev/null | sed -e 's|/etc/minicom/minirc.||' | grep "^$cur" ) )
-	fi
-} &&
-complete -F _minicom minicom
-
-# svn completion
-#
-have svn &&
-{
-_svn()
-{
-	local cur prev commands options command
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	commands='add blame praise annotate ann cat checkout co cleanup commit \
-		ci copy cp delete del remove rm diff di export help ? h import \
-		info list ls lock log merge mkdir move mv rename ren \
-		propdel pdel pd propedit pedit pe propget pget pg \
-		proplist plist pl propset pset ps resolved revert \
-		status stat st switch sw unlock update up'
-
-	if [[ $COMP_CWORD -eq 1 ]] ; then
-		if [[ "$cur" == -* ]]; then
-			COMPREPLY=( $( compgen -W '--version' -- $cur ) )
-		else
-			COMPREPLY=( $( compgen -W "$commands" -- $cur ) )
-		fi
-	else
-
-		prev=${COMP_WORDS[COMP_CWORD-1]}
-		case $prev in
-			--config-dir)
-				_filedir -d
-				return 0;
-				;;
-			-@(F|-file|-targets))
-				_filedir
-				return 0;
-				;;
-			--encoding)
-				COMPREPLY=( $( compgen -W \
-					'$( iconv --list | sed -e "s@//@@;" )' \
-					-- "$cur" ) )
-				return 0;
-				;;
-			--@(editor|diff|diff3)-cmd)
-				COMP_WORDS=(COMP_WORDS[0] $cur)
-				COMP_CWORD=1
-				_command
-				return 0;
-				;;
-		esac
-
-		command=${COMP_WORDS[1]}
-
-		if [[ "$cur" == -* ]]; then
-			# possible options for the command
-			case $command in
-				add)
-					options='--auto-props --no-auto-props \
-						--force --targets --no-ignore \
-						--non-recursive -N -q --quiet'
-					;;
-				@(blame|annotate|ann|praise))
-					options='-r --revisions --username \
-						--password --no-auth-cache \
-						--non-interactive -v \
-						--verbose --incremental --xml'
-					;;
-				cat)
-					options='-r --revision --username \
-						--password --no-auth-cache \
-						--non-interactive'
-					;;
-				@(checkout|co))
-					options='-r --revision -q --quiet -N \
-						--non-recursive --username \
-						--password --no-auth-cache \
-						--non-interactive \
-						--ignore-externals'
-					;;
-				cleanup)
-					options='--diff3-cmd'
-					;;
-				@(commit|ci))
-					options='-m --message -F --file \
-						--encoding --force-log -q \
-						--quiet --non-recursive -N \
-						--targets --editor-cmd \
-						--username --password \
-						--no-auth-cache \
-						--non-interactive --no-unlock'
-					;;
-				@(copy|cp))
-					options='-m --message -F --file \
-						--encoding --force-log -r \
-						--revision -q --quiet \
-						--editor-cmd -username \
-						--password --no-auth-cache \
-						--non-interactive'
-					;;
-				@(delete|del|remove|rm))
-					options='--force -m --message -F \
-						--file --encoding --force-log \
-						-q --quiet --targets \
-						--editor-cmd -username \
-						--password --no-auth-cache \
-						--non-interactive'
-					;;
-				@(diff|di))
-					options='-r --revision -x --extensions \
-						--diff-cmd --no-diff-deleted \
-						-N --non-recursive --username \
-						--password --no-auth-cache \
-						--non-interactive --force \
-						--old --new --notice-ancestry'
-					;;
-				export)
-					options='-r --revision -q --quiet \
-						--username --password \
-						--no-auth-cache \
-						--non-interactive -N \
-						--non-recursive --force \
-						--native-eol --ignore-externals'
-					;;
-				import)
-					options='--auto-props --no-auto-props \
-						-m --message -F --file \
-						--encoding --force-log -q \
-						--quiet --non-recursive \
-						--no-ignore --editor-cmd \
-						--username --password \
-						--no-auth-cache \
-						--non-interactive'
-					;; 
-				info)
-					options='--username --password \
-						--no-auth-cache \
-						--non-interactive -r \
-						--revision --xml --targets \
-						-R --recursive --incremental'
-					;;
-				@(list|ls))
-					options='-r --revision -v --verbose -R \
-						--recursive --username \
-						--password --no-auth-cache \
-						--non-interactive \
-						--incremental --xml'
-					;;
-				lock)
-					options='-m --message -F --file \
-						--encoding --force-log \
-						--targets --force --username \
-						--password --no-auth-cache \
-						--non-interactive'
-					;;
-				log)
-					options='-r --revision -v --verbose \
-						--targets --username \
-						--password --no-auth-cache \
-						--non-interactive \
-						--stop-on-copy --incremental \
-						--xml -q --quiet --limit'
-					;;
-				merge)
-					options='-r --revision -N \
-						--non-recursive -q --quiet \
-						--force --dry-run --diff3-cmd \
-						--username --password \
-						--no-auth-cache \
-						--non-interactive \
-						--ignore-ancestry'
-					;;
-				mkdir)
-					options='-m --message -F --file \
-						--encoding --force-log -q \
-						--quiet --editor-cmd \
-						--username --password \
-						--no-auth-cache \
-						--non-interactive'
-					;;
-				@(move|mv|rename|ren))
-					options='-m --message -F --file \
-						--encoding --force-log -r \
-						--revision -q --quiet \
-						--force --editor-cmd \
-						--username --password \
-						--no-auth-cache \
-						--non-interactive'
-					;;
-				@(propdel|pdel|pd))
-					options='-q --quiet -R --recursive -r \
-						--revision --revprop \
-						--username --password \
-						--no-auth-cache \
-						--non-interactive'
-					;;
-				@(propedit|pedit|pe))
-					options='-r --revision --revprop \
-						--encoding --editor-cmd \
-						--username --password \
-						--no-auth-cache \
-						--non-interactive --force'
-					;;
-				@(propget|pget|pg))
-					options='-R --recursive -r --revision \
-						--revprop --strict --username \
-						--password --no-auth-cache \
-						--non-interactive'
-					;;
-				@(proplist|plist|pl))
-					options='-v --verbose -R --recursive \
-						-r --revision --revprop -q \
-						--quiet --username --password \
-						--no-auth-cache \
-						--non-interactive'
-					;;
-				@(propset|pset|ps))
-					options='-F --file -q --quiet \
-						--targets -R --recursive \
-						--revprop --encoding \
-						--username --password \
-						--no-auth-cache \
-						--non-interactive -r \
-						--revision --force'
-					;;
-				resolved)
-					options='--targets -R --recursive -q \
-						--quiet'
-					;;
-				revert)
-					options='--targets -R --recursive -q \
-						--quiet'
-					;;
-				@(status|stat|st))
-					options='-u --show-updates -v \
-						--verbose -N --non-recursive \
-						-q --quiet --username \
-						--password --no-auth-cache \
-						--non-interactive --no-ignore \
-						--ignore-externals \
-						--incremental --xml'
-					;;
-				@(switch|sw))
-					options='--relocate -r --revision -N \
-						--non-recursive -q --quiet \
-						--username --password \
-						--no-auth-cache \
-						--non-interactive --diff3-cmd'
-					;;
-				unlock)
-					options='--targets --force --username \
-						--password --no-auth-cache \
-						--non-interactive'
-					;;
-				@(update|up))
-					options='-r --revision -N \
-						--non-recursive -q --quiet \
-						--username --password \
-						--no-auth-cache \
-						--non-interactive \
-						--diff3-cmd --ignore-externals'
-					;;
-			esac
-			options="$options --help -h --config-dir"
-
-			COMPREPLY=( $( compgen -W "$options" -- $cur ) )
-		else
-			if [[ "$command" == @(help|h|\?) ]]; then
-				COMPREPLY=( $( compgen -W "$commands" -- $cur ) )
-			else
-				_filedir
-			fi
-		fi
-	fi
-
-	return 0
-}
-complete -F _svn $default svn
-
-_svnadmin()
-{
-	local cur prev commands options mode
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	commands='create deltify dump help ? hotcopy list-dblogs \
-		list-unused-dblogs load lslocks lstxns recover rmlocks \
-		rmtxns setlog verify'
-
-	if [[ $COMP_CWORD -eq 1 ]] ; then
-		if [[ "$cur" == -* ]]; then
-			COMPREPLY=( $( compgen -W '--version' -- $cur ) )
-		else
-			COMPREPLY=( $( compgen -W "$commands" -- $cur ) )
-		fi
-	else
-		prev=${COMP_WORDS[COMP_CWORD-1]}
-		case $prev in
-			--config-dir)
-				_filedir -d
-				return 0;
-				;;
-			--fs-type)
-				COMPREPLY=( $( compgen -W 'fsfs bdb' -- $cur ) )
-				return 0;
-				;;
-		esac
-
-		command=${COMP_WORDS[1]}
-
-		if [[ "$cur" == -* ]]; then
-			# possible options for the command
-			case $command in
-				create)
-					options='--bdb-txn-nosync \
-						--bdb-log-keep --config-dir \
-						--fs-type'
-					;;
-				deltify)
-					options='-r --revision -q --quiet'
-					;;
-				dump)
-					options='-r --revision --incremental \
-						-q --quiet --deltas'
-					;;
-				hotcopy)
-					options='--clean-logs'
-					;;
-				load)
-					options='--ignore-uuid --force-uuid \
-						--parent-dir -q --quiet \
-						--use-pre-commit-hook \
-						--use-post-commit-hook'
-					;;
-				rmtxns)
-					options='-q --quiet'
-					;;
-				setlog)
-					options='-r --revision --bypass-hooks'
-					;;
-			esac
-
-			options="$options --help -h"
-			COMPREPLY=( $( compgen -W "$options" -- $cur ) )
-		else
-			if [[ "$command" == @(help|h|\?) ]]; then
-				COMPREPLY=( $( compgen -W "$commands" -- $cur ) )
-			else
-				_filedir
-			fi
-		fi
-	fi
-
-	return 0
-}
-complete -F _svnadmin $default svnadmin
-
-_svnlook()
-{
-	local cur prev commands options mode
-
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	commands='author cat changed date diff dirs-changed help ? h history \
-		info lock log propget pget pg proplist plist pl tree uuid \
-		youngest'
-
-	if [[ $COMP_CWORD -eq 1 ]] ; then
-		if [[ "$cur" == -* ]]; then
-			COMPREPLY=( $( compgen -W '--version' -- $cur ) )
-		else
-			COMPREPLY=( $( compgen -W "$commands" -- $cur ) )
-		fi
-	else
-		command=${COMP_WORDS[1]}
-
-		if [[ "$cur" == -* ]]; then
-			# possible options for the command
-			case $command in
-				@(author|cat|date|dirs-changed|info|log))
-					options='-r --revision -t \
-						--transaction'
-					;;
-				changed)
-					options='-r --revision -t \
-						--transaction --copy-info'
-					;;
-				diff)
-					options='-r --revision -t \
-						--transaction \
-						--no-diff-deleted \
-						--no-diff-added \
-						--diff-copy-from'
-					;;
-				history)
-					options='-r --revision --show-ids'
-					;;
-				prop@(get|list))
-					options='-r --revision -t \
-						--transaction --revprop'
-					;;
-				tree)
-					options='-r --revision -t \
-						--transaction --show-ids \
-						--full-paths'
-					;;
-			esac
-
-			options="$options --help -h"
-			COMPREPLY=( $( compgen -W "$options" -- $cur ) )
-		else
-			if [[ "$command" == @(help|h|\?) ]]; then
-				COMPREPLY=( $( compgen -W "$commands" -- $cur ) )
-			else
-				_filedir
-			fi
-		fi
-	fi
-
-	return 0
-}
-complete -F _svnlook $default svnlook
-}
-
-_filedir_xspec()
-{
-	local IFS cur xspec
-
-	IFS=$'\t\n'
-	COMPREPLY=()
-	cur=`_get_cword`
-
-	_expand || return 0
-
-	# get first exclusion compspec that matches this command
-	xspec=$( sed -ne $'/^complete .*[ \t]'${1##*/}$'\([ \t]\|$\)/{p;q;}' \
-		  $BASH_COMPLETION )
-	# prune to leave nothing but the -X spec
-	xspec=${xspec#*-X }
-	xspec=${xspec%% *}
-
-	local toks=( ) tmp
-
-	while read -r tmp; do
-		[[ -n $tmp ]] && toks[${#toks[@]}]=$tmp
-	done < <( compgen -d -- "$(quote_readline "$cur")" )
-
-	while read -r tmp; do
-		[[ -n $tmp ]] && toks[${#toks[@]}]=$tmp
-	done < <( eval compgen -f -X $xspec -- "\$(quote_readline "\$cur")" )
-
-	COMPREPLY=( "${toks[@]}" )
-}
-list=( $( sed -ne '/^# START exclude/,/^# FINISH exclude/p' \
-	  $BASH_COMPLETION | \
-	# read exclusion compspecs
-	(
-	while read line
-	do
-		# ignore compspecs that are commented out
-		if [ "${line#\#}" != "$line" ]; then continue; fi
-		line=${line%# START exclude*}
-		line=${line%# FINISH exclude*}
-		line=${line##*\'}
-		list=( "${list[@]}" $line )
-	done
-	echo "${list[@]}"
-	)
-     ) )
-# remove previous compspecs
-if [ ${#list[@]} -gt 0 ]; then
-    eval complete -r ${list[@]}
-    # install new compspecs
-    eval complete -F _filedir_xspec $filenames "${list[@]}"
-fi
-unset list
-
-# source completion directory definitions
-if [ -d $BASH_COMPLETION_DIR -a -r $BASH_COMPLETION_DIR -a \
-     -x $BASH_COMPLETION_DIR ]; then
-	for i in $BASH_COMPLETION_DIR/*; do
-		[[ ${i##*/} != @(*~|*.bak|*.swp|\#*\#|*.dpkg*|.rpm*) ]] &&
-			[ \( -f $i -o -h $i \) -a -r $i ] && . $i
-	done
-fi
-unset i
-
-# source user completion file
-[ $BASH_COMPLETION != ~/.bash_completion -a -r ~/.bash_completion ] \
-	&& . ~/.bash_completion
-unset -f have
-unset UNAME RELEASE default dirnames filenames have nospace bashdefault \
-      plusdirs
-
-set $BASH_COMPLETION_ORIGINAL_V_VALUE
-unset BASH_COMPLETION_ORIGINAL_V_VALUE
-
-###  Local Variables:
-###  mode: shell-script
-###  End:
diff --git a/overlay/generic/etc/bash/bash_completion.d/dladm b/overlay/generic/etc/bash/bash_completion.d/dladm
deleted file mode 100644
index 179227b2..00000000
--- a/overlay/generic/etc/bash/bash_completion.d/dladm
+++ /dev/null
@@ -1,34 +0,0 @@
-_dladm()
-{
-    local cur prev opts base
-    COMPREPLY=()
-    cur="${COMP_WORDS[COMP_CWORD]}"
-    prev="${COMP_WORDS[COMP_CWORD-1]}"
-
-    if [[ ${prev} == 'dladm' ]]; then
-        local cmds="rename-link show-link create-aggr delete-aggr add-aggr \
-            remove-aggr modify-aggr show-aggr scan-wifi connect-wifi \
-            disconnect-wifi show-wifi set-linkprop reset-linkprop \
-            show-linkprop show-ether create-secobj delete-secobj show-secobj \
-            create-vlan delete-vlan show-vlan create-iptun delete-iptun \
-            modify-iptun show-iptun delete-phys show-phys create-vnic \
-            delete-vnic show-vnic create-part delete-part show-part show-ib \
-            create-etherstub delete-etherstub show-etherstub create-bridge \
-            modify-bridge delete-bridge add-bridge remove-bridge show-bridge \
-            show-bridge show-usage"
-
-        COMPREPLY=( $(compgen -W "$cmds" -- ${cur}) )
-    # The -z takes a zone option, ignore everything else
-    elif [[ ${prev} =~ -.*z$ ]]; then
-        local zones=$(zoneadm list -c | grep -v '^global$')
-        COMPREPLY=( $(compgen -W "${zones}" -- ${cur}) )
-    elif [[ ${prev} =~ 'delete-vnic' ]]; then
-        local vnics=$(dladm show-vnic -p -o link)
-        COMPREPLY=( $(compgen -W "${vnics}" -- ${cur}) )
-    elif [[ ${prev} =~ 'delete-etherstub' ]]; then
-        local stubs=$(dladm show-etherstub -p)
-        COMPREPLY=( $(compgen -W "${stubs}" -- ${cur}) )
-    fi
-}
-
-complete -F _dladm dladm
diff --git a/overlay/generic/etc/bash/bash_completion.d/machines b/overlay/generic/etc/bash/bash_completion.d/machines
deleted file mode 100644
index 05de1b75..00000000
--- a/overlay/generic/etc/bash/bash_completion.d/machines
+++ /dev/null
@@ -1,19 +0,0 @@
-_machine()
-{
-    local cur prev opts base
-    COMPREPLY=()
-    cur="${COMP_WORDS[COMP_CWORD]}"
-    prev="${COMP_WORDS[COMP_CWORD-1]}"
-
-    if [[ ${prev} == 'machine-json' ]]; then
-        machines=$(zoneadm list -cp | grep -v ':global:' | cut -d':' -f2,5 | tr ':' '\n' | sort | uniq)
-        COMPREPLY=( $(compgen -W "${machines}" -- ${cur}) )
-    else
-        # Just expand files by default
-        COMPREPLY=( $(compgen -f -- ${cur}) )
-    fi
-
-    return 0
-}
-
-complete -F _machine machine-json
diff --git a/overlay/generic/etc/bash/bash_completion.d/vms b/overlay/generic/etc/bash/bash_completion.d/vms
deleted file mode 100644
index 71bcac59..00000000
--- a/overlay/generic/etc/bash/bash_completion.d/vms
+++ /dev/null
@@ -1,62 +0,0 @@
-_vmadm()
-{
-    local cur prev opts base
-    COMPREPLY=()
-    cur="${COMP_WORDS[COMP_CWORD]}"
-    prev="${COMP_WORDS[COMP_CWORD-1]}"
-
-    up_patterns=$(printf " running *\$\n halting *\$\n")
-
-    if [[ ${prev} == 'vmadm' ]]; then
-        COMPREPLY=( $(compgen -W "boot destroy dump kill halt list reboot reset info nmi" -- ${cur}) )
-    else
-        case ${prev} in
-            boot)
-                local not_running=$(vmadm list -v | grep -v "^UUID" | \
-                    /usr/xpg4/bin/grep -v -e "${up_patterns}" | cut -d' ' -f1)
-                COMPREPLY=( $(compgen -W "${not_running}" -- ${cur}) )
-            ;;
-            info|kill)
-                local running=$(vmadm list -v | grep -v "^UUID" | \
-                    /usr/xpg4/bin/grep -e "${up_patterns}" | cut -d ' ' -f1)
-                COMPREPLY=( $(compgen -W "${running}" -- ${cur}) )
-            ;;
-            halt|reboot|reset|nmi|screenshot)
-                local running=$(vmadm list -v | grep -v "^UUID" | \
-                    grep " running *$" | cut -d ' ' -f1)
-                COMPREPLY=( $(compgen -W "${running}" -- ${cur}) )
-            ;;
-            dump|destroy)
-                local all=$(vmadm list)
-                COMPREPLY=( $(compgen -W "${all}" -- ${cur}) )
-            ;;
-            *)
-                # Just expand files by default
-                COMPREPLY=( $(compgen -f -- ${cur}) )
-            ;;
-        esac
-    fi
-
-    return 0
-}
-
-_vmcfg()
-{
-    local cur prev opts base
-    COMPREPLY=()
-    cur="${COMP_WORDS[COMP_CWORD]}"
-    prev="${COMP_WORDS[COMP_CWORD-1]}"
-
-    if [[ ${prev} == 'vmcfg' ]]; then
-        vms=$(vmadm list)
-        COMPREPLY=( $(compgen -W "${vms}" -- ${cur}) )
-    else
-        # Just expand files by default
-        COMPREPLY=( $(compgen -f -- ${cur}) )
-    fi
-
-    return 0
-}
-
-complete -F _vmadm vmadm
-complete -F _vmcfg vmcfg
diff --git a/overlay/generic/etc/bash/bash_completion.d/zones b/overlay/generic/etc/bash/bash_completion.d/zones
deleted file mode 100644
index 2c68ba36..00000000
--- a/overlay/generic/etc/bash/bash_completion.d/zones
+++ /dev/null
@@ -1,41 +0,0 @@
-_zlogin()
-{
-    local cur prev opts base
-    COMPREPLY=()
-    cur="${COMP_WORDS[COMP_CWORD]}"
-    prev="${COMP_WORDS[COMP_CWORD-1]}"
-
-    # The -e and -l take non-zone arguments, otherwise complete zone
-    if [[ ${prev} != '-e' ]] && [[ ${prev} != '-l' ]]; then
-        local running=$(zoneadm list | grep -v '^global$')
-        COMPREPLY=( $(compgen -W "${running}" -- ${cur}) )
-    fi
-    return 0
-}
-
-_dash_z_zone()
-{
-    local cur prev opts base
-    COMPREPLY=()
-    cur="${COMP_WORDS[COMP_CWORD]}"
-    prev="${COMP_WORDS[COMP_CWORD-1]}"
-
-    # The -z takes a zone option, ignore everything else
-    if [[ ${prev} =~ -.*z$ ]]; then
-        local zones=$(zoneadm list -c | grep -v '^global$')
-        COMPREPLY=( $(compgen -W "${zones}" -- ${cur}) )
-    fi
-    return 0
-}
-
-complete -F _zlogin zlogin
-complete -F _dash_z_zone zoneadm
-complete -F _dash_z_zone zonecfg
-complete -F _dash_z_zone svcs
-complete -F _dash_z_zone svcadm
-complete -F _dash_z_zone svcprop
-complete -F _dash_z_zone pgrep
-complete -F _dash_z_zone pkill
-complete -F _dash_z_zone ps
-complete -F _dash_z_zone ptree
-complete -F _dash_z_zone wall
diff --git a/overlay/generic/etc/bash/bashrc.example b/overlay/generic/etc/bash/bashrc.example
deleted file mode 100755
index a993fb99..00000000
--- a/overlay/generic/etc/bash/bashrc.example
+++ /dev/null
@@ -1,77 +0,0 @@
-#
-# This file contains an example of default settings that can be made for
-# bash(1) users on this system.  To make these settings the default for system
-# users, you will need to copy it to /etc/bash/bashrc
-#
-# Bourne Again SHell init file.
-#
-umask 022
-
-# Where's the Gnu stuff at?
-GNU=/usr/gnu/bin
-X11=/usr/X11/bin
-
-UTIL_PATH=$GNU:$X11
-STANDARD_PATH=/bin:/usr/bin:/sbin:/usr/sbin
-
-if [ -d $HOME/bin ]; then
-    MY_PATH=$MY_PATH:$HOME/bin
-fi
-
-export PATH="$MY_PATH:$UTIL_PATH:$STANDARD_PATH"
-
-# If not running interactively, then return
-if [ -z "$PS1" ]; then
-	return
-fi
-
-# Set ignoreeof if you don't want EOF as the sole input to the shell to
-# immediately signal a quit condition.  This only happens at the start
-# of a line if the line is empty, and you haven't just deleted a character
-# with C-d.  I turn this on in ~/.bash_profile so that only login shells
-# have the right to be obnoxious.
-set -o ignoreeof
-
-# Set auto_resume if you want to resume on "emacs", as well as on
-# "%emacs".
-auto_resume=exact
-
-# Set notify if you want to be asynchronously notified about background
-# job completion.
-set -o notify
-
-# Make it so that failed `exec' commands don't flush this shell.
-shopt -s execfail
-
-if [ -z "$LOGIN_SHELL" ]; then
-    PS1="[\u@\h]:[\#]:[\w]:\$ "
-fi
-
-HISTSIZE=256
-MAILCHECK=60
-
-#
-# we want pretty colored file listings
-#
-if [ -x /usr/bin/dircolors ] ; then
-    if [ -f ~/.dir_colors ] ; then
-	eval "`/usr/bin/dircolors -b ~/.dir_colors`"
-    elif [ -f ~/.dircolors ] ; then
-	eval "`/usr/bin/dircolors -b ~/.dircolors`"
-    fi
-fi
-
-[ -f /etc/bash/bash_completion ] && . /etc/bash/bash_completion
-
-for s in /etc/bash/*.sh ; do
-    test -r $s && . $s
-done
-
-for s in /etc/bash/*.bash ; do
-    test -r $s && . $s
-done
-
-[ -f ~/.bash_expert ] && . ~/.bash_expert
-
-[ -f ~/.bash_aliases ] && . ~/.bash_aliases
-
diff --git a/overlay/generic/etc/bash/inputrc.example b/overlay/generic/etc/bash/inputrc.example
deleted file mode 100755
index a0f23589..00000000
--- a/overlay/generic/etc/bash/inputrc.example
+++ /dev/null
@@ -1,338 +0,0 @@
-#
-# This file contains an example of default key binding that can be made for
-# bash(1) users on this system.  To make these settings the default for system
-# users, you will need to copy it to /etc/bash/inputrc
-#
-
-set meta-flag on
-set input-meta on
-set convert-meta off
-set output-meta on
-
-$if mode=vi
-    set editing-mode vi
-    set keymap vi
-$endif
-
-$if mode=emacs
-    $if term=xterm
-        "\e\eOD":  backward-word
-        "\e\eOC":  forward-word
-        "\e\eOA":  up-history
-        "\e\eOB":  down-history
-        "\C-\eOD": backward-char
-        "\C-\eOC": forward-char
-        "\C-\eOA": up-history
-        "\C-\eOB": down-history
-    $endif
-    "\e\e[D":  backward-word
-    "\e\e[C":  forward-word
-    "\e\e[A":  up-history
-    "\e\e[B":  down-history
-    "\C-\e[D": backward-char
-    "\C-\e[C": forward-char
-    "\C-\e[A": up-history
-    "\C-\e[B": down-history
-$endif
-
-"\e[1~":        beginning-of-line
-"\e[2~":        yank
-"\e[3~":        delete-char
-"\e[4~":        end-of-line
-"\e[5~":        history-search-backward
-"\e[6~":        history-search-forward
-"\e[C":         forward-char
-"\e[D":         backward-char
-"\e[A":         previous-history
-"\e[B":         next-history
-"\C-?":         backward-delete-char
-"\C-H":         backward-delete-char
-
-$if term=xterm
-    "\e[2;2~":  yank
-    "\e[3;2~":  delete-char
-    "\e[5;2~":  history-search-backward
-    "\e[6;2~":  history-search-forward
-    "\e[2;3~":  yank
-    "\e[3;3~":  delete-char
-    "\e[5;3~":  history-search-backward
-    "\e[6;3~":  history-search-forward
-    "\e[2;4~":  yank
-    "\e[3;4~":  delete-char
-    "\e[5;4~":  history-search-backward
-    "\e[6;4~":  history-search-forward
-    "\e[2;5~":  yank
-    "\e[3;5~":  delete-char
-    "\e[5;5~":  history-search-backward
-    "\e[6;5~":  history-search-forward
-    "\e[2;6~":  yank
-    "\e[3;6~":  delete-char
-    "\e[5;6~":  history-search-backward
-    "\e[6;6~":  history-search-forward
-    "\e[2;7~":  yank
-    "\e[3;7~":  delete-char
-    "\e[5;7~":  history-search-backward
-    "\e[6;7~":  history-search-forward
-    "\e[2;8~":  yank
-    "\e[3;8~":  delete-char
-    "\e[5;8~":  history-search-backward
-    "\e[6;8~":  history-search-forward
-    "\e[E":     re-read-init-file
-    "\e[1;2E":  re-read-init-file
-    "\e[1;3E":  re-read-init-file
-    "\e[1;4E":  re-read-init-file
-    "\e[1;5E":  re-read-init-file
-    "\e[1;6E":  re-read-init-file
-    "\e[1;7E":  re-read-init-file
-    "\e[1;8E":  re-read-init-file
-    "\e[2C":    forward-word
-    "\e[2D":    backward-word
-    "\e[2A":    history-search-backward
-    "\e[2B":    history-search-forward
-    "\e[1;2C":  forward-word
-    "\e[1;2D":  backward-word
-    "\e[1;2A":  history-search-backward
-    "\e[1;2B":  history-search-forward
-    "\e[1;3C":  forward-word
-    "\e[1;3D":  backward-word
-    "\e[1;3A":  history-search-backward
-    "\e[1;3B":  history-search-forward
-    "\e[1;4C":  forward-word
-    "\e[1;4D":  backward-word
-    "\e[1;4A":  history-search-backward
-    "\e[1;4B":  history-search-forward
-    "\e[5C":    forward-word
-    "\e[5D":    backward-word
-    "\e[5A":    history-search-backward
-    "\e[5B":    history-search-forward
-    "\e[1;5C":  forward-word
-    "\e[1;5D":  backward-word
-    "\e[1;5A":  history-search-backward
-    "\e[1;5B":  history-search-forward
-    "\e[1;6C":  forward-word
-    "\e[1;6D":  backward-word
-    "\e[1;6A":  history-search-backward
-    "\e[1;6B":  history-search-forward
-    "\e[1;7C":  forward-word
-    "\e[1;7D":  backward-word
-    "\e[1;7A":  history-search-backward
-    "\e[1;7B":  history-search-forward
-    "\e[1;8C":  forward-word
-    "\e[1;8D":  backward-word
-    "\e[1;8A":  history-search-backward
-    "\e[1;8B":  history-search-forward
-    "\e[1~":   history-search-backward
-    "\e[4~":   set-mark
-    "\e[H":    beginning-of-line
-    "\e[F":    end-of-line
-    "\e[1;2H": beginning-of-line
-    "\e[1;2F": end-of-line
-    "\e[1;3H": beginning-of-line
-    "\e[1;3F": end-of-line
-    "\e[1;4H": beginning-of-line
-    "\e[1;4F": end-of-line
-    "\e[1;5H": beginning-of-line
-    "\e[1;5F": end-of-line
-    "\e[1;6H": beginning-of-line
-    "\e[1;6F": end-of-line
-    "\e[1;7H": beginning-of-line
-    "\e[1;7F": end-of-line
-    "\e[1;8H": beginning-of-line
-    "\e[1;8F": end-of-line
-    "\e[2H":   beginning-of-line
-    "\e[2F":   end-of-line
-    "\e[5H":   beginning-of-line
-    "\e[5F":   end-of-line
-    "\eOH":    beginning-of-line
-    "\eOF":    end-of-line
-    "\eO2H":   beginning-of-line
-    "\eO2F":   end-of-line
-    "\eO5H":   beginning-of-line
-    "\eO5F":   end-of-line
-    "\eOD":     backward-char
-    "\eOC":     forward-char
-    "\eOA":     previous-history
-    "\eOB":     next-history
-    "\eOE":     re-read-init-file
-    "\eO2D":    backward-word
-    "\eO2C":    forward-word
-    "\eO2A":    history-search-backward
-    "\eO2B":    history-search-forward
-    "\eO3D":    backward-word
-    "\eO3C":    forward-word
-    "\eO3A":    history-search-backward
-    "\eO3B":    history-search-forward
-    "\eO4D":    backward-word
-    "\eO4C":    forward-word
-    "\eO4A":    history-search-backward
-    "\eO4B":    history-search-forward
-    "\eO5D":    backward-word
-    "\eO5C":    forward-word
-    "\eO5A":    history-search-backward
-    "\eO5B":    history-search-forward
-    "\eO6D":    backward-word
-    "\eO6C":    forward-word
-    "\eO6A":    history-search-backward
-    "\eO6B":    history-search-forward
-    "\eO7D":    backward-word
-    "\eO7C":    forward-word
-    "\eO7A":    history-search-backward
-    "\eO7B":    history-search-forward
-    "\eO8D":    backward-word
-    "\eO8C":    forward-word
-    "\eO8A":    history-search-backward
-    "\eO8B":    history-search-forward
-    "\eOP":     "\e"
-    "\eOQ":     undo
-    "\eOR":     ""
-    "\eOS":     kill-line
-    "\eO2P":    "\e"
-    "\eO2Q":    undo
-    "\eO2R":    ""
-    "\eO2S":    kill-line
-    "\eO3P":    "\e"
-    "\eO3Q":    undo
-    "\eO3R":    ""
-    "\eO3S":    kill-line
-    "\eO4P":    "\e"
-    "\eO4Q":    undo
-    "\eO4R":    ""
-    "\eO4S":    kill-line
-    "\eO5P":    "\e"
-    "\eO5Q":    undo
-    "\eO5R":    ""
-    "\eO5S":    kill-line
-    "\eO6P":    "\e"
-    "\eO6Q":    undo
-    "\eO6R":    ""
-    "\eO6S":    kill-line
-    "\eO7P":    "\e"
-    "\eO7Q":    undo
-    "\eO7R":    ""
-    "\eO7S":    kill-line
-    "\eO8P":    "\e"
-    "\eO8Q":    undo
-    "\eO8R":    ""
-    "\eO8S":    kill-line
-    "\eO1;2P":  "\e"
-    "\eO1;2Q":  undo
-    "\eO1;2R":  ""
-    "\eO1;2S":  kill-line
-    "\eO1;3P":  "\e"
-    "\eO1;3Q":  undo
-    "\eO1;3R":  ""
-    "\eO1;3S":  kill-line
-    "\eO1;4P":  "\e"
-    "\eO1;4Q":  undo
-    "\eO1;4R":  ""
-    "\eO1;4S":  kill-line
-    "\eO1;5P":  "\e"
-    "\eO1;5Q":  undo
-    "\eO1;5R":  ""
-    "\eO1;5S":  kill-line
-    "\eO1;6P":  "\e"
-    "\eO1;6Q":  undo
-    "\eO1;6R":  ""
-    "\eO1;6S":  kill-line
-    "\eO1;7P":  "\e"
-    "\eO1;7Q":  undo
-    "\eO1;7R":  ""
-    "\eO1;7S":  kill-line
-    "\eO1;8P":  "\e"
-    "\eO1;8Q":  undo
-    "\eO1;8R":  ""
-    "\eO1;8S":  kill-line
-$else
-    "\e[G":     re-read-init-file
-    "\e[1~":    beginning-of-line
-    "\e[4~":    end-of-line
-$endif
-$if term=gnome
-    "\eOP":     "\e"
-    "\eOQ":     undo
-    "\eOR":     ""
-    "\eOS":     kill-line
-$endif
-
-$if term=rxvt-unicode
-    "\e[23$":   ""
-    "\e[24$":   ""
-    "\e[11^":   ""
-    "\e[12^":   ""
-    "\e[13^":   ""
-    "\e[14^":   ""
-    "\e[15^":   ""
-    "\e[17^":   ""
-    "\e[18^":   ""
-    "\e[19^":   ""
-    "\e[20^":   ""
-    "\e[21^":   ""
-    "\e[23^":   ""
-    "\e[24^":   ""
-    "\eOo":     "/"
-    "\eOj":     "*"
-    "\eOm":     "-"
-    "\eOk":     "+"
-    "\eOl":     ","
-    "\eOM":     accept-line
-    "\eOn":     "."
-    "\eOp":     "0"
-    "\eOq":     "1"
-    "\eOr":     "2"
-    "\eOs":     "3"
-    "\eOt":     "4"
-    "\eOu":     "5"
-    "\eOv":     "6"
-    "\eOw":     "7"
-    "\eOx":     "8"
-    "\eOy":     "9"
-    "\e\eOo":   ""
-    "\e\eOj":   ""
-    "\e\eOm":   ""
-    "\e\eOk":   ""
-    "\e\eOl":   delete-char
-    "\e\eOM":   accept-line
-    "\e\eOn":   delete-char
-    "\e\eOp":   yank
-    "\e\eOq":   end-of-line
-    "\e\eOr":   down-history
-    "\e\eOs":   history-search-forward
-    "\e\eOt":   backward-char
-    "\e\eOu":   re-read-init-file
-    "\e\eOv":   forward-char
-    "\e\eOw":   beginning-of-line
-    "\e\eOx":   up-history
-    "\e\eOy":   history-search-backward
-    "\e[c":     forward-word
-    "\e[d":     backward-word
-    "\e[a":     history-search-backward
-    "\e[b":     history-search-forward
-    "\e\e[c":   forward-word
-    "\e\e[d":   backward-word
-    "\e\e[a":   history-search-backward
-    "\e\e[b":   history-search-forward
-    "\e\e[C":   forward-word
-    "\e\e[D":   backward-word
-    "\e\e[A":   history-search-backward
-    "\e\e[B":   history-search-forward
-    "\e[2^":    yank
-    "\e[3^":    delete-char
-    "\e[5^":    history-search-backward
-    "\e[6^":    history-search-forward
-    "\e[7^":    beginning-of-line
-    "\e[8^":    end-of-line
-    "\e[2$":    yank
-    "\e[3$":    delete-char
-    "\e[5$":    history-search-backward
-    "\e[6$":    history-search-forward
-    "\e[7$":    beginning-of-line
-    "\e[8$":    end-of-line
-    "\e\e[2$":  yank
-    "\e\e[3$":  delete-char
-    "\e\e[5$":  history-search-backward
-    "\e\e[6$":  history-search-forward
-    "\e\e[7$":  beginning-of-line
-    "\e\e[8$":  end-of-line
-    "\e=":      accept-line
-$endif
-
diff --git a/overlay/generic/etc/cron.d/crontabs/root b/overlay/generic/etc/cron.d/crontabs/root
deleted file mode 100644
index 4153ad2d..00000000
--- a/overlay/generic/etc/cron.d/crontabs/root
+++ /dev/null
@@ -1,18 +0,0 @@
-## Rotate and trim the audit logs nightly.
-0 0 * * * /smartdc/bin/sdc-lastcomm -R 30
-## Run logadm hourly so that the minimum rotate interval is 1h
-0 * * * * /usr/sbin/logadm
-## Rotate vm.log files for any KVM VMs
-0 * * * * SDC_LOG_ROLL_BACKWARD=1 /usr/vm/sbin/rotate-kvm-logs.sh >> /var/log/rotate-kvm-logs.log 2>&1
-## Headnode should phone home nightly.
-0 1 * * * [ -x /opt/smartdc/bin/sdc-phonehome ] && /opt/smartdc/bin/sdc-phonehome
-## Delete saved core dumps over 7 days old
-15 0 * * * find /zones/*/cores -type f -mtime +7 -exec rm -f "{}" \;
-## Delete archived zone data over 7 days old
-30 0 * * * find /zones/archive/ -mount -maxdepth 1 -mindepth 1 -type d -mtime +7 -exec rm -rf "{}" \;
-## Delete logs to be uploaded over 7 days old if they aren't being consumed
-45 0 * * * [ -d /var/log/sdc/upload/ ] && find /var/log/sdc/upload/ -mount -maxdepth 1 -mindepth 1 -type f -mtime +7 -exec rm -f "{}" \;
-
-# NOTE: all entries above are in root's system-defined crontab; see the
-# crontab(1) man page.
-
diff --git a/overlay/generic/etc/crypto/pkcs11.conf b/overlay/generic/etc/crypto/pkcs11.conf
deleted file mode 100644
index 835e61f7..00000000
--- a/overlay/generic/etc/crypto/pkcs11.conf
+++ /dev/null
@@ -1,43 +0,0 @@
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-# Copyright 2009 Sun Microsystems, Inc.  All rights reserved.
-# Use is subject to license terms.
-# Copyright 2011 Joyent, Inc.  All rights reserved.
-#
-# /etc/crypto/pkcs11.conf
-#
-# Do NOT edit this file by hand.  An administrator should use cryptoadm(1m)
-# to administer the cryptographic framework.  A developer for a user-level
-# cryptographic provider package should provide an input file and use the
-# {i,r}.pkcs11conf class action scripts to update this file during the
-# installation and removal of the package.
-#
-# This document does not constitute an API.  The /etc/crypto/pkcs11.conf file 
-# may not exist or may have a different content or interpretation in a future
-# release.  The existence of this notice does not imply that any other 
-# documentation that lacks this notice constitutes an API.
-#
-#
-# Start SUNWcsr
-metaslot:metaslot_status=enabled;metaslot_auto_key_migrate=enabled;metaslot_token=Sun Software PKCS#11 softtoken;metaslot_slot=Sun Crypto Softtoken
-/usr/lib/security/$ISA/pkcs11_kernel.so
-/usr/lib/security/$ISA/pkcs11_softtoken.so
-# End SUNWcsr
diff --git a/overlay/generic/etc/default/be b/overlay/generic/etc/default/be
deleted file mode 100644
index baa10391..00000000
--- a/overlay/generic/etc/default/be
+++ /dev/null
@@ -1 +0,0 @@
-BE_HAS_GRUB=true
diff --git a/overlay/generic/etc/default/init b/overlay/generic/etc/default/init
deleted file mode 100644
index 6f185159..00000000
--- a/overlay/generic/etc/default/init
+++ /dev/null
@@ -1,38 +0,0 @@
-#
-# Copyright 2005 Sun Microsystems, Inc.  All rights reserved.
-# Use is subject to license terms.
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License, Version 1.0 only
-# (the "License").  You may not use this file except in compliance
-# with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-#ident	"%Z%%M%	%I%	%E% SMI"
-#
-# This file is /etc/default/init.  /etc/TIMEZONE is a symlink to this file.
-# This file looks like a shell script, but it is not.  To maintain
-# compatibility with old versions of /etc/TIMEZONE, some shell constructs
-# (i.e., export commands) are allowed in this file, but are ignored.
-#
-# Lines of this file should be of the form VAR=value, where VAR is one of
-# TZ, LANG, CMASK, or any of the LC_* environment variables.  value may
-# be enclosed in double quotes (") or single quotes (').
-#
-TZ=UTC
-CMASK=022
-LANG=en_US.UTF-8
diff --git a/overlay/generic/etc/default/login b/overlay/generic/etc/default/login
deleted file mode 100644
index 4515dfcc..00000000
--- a/overlay/generic/etc/default/login
+++ /dev/null
@@ -1,98 +0,0 @@
-#
-# Copyright 2008 Sun Microsystems, Inc.  All rights reserved.
-# Use is subject to license terms.
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-
-# Set the TZ environment variable of the shell.
-#
-#TIMEZONE=EST5EDT
-
-# ULIMIT sets the file size limit for the login.  Units are disk blocks.
-# The default of zero means no limit.
-#
-#ULIMIT=0
-
-# If CONSOLE is set, root can only login on that device.
-# If the specified device is /dev/console, then root can also log into
-# any of the currently enabled /dev/vt/# virtual terminal devices.
-# Comment this line out to allow remote login by root.
-#
-#CONSOLE=/dev/console
-
-# PASSREQ determines if login requires a password.
-#
-PASSREQ=YES
-
-# ALTSHELL determines if the SHELL environment variable should be set
-#
-ALTSHELL=YES
-
-# PATH sets the initial shell PATH variable
-#
-#PATH=/usr/bin:
-
-# SUPATH sets the initial shell PATH variable for root
-#
-#SUPATH=/usr/sbin:/usr/bin
-
-# TIMEOUT sets the number of seconds (between 0 and 900) to wait before
-# abandoning a login session.
-#
-#TIMEOUT=300
-
-# UMASK sets the initial shell file creation mode mask.  See umask(1).
-#
-#UMASK=022
-
-# SYSLOG determines whether the syslog(3) LOG_AUTH facility should be used
-# to log all root logins at level LOG_NOTICE and multiple failed login
-# attempts at LOG_CRIT.
-#
-SYSLOG=YES
-
-# SLEEPTIME controls the number of seconds that the command should
-# wait before printing the "login incorrect" message when a
-# bad password is provided.  The range is limited from
-# 0 to 5 seconds.
-#
-#SLEEPTIME=4
-
-# DISABLETIME  If present, and greater than zero, the number of seconds
-# login will wait after RETRIES failed attempts or the PAM framework returns
-# PAM_ABORT. Default is 20. Minimum is 0. No maximum is imposed.
-#
-#DISABLETIME=20
-
-# RETRIES determines the number of failed logins that will be
-# allowed before login exits. Default is 5 and maximum is 15.
-# If account locking is configured (user_attr(4)/policy.conf(4))
-# for a local user's account (passwd(4)/shadow(4)), that account
-# will be locked if failed logins equals or exceeds RETRIES.
-#
-#RETRIES=5
-#
-# The SYSLOG_FAILED_LOGINS variable is used to determine how many failed
-# login attempts will be allowed by the system before a failed login
-# message is logged, using the syslog(3) LOG_NOTICE facility.  For example,
-# if the variable is set to 0, login will log -all- failed login attempts.
-#
-#SYSLOG_FAILED_LOGINS=5
diff --git a/overlay/generic/etc/default/passwd b/overlay/generic/etc/default/passwd
deleted file mode 100644
index baa3c705..00000000
--- a/overlay/generic/etc/default/passwd
+++ /dev/null
@@ -1,71 +0,0 @@
-#ident	"%Z%%M%	%I%	%E% SMI"
-#
-# Copyright 2005 Sun Microsystems, Inc.  All rights reserved.
-# Use is subject to license terms.
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License, Version 1.0 only
-# (the "License").  You may not use this file except in compliance
-# with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-MAXWEEKS=
-MINWEEKS=
-PASSLENGTH=6
-
-# NAMECHECK enables/disables login name checking.
-# The default is to do login name checking.
-# Specifying a value of "NO" will disable login name checking.
-#
-#NAMECHECK=NO
-
-# HISTORY sets the number of prior password changes to keep and
-# check for a user when changing passwords.  Setting the HISTORY
-# value to zero (0), or removing/commenting out the flag will
-# cause all users' prior password history to be discarded at the
-# next password change by any user.  No password history will
-# be checked if the flag is not present or has zero value.
-# The maximum value of HISTORY is 26.
-#
-# This flag is only enforced for user accounts defined in the
-# local passwd(4)/shadow(4) files.
-#
-#HISTORY=0
-#
-# Password complexity tunables.  The values listed are the defaults
-# which are compatible with previous releases of passwd.
-# See passwd(1) and pam_authtok_check(5) for use warnings and
-# discussion of the use of these options.
-#
-#MINDIFF=3
-#MINALPHA=2
-#MINNONALPHA=1
-#MINUPPER=0
-#MINLOWER=0
-#MAXREPEATS=0
-#MINSPECIAL=0
-#MINDIGIT=0
-#WHITESPACE=YES
-#
-# 
-# passwd performs dictionary lookups if DICTIONLIST or DICTIONDBDIR
-# is defined. If the password database does not yet exist, it is
-# created by passwd. See passwd(1), pam_authtok_check(5) and
-# mkpwdict(1M) for more information.
-#
-#DICTIONLIST=
-#DICTIONDBDIR=/var/passwd
diff --git a/overlay/generic/etc/dispadmin.conf b/overlay/generic/etc/dispadmin.conf
deleted file mode 100644
index 7970647c..00000000
--- a/overlay/generic/etc/dispadmin.conf
+++ /dev/null
@@ -1 +0,0 @@
-DEFAULT_SCHEDULER=FSS
diff --git a/overlay/generic/etc/driver_aliases b/overlay/generic/etc/driver_aliases
deleted file mode 100644
index 64b11760..00000000
--- a/overlay/generic/etc/driver_aliases
+++ /dev/null
@@ -1,1438 +0,0 @@
-aac "pci1028,3"
-aac "pci1028,a"
-aac "pci9005,285"
-aac "pci9005,286"
-aac "pciex9005,285"
-aac "pciex9005,286"
-acpinex "acpivirtnex"
-adpu320 "pci9005,8000"
-adpu320 "pci9005,800f.9005.5f"
-adpu320 "pci9005,8010"
-adpu320 "pci9005,8011"
-adpu320 "pci9005,8012"
-adpu320 "pci9005,8014"
-adpu320 "pci9005,8015"
-adpu320 "pci9005,8016"
-adpu320 "pci9005,8017"
-adpu320 "pci9005,801d"
-adpu320 "pci9005,801e"
-adpu320 "pci9005,801f"
-adpu320 "pci9005,808f"
-afe "pci10b7,9300"
-afe "pci1113,1216"
-afe "pci1317,1985"
-afe "pci1317,9511"
-afe "pci1317,9513"
-afe "pci1317,981"
-afe "pci1317,985"
-afe "pci13d1,ab02"
-afe "pci13d1,ab03"
-afe "pci13d1,ab08"
-afe "pci1737,ab08"
-agptarget "pci1022,7454"
-agptarget "pci8086,1130"
-agptarget "pci8086,2560"
-agptarget "pci8086,2570"
-agptarget "pci8086,2580"
-agptarget "pci8086,2590"
-agptarget "pci8086,2770"
-agptarget "pci8086,27a0"
-agptarget "pci8086,27ac"
-agptarget "pci8086,2970"
-agptarget "pci8086,2980"
-agptarget "pci8086,2990"
-agptarget "pci8086,29a0"
-agptarget "pci8086,29b0"
-agptarget "pci8086,29c0"
-agptarget "pci8086,29d0"
-agptarget "pci8086,2a00"
-agptarget "pci8086,2a10"
-agptarget "pci8086,2a40"
-agptarget "pci8086,2e00"
-agptarget "pci8086,2e10"
-agptarget "pci8086,2e20"
-agptarget "pci8086,2e30"
-agptarget "pci8086,2e40"
-agptarget "pci8086,3575"
-agptarget "pci8086,3580"
-agptarget "pci8086,40"
-agptarget "pci8086,44"
-agptarget "pci8086,62"
-agptarget "pci8086,6a"
-agptarget "pci8086,7120"
-agptarget "pci8086,7122"
-agptarget "pci8086,7124"
-ahci "pciclass,010601"
-amd64_gart "pci1022,1103"
-amd8111s "pci1022,7462"
-amd_iommu "pci1002,5a23"
-amd_iommu "pci1022,11ff"
-amdf17nbdf "pci1022,1450"
-amdf17nbdf "pci1022,1460"
-amr "pci1000,1960.1000,532"
-amr "pci101e,1960.1028,493"
-amr "pci1000,1960.1028,518"
-amr "pci1000,1960.1028,520"
-arcmsr "pci17d3,1110"
-arcmsr "pci17d3,1120"
-arcmsr "pci17d3,1130"
-arcmsr "pci17d3,1160"
-arcmsr "pci17d3,1170"
-arcmsr "pci17d3,1201"
-arcmsr "pci17d3,1210"
-arcmsr "pci17d3,1220"
-arcmsr "pci17d3,1230"
-arcmsr "pci17d3,1260"
-arcmsr "pci17d3,1270"
-arcmsr "pci17d3,1280"
-arcmsr "pci17d3,1380"
-arcmsr "pci17d3,1381"
-arcmsr "pci17d3,1680"
-arcmsr "pci17d3,1681"
-arcmsr "pci17d3,1880"
-arcmsr "pci17d3,1882"
-asy "pci11c1,480"
-ata "ide"
-atge "pciex1969,1026"
-atge "pciex1969,1048"
-atge "pciex1969,1062"
-atge "pciex1969,1063"
-atge "pciex1969,1073"
-atge "pciex1969,1083"
-atge "pciex1969,2060"
-atge "pciex1969,2062"
-axf "usb7b8,420a"
-axf "usbb95,7720"
-axf "usbb95,772a"
-axf "usb2001,1a00"
-axf "usb77b,2226"
-axf "usb846,1040"
-axf "usbb95,1720"
-axf "usb8dd,90ff"
-axf "usb557,2009"
-axf "usb411,3d"
-axf "usb6189,182d"
-axf "usb7aa,17"
-axf "usb1189,893"
-axf "usb1631,6200"
-axf "usb13b1,18"
-axf "usb1557,7720"
-axf "usb7d1,3c05"
-axf "usb2001,3c05"
-axf "usb5ac,1402"
-bcm_sata "pci1166,24a"
-bfe "pci14e4,170c"
-bfe "pci14e4,4401"
-bfe "pci14e4,4402"
-bge "SUNW,bge"
-bge "pci108e,1647"
-bge "pci108e,1648"
-bge "pci108e,16a7"
-bge "pci108e,16a8"
-bge "pci14e4,1600"
-bge "pci14e4,1601"
-bge "pci14e4,1643"
-bge "pci14e4,1644"
-bge "pci14e4,1645"
-bge "pci14e4,1647"
-bge "pci14e4,1648"
-bge "pci14e4,1649"
-bge "pci14e4,1653"
-bge "pci14e4,1654"
-bge "pci14e4,1657"
-bge "pci14e4,1659"
-bge "pci14e4,165d"
-bge "pci14e4,165e"
-bge "pci14e4,165f"
-bge "pci14e4,1665"
-bge "pci14e4,1668"
-bge "pci14e4,1669"
-bge "pci14e4,166a"
-bge "pci14e4,166e"
-bge "pci14e4,1677"
-bge "pci14e4,1678"
-bge "pci14e4,1679"
-bge "pci14e4,167d"
-bge "pci14e4,1693"
-bge "pci14e4,1696"
-bge "pci14e4,1699"
-bge "pci14e4,169b"
-bge "pci14e4,169c"
-bge "pci14e4,16a6"
-bge "pci14e4,16a7"
-bge "pci14e4,16a8"
-bge "pci14e4,16c7"
-bge "pci14e4,16f3"
-bge "pciex14e4,1643"
-bge "pciex14e4,1655"
-bge "pciex14e4,1656"
-bge "pciex14e4,1657"
-bge "pciex14e4,165a"
-bge "pciex14e4,165b"
-bge "pciex14e4,165c"
-bge "pciex14e4,165f"
-bge "pciex14e4,1665"
-bge "pciex14e4,1673"
-bge "pciex14e4,1674"
-bge "pciex14e4,1677"
-bge "pciex14e4,167a"
-bge "pciex14e4,167b"
-bge "pciex14e4,1680"
-bge "pciex14e4,1681"
-bge "pciex14e4,1684"
-bge "pciex14e4,1688"
-bge "pciex14e4,1689"
-bge "pciex14e4,1690"
-bge "pciex14e4,1691"
-bge "pciex14e4,1692"
-bge "pciex14e4,1694"
-bge "pciex14e4,1698"
-bge "pciex14e4,169d"
-bge "pciex14e4,16fd"
-bge "pciex14e4,16f3"
-bge "pciex14e4,1713"
-bnx "pci14e4,1639"
-bnx "pci14e4,163a"
-bnx "pci14e4,163b"
-bnx "pci14e4,163c"
-bnx "pci14e4,164a"
-bnx "pci14e4,164c"
-bnx "pci14e4,16aa"
-bnx "pci14e4,16ac"
-bnxe "pci14e4,164e"
-bnxe "pci14e4,164f"
-bnxe "pci14e4,1650"
-bnxe "pciex14e4,164e"
-bnxe "pciex14e4,164f"
-bnxe "pciex14e4,1650"
-bnxe "pciex14e4,1662"
-bnxe "pciex14e4,1663"
-bnxe "pciex14e4,168a"
-bnxe "pciex14e4,168d"
-bnxe "pciex14e4,168e"
-bnxe "pciex14e4,16a1"
-bnxe "pciex14e4,16a4"
-bnxe "pciex14e4,16a5"
-bnxe "pciex14e4,16ab"
-bnxe "pciex14e4,16ae"
-bscbus "SVI0101"
-ce "pci100b,35"
-ce "pci108e,abba"
-chxge "pci1425,7"
-chxge "pci1425,a"
-cpqary3 "pci103c,3211"
-cpqary3 "pci103c,3212"
-cpqary3 "pci103c,3223"
-cpqary3 "pci103c,3225"
-cpqary3 "pci103c,3234"
-cpqary3 "pci103c,3235"
-cpqary3 "pci103c,3237"
-cpqary3 "pci103c,323d"
-cpqary3 "pcie11,4070"
-cpqary3 "pcie11,4080"
-cpqary3 "pcie11,4082"
-cpqary3 "pcie11,4083"
-cpqary3 "pcie11,4091"
-cpqary3 "pcie11,409a"
-cpqary3 "pcie11,409b"
-cpqary3 "pcie11,409c"
-cpqary3 "pcie11,409d"
-cpqary3 "pcie11,409e"
-cpudrv "cpu"
-cpunex "cpus"
-dcam1394 "firewire000104,000100"
-dcam1394 "firewire00a02d,000100"
-dmfe "pci108e,9102"
-dmfe "pci1282,9102"
-dmfe "pci128h,9102"
-dnet "pci1011,14"
-dnet "pci1011,19"
-dnet "pci1011,2"
-dnet "pci1011,9"
-dnet "pci10b8,2001"
-dnet "pci1109,1400"
-dnet "pci1109,2400"
-dnet "pci2646,1"
-dr "acpidr_sbd"
-dr_sas "pciex1000,78"
-dr_sas "pciex1000,79"
-e1000g "pci8086,1000"
-e1000g "pci8086,1001"
-e1000g "pci8086,1004.0e11.49"
-e1000g "pci8086,1004.0e11.b1a4"
-e1000g "pci8086,1004.1014.10f2"
-e1000g "pci8086,1004.8086.1004"
-e1000g "pci8086,1004.8086.2004"
-e1000g "pci8086,1008"
-e1000g "pci8086,1009"
-e1000g "pci8086,100c"
-e1000g "pci8086,100d"
-e1000g "pci8086,100e"
-e1000g "pci8086,100f"
-e1000g "pci8086,1010"
-e1000g "pci8086,1011"
-e1000g "pci8086,1012"
-e1000g "pci8086,1013"
-e1000g "pci8086,1014"
-e1000g "pci8086,1015"
-e1000g "pci8086,1016"
-e1000g "pci8086,1017"
-e1000g "pci8086,1018"
-e1000g "pci8086,1019"
-e1000g "pci8086,101a"
-e1000g "pci8086,101d"
-e1000g "pci8086,101e"
-e1000g "pci8086,1026"
-e1000g "pci8086,1027"
-e1000g "pci8086,1028"
-e1000g "pci8086,1049"
-e1000g "pci8086,104a"
-e1000g "pci8086,104b"
-e1000g "pci8086,104c"
-e1000g "pci8086,104d"
-e1000g "pci8086,105a"
-e1000g "pci8086,105b"
-e1000g "pci8086,105c"
-e1000g "pci8086,105e"
-e1000g "pci8086,105f"
-e1000g "pci8086,1060"
-e1000g "pci8086,1061"
-e1000g "pci8086,1062"
-e1000g "pci8086,1063"
-e1000g "pci8086,1075"
-e1000g "pci8086,1076"
-e1000g "pci8086,1077"
-e1000g "pci8086,1078"
-e1000g "pci8086,1079"
-e1000g "pci8086,107a"
-e1000g "pci8086,107b"
-e1000g "pci8086,107c"
-e1000g "pci8086,107d"
-e1000g "pci8086,107e"
-e1000g "pci8086,107f"
-e1000g "pci8086,108a"
-e1000g "pci8086,108b"
-e1000g "pci8086,108c"
-e1000g "pci8086,1096"
-e1000g "pci8086,1098"
-e1000g "pci8086,1099"
-e1000g "pci8086,109a"
-e1000g "pci8086,10a4"
-e1000g "pci8086,10a5"
-e1000g "pci8086,10b5"
-e1000g "pci8086,10b9"
-e1000g "pci8086,10ba"
-e1000g "pci8086,10bb"
-e1000g "pci8086,10bc"
-e1000g "pci8086,10bd"
-e1000g "pci8086,10bf"
-e1000g "pci8086,10c0"
-e1000g "pci8086,10c2"
-e1000g "pci8086,10c3"
-e1000g "pci8086,10c4"
-e1000g "pci8086,10c5"
-e1000g "pci8086,10cb"
-e1000g "pci8086,10cc"
-e1000g "pci8086,10cd"
-e1000g "pci8086,10ce"
-e1000g "pci8086,10d3"
-e1000g "pci8086,10d5"
-e1000g "pci8086,10d9"
-e1000g "pci8086,10da"
-e1000g "pci8086,10de"
-e1000g "pci8086,10df"
-e1000g "pci8086,10e5"
-e1000g "pci8086,10ea"
-e1000g "pci8086,10eb"
-e1000g "pci8086,10ef"
-e1000g "pci8086,10f0"
-e1000g "pci8086,10f5"
-e1000g "pci8086,10f6"
-e1000g "pci8086,1502"
-e1000g "pci8086,1503"
-e1000g "pci8086,150c"
-e1000g "pci8086,153a"
-e1000g "pci8086,153b"
-e1000g "pci8086,1559"
-e1000g "pci8086,155a"
-e1000g "pci8086,156f"
-e1000g "pci8086,1570"
-e1000g "pci8086,15a0"
-e1000g "pci8086,15a1"
-e1000g "pci8086,15a2"
-e1000g "pci8086,15a3"
-e1000g "pci8086,15b7"
-e1000g "pci8086,15b8"
-e1000g "pci8086,15b9"
-e1000g "pci8086,15bb"
-e1000g "pci8086,15bc"
-e1000g "pci8086,15bd"
-e1000g "pci8086,15be"
-e1000g "pci8086,15d6"
-e1000g "pci8086,15d7"
-e1000g "pci8086,15d8"
-e1000g "pci8086,15df"
-e1000g "pci8086,15e0"
-e1000g "pci8086,15e1"
-e1000g "pci8086,15e2"
-e1000g "pci8086,15e3"
-e1000g "pci8086,294c"
-e1000g "pci8086,f0fe"
-e1000g "pciex8086,1049"
-e1000g "pciex8086,104a"
-e1000g "pciex8086,104b"
-e1000g "pciex8086,104c"
-e1000g "pciex8086,104d"
-e1000g "pciex8086,105e"
-e1000g "pciex8086,105f"
-e1000g "pciex8086,1060"
-e1000g "pciex8086,107d"
-e1000g "pciex8086,107e"
-e1000g "pciex8086,107f"
-e1000g "pciex8086,108b"
-e1000g "pciex8086,108c"
-e1000g "pciex8086,1096"
-e1000g "pciex8086,1098"
-e1000g "pciex8086,109a"
-e1000g "pciex8086,10a4"
-e1000g "pciex8086,10a5"
-e1000g "pciex8086,10b9"
-e1000g "pciex8086,10ba"
-e1000g "pciex8086,10bb"
-e1000g "pciex8086,10bc"
-e1000g "pciex8086,10bd"
-e1000g "pciex8086,10bf"
-e1000g "pciex8086,10c0"
-e1000g "pciex8086,10c2"
-e1000g "pciex8086,10c3"
-e1000g "pciex8086,10c4"
-e1000g "pciex8086,10c5"
-e1000g "pciex8086,10cb"
-e1000g "pciex8086,10cc"
-e1000g "pciex8086,10cd"
-e1000g "pciex8086,10ce"
-e1000g "pciex8086,10d3"
-e1000g "pciex8086,10d5"
-e1000g "pciex8086,10d9"
-e1000g "pciex8086,10da"
-e1000g "pciex8086,10de"
-e1000g "pciex8086,10df"
-e1000g "pciex8086,10e5"
-e1000g "pciex8086,10ea"
-e1000g "pciex8086,10eb"
-e1000g "pciex8086,10ef"
-e1000g "pciex8086,10f0"
-e1000g "pciex8086,10f5"
-e1000g "pciex8086,10f6"
-e1000g "pciex8086,1502"
-e1000g "pciex8086,1503"
-e1000g "pciex8086,150c"
-e1000g "pciex8086,153a"
-e1000g "pciex8086,153b"
-e1000g "pciex8086,1559"
-e1000g "pciex8086,156f"
-e1000g "pciex8086,1570"
-e1000g "pciex8086,155a"
-e1000g "pciex8086,15a0"
-e1000g "pciex8086,15a1"
-e1000g "pciex8086,15a2"
-e1000g "pciex8086,15a3"
-e1000g "pciex8086,15b7"
-e1000g "pciex8086,15b8"
-e1000g "pciex8086,15b9"
-e1000g "pciex8086,15bb"
-e1000g "pciex8086,15bc"
-e1000g "pciex8086,15bd"
-e1000g "pciex8086,15be"
-e1000g "pciex8086,15d6"
-e1000g "pciex8086,15d7"
-e1000g "pciex8086,15d8"
-e1000g "pciex8086,15df"
-e1000g "pciex8086,15e0"
-e1000g "pciex8086,15e1"
-e1000g "pciex8086,15e2"
-e1000g "pciex8086,15e3"
-e1000g "pciex8086,294c"
-e1000g "pciex8086,f0fe"
-ecpp "lp"
-ehci "pciclass,0c0320"
-elxl "pci10b7,9000"
-elxl "pci10b7,9001"
-elxl "pci10b7,9004"
-elxl "pci10b7,9005"
-elxl "pci10b7,9006"
-elxl "pci10b7,9050"
-elxl "pci10b7,9051"
-elxl "pci10b7,9055"
-elxl "pci10b7,9056"
-elxl "pci10b7,905a"
-elxl "pci10b7,9200"
-elxl "pci10b7,9201"
-elxl "pci10b7,9202"
-elxl "pci10b7,9800"
-elxl "pci10b7,9805"
-emlxs "lpfs"
-emlxs "pci10df,f0a5"
-emlxs "pci10df,f800"
-emlxs "pci10df,f900"
-emlxs "pci10df,f980"
-emlxs "pci10df,fa00"
-emlxs "pci10df,fc00"
-emlxs "pci10df,fc10"
-emlxs "pci10df,fc20"
-emlxs "pci10df,fd00"
-emlxs "pci10df,fe00"
-emlxs "pciex10df,f100"
-emlxs "pciex10df,f111"
-emlxs "pciex10df,f112"
-emlxs "pciex10df,fc20"
-emlxs "pciex10df,fc40"
-emlxs "pciex10df,fe00"
-emlxs "pciex10df,fe05"
-emlxs "pciex19a2,704"
-emlxs "pciex19a2,714"
-fipe "pci8086,25f0"
-fipe "pci8086,360c"
-glm "pci1000,b"
-hci1394 "pciclass,0c0010"
-heci "pci8086,2974"
-heci "pci8086,2984"
-heci "pci8086,2994"
-heci "pci8086,29a4"
-heci "pci8086,29b4"
-heci "pci8086,29c4"
-heci "pci8086,2e04"
-heci "pci8086,2e14"
-hid "usbif,class3"
-hme "pci108e,1001"
-hubd "usbif,class9"
-hxge "pci108e,aaaa"
-i40e "pciex8086,1572"
-i40e "pciex8086,1580"
-i40e "pciex8086,1581"
-i40e "pciex8086,1583"
-i40e "pciex8086,1584"
-i40e "pciex8086,1585"
-i40e "pciex8086,1586"
-i40e "pciex8086,1589"
-i40e "pciex8086,158a"
-i40e "pciex8086,158b"
-i40e "pciex8086,37ce"
-i40e "pciex8086,37cf"
-i40e "pciex8086,37d0"
-i40e "pciex8086,37d1"
-i40e "pciex8086,37d2"
-i40e "pciex8086,37d3"
-i915 "pci8086,2562"
-i915 "pci8086,2572"
-i915 "pci8086,2582"
-i915 "pci8086,2592"
-i915 "pci8086,2772"
-i915 "pci8086,27a2"
-i915 "pci8086,27ae"
-i915 "pci8086,2972"
-i915 "pci8086,2982"
-i915 "pci8086,2992"
-i915 "pci8086,29a2"
-i915 "pci8086,29b2"
-i915 "pci8086,29c2"
-i915 "pci8086,29d2"
-i915 "pci8086,2a02"
-i915 "pci8086,2a12"
-i915 "pci8086,2a42"
-i915 "pci8086,2e02.8086.2e02"
-i915 "pci8086,2e12"
-i915 "pci8086,2e22"
-i915 "pci8086,2e32"
-i915 "pci8086,2e42"
-i915 "pci8086,42"
-i915 "pci8086,46"
-ibp "ib.ipib"
-igb "pciex8086,10a7"
-igb "pciex8086,10a9"
-igb "pciex8086,10c9"
-igb "pciex8086,10d6"
-igb "pciex8086,10e6"
-igb "pciex8086,10e7"
-igb "pciex8086,10e8"
-igb "pciex8086,150a"
-igb "pciex8086,150d"
-igb "pciex8086,150e"
-igb "pciex8086,150f"
-igb "pciex8086,1510"
-igb "pciex8086,1511"
-igb "pciex8086,1516"
-igb "pciex8086,1518"
-igb "pciex8086,1521"
-igb "pciex8086,1522"
-igb "pciex8086,1523"
-igb "pciex8086,1524"
-igb "pciex8086,1526"
-igb "pciex8086,1533"
-igb "pciex8086,1534"
-igb "pciex8086,1535"
-igb "pciex8086,1536"
-igb "pciex8086,1537"
-igb "pciex8086,1538"
-igb "pciex8086,1539"
-igb "pciex8086,1546"
-igb "pciex8086,157b"
-igb "pciex8086,157c"
-igb "pciex8086,1f40"
-igb "pciex8086,1f41"
-igb "pciex8086,1f45"
-igb "pciex8086,438"
-intel_nb5000 "pci8086,25c0"
-intel_nb5000 "pci8086,25d0"
-intel_nb5000 "pci8086,25d4"
-intel_nb5000 "pci8086,25d8"
-intel_nb5000 "pci8086,3600"
-intel_nb5000 "pci8086,4000"
-intel_nb5000 "pci8086,4001"
-intel_nb5000 "pci8086,4003"
-intel_nb5000 "pci8086,65c0"
-intel_nhm "pci8086,3423"
-intel_nhm "pci8086,372a"
-intel_nhmex "pci8086,3422"
-intel_nhmex "pci8086,3438"
-ioat "pciex8086,1a38"
-ioat "pciex8086,360b"
-ioat "pciex8086,402f"
-iprb "pci8086,1029"
-iprb "pci8086,1030"
-iprb "pci8086,1031"
-iprb "pci8086,1032"
-iprb "pci8086,1038"
-iprb "pci8086,1039"
-iprb "pci8086,103d"
-iprb "pci8086,103d.8086.103d"
-iprb "pci8086,1050"
-iprb "pci8086,1050.8086.3020"
-iprb "pci8086,1050.8086.302f"
-iprb "pci8086,1050.8086.3427"
-iprb "pci8086,1059"
-iprb "pci8086,1064"
-iprb "pci8086,1068"
-iprb "pci8086,1069"
-iprb "pci8086,1092"
-iprb "pci8086,1209"
-iprb "pci8086,1229"
-iprb "pci8086,1229.8086.1"
-iprb "pci8086,1229.8086.10"
-iprb "pci8086,1229.8086.1009"
-iprb "pci8086,1229.8086.100c"
-iprb "pci8086,1229.8086.1012"
-iprb "pci8086,1229.8086.1013"
-iprb "pci8086,1229.8086.1015"
-iprb "pci8086,1229.8086.1016"
-iprb "pci8086,1229.8086.1017"
-iprb "pci8086,1229.8086.1030"
-iprb "pci8086,1229.8086.1040"
-iprb "pci8086,1229.8086.1041"
-iprb "pci8086,1229.8086.1042"
-iprb "pci8086,1229.8086.1050"
-iprb "pci8086,1229.8086.1051"
-iprb "pci8086,1229.8086.1052"
-iprb "pci8086,1229.8086.10f0"
-iprb "pci8086,1229.8086.11"
-iprb "pci8086,1229.8086.12"
-iprb "pci8086,1229.8086.1229"
-iprb "pci8086,1229.8086.13"
-iprb "pci8086,1229.8086.2"
-iprb "pci8086,1229.8086.2009"
-iprb "pci8086,1229.8086.200d"
-iprb "pci8086,1229.8086.200e"
-iprb "pci8086,1229.8086.200f"
-iprb "pci8086,1229.8086.2010"
-iprb "pci8086,1229.8086.2013"
-iprb "pci8086,1229.8086.2016"
-iprb "pci8086,1229.8086.2017"
-iprb "pci8086,1229.8086.2018"
-iprb "pci8086,1229.8086.2019"
-iprb "pci8086,1229.8086.2101"
-iprb "pci8086,1229.8086.2102"
-iprb "pci8086,1229.8086.2103"
-iprb "pci8086,1229.8086.2104"
-iprb "pci8086,1229.8086.2105"
-iprb "pci8086,1229.8086.2106"
-iprb "pci8086,1229.8086.2107"
-iprb "pci8086,1229.8086.2108"
-iprb "pci8086,1229.8086.2200"
-iprb "pci8086,1229.8086.2201"
-iprb "pci8086,1229.8086.2202"
-iprb "pci8086,1229.8086.2203"
-iprb "pci8086,1229.8086.2204"
-iprb "pci8086,1229.8086.2205"
-iprb "pci8086,1229.8086.2206"
-iprb "pci8086,1229.8086.2207"
-iprb "pci8086,1229.8086.2208"
-iprb "pci8086,1229.8086.2402"
-iprb "pci8086,1229.8086.2407"
-iprb "pci8086,1229.8086.2408"
-iprb "pci8086,1229.8086.2409"
-iprb "pci8086,1229.8086.240f"
-iprb "pci8086,1229.8086.2410"
-iprb "pci8086,1229.8086.2411"
-iprb "pci8086,1229.8086.2412"
-iprb "pci8086,1229.8086.2413"
-iprb "pci8086,1229.8086.3"
-iprb "pci8086,1229.8086.30"
-iprb "pci8086,1229.8086.3000"
-iprb "pci8086,1229.8086.3001"
-iprb "pci8086,1229.8086.3002"
-iprb "pci8086,1229.8086.3006"
-iprb "pci8086,1229.8086.3007"
-iprb "pci8086,1229.8086.3008"
-iprb "pci8086,1229.8086.3010"
-iprb "pci8086,1229.8086.3011"
-iprb "pci8086,1229.8086.3012"
-iprb "pci8086,1229.8086.301a"
-iprb "pci8086,1229.8086.31"
-iprb "pci8086,1229.8086.3411"
-iprb "pci8086,1229.8086.4"
-iprb "pci8086,1229.8086.40"
-iprb "pci8086,1229.8086.41"
-iprb "pci8086,1229.8086.42"
-iprb "pci8086,1229.8086.5"
-iprb "pci8086,1229.8086.50"
-iprb "pci8086,1229.8086.6"
-iprb "pci8086,1229.8086.7"
-iprb "pci8086,1229.8086.8"
-iprb "pci8086,1229.8086.9"
-iprb "pci8086,1229.8086.a"
-iprb "pci8086,1229.8086.b"
-iprb "pci8086,1229.8086.c"
-iprb "pci8086,1229.8086.d"
-iprb "pci8086,1229.8086.e"
-iprb "pci8086,1229.8086.f"
-iprb "pci8086,2449"
-iprb "pci8086,2449.8086.3010"
-iprb "pci8086,2449.8086.3011"
-iprb "pci8086,2449.8086.3012"
-iprb "pci8086,2449.8086.3013"
-iprb "pci8086,2449.8086.3014"
-iprb "pci8086,2449.8086.3015"
-iprb "pci8086,2449.8086.3016"
-iprb "pci8086,2449.8086.3017"
-iprb "pci8086,2449.8086.3018"
-iprb "pci8086,27dc"
-iprb "pci8086,27dc.8086.308d"
-isa "pciclass,060100"
-iwn "pci8086,82"
-iwn "pci8086,83"
-iwn "pci8086,84"
-iwn "pci8086,85"
-iwn "pci8086,87"
-iwn "pci8086,89"
-iwn "pci8086,8a"
-iwn "pci8086,8b"
-iwn "pci8086,8d"
-iwn "pci8086,8e"
-iwn "pci8086,90"
-iwn "pci8086,91"
-iwn "pci8086,887"
-iwn "pci8086,888"
-iwn "pci8086,88e"
-iwn "pci8086,88f"
-iwn "pci8086,890"
-iwn "pci8086,891"
-iwn "pci8086,892"
-iwn "pci8086,893"
-iwn "pci8086,894"
-iwn "pci8086,895"
-iwn "pci8086,896"
-iwn "pci8086,897"
-iwn "pci8086,8ae"
-iwn "pci8086,422b"
-iwn "pci8086,422c"
-iwn "pci8086,4236"
-iwn "pci8086,4238"
-iwn "pci8086,4239"
-ixgb "pci8086,1048"
-ixgb "pci8086,109e"
-ixgb "pci8086,1a48"
-ixgb "pci8086,a11f"
-ixgbe "pciex8086,10b6"
-ixgbe "pciex8086,10c6"
-ixgbe "pciex8086,10c7"
-ixgbe "pciex8086,10c8"
-ixgbe "pciex8086,10db"
-ixgbe "pciex8086,10dd"
-ixgbe "pciex8086,10e1"
-ixgbe "pciex8086,10ec"
-ixgbe "pciex8086,10f1"
-ixgbe "pciex8086,10f4"
-ixgbe "pciex8086,10f7"
-ixgbe "pciex8086,10f8"
-ixgbe "pciex8086,10f9"
-ixgbe "pciex8086,10fb"
-ixgbe "pciex8086,10fc"
-ixgbe "pciex8086,1507"
-ixgbe "pciex8086,1508"
-ixgbe "pciex8086,150b"
-ixgbe "pciex8086,1514"
-ixgbe "pciex8086,1517"
-ixgbe "pciex8086,151c"
-ixgbe "pciex8086,1528"
-ixgbe "pciex8086,154d"
-ixgbe "pciex8086,154a"
-ixgbe "pciex8086,1557"
-ixgbe "pciex8086,1558"
-ixgbe "pciex8086,1560"
-ixgbe "pciex8086,1563"
-ixgbe "pciex8086,15aa"
-ixgbe "pciex8086,15ab"
-ixgbe "pciex8086,15ac"
-ixgbe "pciex8086,15ad"
-ixgbe "pciex8086,15ae"
-ixgbe "pciex8086,15d1"
-kb8042 "pnpPNP,303"
-lsimega "pci1000,1960"
-lsimega "pci1000,407"
-lsimega "pci1000,407.1000.532"
-lsimega "pci1000,408"
-lsimega "pci1000,408.1000.2"
-lsimega "pci1000,409"
-lsimega "pci1028,13"
-marvell88sx "pci11ab,5040"
-marvell88sx "pci11ab,5041"
-marvell88sx "pci11ab,5080"
-marvell88sx "pci11ab,5081"
-marvell88sx "pci11ab,6041.9"
-marvell88sx "pci11ab,6081.9"
-mc-amd "pci1022,1100"
-mc-amd "pci1022,1101"
-mc-amd "pci1022,1102"
-mega_sas "pci1000,411.1000.1001"
-mega_sas "pci1000,411.1000.1002"
-mega_sas "pci1000,411.1000.1003"
-mega_sas "pci1000,411.1000.1004"
-mega_sas "pci1000,411.1000.1008"
-mega_sas "pci1000,411.1000.100c"
-mega_sas "pci1000,411.1000.100d"
-mega_sas "pci1000,411.1000.2004"
-mega_sas "pci1000,411.1000.2005"
-mega_sas "pci1000,411.1033.8287"
-mega_sas "pci1000,411.1054.3016"
-mega_sas "pci1000,411.1734.1081"
-mega_sas "pci1000,411.1734.10a3"
-mega_sas "pci1000,411.8086.1001"
-mega_sas "pci1000,411.8086.1003"
-mega_sas "pci1000,411.8086.1008"
-mega_sas "pci1000,411.8086.3490"
-mega_sas "pci1000,411.8086.3500"
-mega_sas "pci1000,411.8086.3501"
-mega_sas "pci1000,411.8086.3504"
-mega_sas "pci1000,411.8086.3507"
-mega_sas "pci1000,413.1000.1005"
-mega_sas "pci1000,57.8086.3002"
-mega_sas "pci1000,60.1000.1006"
-mega_sas "pci1000,60.1000.100a"
-mega_sas "pci1000,60.1000.100e"
-mega_sas "pci1000,60.1000.100f"
-mega_sas "pci1000,60.1000.1010"
-mega_sas "pci1000,60.1000.1011"
-mega_sas "pci1000,60.1000.1012"
-mega_sas "pci1000,60.1000.1013"
-mega_sas "pci1000,60.1000.1014"
-mega_sas "pci1000,60.1000.1015"
-mega_sas "pci1000,60.1000.1016"
-mega_sas "pci1000,60.1000.1017"
-mega_sas "pci1000,60.1000.1018"
-mega_sas "pci1000,60.1000.1019"
-mega_sas "pci1000,60.1000.101a"
-mega_sas "pci1000,60.1000.101b"
-mega_sas "pci1000,60.1000.1021"
-mega_sas "pci1000,60.1000.1022"
-mega_sas "pci1000,60.1014.363"
-mega_sas "pci1000,60.1014.364"
-mega_sas "pci1000,60.1014.365"
-mega_sas "pci1000,60.1014.379"
-mega_sas "pci1000,60.1014.3a2"
-mega_sas "pci1000,60.1014.3ac"
-mega_sas "pci1000,60.1028.1f0a"
-mega_sas "pci1000,60.1028.1f0b"
-mega_sas "pci1000,60.1028.1f0c"
-mega_sas "pci1000,60.1028.1f0d"
-mega_sas "pci1000,60.1028.1f11"
-mega_sas "pci1000,60.1033.835a"
-mega_sas "pci1000,60.1033.836e"
-mega_sas "pci1000,60.1043.824d"
-mega_sas "pci1000,60.1054.3019"
-mega_sas "pci1000,60.1170.2f"
-mega_sas "pci1000,60.1170.34"
-mega_sas "pci1000,60.1170.36"
-mega_sas "pci1000,60.1458.1000"
-mega_sas "pci1000,60.15d9.c080"
-mega_sas "pci1000,60.1734.10f9"
-mega_sas "pci1000,60.1734.1102"
-mega_sas "pci1000,60.1734.114b"
-mega_sas "pci1000,60.17aa.6b7c"
-mega_sas "pci1000,60.18a1.3"
-mega_sas "pci1000,60.19e5.2001"
-mega_sas "pci1000,60.19e5.2002"
-mega_sas "pci1000,60.19e5.2003"
-mega_sas "pci1000,60.19e5.2004"
-mega_sas "pci1000,60.19e5.2005"
-mega_sas "pci1000,60.19e5.2006"
-mega_sas "pci1000,60.19e5.2010"
-mega_sas "pci1000,60.19e5.2011"
-mega_sas "pci1000,60.19e5.2012"
-mega_sas "pci1000,60.19e5.2013"
-mega_sas "pci1000,60.19e5.2014"
-mega_sas "pci1000,60.19e5.2015"
-mega_sas "pci1000,60.19e5.2016"
-mega_sas "pci1000,60.19e5.2017"
-mega_sas "pci1000,60.19e5.2018"
-mega_sas "pci1000,60.19e5.2019"
-mega_sas "pci1000,60.19e5.201a"
-mega_sas "pci1000,60.19e5.d203"
-mega_sas "pci1000,60.1b0a.14"
-mega_sas "pci1000,60.1fca.2163"
-mega_sas "pci1000,60.1fca.2164"
-mega_sas "pci1000,60.8086.1006"
-mega_sas "pci1000,60.8086.100a"
-mega_sas "pci1000,60.8086.1010"
-mega_sas "pci1000,60.8086.1013"
-mega_sas "pci1000,60.8086.1021"
-mega_sas "pci1000,60.8086.34cc"
-mega_sas "pci1000,60.8086.34cd"
-mega_sas "pci1000,60.8086.34e4"
-mega_sas "pci1000,60.8086.3505"
-mega_sas "pci1000,60.8086.3508"
-mega_sas "pci1000,7c.1000.101c"
-mega_sas "pci1000,7c.1000.101d"
-mega_sas "pci1000,7c.1014.395"
-mega_sas "pci1028,15.1028.1f01"
-mega_sas "pci1028,15.1028.1f02"
-mega_sas "pci1028,15.1028.1f03"
-mouse8042 "pnpPNP,f03"
-mpt "pci1000,30"
-mpt "pci1000,50"
-mpt "pci1000,54"
-mpt "pci1000,56"
-mpt "pci1000,58"
-mpt "pci1000,62"
-mpt "pciex1000,56"
-mpt "pciex1000,58"
-mpt "pciex1000,62"
-mpt_sas "pci1000,64"
-mpt_sas "pci1000,70"
-mpt_sas "pci1000,72"
-mpt_sas "pci1000,76"
-mpt_sas "pciex1000,64"
-mpt_sas "pciex1000,65"
-mpt_sas "pciex1000,6e"
-mpt_sas "pciex1000,70"
-mpt_sas "pciex1000,72"
-mpt_sas "pciex1000,74"
-mpt_sas "pciex1000,76"
-mpt_sas "pciex1000,77"
-mpt_sas "pciex1000,7e"
-mpt_sas "pciex1000,80"
-mpt_sas "pciex1000,81"
-mpt_sas "pciex1000,82"
-mpt_sas "pciex1000,83"
-mpt_sas "pciex1000,84"
-mpt_sas "pciex1000,85"
-mpt_sas "pciex1000,86"
-mpt_sas "pciex1000,87"
-mpt_sas "pciex1000,90"
-mpt_sas "pciex1000,91"
-mpt_sas "pciex1000,92"
-mpt_sas "pciex1000,93"
-mpt_sas "pciex1000,94"
-mpt_sas "pciex1000,95"
-mpt_sas "pciex1000,96"
-mpt_sas "pciex1000,97"
-mpt_sas "pciex1000,aa"
-mpt_sas "pciex1000,ab"
-mpt_sas "pciex1000,ac"
-mpt_sas "pciex1000,ad"
-mpt_sas "pciex1000,ae"
-mpt_sas "pciex1000,af"
-mpt_sas "pciex1000,c0"
-mpt_sas "pciex1000,c1"
-mpt_sas "pciex1000,c2"
-mpt_sas "pciex1000,c3"
-mpt_sas "pciex1000,c4"
-mpt_sas "pciex1000,c5"
-mpt_sas "pciex1000,c6"
-mpt_sas "pciex1000,c7"
-mpt_sas "pciex1000,c8"
-mpt_sas "pciex1000,c9"
-mpt_sas "pciex1000,d0"
-mpt_sas "pciex1000,d1"
-mpt_sas "pciex1000,d2"
-mr_sas "pciex1000,52"
-mr_sas "pciex1000,53"
-mr_sas "pciex1000,5b"
-mr_sas "pciex1000,5d"
-mr_sas "pciex1000,5f"
-mr_sas "pciex1000,71"
-mr_sas "pciex1000,73"
-mr_sas "pciex1000,ce"
-mr_sas "pciex1000,cf"
-mwl "pci11ab,2a0a"
-mwl "pci11ab,2a24"
-mxfe "pci10d9,512"
-mxfe "pci10d9,531"
-mxfe "pci11ad,c115"
-mxfe "pci11fc,9881"
-myri10ge "pci14c1,8"
-myri10ge "pci14c1,9"
-myri10ge "pciex14c1,8"
-myri10ge "pciex14c1,9"
-nfp "pci1011,1065.100.100"
-nfp "pciex1011,1065.100.100"
-nfp "pci8086,b555.100.100"
-nfp "pciex8086,b555.100.100"
-nge "pci10de,268"
-nge "pci10de,269"
-nge "pci10de,37"
-nge "pci10de,372"
-nge "pci10de,373"
-nge "pci10de,38"
-nge "pci10de,3ee"
-nge "pci10de,3ef"
-nge "pci10de,56"
-nge "pci10de,57"
-nge "pci10de,760"
-nge "pci10de,ab0"
-nge "pci10de,df"
-nge "pci10de,e6"
-npe "pciex_root_complex"
-ntxn "pci4040,1"
-ntxn "pci4040,100"
-ntxn "pci4040,2"
-ntxn "pci4040,24"
-ntxn "pci4040,25"
-ntxn "pci4040,3"
-ntxn "pci4040,4"
-ntxn "pci4040,5"
-nulldriver "scsa,nodev"
-nulldriver "scsa,probe"
-nv_sata "pci10de,266"
-nv_sata "pci10de,267"
-nv_sata "pci10de,36"
-nv_sata "pci10de,37e"
-nv_sata "pci10de,37f"
-nv_sata "pci10de,3e"
-nv_sata "pci10de,3f6"
-nv_sata "pci10de,3f7"
-nv_sata "pci10de,54"
-nv_sata "pci10de,55"
-nvme "pciclass,010802"
-nvme "pciexclass,010802"
-nxge "SUNW,niusl"
-nxge "pciex108e,abcd"
-oce "pciex19a2,700"
-oce "pciex19a2,710"
-ohci "pciclass,0c0310"
-pcata "pccard,disk"
-pchtemp "pci8086,8ca4"
-pchtemp "pci8086,8c24"
-pchtemp "pci8086,8d24"
-pchtemp "pci8086,9d31"
-pchtemp "pci8086,a1b1"
-pchtemp "pci8086,a231"
-pchtemp "pci8086,a2b1"
-pchtemp "pci8086,a131"
-pchtemp "pci8086,a379"
-pci_pci "pci1011,1"
-pci_pci "pci1011,21"
-pci_pci "pci1014,22"
-pci_pci "pciclass,060400"
-pci_pci "pciclass,060401"
-pcic "pciclass,060500"
-pcic "pciclass,060700"
-pcieb "pciexclass,060400"
-pcieb "pciexclass,060401"
-pcn "pci1022,2000"
-pcn "pci103c,104c"
-pcser "pccard,Intel_MODEM_2400+_iNC110US_A-"
-pcser "pccard,serial"
-pcser "pccard102,2"
-pcser "pccard102,5"
-pit_beep "SUNW,pit_beep"
-pmcs "pciex11f8,8001"
-pseudo "zconsnex"
-pseudo "zfdnex"
-pvscsi "pci15ad,7c0"
-qede "pciex1077,1634"
-qede "pciex1077,1629"
-qede "pciex1077,1630"
-qede "pciex1077,1656"
-qede "pciex1077,1654"
-qede "pciex1077,1666"
-qede "pciex1077,8070"
-qede "pciex1077,8071"
-qede "pciex1077,8072"
-qede "pciex1077,8073"
-qlc "pci1077,132"
-qlc "pci1077,2200"
-qlc "pci1077,2300"
-qlc "pci1077,2312"
-qlc "pci1077,2422"
-qlc "pciex1077,2432"
-qlc "pciex1077,2532"
-qlc "pciex1077,5432"
-qlc "pciex1077,8001"
-qlc "pciex1077,8021"
-qlge "pciex1077,8000"
-rge "pci10ec,8136"
-rge "pci10ec,8167"
-rge "pci10ec,8168"
-rge "pci10ec,8169"
-rge "pci16ec,116"
-rge "pciex10ec,8136"
-rtls "pci10ec,8139"
-rtls "pci1113,1211"
-rtls "pci1186,1300"
-rtls "pci1186,1301"
-rum "usb1044,800a"
-rum "usb13b1,20"
-rum "usb148f,2573"
-rum "usb15a9,4"
-rum "usb7d1,3c03"
-rum "usb7d1,3c04"
-rum "usbb05,1723"
-scsa1394 "firewire00609e,010483"
-scsa2usb "usb584,222"
-scsa2usb "usbif,class8"
-sd "scsiclass,00"
-sd "scsiclass,05"
-sdhost "pciclass,080500"
-sdhost "pciclass,080501"
-ses "scsiclass,03S"
-ses "scsiclass,0d"
-sfe "pci100b,20"
-sfe "pci1039,7016"
-sfe "pci1039,900"
-sfxge "pci1924,803"
-sfxge "pci1924,810"
-sfxge "pci1924,813"
-sfxge "pci1924,901"
-sfxge "pci1924,903"
-sfxge "pci1924,923"
-sgen "scsa,08.bfcp"
-sgen "scsa,08.bvhci"
-smrt "pci103c,1920"
-smrt "pci103c,1921"
-smrt "pci103c,1922"
-smrt "pci103c,1923"
-smrt "pci103c,1924"
-smrt "pci103c,1926"
-smrt "pci103c,1928"
-smrt "pci103c,21bd"
-smrt "pci103c,21be"
-smrt "pci103c,21bf"
-smrt "pci103c,21c0"
-smrt "pci103c,21c1"
-smrt "pci103c,21c2"
-smrt "pci103c,21c3"
-smrt "pci103c,21c5"
-smrt "pci103c,21c6"
-smrt "pci103c,21c7"
-smrt "pci103c,21c8"
-smrt "pci103c,21ca"
-smrt "pci103c,21cb"
-smrt "pci103c,21cc"
-smrt "pci103c,21cd"
-smrt "pci103c,21ce"
-smrt "pci103c,3241"
-smrt "pci103c,3243"
-smrt "pci103c,3245"
-smrt "pci103c,3247"
-smrt "pci103c,3249"
-smrt "pci103c,324a"
-smrt "pci103c,324b"
-smrt "pci103c,3350"
-smrt "pci103c,3351"
-smrt "pci103c,3352"
-smrt "pci103c,3353"
-smrt "pci103c,3354"
-smrt "pci103c,3355"
-smrt "pci103c,3356"
-si3124 "pci1095,3124"
-si3124 "pci1095,3132"
-skd "pciex1b39,1"
-st "scsiclass,01"
-t4nex "pciex1425,4400"
-t4nex "pciex1425,4401"
-t4nex "pciex1425,4402"
-t4nex "pciex1425,4403"
-t4nex "pciex1425,4404"
-t4nex "pciex1425,4405"
-t4nex "pciex1425,4406"
-t4nex "pciex1425,4407"
-t4nex "pciex1425,4408"
-t4nex "pciex1425,4409"
-t4nex "pciex1425,440a"
-t4nex "pciex1425,440d"
-t4nex "pciex1425,440e"
-t4nex "pciex1425,5400"
-t4nex "pciex1425,5401"
-t4nex "pciex1425,5402"
-t4nex "pciex1425,5403"
-t4nex "pciex1425,5404"
-t4nex "pciex1425,5405"
-t4nex "pciex1425,5406"
-t4nex "pciex1425,5407"
-t4nex "pciex1425,5408"
-t4nex "pciex1425,5409"
-t4nex "pciex1425,540a"
-t4nex "pciex1425,540b"
-t4nex "pciex1425,540c"
-t4nex "pciex1425,540d"
-t4nex "pciex1425,540e"
-t4nex "pciex1425,540f"
-t4nex "pciex1425,5410"
-t4nex "pciex1425,5411"
-t4nex "pciex1425,5412"
-t4nex "pciex1425,5413"
-t4nex "pciex1425,5414"
-t4nex "pciex1425,5415"
-t4nex "pciex1425,5416"
-t4nex "pciex1425,5417"
-t4nex "pciex1425,5418"
-t4nex "pciex1425,5480"
-t4nex "pciex1425,5481"
-t4nex "pciex1425,5482"
-t4nex "pciex1425,5486"
-t4nex "pciex1425,5487"
-t4nex "pciex1425,5488"
-t4nex "pciex1425,5489"
-t4nex "pciex1425,5490"
-t4nex "pciex1425,5491"
-t4nex "pciex1425,5492"
-t4nex "pciex1425,5493"
-t4nex "pciex1425,5494"
-t4nex "pciex1425,5495"
-t4nex "pciex1425,5496"
-t4nex "pciex1425,5497"
-t4nex "pciex1425,5498"
-t4nex "pciex1425,5499"
-t4nex "pciex1425,549a"
-t4nex "pciex1425,549b"
-t4nex "pciex1425,549c"
-t4nex "pciex1425,549d"
-t4nex "pciex1425,549e"
-t4nex "pciex1425,549f"
-t4nex "pciex1425,54a0"
-t4nex "pciex1425,54a1"
-t4nex "pciex1425,6400"
-t4nex "pciex1425,6401"
-t4nex "pciex1425,6402"
-t4nex "pciex1425,6403"
-t4nex "pciex1425,6404"
-t4nex "pciex1425,6405"
-t4nex "pciex1425,6406"
-t4nex "pciex1425,6407"
-t4nex "pciex1425,6408"
-t4nex "pciex1425,6409"
-t4nex "pciex1425,640d"
-t4nex "pciex1425,6410"
-t4nex "pciex1425,6411"
-t4nex "pciex1425,6414"
-t4nex "pciex1425,6415"
-t4nex "pciex1425,6480"
-t4nex "pciex1425,6481"
-tavor "pci15b3,5a44"
-tavor "pci15b3,5a45"
-tavor "pci15b3,6278"
-tavor "pci15b3,6279"
-tavor "pciex15b3,6278"
-tavor "pciex15b3,6279"
-udmf "usb7aa,9601"
-udmf "usba46,6688"
-udmf "usba46,268"
-udmf "usba46,9601"
-udmf "usbfe6,8101"
-ugen "usbif51d,class3"
-upf "usb7a6,8511"
-upf "usb411,5"
-upf "usb4bb,904"
-upf "usb4bb,93a"
-upf "usb506,4601"
-upf "usb557,2007"
-upf "usb7b8,110c"
-upf "usb7b8,4104"
-upf "usb7b8,4004"
-upf "usb7b8,4007"
-upf "usb7b8,4102"
-upf "usb7b8,4002"
-upf "usb7b8,400b"
-upf "usb7b8,400c"
-upf "usb7b8,abc1"
-upf "usb7b8,200c"
-upf "usb83a,1046"
-upf "usb83a,5046"
-upf "usb83a,b004"
-upf "usb7a6,8513"
-upf "usb7a6,8515"
-upf "usb7a6,986"
-upf "usb7a6,1986"
-upf "usb334,1701"
-upf "usb7c9,b100"
-upf "usb50d,121"
-upf "usb8dd,986"
-upf "usb8dd,987"
-upf "usb8dd,988"
-upf "usb8dd,8511"
-upf "usb49f,8511"
-upf "usb7aa,4"
-upf "usb7aa,d"
-upf "usb2001,4001"
-upf "usb2001,4002"
-upf "usb2001,4102"
-upf "usb2001,400b"
-upf "usb2001,200c"
-upf "usb2001,4003"
-upf "usb2001,abc1"
-upf "usbdb7,2"
-upf "usb1342,304"
-upf "usb56e,4010"
-upf "usb5cc,3000"
-upf "usb1044,8002"
-upf "usbe66,400c"
-upf "usb3f0,811c"
-upf "usb4bb,913"
-upf "usb951,a"
-upf "usb56e,4002"
-upf "usb56e,4005"
-upf "usb56e,400b"
-upf "usb56e,abc1"
-upf "usb56e,200c"
-upf "usb66b,2202"
-upf "usb66b,2203"
-upf "usb66b,2204"
-upf "usb66b,2206"
-upf "usb66b,8b4"
-upf "usb66b,400b"
-upf "usb66b,200c"
-upf "usb411,1"
-upf "usb411,9"
-upf "usb45e,7a"
-upf "usb846,1020"
-upf "usbb3p,109"
-upf "usbb3p,901"
-upf "usb8d1,3"
-upf "usb707,200"
-upf "usb707,201"
-upf "usb15e8,9100"
-upf "usb15e8,9110"
-upf "usb67c,1001"
-urf "usbbda,8150"
-urf "usb411,12"
-urf "usb3980,3"
-urf "usb7b8,401a"
-urf "usb1557,8150"
-urf "usb586,401a"
-uhci "pciclass,0c0300"
-usb_ac "usbif,class1.1"
-usb_as "usbif,class1.2"
-usb_ia "usb,ia"
-usb_mid "usb,device"
-usbecm "usb,class2.6.0"
-usbecm "usb430,a4a2"
-usbecm "usbif,class2.6"
-usbftdi "usb403,6001"
-usbftdi "usb403,6015"
-usbftdi "usb403,cc48"
-usbftdi "usb403,cc49"
-usbftdi "usb403,cc4a"
-usbftdi "usb403,e888"
-usbftdi "usb403,e889"
-usbftdi "usb403,e88b"
-usbftdi "usb403,e88c"
-usbftdi "usb403,fa00"
-usbftdi "usb403,fa01"
-usbftdi "usb403,fa02"
-usbftdi "usb403,fa03"
-usbftdi "usb403,fa04"
-usbftdi "usb403,fc08"
-usbftdi "usb403,fc09"
-usbftdi "usb403,fc0b"
-usbftdi "usb403,fc0c"
-usbftdi "usb403,fc0d"
-usbftdi "usb403,fc82"
-usbftdi "usb411,00b3"
-usbftdi "usb7cc,0421"
-usbftdi "usb856,ac01"
-usbftdi "usb93c,0601"
-usbftdi "usb93c,0701"
-usbprn "usbif,class7.1"
-usbsacm "usb,class2.2.0"
-usbsacm "usb1410,1110"
-usbsacm "usbc88,17da"
-usbsacm "usbif,class2.2"
-usbser_edge "usbif1608,1.100.config1.0"
-usbser_edge "usbif1608,1.config1.0"
-usbser_edge "usbif1608,10.config1.0"
-usbser_edge "usbif1608,11.config1.0"
-usbser_edge "usbif1608,12.config1.0"
-usbser_edge "usbif1608,13.config1.0"
-usbser_edge "usbif1608,14.config1.0"
-usbser_edge "usbif1608,201.config1.0"
-usbser_edge "usbif1608,205.config1.0"
-usbser_edge "usbif1608,206.config1.0"
-usbser_edge "usbif1608,207.config1.0"
-usbser_edge "usbif1608,20c.config1.0"
-usbser_edge "usbif1608,20d.config1.0"
-usbser_edge "usbif1608,215.config1.0"
-usbser_edge "usbif1608,217.config1.0"
-usbser_edge "usbif1608,21a.config1.0"
-usbser_edge "usbif1608,240.config1.0"
-usbser_edge "usbif1608,241.config1.0"
-usbser_edge "usbif1608,242.config1.0"
-usbser_edge "usbif1608,243.config1.0"
-usbser_edge "usbif1608,244.config1.0"
-usbser_edge "usbif1608,247.config1.0"
-usbser_edge "usbif1608,3.config1.0"
-usbser_edge "usbif1608,4.config1.0"
-usbser_edge "usbif1608,5.config1.0"
-usbser_edge "usbif1608,6.config1.0"
-usbser_edge "usbif1608,7.config1.0"
-usbser_edge "usbif1608,c.config1.0"
-usbser_edge "usbif1608,d.config1.0"
-usbser_edge "usbif1608,e.config1.0"
-usbser_edge "usbif1608,f.config1.0"
-usbsksp "usb6cd,11a"
-usbsksp "usb6cd,121"
-usbsksp "usb6cd,12a"
-usbsksp "usb6cd,131"
-usbsprl "usb557,2008"
-usbsprl "usb56e,5004"
-usbsprl "usb5ad,fba"
-usbsprl "usb6189,2068"
-usbsprl "usb67b,2303"
-usbsprl "usb67b,aaa2"
-vgatext "pciclass,000100"
-vgatext "pciclass,030000"
-vgatext "pciclass,030001"
-vgatext "pnpPNP,900"
-vmxnet "pci15ad,720"
-vmxnet3s "pci15ad,7b0"
-vr "pci1106,3043"
-vr "pci1106,3053"
-vr "pci1106,3065"
-vr "pci1106,3106"
-xge "pci17d5,5731"
-xge "pci17d5,5831"
-xge "pci17d5,5832"
-xhci "pciclass,0c0330"
-xnbe "xnb,ioemu"
-xnbo "xnb"
-xnbo "xnb,SUNW_mac"
-xnbu "xnb,netfront"
-xpv "pci5853,1.1"
-yge "pciex1186,4b00"
-yge "pciex11ab,4354"
-yge "pciex11ab,4355"
-yge "pciex11ab,4362"
-yge "pciex11ab,4363"
-yge "pciex11ab,4364"
-yge "pciex11ab,436a"
-vioblk "pci1af4,1001"
-vioif "pci1af4,1"
diff --git a/overlay/generic/etc/driver_classes b/overlay/generic/etc/driver_classes
deleted file mode 100644
index 3124f9a2..00000000
--- a/overlay/generic/etc/driver_classes
+++ /dev/null
@@ -1,30 +0,0 @@
-scsi_vhci	scsi-self-identifying
-mpt	scsi
-pci_pci	pci
-cpqary3	scsi
-aac	scsi
-adpu320	scsi
-ahci	scsi-self-identifying
-amr	scsi
-arcmsr	scsi
-bcm_sata	scsi-self-identifying
-isa	sysbus
-pci	pci
-emlxs	fibre-channel
-iscsi	scsi-self-identify
-lsimega	scsi
-mpt_sas	scsi-self-identifying
-mr_sas	scsi-self-identifying
-mega_sas	scsi
-marvell88sx	scsi-self-identifying
-nv_sata	scsi-self-identifying
-pcic	pcmcia
-glm	scsi
-pmcs	scsi-self-identifying
-ata	dada
-ata	scsi
-qlc	fibre-channel
-si3124	scsi-self-identifying
-dr_sas	scsi-self-identifying
-skd	disk
-smrt	scsi-self-identifying
diff --git a/overlay/generic/etc/dumpadm.conf b/overlay/generic/etc/dumpadm.conf
deleted file mode 100644
index 804e1da1..00000000
--- a/overlay/generic/etc/dumpadm.conf
+++ /dev/null
@@ -1,11 +0,0 @@
-#
-# dumpadm.conf
-#
-# Configuration parameters for system crash dump.
-# Do NOT edit this file by hand -- use dumpadm(1m) instead.
-#
-DUMPADM_DEVICE=/dev/zvol/dsk/zones/dump
-DUMPADM_SAVDIR=/var/crash/volatile
-DUMPADM_CONTENT=kernel
-DUMPADM_ENABLE=no
-DUMPADM_CSAVE=on
diff --git a/overlay/generic/etc/group b/overlay/generic/etc/group
deleted file mode 100644
index 52482c15..00000000
--- a/overlay/generic/etc/group
+++ /dev/null
@@ -1,28 +0,0 @@
-root::0:
-other::1:root
-bin::2:root,daemon
-sys::3:root,bin,adm
-adm::4:root,daemon
-uucp::5:root
-mail::6:root
-tty::7:root,adm
-lp::8:root,adm
-nuucp::9:root
-staff::10:
-daemon::12:root
-sysadmin::14:
-games::20:
-smmsp::25:
-gdm::50:
-upnp::52:
-xvm::60:
-mysql::70:
-openldap::75:
-webservd::80:
-postgres::90:
-slocate::95:
-unknown::96:
-nobody::60001:
-noaccess::60002:
-nogroup::65534:
-netadm::65:
diff --git a/overlay/generic/etc/inet/ntp.conf b/overlay/generic/etc/inet/ntp.conf
deleted file mode 100644
index 7097aa88..00000000
--- a/overlay/generic/etc/inet/ntp.conf
+++ /dev/null
@@ -1,16 +0,0 @@
-driftfile /var/ntp/ntp.drift
-logfile /var/log/ntp.log
-
-# Ignore all network traffic by default
-restrict default ignore
-restrict -6 default ignore
-
-# Allow localhost to manage ntpd
-restrict 127.0.0.1
-restrict -6 ::1
-
-# # Allow servers to reply to our queries
-restrict source nomodify noquery notrap
-
-# Time Servers
-pool 0.smartos.pool.ntp.org burst iburst minpoll 4
diff --git a/overlay/generic/etc/inet/services b/overlay/generic/etc/inet/services
deleted file mode 100644
index f4775bfb..00000000
--- a/overlay/generic/etc/inet/services
+++ /dev/null
@@ -1,653 +0,0 @@
-# Copyright 2010 Sun Microsystems, Inc.  All rights reserved.
-# Use is subject to license terms.
-# Copyright 2012 Joyent, Inc.  All rights reserved.
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-# Network services, Internet style
-#
-# Note that it is presently the policy of IANA to assign a single well-known
-# port number for both TCP and UDP; hence, officially ports have two entries
-# even if the protocol doesn't support UDP operations.
-#
-# Updated from http://www.iana.org/assignments/port-numbers and other
-# sources like http://www.freebsd.org/cgi/cvsweb.cgi/src/etc/services .
-# New ports will be added on request if they have been officially assigned
-# by IANA and used in the real-world or are needed by a debian package.
-# If you need a huge list of used numbers please install the nmap package.
-
-tcpmux		1/tcp				# TCP port service multiplexer
-echo		7/tcp
-echo		7/udp
-discard		9/tcp		sink null
-discard		9/udp		sink null
-systat		11/tcp		users
-daytime		13/tcp
-daytime		13/udp
-netstat		15/tcp
-qotd		17/tcp		quote
-msp		18/tcp				# message send protocol
-msp		18/udp
-chargen		19/tcp		ttytst source
-chargen		19/udp		ttytst source
-ftp-data	20/tcp
-ftp		21/tcp
-ftp		21/sctp
-fsp		21/udp		fspd
-ssh		22/tcp				# SSH Remote Login Protocol
-ssh		22/sctp
-ssh		22/udp
-telnet		23/tcp
-smtp		25/tcp		mail
-time		37/tcp		timserver
-time		37/udp		timserver
-rlp		39/tcp				# Resource Location Protocol
-rlp		39/udp		resource	# resource location
-nameserver	42/tcp		name		# IEN 116
-nameserver	42/udp		name
-whois		43/tcp		nicname
-tacacs		49/tcp				# Login Host Protocol (TACACS)
-tacacs		49/udp
-re-mail-ck	50/tcp				# Remote Mail Checking Protocol
-re-mail-ck	50/udp
-domain		53/tcp				# name-domain server
-domain		53/udp
-mtp		57/tcp				# deprecated
-tacacs-ds	65/tcp				# TACACS-Database Service
-tacacs-ds	65/udp
-bootps		67/tcp				# BOOTP server
-bootps		67/udp
-bootpc		68/tcp				# BOOTP client
-bootpc		68/udp
-tftp		69/udp
-gopher		70/tcp				# Internet Gopher
-gopher		70/udp
-rje		77/tcp		netrjs
-finger		79/tcp
-www		80/tcp		http		# WorldWideWeb HTTP
-www		80/sctp		http
-www		80/udp				# HyperText Transfer Protocol
-link		87/tcp		ttylink
-kerberos	88/tcp		kerberos5 krb5 kerberos-sec	# Kerberos v5
-kerberos	88/udp		kerberos5 krb5 kerberos-sec	# Kerberos v5
-supdup		95/tcp
-hostnames	101/tcp		hostname	# usually from sri-nic
-iso-tsap	102/tcp		tsap		# part of ISODE
-x400		103/tcp				# ISO Mail
-acr-nema	104/tcp		dicom		# Digital Imag. & Comm. 300
-acr-nema	104/udp		dicom		# Digital Imag. & Comm. 300
-csnet-ns	105/tcp		cso-ns		# also used by CSO name server
-csnet-ns	105/udp		cso-ns
-rtelnet		107/tcp				# Remote Telnet
-rtelnet		107/udp
-pop2		109/tcp		postoffice pop-2 # POP version 2
-pop2		109/udp		pop-2
-pop3		110/tcp		pop-3		# POP version 3
-pop3		110/udp		pop-3
-sunrpc		111/tcp		portmapper	# RPC 4.0 portmapper
-sunrpc		111/udp		portmapper
-auth		113/tcp		authentication tap ident
-sftp		115/tcp
-uucp-path	117/tcp
-nntp		119/tcp		readnews untp	# USENET News Transfer Protocol
-ntp		123/tcp
-ntp		123/udp				# Network Time Protocol
-pwdgen		129/tcp				# PWDGEN service
-pwdgen		129/udp				# PWDGEN service
-loc-srv		135/tcp		epmap		# Location Service
-loc-srv		135/udp		epmap
-netbios-ns	137/tcp				# NETBIOS Name Service
-netbios-ns	137/udp
-netbios-dgm	138/tcp				# NETBIOS Datagram Service
-netbios-dgm	138/udp
-netbios-ssn	139/tcp				# NETBIOS session service
-netbios-ssn	139/udp
-imap2		143/tcp		imap		# Interim Mail Access P 2 and 4
-imap2		143/udp		imap
-snmp		161/tcp				# Simple Net Mgmt Protocol
-snmp		161/udp				# Simple Net Mgmt Protocol
-snmp-trap	162/tcp		snmptrap	# Traps for SNMP
-snmp-trap	162/udp		snmptrap	# Traps for SNMP
-cmip-man	163/tcp				# ISO mgmt over IP (CMOT)
-cmip-man	163/udp
-cmip-agent	164/tcp
-cmip-agent	164/udp
-mailq		174/tcp			# Mailer transport queue for Zmailer
-mailq		174/udp			# Mailer transport queue for Zmailer
-xdmcp		177/tcp				# X Display Mgr. Control Proto
-xdmcp		177/udp
-nextstep	178/tcp		NeXTStep NextStep	# NeXTStep window
-nextstep	178/udp		NeXTStep NextStep	#  server
-bgp		179/tcp				# Border Gateway Protocol
-bgp		179/sctp
-bgp		179/udp
-prospero	191/tcp				# Cliff Neuman's Prospero
-prospero	191/udp
-irc		194/tcp				# Internet Relay Chat
-irc		194/udp
-smux		199/tcp				# SNMP Unix Multiplexer
-smux		199/udp
-at-rtmp		201/tcp				# AppleTalk routing
-at-rtmp		201/udp
-at-nbp		202/tcp				# AppleTalk name binding
-at-nbp		202/udp
-at-echo		204/tcp				# AppleTalk echo
-at-echo		204/udp
-at-zis		206/tcp				# AppleTalk zone information
-at-zis		206/udp
-qmtp		209/tcp				# Quick Mail Transfer Protocol
-qmtp		209/udp				# Quick Mail Transfer Protocol
-z3950		210/tcp		wais		# NISO Z39.50 database
-z3950		210/udp		wais
-ipx		213/tcp				# IPX
-ipx		213/udp
-imap3		220/tcp				# Interactive Mail Access
-imap3		220/udp				# Protocol v3
-pawserv		345/tcp				# Perf Analysis Workbench
-pawserv		345/udp
-zserv		346/tcp				# Zebra server
-zserv		346/udp
-fatserv		347/tcp				# Fatmen Server
-fatserv		347/udp
-rpc2portmap	369/tcp
-rpc2portmap	369/udp				# Coda portmapper
-codaauth2	370/tcp
-codaauth2	370/udp				# Coda authentication server
-clearcase	371/tcp		Clearcase
-clearcase	371/udp		Clearcase
-ulistserv	372/tcp				# UNIX Listserv
-ulistserv	372/udp
-ldap		389/tcp			# Lightweight Directory Access Protocol
-ldap		389/udp
-imsp		406/tcp			# Interactive Mail Support Protocol
-imsp		406/udp
-slp		427/tcp		slp		# Service Location Protocol, V2
-slp		427/udp		slp		# Service Location Protocol, V2
-mobile-ip	434/udp		mobile-ip	# Mobile-IP
-cvc_hostd	442/tcp				# Network Console
-https		443/tcp				# http protocol over TLS/SSL
-https		443/udp
-https		443/sctp
-snpp		444/tcp				# Simple Network Paging Protocol
-snpp		444/udp
-microsoft-ds	445/tcp				# Microsoft Naked CIFS
-microsoft-ds	445/udp
-kpasswd		464/tcp
-kpasswd		464/udp
-saft		487/tcp			# Simple Asynchronous File Transfer
-saft		487/udp
-isakmp		500/tcp			# IPsec - Internet Security Association
-isakmp		500/udp			#  and Key Management Protocol
-dhcpv6-client	546/udp		dhcpv6c		# DHCPv6 Client (RFC 3315)
-dhcpv6-client	546/tcp
-dhcpv6-server	547/udp		dhcpv6s		# DHCPv6 Server (RFC 3315)
-dhcpv6-server	547/tcp
-rtsp		554/tcp			# Real Time Stream Control Protocol
-rtsp		554/udp			# Real Time Stream Control Protocol
-nqs		607/tcp				# Network Queuing system
-nqs		607/udp
-npmp-local	610/tcp		dqs313_qmaster		# npmp-local / DQS
-npmp-local	610/udp		dqs313_qmaster
-npmp-gui	611/tcp		dqs313_execd		# npmp-gui / DQS
-npmp-gui	611/udp		dqs313_execd
-hmmp-ind	612/tcp		dqs313_intercell	# HMMP Indication / DQS
-hmmp-ind	612/udp		dqs313_intercell
-qmqp		628/tcp
-qmqp		628/udp
-ipp		631/tcp				# Internet Printing Protocol
-ipp		631/udp
-uuidgen		697/tcp				# UUID Generator
-uuidgen		697/udp				# UUID Generator
-#
-# UNIX specific services
-#
-rdc		121/tcp				# SNDR server daemon
-exec		512/tcp
-biff		512/udp		comsat
-login		513/tcp
-who		513/udp		whod
-shell		514/tcp		cmd		# no passwords used
-syslog		514/udp
-printer		515/tcp		spooler		# line printer spooler
-talk		517/udp
-ntalk		518/udp
-route		520/udp		router routed	# RIP
-ripng		521/udp
-timed		525/udp		timeserver
-tempo		526/tcp		newdate
-courier		530/tcp		rpc
-conference	531/tcp		chat
-netnews		532/tcp		readnews
-netwall		533/udp				# for emergency broadcasts
-gdomap		538/tcp				# GNUstep distributed objects
-gdomap		538/udp
-uucp		540/tcp		uucpd		# uucp daemon
-klogin		543/tcp				# Kerberized `rlogin' (v5)
-kshell		544/tcp		krcmd		# Kerberized `rsh' (v5)
-afpovertcp	548/tcp				# AFP over TCP
-afpovertcp	548/udp
-new-rwho	550/udp		new-who		# experimental
-remotefs	556/tcp		rfs_server rfs	# Brunhoff remote filesystem
-rmonitor	560/udp		rmonitord	# experimental
-monitor		561/udp				# experimental
-nntps		563/tcp		snntp		# NNTP over SSL
-nntps		563/udp		snntp
-submission	587/tcp				# Submission [RFC4409]
-submission	587/udp
-pcserver	600/tcp				# ECD Integrated PC board srvr
-ldaps		636/tcp				# LDAP over SSL
-ldaps		636/udp
-tinc		655/tcp				# tinc control port
-tinc		655/udp
-sun-dr		665/tcp				# Remote Dynamic Reconfiguration
-silc		706/tcp
-silc		706/udp
-kerberos-adm	749/tcp				# Kerberos `kadmin' (v5)
-kerberos-adm	749/udp				# Kerberos V5 Administration
-kerberos-iv	750/udp				# Kerberos V4 key server
-krb5_prop	754/tcp				# Kerberos V5 KDC propogation
-#
-webster		765/tcp				# Network dictionary
-webster		765/udp
-iscsi		860/tcp
-iscsi		860/udp
-rsync		873/tcp
-rsync		873/udp
-ftps-data	989/tcp				# FTP over SSL (data)
-ftps		990/tcp
-telnets		992/tcp				# Telnet over SSL
-telnets		992/udp
-imaps		993/tcp				# IMAP over SSL
-imaps		993/udp
-ircs		994/tcp				# IRC over SSL
-ircs		994/udp
-pop3s		995/tcp				# POP-3 over SSL
-pop3s		995/udp
-ufsd		1008/tcp	ufsd		# UFS-aware server
-ufsd		1008/udp	ufsd
-cvc		1495/tcp			# Network Console
-#
-# From ``Assigned Numbers'':
-#
-#> The Registered Ports are not controlled by the IANA and on most systems
-#> can be used by ordinary user processes or programs executed by ordinary
-#> users.
-#
-#> Ports are used in the TCP [45,106] to name the ends of logical
-#> connections which carry long term conversations.  For the purpose of
-#> providing services to unknown callers, a service contact port is
-#> defined.  This list specifies the port used by the server process as its
-#> contact port.  While the IANA can not control uses of these ports it
-#> does register or list uses of these ports as a convienence to the
-#> community.
-#
-socks		1080/tcp			# socks proxy server
-socks		1080/udp
-proofd		1093/tcp
-proofd		1093/udp
-rootd		1094/tcp
-rootd		1094/udp
-openvpn		1194/tcp
-openvpn		1194/udp
-rmiregistry	1099/tcp			# Java RMI Registry
-rmiregistry	1099/udp
-kazaa		1214/tcp
-kazaa		1214/udp
-nessus		1241/tcp			# Nessus vulnerability
-nessus		1241/udp			#  assessment scanner
-icap		1344/tcp			# Internet Content Adaptation Protocol
-lotusnote	1352/tcp	lotusnotes	# Lotus Note
-lotusnote	1352/udp	lotusnotes
-ms-sql-s	1433/tcp			# Microsoft SQL Server
-ms-sql-s	1433/udp
-ms-sql-m	1434/tcp			# Microsoft SQL Monitor
-ms-sql-m	1434/udp
-wins		1512/tcp
-wins		1512/udp
-ingreslock	1524/tcp
-ingreslock	1524/udp
-prospero-np	1525/tcp			# Prospero non-privileged
-prospero-np	1525/udp
-datametrics	1645/tcp	old-radius
-datametrics	1645/udp	old-radius
-sa-msg-port	1646/tcp	old-radacct
-sa-msg-port	1646/udp	old-radacct
-kermit		1649/tcp
-kermit		1649/udp
-l2f		1701/tcp	l2tp
-l2f		1701/udp	l2tp
-www-ldap-gw	1760/tcp			# HTTP to LDAP gateway
-www-ldap-gw	1760/udp			# HTTP to LDAP gateway
-radius		1812/tcp
-radius		1812/udp
-radius-acct	1813/tcp	radacct		# Radius Accounting
-radius-acct	1813/udp	radacct
-msnp		1863/tcp			# MSN Messenger
-msnp		1863/udp
-unix-status	1957/tcp			# remstats unix-status server
-log-server	1958/tcp			# remstats log server
-remoteping	1959/tcp			# remstats remoteping server
-cisco-sccp	2000/tcp	sieve		# Cisco SCCP
-cisco-sccp	2000/udp
-search		2010/tcp	ndtp
-pipe_server	2010/tcp
-nfs		2049/tcp			# Network File System
-nfs		2049/udp			# Network File System
-nfsd		2049/sctp	nfs
-gnunet		2086/tcp
-gnunet		2086/udp
-rtcm-sc104	2101/tcp			# RTCM SC-104 IANA 1/29/99
-rtcm-sc104	2101/udp
-gsigatekeeper	2119/tcp
-gsigatekeeper	2119/udp
-gris		2135/tcp		# Grid Resource Information Server
-gris		2135/udp		# Grid Resource Information Server
-cvspserver	2401/tcp			# CVS client/server operations
-cvspserver	2401/udp
-venus		2430/tcp			# codacon port
-venus		2430/udp			# Venus callback/wbc interface
-venus-se	2431/tcp			# tcp side effects
-venus-se	2431/udp			# udp sftp side effect
-codasrv		2432/tcp			# not used
-codasrv		2432/udp			# server port
-codasrv-se	2433/tcp			# tcp side effects
-codasrv-se	2433/udp			# udp sftp side effect
-mon		2583/tcp			# MON traps
-mon		2583/udp
-dict		2628/tcp			# Dictionary server
-dict		2628/udp
-listen		2766/tcp			# System V listener port
-gsiftp		2811/tcp
-gsiftp		2811/udp
-gpsd		2947/tcp
-gpsd		2947/udp
-gds_db		3050/tcp			# InterBase server
-gds_db		3050/udp
-icpv2		3130/tcp	icp		# Internet Cache Protocol
-icpv2		3130/udp	icp
-iscsi-target	3260/tcp
-iscsi-target	3260/udp
-mysql		3306/tcp
-mysql		3306/udp
-nut		3493/tcp			# Network UPS Tools
-nut		3493/udp
-distcc		3632/tcp			# distributed compiler
-distcc		3632/udp
-daap		3689/tcp			# Digital Audio Access Protocol
-daap		3689/udp
-svn		3690/tcp	subversion	# Subversion protocol
-svn		3690/udp	subversion
-suucp		4031/tcp			# UUCP over SSL
-suucp		4031/udp			# UUCP over SSL
-lockd		4045/udp			# NFS lock daemon/manager
-lockd		4045/tcp
-sysrqd		4094/tcp			# sysrq daemon
-sysrqd		4094/udp			# sysrq daemon
-remctl		4373/tcp		# Remote Authenticated Command Service
-remctl		4373/udp		# Remote Authenticated Command Service
-epmd		4369/tcp			# Erlang Port Mapper Daemon
-epmd		4369/udp
-ipsec-nat-t	4500/udp			# IPsec NAT-Traversal
-iax		4569/tcp			# Inter-Asterisk eXchange
-iax		4569/udp
-radmin-port	4899/tcp			# RAdmin Port
-radmin-port	4899/udp
-rfe		5002/udp			# Radio Free Ethernet
-rfe		5002/tcp
-mmcc		5050/tcp	# multimedia conference control tool (Yahoo IM)
-mmcc		5050/udp
-sip		5060/tcp			# Session Initiation Protocol
-sip		5060/udp
-sip-tls		5061/tcp
-sip-tls		5061/udp
-aol		5190/tcp			# AIM
-aol		5190/udp
-xmpp-client	5222/tcp	jabber-client	# Jabber Client Connection
-xmpp-client	5222/udp	jabber-client
-xmpp-server	5269/tcp	jabber-server	# Jabber Server Connection
-xmpp-server	5269/udp	jabber-server
-cfengine	5308/tcp
-cfengine	5308/udp
-mdns		5353/tcp			# Multicast DNS
-mdns		5353/udp			# Multicast DNS
-postgresql	5432/tcp	postgres	# PostgreSQL Database
-postgresql	5432/udp	postgres
-freeciv		5556/tcp	rptp		# Freeciv gameplay
-freeciv		5556/udp
-amqp		5672/tcp
-amqp		5672/udp
-amqp		5672/sctp
-ggz		5688/tcp			# GGZ Gaming Zone
-ggz		5688/udp			# GGZ Gaming Zone
-vnc-server	5900/tcp			# VNC Server
-x11		6000/tcp	x11-0		# X Window System
-x11		6000/udp	x11-0
-x11-1		6001/tcp
-x11-1		6001/udp
-x11-2		6002/tcp
-x11-2		6002/udp
-x11-3		6003/tcp
-x11-3		6003/udp
-x11-4		6004/tcp
-x11-4		6004/udp
-x11-5		6005/tcp
-x11-5		6005/udp
-x11-6		6006/tcp
-x11-6		6006/udp
-x11-7		6007/tcp
-x11-7		6007/udp
-dtspc		6112/tcp			# CDE subprocess control
-gnutella-svc	6346/tcp			# gnutella
-gnutella-svc	6346/udp
-gnutella-rtr	6347/tcp			# gnutella
-gnutella-rtr	6347/udp
-sge_qmaster	6444/tcp			# Grid Engine Qmaster Service
-sge_qmaster	6444/udp			# Grid Engine Qmaster Service
-sge_execd	6445/tcp			# Grid Engine Execution Service
-sge_execd	6445/udp			# Grid Engine Execution Service
-servicetag	6481/udp
-servicetag	6481/tcp
-afs3-fileserver 7000/tcp	bbs		# file server itself
-afs3-fileserver 7000/udp	bbs
-afs3-callback	7001/tcp			# callbacks to cache managers
-afs3-callback	7001/udp
-afs3-prserver	7002/tcp			# users & groups database
-afs3-prserver	7002/udp
-afs3-vlserver	7003/tcp			# volume location database
-afs3-vlserver	7003/udp
-afs3-kaserver	7004/tcp			# AFS/Kerberos authentication
-afs3-kaserver	7004/udp
-afs3-volser	7005/tcp			# volume managment server
-afs3-volser	7005/udp
-afs3-errors	7006/tcp			# error interpretation service
-afs3-errors	7006/udp
-afs3-bos	7007/tcp			# basic overseer process
-afs3-bos	7007/udp
-afs3-update	7008/tcp			# server-to-server updater
-afs3-update	7008/udp
-afs3-rmtsys	7009/tcp			# remote cache manager service
-afs3-rmtsys	7009/udp
-font-service	7100/tcp	xfs		# X Font Service
-font-service	7100/udp	xfs
-http-alt	8080/tcp	webcache	# WWW caching service
-http-alt	8080/udp			# WWW caching service
-bacula-dir	9101/tcp			# Bacula Director
-bacula-dir	9101/udp
-bacula-fd	9102/tcp			# Bacula File Daemon
-bacula-fd	9102/udp
-bacula-sd	9103/tcp			# Bacula Storage Daemon
-bacula-sd	9103/udp
-xmms2		9667/tcp	# Cross-platform Music Multiplexing System
-xmms2		9667/udp	# Cross-platform Music Multiplexing System
-amanda		10080/tcp			# amanda backup services
-amanda		10080/udp
-memcache	11211/tcp
-memcache	11211/udp
-hkp		11371/tcp			# OpenPGP HTTP Keyserver
-hkp		11371/udp			# OpenPGP HTTP Keyserver
-bprd		13720/tcp			# VERITAS NetBackup
-bprd		13720/udp
-bpdbm		13721/tcp			# VERITAS NetBackup
-bpdbm		13721/udp
-bpjava-msvc	13722/tcp			# BP Java MSVC Protocol
-bpjava-msvc	13722/udp
-vnetd		13724/tcp			# Veritas Network Utility
-vnetd		13724/udp
-bpcd		13782/tcp			# VERITAS NetBackup
-bpcd		13782/udp
-vopied		13783/tcp			# VERITAS NetBackup
-vopied		13783/udp
-solaris-audit	16162/tcp			# Secure remote audit logging
-wnn6		22273/tcp			# wnn6
-wnn6		22273/udp
-
-#
-# Datagram Delivery Protocol services
-#
-rtmp		1/ddp			# Routing Table Maintenance Protocol
-nbp		2/ddp			# Name Binding Protocol
-echo		4/ddp			# AppleTalk Echo Protocol
-zip		6/ddp			# Zone Information Protocol
-
-#=========================================================================
-# The remaining port numbers are not as allocated by IANA.
-#=========================================================================
-
-# Kerberos (Project Athena/MIT) services
-# Note that these are for Kerberos v4, and are unofficial.  Sites running
-# v4 should uncomment these and comment out the v5 entries above.
-#
-kerberos4	750/udp		kerberos-iv kdc	# Kerberos (server)
-kerberos4	750/tcp		kerberos-iv kdc
-kerberos_master	751/udp				# Kerberos authentication
-kerberos_master	751/tcp
-passwd_server	752/udp				# Kerberos passwd server
-krb_prop	754/tcp		krb5_prop hprop	# Kerberos slave propagation
-krbupdate	760/tcp		kreg		# Kerberos registration
-swat		901/tcp				# swat
-kpop		1109/tcp			# Pop with Kerberos
-knetd		2053/tcp			# Kerberos de-multiplexor
-zephyr-srv	2102/udp			# Zephyr server
-zephyr-clt	2103/udp			# Zephyr serv-hm connection
-zephyr-hm	2104/udp			# Zephyr hostmanager
-eklogin		2105/tcp			# Kerberos encrypted rlogin
-# Hmmm. Are we using Kv4 or Kv5 now? Worrying.
-# The following is probably Kerberos v5  --- ajt@debian.org (11/02/2000)
-kx		2111/tcp			# X over Kerberos
-iprop		2121/tcp			# incremental propagation
-#
-# Unofficial but necessary (for NetBSD) services
-#
-supfilesrv	871/tcp				# SUP server
-supfiledbg	1127/tcp			# SUP debugging
-
-#
-# Services added for the Debian GNU/Linux distribution
-#
-linuxconf	98/tcp				# LinuxConf
-poppassd	106/tcp				# Eudora
-poppassd	106/udp
-ssmtp		465/tcp		smtps		# SMTP over SSL
-moira_db	775/tcp				# Moira database
-moira_update	777/tcp				# Moira update protocol
-moira_ureg	779/udp				# Moira user registration
-spamd		783/tcp				# spamassassin daemon
-omirr		808/tcp		omirrd		# online mirror
-omirr		808/udp		omirrd
-customs		1001/tcp			# pmake customs server
-customs		1001/udp
-skkserv		1178/tcp			# skk jisho server port
-predict		1210/udp			# predict -- satellite tracking
-rmtcfg		1236/tcp			# Gracilis Packeten remote config server
-wipld		1300/tcp			# Wipl network monitor
-xtel		1313/tcp			# french minitel
-xtelw		1314/tcp			# french minitel
-support		1529/tcp			# GNATS
-cfinger		2003/tcp			# GNU Finger
-frox		2121/tcp			# frox: caching ftp proxy
-ninstall	2150/tcp			# ninstall service
-ninstall	2150/udp
-zebrasrv	2600/tcp			# zebra service
-zebra		2601/tcp			# zebra vty
-ripd		2602/tcp			# ripd vty (zebra)
-ripngd		2603/tcp			# ripngd vty (zebra)
-ospfd		2604/tcp			# ospfd vty (zebra)
-bgpd		2605/tcp			# bgpd vty (zebra)
-ospf6d		2606/tcp			# ospf6d vty (zebra)
-ospfapi		2607/tcp			# OSPF-API
-isisd		2608/tcp			# ISISd vty (zebra)
-afbackup	2988/tcp			# Afbackup system
-afbackup	2988/udp
-afmbackup	2989/tcp			# Afmbackup system
-afmbackup	2989/udp
-xtell		4224/tcp			# xtell server
-fax		4557/tcp			# FAX transmission service (old)
-hylafax		4559/tcp			# HylaFAX client-server protocol (new)
-distmp3		4600/tcp			# distmp3host daemon
-munin		4949/tcp	lrrd		# Munin
-enbd-cstatd	5051/tcp			# ENBD client statd
-enbd-sstatd	5052/tcp			# ENBD server statd
-pcrd		5151/tcp			# PCR-1000 Daemon
-noclog		5354/tcp			# noclogd with TCP (nocol)
-noclog		5354/udp			# noclogd with UDP (nocol)
-hostmon		5355/tcp			# hostmon uses TCP (nocol)
-hostmon		5355/udp			# hostmon uses UDP (nocol)
-rplay		5555/udp			# RPlay audio service
-nsca		5667/tcp			# Nagios Agent - NSCA
-mrtd		5674/tcp			# MRT Routing Daemon
-bgpsim		5675/tcp			# MRT Routing Simulator
-canna		5680/tcp			# cannaserver
-sane-port	6566/tcp	sane saned	# SANE network scanner daemon
-ircd		6667/tcp			# Internet Relay Chat
-zope-ftp	8021/tcp			# zope management by ftp
-tproxy		8081/tcp			# Transparent Proxy
-omniorb		8088/tcp			# OmniORB
-omniorb		8088/udp
-clc-build-daemon 8990/tcp			# Common lisp build daemon
-xinetd		9098/tcp
-mandelspawn	9359/udp	mandelbrot	# network mandelbrot
-git		9418/tcp			# Git Version Control System
-zope		9673/tcp			# zope server
-webmin		10000/tcp
-kamanda		10081/tcp			# amanda backup services (Kerberos)
-kamanda		10081/udp
-amandaidx	10082/tcp			# amanda backup services
-amidxtape	10083/tcp			# amanda backup services
-smsqp		11201/tcp			# Alamin SMS gateway
-smsqp		11201/udp
-xpilot		15345/tcp			# XPilot Contact Port
-xpilot		15345/udp
-sgi-cmsd	17001/udp		# Cluster membership services daemon
-sgi-crsd	17002/udp
-sgi-gcd		17003/udp			# SGI Group membership daemon
-sgi-cad		17004/tcp			# Cluster Admin daemon
-isdnlog		20011/tcp			# isdn logging system
-isdnlog		20011/udp
-vboxd		20012/tcp			# voice box system
-vboxd		20012/udp
-binkp		24554/tcp			# binkp fidonet protocol
-asp		27374/tcp			# Address Search Protocol
-asp		27374/udp
-csync2		30865/tcp			# cluster synchronization tool
-dircproxy	57000/tcp			# Detachable IRC Proxy
-tfido		60177/tcp			# fidonet EMSI over telnet
-fido		60179/tcp			# fidonet EMSI over TCP
-
-# Local services
diff --git a/overlay/generic/etc/inittab b/overlay/generic/etc/inittab
deleted file mode 100644
index 1e615cd8..00000000
--- a/overlay/generic/etc/inittab
+++ /dev/null
@@ -1,40 +0,0 @@
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-# Copyright (c) 1988, 2010, Oracle and/or its affiliates. All rights reserved.
-#
-# The /etc/inittab file controls the configuration of init(1M); for more
-# information refer to init(1M) and inittab(4).  It is no longer
-# necessary to edit inittab(4) directly; administrators should use the
-# Solaris Service Management Facility (SMF) to define services instead.
-# Refer to smf(5) and the System Administration Guide for more
-# information on SMF.
-#
-# For modifying parameters passed to ttymon, use svccfg(1m) to modify
-# the SMF repository. For example:
-#
-#	# svccfg
-#	svc:> select system/console-login
-#	svc:/system/console-login> setprop ttymon/terminal_type = "xterm"
-#	svc:/system/console-login> exit
-#
-ap::sysinit:/sbin/autopush -f /etc/iu.ap
-sp::sysinit:/sbin/soconfig -d /etc/sock2path.d
-smf::sysinit:/lib/svc/bin/svc.startd	>/dev/msglog 2<>/dev/msglog </dev/console
-p3:s1234:powerfail:/usr/sbin/shutdown -y -i5 -g0 >/dev/msglog 2<>/dev/msglog
diff --git a/overlay/generic/etc/ipf/smartos_version b/overlay/generic/etc/ipf/smartos_version
deleted file mode 100644
index 0cfbf088..00000000
--- a/overlay/generic/etc/ipf/smartos_version
+++ /dev/null
@@ -1 +0,0 @@
-2
diff --git a/overlay/generic/etc/issue b/overlay/generic/etc/issue
deleted file mode 100644
index d9957b7a..00000000
--- a/overlay/generic/etc/issue
+++ /dev/null
@@ -1,14 +0,0 @@
-
-
-         [37m[1m*[31m--[0m[31m+--[37m[1m*[0m[33m--[37m[1m*[0m
-         [31m|[1m\[0m [31m|[0m[31m\ |[33m\ [1m|\[0m      J O Y E N T
-         [31m| [1m\[0m[31m|[0m [31m\| [33m\[1m| \[0m     [37;47m#####[0m  [37;47m####[0m   [37;47m#[0m  [37;47m#####[0m  [37;47m###[0m   [37;47m#[0m   [37;47m#[0m TM
-         [31m+--[1m[37m*[31m--+[0m[33m--[1m[37m*[33m--[37m*[0m      [37;47m#[0m    [37;47m#[0m   [37;47m#[0m  [37;47m#[0m    [37;47m#[0m   [37;47m#[0m   [37;47m#[0m  [37;47m##[0m  [37;47m#[0m
-         [37m|[31m\ |\ |\ [33m|[1m\ |[0m      [37;47m#[0m    [37;47m####[0m   [37;47m#[0m    [37;47m#[0m   [37;47m#[0m   [37;47m#[0m  [37;47m#[0m [37;47m#[0m [37;47m#[0m
-         [37m| [31m\| \| \[33m| [1m\|[0m      [37;47m#[0m    [37;47m#[0m  [37;47m#[0m   [37;47m#[0m    [37;47m#[0m   [37;47m#[0m   [37;47m#[0m  [37;47m#[0m  [37;47m##[0m
-         [37m[1m*[0m[37m--+[31m--+[33m--+[1m--+[0m      [37;47m#[0m    [37;47m#[0m   [37;47m#[0m  [37;47m#[0m    [37;47m#[0m    [37;47m###[0m   [37;47m#[0m   [37;47m#[0m
-          [37m[1m\ |[0m[34m\ |\ |[1m\ |[0m
-           [37m[1m\| [0m[34m\| \| [1m\|[0m     [1;37mSmartOS[0m
-            [37m[1m*--+[0m[34m--[37m[1m*[34m--[37m*[0m      build: 00000000T000000Z
-
-
diff --git a/overlay/generic/etc/logadm.conf b/overlay/generic/etc/logadm.conf
deleted file mode 100644
index 39eea575..00000000
--- a/overlay/generic/etc/logadm.conf
+++ /dev/null
@@ -1,59 +0,0 @@
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-# Copyright (c) 2001, 2010, Oracle and/or its affiliates. All rights reserved.
-# Copyright (c) 2018, Joyent, Inc.
-#
-# logadm.conf
-#
-# Default settings for system log file management.
-# The -w option to logadm(1M) is the preferred way to write to this file,
-# but if you do edit it by hand, use "logadm -V" to check it for errors.
-#
-# The format of lines in this file is:
-#       <logname> <options>
-# For each logname listed here, the default options to logadm
-# are given.  Options given on the logadm command line override
-# the defaults contained in this file.
-#
-# logadm typically runs early every morning via an entry in
-# root's crontab (see crontab(1)).
-#
-/var/log/syslog -C 8 -a 'kill -HUP `cat /var/run/*syslog*.pid`'
-/var/adm/messages -C 4 -a 'kill -HUP `cat /var/run/*syslog*.pid`'
-/var/cron/log -c -s 512k -t /var/cron/olog
-/var/lp/logs/lpsched -C 2 -N -t '$file.$N'
-/var/fm/fmd/errlog -N -s 2m -M '/usr/sbin/fmadm -q rotate errlog && mv /var/fm/fmd/errlog.0- $nfile'
-/var/fm/fmd/fltlog -N -A 6m -s 10m -M '/usr/sbin/fmadm -q rotate fltlog && mv /var/fm/fmd/fltlog.0- $nfile'
-vm_logs /var/log/vm/vmadm.log -b '/usr/vm/sbin/rotate-logs.sh -m /var/log/vm/logs/ /var/log/vm/vmadm.log' -t '/var/log/vm/vmadm_$nodename_%FT%H:%M:%S.log' -C 168 -S 1g -p 1h
-fw_logs /var/log/fw/fwadm.log -b '/usr/vm/sbin/rotate-logs.sh -i /var/log/fw/logs/ /var/log/fw/fwadm.log' -t '/var/log/fw/fwadm_$nodename_%FT%H:%M:%S.log' -C 168 -S 1g -p 1h
-vmadmd_logs /var/svc/log/*vmadmd*.log -C 168 -S 1g -c -p 1h -t '/var/log/vm/vmadmd_$nodename_%FT%H:%M:%S.log'
-vminfod_logs /var/svc/log/*vminfod*.log -C 168 -S 1g -c -p 1h -t '/var/log/vm/vminfod_$nodename_%FT%H:%M:%S.log'
-/var/log/*.log -C 2 -s 5m -c
-/var/log/*.debug -C 2 -s 5m -c
-smf_logs /var/svc/log/*.log -C 8 -s 1m -c
-#
-# The entry below is used by turnacct(1M)
-#
-/var/adm/pacct -C 0 -N -a '/usr/lib/acct/accton pacct' -g adm -m 664 -o adm -p never
-#
-# The entry below manages the Dynamic Resource Pools daemon (poold(1M)) logfile.
-#
-/var/log/pool/poold -N -s 512k -a 'pkill -HUP poold; true'
diff --git a/overlay/generic/etc/minor_perm b/overlay/generic/etc/minor_perm
deleted file mode 100644
index 52aa933f..00000000
--- a/overlay/generic/etc/minor_perm
+++ /dev/null
@@ -1,273 +0,0 @@
-spwr:* 0666 root sys
-dump:dump 0660 root sys
-id:* 0640 root sys
-kstat:* 0666 root sys
-ksyms:* 0666 root sys
-logi:l 0666 root sys
-msm:l 0666 root sys
-pts:* 0644 root sys
-pts:0 0620 root tty
-pts:1 0620 root tty
-pts:2 0620 root tty
-pts:3 0620 root tty
-svvslo:* 0666 root sys
-vol:volctl 0666 root sys
-tnf:tnfctl 0600 root sys
-tnf:tnfmap 0600 root sys
-fssnap:* 0640 root sys
-fssnap:ctl 0666 root sys
-rsm:* 0666 root sys
-vni:* 0666 root sys
-bmc:bmc 0666 root sys
-glm:* 0755 root sys
-usbsacm:* 0666 root sys
-sdpib:* 0644 root sys
-i915:* 0644 root sys
-rdc:* 0666 root sys
-md:* 0640 root sys
-md:admin 0644 root sys
-iscsi:* 0600 root sys
-dcam1394:* 0666 root sys
-nv_sata:* 0644 root sys
-smp:* 0644 root sys
-sv:* 0666 root sys
-dmfe:* 0666 root sys
-clone:dmfe 0666 root sys
-clone:ptmx 0666 root sys
-ehci:* 0644 root sys
-hid:* 0600 root sys
-hubd:* 0644 root sys
-hwahc:* 0644 root sys
-hwarc:* 0644 root sys
-ohci:* 0644 root sys
-uhci:* 0644 root sys
-usb_ac:* 0600 root sys
-usb_as:* 0600 root sys
-usbprn:* 0666 root sys
-wusb_ca:* 0666 root sys
-wusb_df:* 0666 root sys
-ipw:* 0666 root sys
-clone:ipw 0666 root sys
-fcip:* 0600 root sys
-ral:* 0666 root sys
-clone:ral 0666 root sys
-daplt:* 0644 root sys
-atiatom:* 0644 root sys
-rtw:* 0666 root sys
-clone:rtw 0666 root sys
-usbsksp:* 0666 root sys
-wpi:* 0666 root sys
-clone:wpi 0666 root sys
-pcser:* 0666 uucp uucp
-dtrace:* 0666 root sys
-fasttrap:fasttrap 0666 root sys
-fbt:fbt 0644 root sys
-lockstat:* 0644 root sys
-profile:profile 0644 root sys
-sdt:sdt 0644 root sys
-systrace:systrace 0644 root sys
-rum:* 0666 root sys
-clone:rum 0666 root sys
-ce:* 0600 root sys
-rge:* 0666 root sys
-clone:rge 0666 root sys
-fcsm:* 0600 root sys
-bge:* 0666 root sys
-clone:bge 0666 root sys
-winlock:* 0666 root sys
-fp:* 0600 root sys
-fm:* 0644 root sys
-ipf:* 0666 root sys
-smbsrv:* 0640 root sys
-bnx:* 0644 root sys
-pcwl:* 0666 root sys
-clone:pcwl 0666 root sys
-pcan:* 0666 root sys
-clone:pcan 0666 root sys
-ural:* 0666 root sys
-clone:ural 0666 root sys
-mxfe:* 0666 root sys
-clone:mxfe 0666 root sys
-ugen:* 0644 root sys
-zyd:* 0666 root sys
-clone:zyd 0666 root sys
-qlc:* 0666 root sys
-qlge:* 0666 root sys
-igb:* 0666 root sys
-clone:igb 0666 root sys
-afe:* 0666 root sys
-clone:afe 0666 root sys
-scsa1394:* 0666 root sys
-agpgart:* 0644 root sys
-agptarget:* 0644 root sys
-amd64_gart:* 0644 root sys
-nsmb:* 0666 root sys
-fcoet:* 0600 root sys
-nvidia:* 0666 root root
-fcp:* 0600 root sys
-ahci:* 0644 root sys
-adpu320:adpu320ctl 0666 root root
-ses:* 0666 bin bin
-iwk:* 0666 root sys
-clone:iwk 0666 root sys
-iwh:* 0666 root sys
-clone:iwh 0666 root sys
-amd_iommu:* 0644 root sys
-balloon:* 0444 root sys
-domcaps:* 0444 root sys
-evtchn:* 0666 root sys
-privcmd:* 0666 root sys
-xenbus:* 0666 root sys
-xpvtap:* 0666 root sys
-ixgb:* 0666 root root
-pm:* 0666 root sys
-usbvc:* 0666 root sys
-hci1394:* 0600 root sys
-rpcib:* 0644 root sys
-nxge:* 0600 root sys
-audio:* 0666 root sys
-fcoe:* 0600 root sys
-usbser_edge:* 0666 root sys
-srpt:* 0644 root sys
-pool:pool 0666 root sys
-pool:poolctl 0666 root sys
-e1000g:* 0666 root sys
-clone:e1000g 0666 root sys
-sdp:* 0644 root sys
-sdp:sdp 0666 root sys
-ixgbe:* 0666 root sys
-clone:ixgbe 0666 root sys
-xge:* 0666 root sys
-clone:xge 0666 root sys
-aggr:* 0666 root sys
-arp:arp 0666 root sys
-bl:* 0666 root sys
-conskbd:kbd 0666 root sys
-clone:bridge 0666 root sys
-cn:* 0620 root tty
-consms:mouse 0666 root sys
-cpuid:self 0644 root sys
-crypto:crypto 0666 root sys
-cryptoadm:cryptoadm 0644 root sys
-dld:* 0666 root sys
-devinfo:devinfo 0640 root sys
-devinfo:devinfo,ro 0444 root sys
-dlpistub:* 0666 root sys
-icmp:icmp 0666 root sys
-icmp6:icmp6 0666 root sys
-ip:ip 0666 root sys
-ip6:ip6 0666 root sys
-ipnet:lo0 0666 root sys
-ipsecah:ipsecah 0666 root sys
-ipsecesp:ipsecesp 0666 root sys
-keysock:keysock 0666 root sys
-kssl:* 0666 root sys
-clone:llc1 0666 root sys
-lofi:* 0600 root sys
-lofi:ctl 0644 root sys
-log:conslog 0666 root sys
-log:log 0640 root sys
-mm:allkmem 0600 root sys
-mm:full 0666 root sys
-mm:kmem 0640 root sys
-mm:mem 0640 root sys
-mm:null 0666 root sys
-mm:zero 0666 root sys
-openeepr:openprom 0640 root sys
-ptc:* 0666 root sys
-poll:* 0666 root sys
-physmem:* 0600 root sys
-ptsl:* 0666 root sys
-rts:rts 0666 root sys
-random:* 0644 root sys
-sad:admin 0666 root sys
-sad:user 0666 root sys
-scsi_vhci:* 0666 root sys
-simnet:* 0666 root sys
-clone:simnet 0666 root sys
-sgen:* 0600 root sys
-spdsock:spdsock 0666 root sys
-st:* 0666 root sys
-sy:tty 0666 root tty
-sysevent:* 0600 root sys
-sysmsg:msglog 0600 root sys
-sysmsg:sysmsg 0600 root sys
-tcp:tcp 0666 root sys
-tcp6:tcp6 0666 root sys
-tl:* 0666 root sys
-clone:ticlts 0666 root sys
-clone:ticots 0666 root sys
-clone:ticotsord 0666 root sys
-udp:udp 0666 root sys
-vnic:* 0666 root sys
-clone:vnic 0666 root sys
-udp6:udp6 0666 root sys
-wc:* 0600 root sys
-acpi_drv:* 0666 root sys
-ramdisk:* 0600 root sys
-ramdisk:ctl 0644 root sys
-sd:* 0640 root sys
-smbios:smbios 0444 root sys
-ucode:* 0644 root sys
-iser:* 0600 root sys
-ath:* 0666 root sys
-clone:ath 0666 root sys
-usbsprl:* 0666 root sys
-marvell88sx:* 0644 root sys
-rtls:* 0666 root sys
-clone:rtls 0666 root sys
-iwi:* 0666 root sys
-clone:iwi 0666 root sys
-arcmsr:* 0600 root sys
-hxge:* 0600 root sys
-cpc:shared 0666 root sys
-emlxs:* 0666 root sys
-oce:* 0666 root sys
-tavor:* 0666 root sys
-zfs:* 0600 root sys
-zfs:zfs 0666 root sys
-iscsit:* 0600 root sys
-dnet:* 0666 root sys
-clone:dnet 0666 root sys
-elxl:* 0666 root sys
-clone:elxl 0666 root sys
-iprb:* 0666 root sys
-clone:iprb 0666 root sys
-pcn:* 0666 root sys
-clone:pcn 0666 root sys
-sfe:* 0666 root root
-chxge:* 0666 root sys
-clone:chxge 0666 root sys
-av1394:* 0600 root sys
-vscan:* 0640 root sys
-si3124:* 0644 root sys
-nge:* 0666 root sys
-clone:nge 0666 root sys
-asy:* 0666 root sys
-asy:*,cu 0600 uucp uucp
-cmdk:* 0640 root sys
-ecpp:* 0666 root sys
-fd:* 0666 root sys
-fct:* 0666 root sys
-pppt:* 0666 root sys
-qlt:* 0666 root sys
-stmf:* 0666 root sys
-stmf_sbd:* 0666 root sys
-bpf:bpf 0666 root sys
-ib:* 0644 root sys
-sdhost:* 0644 root root
-vboxdrv:'* 0666 root sys'
-vboxusbmon:'* 0666 root sys'
-blkdev:* 0640 root root
-ibp:* 0666 root sys
-clone:ibp 0666 root sys
-ipmi:ipmi 0600 root sys
-lx_ptm:lx_ptmajor 0666 root sys
-lx_systrace:* 0644 root sys
-inotify:* 0666 root sys
-skd:* 0600 root sys
-eventfd:* 0666 root sys
-timerfd:* 0666 root sys
-signalfd:* 0666 root sys
-iwn:* 0666 root sys
-clone:iwn 0666 root sys
diff --git a/overlay/generic/etc/motd b/overlay/generic/etc/motd
deleted file mode 100644
index 23644ffa..00000000
--- a/overlay/generic/etc/motd
+++ /dev/null
@@ -1 +0,0 @@
-- SmartOS (build: 00000000T000000Z)
diff --git a/overlay/generic/etc/name_to_major b/overlay/generic/etc/name_to_major
deleted file mode 100644
index 557ae7de..00000000
--- a/overlay/generic/etc/name_to_major
+++ /dev/null
@@ -1,309 +0,0 @@
-md 85
-devinfo 88
-asy 106
-did 239
-dump 0
-fssnap 1
-kstat 2
-ksyms 3
-logindmux 4
-ptm 5
-pts 6
-aggr 7
-arp 8
-bl 9
-clone 10
-conskbd 11
-bridge 12
-cn 13
-consms 14
-cpuid 15
-crypto 16
-cryptoadm 17
-dld 18
-dlpistub 19
-icmp 20
-icmp6 21
-ip 22
-ip6 23
-ipnet 24
-ippctl 25
-ipsecah 26
-ipsecesp 27
-iptun 28
-bnx 29
-iwscn 30
-kb8042 31
-keysock 32
-kmdb 33
-kssl 34
-llc1 35
-lofi 36
-log 37
-mm 38
-mouse8042 39
-nulldriver 40
-openeepr 41
-options 42
-ptc 43
-poll 44
-physmem 45
-pseudo 46
-ptsl 47
-rts 48
-random 49
-sad 50
-scsi_vhci 51
-kvm 52
-simnet 54
-sgen 55
-softmac 56
-spdsock 57
-st 58
-sy 59
-sysevent 60
-sysmsg 61
-tcp 62
-tcp6 63
-tl 64
-udp 65
-vnic 66
-udp6 67
-wc 68
-acpi_drv 69
-bscbus 70
-bscv 71
-cpunex 72
-i8042 73
-intel_nb5000 74
-intel_nhm 75
-intel_nhmex 76
-mc-amd 77
-mpt 78
-pci_pci 79
-pcieb 80
-power 81
-ramdisk 82
-sd 83
-smbios 84
-tzmon 86
-ucode 87
-vgatext 89
-zfs 90
-pool 91
-zcons 92
-bnxe 93
-cpqary3 94
-hci1394 95
-audio 96
-audio1575 97
-audioens 98
-audiopci 99
-audiots 100
-audio810 101
-adpu320 102
-afe 103
-amd64_gart 104
-agpgart 105
-agptarget 107
-ahci 108
-amd8111s 109
-amr 110
-heci 111
-arcmsr 112
-atge 113
-bcm_sata 114
-bfe 115
-bge 116
-acpippm 117
-amd_iommu 118
-balloon 119
-cpudrv 120
-evtchn 121
-domcaps 122
-isa 123
-pit_beep 124
-npe 125
-ppm 126
-rootnex 127
-pci 128
-privcmd 129
-acpinex 130
-ehci 131
-hid 132
-hubd 133
-hwahc 134
-hwarc 135
-ohci 136
-scsa2usb 137
-uhci 138
-usb_ac 139
-usb_as 140
-usb_ia 141
-usb_mid 142
-usbprn 143
-wusb_ca 144
-wusb_df 145
-xpvtap 146
-xdb 147
-xdf 148
-xencons 149
-xnbe 150
-xnbu 151
-xpvd 152
-xnf 153
-xnbo 154
-xenbus 155
-ce 156
-chxge 157
-cpc 158
-srn 159
-ioat 160
-dmfe 161
-i915 162
-dtrace 163
-dcpc 164
-fasttrap 165
-fbt 166
-profile 167
-lockstat 168
-sdt 169
-systrace 170
-emlxs 171
-oce 172
-fcp 173
-fp 174
-fcip 175
-fcsm 176
-fipe 177
-fm 178
-dcam1394 179
-hme 180
-hxge 181
-ib 182
-sdpib 183
-sdp 184
-igb 185
-e1000g 186
-ipf 187
-iscsi 189
-iser 190
-ixgb 191
-ixgbe 192
-bpf 193
-lsimega 194
-vioif 195
-overlay 196
-mpt_sas 198
-mr_sas 199
-mega_sas 200
-marvell88sx 201
-mwl 202
-mxfe 203
-myri10ge 204
-nge 205
-ntxn 206
-nv_sata 207
-nxge 208
-pcn 209
-dnet 210
-elxl 211
-iprb 212
-pcs 213
-pcic 214
-pcser 215
-glm 216
-pm 217
-pmcs 218
-sppp 219
-sppptun 220
-fd 221
-fdc 222
-ecpp 223
-cmdk 225
-pci-ide 226
-ata 227
-pcata 228
-qlc 229
-qlge 230
-rge 231
-rpcib 232
-rtls 233
-rum 234
-scsa1394 235
-sdhost 237
-ses 238
-sfe 240
-si3124 241
-nsmb 242
-smp 243
-tavor 244
-tpm 245
-usbsacm 246
-daplt 247
-usbser_edge 248
-usbftdi 249
-ugen 250
-usbsksp 251
-usbsprl 252
-audiovia823x 253
-vr 254
-xge 255
-xpv 256
-yge 257
-zyd 258
-fct 259
-stmf 260
-stmf_sbd 261
-pppt 262
-qlt 263
-ibp 264
-blkdev 265
-smbsrv 266
-aac 267
-xsvc 268
-vioblk 53
-iscsit 269
-vmxnet 270
-ipd 188
-tap 271
-tun 272
-ipmi 273
-dr_sas 274
-t4nex 275
-cxgbe 276
-virtio 277
-usbgem 278
-axf 279
-udmf 280
-upf 281
-urf 282
-vnd 283
-lx_ptm 284
-lx_systrace 286
-nfp 287
-inotify 288
-skd 289
-eventfd 290
-zfd 291
-timerfd 292
-signalfd 293
-nvme 294
-lxautofs 295
-i40e 296
-sfxge 297
-pvscsi 298
-vmxnet3s 299
-smrt 300
-iwn 301
-xhci 302
-qede 303
-buildstamp 304
-vmm 305
-viona 306
-ppt 307
-coretemp 308
-amdf17nbdf 309
-pchtemp 310
-ufm 311
-ufmtest 312
diff --git a/overlay/generic/etc/nodename b/overlay/generic/etc/nodename
deleted file mode 100644
index 35466456..00000000
--- a/overlay/generic/etc/nodename
+++ /dev/null
@@ -1 +0,0 @@
-unknown
diff --git a/overlay/generic/etc/notices/COPYRIGHT b/overlay/generic/etc/notices/COPYRIGHT
deleted file mode 100644
index 1834bac7..00000000
--- a/overlay/generic/etc/notices/COPYRIGHT
+++ /dev/null
@@ -1,37 +0,0 @@
-Copyright  2011 Joyent, Inc., 345 California Street, Suite 2000
-San Francisco, California 94104 U.S.A. All rights reserved.
-
-Copyright  2010 Oracle, Inc., All rights reserved.
-
-Joyent, Inc. and Oracle, Inc. have intellectual property rights relating
-to technology embodied in the product that is described in this
-document. In particular, and without limitation, these intellectual
-property rights may include one or more of the U.S. patents listed at
-http://www.sun.com/patents and one or more additional patents or pending
-patent applications in the U.S. and in other countries.
-
-U.S. Government Rights - Commercial software. Government users
-are subject to the Sun Microsystems, Inc. standard license agreement and
-applicable provisions of the FAR and its supplements.
-
-Use is subject to license terms.
-
-This distribution may include materials developed by third parties.
-
-Parts of the product may be derived from Berkeley BSD systems,
-licensed from the University of California. UNIX is a registered
-trademark in the U.S. and in other countries, exclusively licensed
-through X/Open Company, Ltd.
-
-Sun, Sun Microsystems, the Sun logo, Java, Solaris, OpenSolaris
-and the Java Coffee Cup logo are trademarks or registered trademarks of
-Sun Microsystems, Inc. in the U.S. and other countries.
-
-This product is covered and controlled by U.S. Export Control
-laws and may be subject to the export or import laws in other countries.
-Nuclear, missile, chemical biological weapons or nuclear maritime end
-uses or end users, whether direct or indirect, are strictly prohibited.
-Export or reexport to countries subject to U.S. embargo or to entities
-identified on U.S. export exclusion lists, including, but not limited
-to, the denied persons and specially designated nationals lists is
-strictly prohibited.
diff --git a/overlay/generic/etc/nsswitch.conf b/overlay/generic/etc/nsswitch.conf
deleted file mode 100644
index 166e5e0c..00000000
--- a/overlay/generic/etc/nsswitch.conf
+++ /dev/null
@@ -1,54 +0,0 @@
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-# Copyright 2009 Sun Microsystems, Inc.  All rights reserved.
-# Use is subject to license terms.
-#
-
-#
-# /etc/nsswitch.conf:
-#
-# "hosts:" and "services:" in this file are used only if the
-# /etc/netconfig file has a "-" for nametoaddr_libs of "inet" transports.
-
-passwd:     files
-group:      files
-hosts:      files dns mdns
-ipnodes:    files dns mdns
-networks:   files
-protocols:  files
-rpc:        files
-ethers:     files
-netmasks:   files
-bootparams: files
-publickey:  files
-# At present there isn't a 'files' backend for netgroup;  the system will 
-#   figure it out pretty quickly, and won't use netgroups at all.
-netgroup:   files
-automount:  files
-aliases:    files
-services:   files
-printers:   user files
-
-auth_attr:  files
-prof_attr:  files
-project:    files
-
-tnrhtp:     files
-tnrhdb:     files
diff --git a/overlay/generic/etc/opasswd b/overlay/generic/etc/opasswd
deleted file mode 100644
index 7fc1d456..00000000
--- a/overlay/generic/etc/opasswd
+++ /dev/null
@@ -1,26 +0,0 @@
-root:x:0:0:Super-User:/root:/usr/bin/bash
-daemon:x:1:1::/:
-bin:x:2:2::/usr/bin:
-sys:x:3:3::/:
-adm:x:4:4:Admin:/var/adm:
-lp:x:71:8:Line Printer Admin:/usr/spool/lp:
-uucp:x:5:5:uucp Admin:/usr/lib/uucp:
-nuucp:x:9:9:uucp Admin:/var/spool/uucppublic:/usr/lib/uucp/uucico
-dladm:x:15:65:Datalink Admin:/:
-smmsp:x:25:25:SendMail Message Submission Program:/:
-listen:x:37:4:Network Admin:/usr/net/nls:
-gdm:x:50:50:GDM Reserved UID:/var/lib/gdm:
-zfssnap:x:51:12:ZFS Automatic Snapshots Reserved UID:/:/usr/bin/pfsh
-upnp:x:52:52:UPnP Server Reserved UID:/var/coherence:/bin/ksh
-xvm:x:60:60:xVM User:/:
-mysql:x:70:70:MySQL Reserved UID:/:
-openldap:x:75:75:OpenLDAP User:/:
-webservd:x:80:80:WebServer Reserved UID:/:
-postgres:x:90:90:PostgreSQL Reserved UID:/:/usr/bin/pfksh
-svctag:x:95:12:Service Tag UID:/:
-unknown:x:96:96:Unknown Remote UID:/:
-nobody:x:60001:60001:NFS Anonymous Access User:/:
-noaccess:x:60002:60002:No Access User:/:
-nobody4:x:65534:65534:SunOS 4.x NFS Anonymous Access User:/:
-netadm:x:16:65:Network Admin:/:
-netcfg:x:17:65:Network Configuration Admin:/:
diff --git a/overlay/generic/etc/ouser_attr b/overlay/generic/etc/ouser_attr
deleted file mode 100644
index af709be6..00000000
--- a/overlay/generic/etc/ouser_attr
+++ /dev/null
@@ -1,22 +0,0 @@
-# Copyright (c) 1999, 2010, Oracle and/or its affiliates. All rights reserved.
-# CDDL HEADER START
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# See the License for the specific language governing permissions
-# and limitations under the License.
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# CDDL HEADER END
-adm::::profiles=Log Management
-daemon::::auths=solaris.smf.manage.ilb,solaris.smf.modify.application
-dladm::::auths=solaris.smf.manage.wpa,solaris.smf.modify
-lp::::profiles=Printer Management
-netadm::::type=role;project=default;profiles=Network Autoconf Admin,Network Management,Service Management
-netcfg::::type=role;project=default;profiles=Network Autoconf User;auths=solaris.network.autoconf.write
-postgres::::type=role;profiles=Postgres Administration,All
-root::::type=role;auths=solaris.*,solaris.grant;profiles=All;lock_after_retries=no;min_label=admin_low;clearance=admin_high;audit_flags=lo\:no
-zfssnap::::type=role;auths=solaris.smf.manage.zfs-auto-snapshot;profiles=ZFS File System Management
diff --git a/overlay/generic/etc/passwd b/overlay/generic/etc/passwd
deleted file mode 100644
index a8049652..00000000
--- a/overlay/generic/etc/passwd
+++ /dev/null
@@ -1,26 +0,0 @@
-root:x:0:0:Super-User:/root:/usr/bin/bash
-daemon:x:1:1::/:
-bin:x:2:2::/usr/bin:
-sys:x:3:3::/:
-adm:x:4:4:Admin:/var/adm:
-lp:x:71:8:Line Printer Admin:/usr/spool/lp:
-uucp:x:5:5:uucp Admin:/usr/lib/uucp:
-nuucp:x:9:9:uucp Admin:/var/spool/uucppublic:/usr/lib/uucp/uucico
-dladm:x:15:65:Datalink Admin:/:
-netadm:x:16:65:Network Admin:/:
-netcfg:x:17:65:Network Configuration Admin:/:
-smmsp:x:25:25:SendMail Message Submission Program:/:
-listen:x:37:4:Network Admin:/usr/net/nls:
-gdm:x:50:50:GDM Reserved UID:/var/lib/gdm:
-zfssnap:x:51:12:ZFS Automatic Snapshots Reserved UID:/:/usr/bin/pfsh
-upnp:x:52:52:UPnP Server Reserved UID:/var/coherence:/bin/ksh
-xvm:x:60:60:xVM User:/:
-mysql:x:70:70:MySQL Reserved UID:/:
-openldap:x:75:75:OpenLDAP User:/:
-webservd:x:80:80:WebServer Reserved UID:/:
-postgres:x:90:90:PostgreSQL Reserved UID:/:/usr/bin/pfksh
-svctag:x:95:12:Service Tag UID:/:
-unknown:x:96:96:Unknown Remote UID:/:
-nobody:x:60001:60001:NFS Anonymous Access User:/:
-noaccess:x:60002:60002:No Access User:/:
-nobody4:x:65534:65534:SunOS 4.x NFS Anonymous Access User:/:
diff --git a/overlay/generic/etc/path_to_inst b/overlay/generic/etc/path_to_inst
deleted file mode 100644
index 9853ae8e..00000000
--- a/overlay/generic/etc/path_to_inst
+++ /dev/null
@@ -1,3 +0,0 @@
-#
-#	Caution! This file contains critical kernel state
-#
diff --git a/overlay/generic/etc/ppt_matches b/overlay/generic/etc/ppt_matches
deleted file mode 100644
index 03ff7e03..00000000
--- a/overlay/generic/etc/ppt_matches
+++ /dev/null
@@ -1 +0,0 @@
-pci10de,15f0
diff --git a/overlay/generic/etc/profile b/overlay/generic/etc/profile
deleted file mode 100644
index 0db177cb..00000000
--- a/overlay/generic/etc/profile
+++ /dev/null
@@ -1,66 +0,0 @@
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-# Copyright 2010 Sun Microsystems, Inc.  All rights reserved.
-# Use is subject to license terms.
-#
-
-# The profile that all logins get before using their own .profile.
-
-trap ""  2 3
-export LOGNAME PATH
-
-if [ "$TERM" = "" ]
-then
-	if [ `uname -p` = "i386" ]; then
-		TERM=sun-color
-	else
-		TERM=sun
-	fi
-	export TERM
-fi
-
-#	Login and -su shells get /etc/profile services.
-#	-rsh is given its environment in its .profile.
-
-case "$0" in
--sh | -ksh | -ksh93 | -jsh | -bash | -zsh)
-
-	if [ ! -f .hushlogin ]
-	then
-		#	Allow the user to break the Message-Of-The-Day only.
-		trap "trap '' 2"  2
-		/bin/cat -s /etc/motd
-		trap "" 2
-
-		/bin/mail -E
-		case $? in
-		0) 
-			echo "You have new mail."
-		  	;;
-		2) 
-			echo "You have mail."
-		   	;;
-		esac
-	fi
-esac
-
-umask 022
-trap  2 3
diff --git a/overlay/generic/etc/resolv.conf b/overlay/generic/etc/resolv.conf
deleted file mode 100644
index e69de29b..00000000
diff --git a/overlay/generic/etc/rsyslog.conf b/overlay/generic/etc/rsyslog.conf
deleted file mode 100644
index cc37dfb9..00000000
--- a/overlay/generic/etc/rsyslog.conf
+++ /dev/null
@@ -1,25 +0,0 @@
-#
-# Sample rsyslog configuration file
-#
-
-$ModLoad imfile
-$ModLoad immark
-$ModLoad imsolaris
-$ModLoad imtcp
-$ModLoad imudp
-
-*.err;kern.notice;auth.notice			/dev/sysmsg
-*.err;kern.debug;daemon.notice;mail.crit	/var/adm/messages
-
-*.alert;kern.err;daemon.err			operator
-*.alert						root
-
-*.emerg						*
-
-mail.debug					/var/log/syslog
-
-auth.info					/var/log/auth.log
-mail.info					/var/log/postfix.log
-
-# Include files from /opt/custom/etc/rsyslog.d if it exists
-$IncludeConfig /opt/custom/etc/rsyslog.d/
diff --git a/overlay/generic/etc/rtc_config b/overlay/generic/etc/rtc_config
deleted file mode 100644
index 460ce89a..00000000
--- a/overlay/generic/etc/rtc_config
+++ /dev/null
@@ -1,2 +0,0 @@
-zone_info=UTC
-zone_lag=0
diff --git a/overlay/generic/etc/security/device_policy b/overlay/generic/etc/security/device_policy
deleted file mode 100644
index 88d6afa0..00000000
--- a/overlay/generic/etc/security/device_policy
+++ /dev/null
@@ -1,28 +0,0 @@
-#
-# Device policy configuration file.   When devices are opened the
-# additional access controls in this file are enforced.
-#
-# The format of this file is subject to change without notice.
-#
-# Default open privileges, must be first entry in the file.
-#
-
-*		read_priv_set=none		write_priv_set=none
-bridge:*	read_priv_set=net_rawaccess	write_priv_set=net_rawaccess
-fssnap:ctl	read_priv_set=sys_config	write_priv_set=sys_config
-icmp:*		read_priv_set=net_icmpaccess	write_priv_set=net_icmpaccess
-icmp6:*		read_priv_set=net_icmpaccess	write_priv_set=net_icmpaccess
-ipf:*		read_priv_set=sys_ip_config	write_priv_set=sys_ip_config
-ip:*		read_priv_set=net_rawaccess	write_priv_set=net_rawaccess
-ip6:*		read_priv_set=net_rawaccess	write_priv_set=net_rawaccess
-ipnet:*		read_priv_set=net_observability	write_priv_set=net_observability
-ipsecah:*	read_priv_set=sys_ip_config	write_priv_set=sys_ip_config
-ipsecesp:*	read_priv_set=sys_ip_config	write_priv_set=sys_ip_config
-keysock:*	read_priv_set=sys_ip_config	write_priv_set=sys_ip_config
-mm:allkmem	read_priv_set=all		write_priv_set=all
-mm:kmem		read_priv_set=none		write_priv_set=all
-mm:mem		read_priv_set=none		write_priv_set=all
-openeepr:*					write_priv_set=all
-random:*					write_priv_set=sys_devices
-scsi_vhci:devctl				write_priv_set=sys_devices
-spdsock:*	read_priv_set=sys_ip_config	write_priv_set=sys_ip_config
diff --git a/overlay/generic/etc/shadow b/overlay/generic/etc/shadow
deleted file mode 100644
index 80de0b7a..00000000
--- a/overlay/generic/etc/shadow
+++ /dev/null
@@ -1,26 +0,0 @@
-root:$5$jNPghwly$Y0t1vp9/H0Yh7UN/uqGpizPziatxJz1G0uKWGmS6Rg2:14897::::::
-daemon:NP:6445::::::
-bin:NP:6445::::::
-sys:NP:6445::::::
-adm:NP:6445::::::
-lp:NP:6445::::::
-uucp:NP:6445::::::
-nuucp:NP:6445::::::
-dladm:*LK*:::::::
-netadm:*LK*:::::::
-netcfg:*LK*:::::::
-smmsp:NP:6445::::::
-listen:*LK*:::::::
-gdm:*LK*:::::::
-zfssnap:NP:::::::
-upnp:NP:::::::
-xvm:*LK*:6445::::::
-mysql:NP:::::::
-openldap:*LK*:::::::
-webservd:*LK*:::::::
-postgres:NP:::::::
-svctag:*LK*:6445::::::
-unknown:*LK*:::::::
-nobody:*LK*:6445::::::
-noaccess:*LK*:6445::::::
-nobody4:*LK*:6445::::::
diff --git a/overlay/generic/etc/skel/.bashrc b/overlay/generic/etc/skel/.bashrc
deleted file mode 100644
index 128f6b79..00000000
--- a/overlay/generic/etc/skel/.bashrc
+++ /dev/null
@@ -1,7 +0,0 @@
-#
-# Define default prompt to <username>@<hostname>:<path><"($|#) ">
-# and print '#' for user "root" and '$' for normal users.
-#
-PS1='${LOGNAME}@$(/usr/bin/hostname):$(
-    [[ "${LOGNAME}" == "root" ]] && printf "%s" "${PWD/${HOME}/~}# " ||
-    printf "%s" "${PWD/${HOME}/~}\$ ")'
diff --git a/overlay/generic/etc/ssh/sshd_config b/overlay/generic/etc/ssh/sshd_config
deleted file mode 100644
index efc0c4c4..00000000
--- a/overlay/generic/etc/ssh/sshd_config
+++ /dev/null
@@ -1,140 +0,0 @@
-#	$OpenBSD: sshd_config,v 1.97 2015/08/06 14:53:21 deraadt Exp $
-
-# This is the sshd server system-wide configuration file.  See
-# sshd_config(5) for more information.
-
-# This sshd was compiled with PATH=/usr/bin:/bin:/usr/sbin:/sbin
-
-# The strategy used for options in the default sshd_config shipped with
-# OpenSSH is to specify options with their default value where
-# possible, but leave them commented.  Uncommented options override the
-# default value.
-
-Port 22
-#AddressFamily any
-#ListenAddress 0.0.0.0
-#ListenAddress ::
-
-# The default requires explicit activation of protocol 1
-#Protocol 2
-
-# HostKey for protocol version 1
-#HostKey /etc/ssh/ssh_host_key
-# HostKeys for protocol version 2
-HostKey /var/ssh/ssh_host_rsa_key
-HostKey /var/ssh/ssh_host_dsa_key
-HostKey /var/ssh/ssh_host_ecdsa_key
-HostKey /var/ssh/ssh_host_ed25519_key
-
-# Lifetime and size of ephemeral version 1 server key
-#KeyRegenerationInterval 1h
-#ServerKeyBits 1024
-
-# Ciphers and keying
-#RekeyLimit default none
-
-# Logging
-# obsoletes QuietMode and FascistLogging
-SyslogFacility AUTH
-LogLevel INFO
-
-# Use the client's locale/language settings
-#AcceptEnv LANG LC_ALL LC_CTYPE LC_COLLATE LC_TIME LC_NUMERIC
-#AcceptEnv LC_MONETARY LC_MESSAGES
-
-# Authentication:
-
-#LoginGraceTime 2m
-PermitRootLogin yes
-#StrictModes yes
-#MaxAuthTries 6
-#MaxSessions 10
-
-#RSAAuthentication yes
-#PubkeyAuthentication yes
-
-# The default is to check both .ssh/authorized_keys and .ssh/authorized_keys2
-# but this is overridden so installations will only check .ssh/authorized_keys
-AuthorizedKeysFile	.ssh/authorized_keys
-
-#AuthorizedPrincipalsFile none
-
-#AuthorizedKeysCommand none
-#AuthorizedKeysCommandUser nobody
-
-# For this to work you will also need host keys in /etc/ssh/ssh_known_hosts
-#RhostsRSAAuthentication no
-# similar for protocol version 2
-#HostbasedAuthentication no
-# Change to yes if you don't trust ~/.ssh/known_hosts for
-# RhostsRSAAuthentication and HostbasedAuthentication
-#IgnoreUserKnownHosts no
-# Don't read the user's ~/.rhosts and ~/.shosts files
-#IgnoreRhosts yes
-
-# To disable tunneled clear text passwords, change to no here!
-PasswordAuthentication yes
-PermitEmptyPasswords no
-
-# Change to no to disable s/key passwords
-#ChallengeResponseAuthentication yes
-
-# Kerberos options
-#KerberosAuthentication no
-#KerberosOrLocalPasswd yes
-#KerberosTicketCleanup yes
-#KerberosGetAFSToken no
-
-# GSSAPI options
-#GSSAPIAuthentication yes
-#GSSAPICleanupCredentials yes
-#GSSAPIKeyExchange yes
-
-# On Illumos OpenSSH will always use PAM for authentication.
-# This config option is valid but will have no effect.
-#UsePAM yes
-
-# KeepAlive specifies whether keep alive messages are sent to the client.
-# See sshd(1) for detailed description of what this means.
-# Note that the client may also be sending keep alive messages to the server.
-KeepAlive yes
-
-#AllowAgentForwarding yes
-#AllowTcpForwarding yes
-GatewayPorts no
-X11Forwarding yes
-X11DisplayOffset 10
-X11UseLocalhost yes
-#PermitTTY yes
-
-# Should sshd print the /etc/motd file and check for mail.
-# On Solaris it is assumed that the login shell will do these (eg /etc/profile).
-PrintMotd no
-PrintLastLog no
-
-#TCPKeepAlive yes
-#UseLogin no
-UsePrivilegeSeparation sandbox		# Default for new installations.
-#PermitUserEnvironment no
-#Compression delayed
-#ClientAliveInterval 0
-#ClientAliveCountMax 3
-#UseDNS no
-#PidFile /var/run/sshd.pid
-#MaxStartups 10:30:100
-#PermitTunnel no
-#ChrootDirectory none
-#VersionAddendum none
-
-# no default banner path
-#Banner none
-
-# override default of no subsystems
-Subsystem	sftp	internal-sftp
-
-# Example of overriding settings on a per-user basis
-#Match User anoncvs
-#	X11Forwarding no
-#	AllowTcpForwarding no
-#	PermitTTY no
-#	ForceCommand cvs server
diff --git a/overlay/generic/etc/svc/profile/generic.xml b/overlay/generic/etc/svc/profile/generic.xml
deleted file mode 100644
index 1920d1e8..00000000
--- a/overlay/generic/etc/svc/profile/generic.xml
+++ /dev/null
@@ -1,392 +0,0 @@
-<?xml version='1.0'?>
-<!DOCTYPE service_bundle SYSTEM '/usr/share/lib/xml/dtd/service_bundle.dtd.1'>
-<!--
-    CDDL HEADER START
-
-    The contents of this file are subject to the terms of the
-    Common Development and Distribution License (the "License").
-    You may not use this file except in compliance with the License.
-
-    You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-    or http://www.opensolaris.org/os/licensing.
-    See the License for the specific language governing permissions
-    and limitations under the License.
-
-    When distributing Covered Code, include this CDDL HEADER in each
-    file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-    If applicable, add the following below this CDDL HEADER, with the
-    fields enclosed by brackets "[]" replaced with your own identifying
-    information: Portions Copyright [yyyy] [name of copyright owner]
-
-    CDDL HEADER END
-
-    Copyright 2010 Sun Microsystems, Inc.  All rights reserved.
-    Use is subject to license terms.
-
-    The purpose of the limited_net profile is to provide a set of
-    active services that allow one to connect to the machine via ssh
-    (requires sshd). The services which are deactivated here are those
-    that are at odds with this goal. Those which are activated are
-    explicit requirements for the goal's satisfaction.
-
-    NOTE:  Service profiles delivered by this package are not editable,
-    and their contents will be overwritten by package or patch
-    operations, including operating system upgrade.  Make customizations
-    in a distinct file.  The paths, /etc/svc/profile/site.xml and
-    /var/svc/profile/site.xml, are distinguished locations for site-specific
-    service profile, treated otherwise equivalently to this file.
--->
-<service_bundle type='profile' name='generic_limited_net'
-	 xmlns:xi='http://www.w3.org/2003/XInclude' >
-
-  <!--
-      svc.startd(1M) services
-  -->
-  <service name='system/cryptosvc' version='1' type='service'>
-    <instance name='default' enabled='true'/>
-  </service>
-  <service name='system/coreadm' version='1' type='service'>
-    <instance name='default' enabled='true'/>
-  </service>
-  <service name='system/metainit' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='system/cron' version='1' type='service'>
-    <instance name='default' enabled='true'/>
-  </service>
-  <service name='system/dbus' version='1' type='service'>
-    <instance name='default' enabled='true'/>
-  </service>
-  <service name='system/extended-accounting' version='1' type='service'>
-    <instance name='flow'    enabled='false'/>
-    <instance name='process' enabled='false'/>
-    <instance name='task'    enabled='false'/>
-    <instance name='net'    enabled='false'/>
-  </service>
-  <service name='system/identity' version='1' type='service'>
-    <instance name='domain' enabled='true'/>
-  </service>
-  <service name='system/intrd' version='1' type='service'>
-    <instance name='default' enabled='true'/>
-  </service>
-  <service name='system/keymap' version='1' type='service'>
-    <instance name='default' enabled='true'/>
-  </service>
-  <service name='system/picl' version='1' type='service'>
-    <instance name='default' enabled='true'/>
-  </service>
-  <service name='system/sac' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='system/scheduler' version='1' type='service'>
-    <instance name='default' enabled='true'/>
-  </service>
-  <service name='system/system-log' version='1' type='service'>
-    <instance name='default' enabled='true'/>
-  </service>
-  <service name='system/utmp' version='1' type='service'>
-    <instance name='default' enabled='true'/>
-  </service>
-  <service name='system/zones' version='1' type='service'>
-    <instance name='default' enabled='true'/>
-  </service>
-  <service name='system/rcap' version='1' type='service'>
-    <instance name='default' enabled='true'/>
-  </service>
-  <service name='network/rpc/bind' version='1' type='service'>
-    <instance name='default' enabled='true'/>
-  </service>
-  <service name='system/name-service-cache' version='1' type='service'>
-    <instance name='default' enabled='true'/>
-  </service>
-  <service name='network/netmask' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/nfs/status' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/nfs/nlockmgr' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/nfs/client' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/nfs/server' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/nfs/rquota' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/nfs/cbd' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/nfs/mapid' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/smb/client' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-
-  <service name='network/ssh' version='1' type='service'>
-    <instance name='default' enabled='true'/>
-  </service>
-  <service name='network/smtp' version='1' type='service'>
-    <instance name='sendmail' enabled='false'/>
-  </service>
-  <service name='network/sendmail-client' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/inetd' version='1' type='restarter'>
-    <instance name='default' enabled='true'/>
-  </service>
-  <service name='system/filesystem/autofs' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='system/filesystem/rmvolmgr' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='system/power' version='1' type='service'>
-    <instance name='default' enabled='true'/>
-  </service>
-
-  <service name='network/dns/multicast' version='1' type='service'>
-    <instance name='default' enabled='true'/>
-  </service>
-  <service name='network/dhcp-server' version='1' type='service'>
-    <instance name='default' enabled='false' />
-  </service>
-  <service name='network/ntp' version='1' type='service'>
-    <instance name='default' enabled='true' />
-  </service>
-  <service name='network/rarp' version='1' type='service'>
-    <instance name='default' enabled='false' />
-  </service>
-  <service name='network/slp' version='1' type='service'>
-    <instance name='default' enabled='false' />
-  </service>
-  <service name='network/security/kadmin' version='1' type='service'>
-    <instance name='default' enabled='false' />
-  </service>
-  <service name='network/security/krb5_prop' version='1' type='service'>
-    <instance name='default' enabled='false' />
-  </service>
-  <service name='network/security/krb5kdc' version='1' type='service'>
-    <instance name='default' enabled='false' />
-  </service>
-
-  <service name='application/management/net-snmp' version='1' type='service'>
-    <instance name='default' enabled='false' />
-  </service>
-  <service name='application/management/seaport' version='1' type='service'>
-    <instance name='default' enabled='false' />
-  </service>
-  <service name='application/management/snmpdx' version='1' type='service'>
-    <instance name='default' enabled='false' />
-  </service>
-  <service name='application/management/wbem' version='1' type='service'>
-    <instance name='default' enabled='false' />
-  </service>
-  <service name='application/print/ipp-listener' version='1' type='service'>
-    <instance name='default' enabled='false' />
-  </service>
-  <service name='application/print/ppd-cache-update' version='1' type='service'>
-    <instance name='default' enabled='false' />
-  </service>
-  <service name='application/print/rfc1179' version='1' type='service'>
-    <instance name='default' enabled='false' />
-  </service>
-  <service name='application/cups/in-lpd' version='1' type='service'>
-    <instance name='default' enabled='false' />
-  </service>
-  <service name='application/stosreg' version='1' type='service'>
-    <instance name='default' enabled='true' />
-  </service>
-
-  <!--
-	default inetd(1M) services
-  -->
-  <service name='network/finger' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/ftp' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/login' version='1' type='service'>
-    <instance name='rlogin'  enabled='false'/>
-    <instance name='klogin'  enabled='false'/>
-    <instance name='eklogin' enabled='false'/>
-  </service>
-  <service name='network/shell' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-    <instance name='kshell'  enabled='false'/>
-  </service>
-  <service name='network/telnet' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-
-  <!--
-	non-default inetd(1M) services
-  -->
-  <service name='network/uucp' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/chargen' version='1' type='service'>
-    <instance name='stream' enabled='false'/>
-    <instance name='dgram' enabled='false'/>
-  </service>
-  <service name='network/daytime' version='1' type='service'>
-    <instance name='stream' enabled='false'/>
-    <instance name='dgram' enabled='false'/>
-  </service>
-  <service name='network/discard' version='1' type='service'>
-    <instance name='stream' enabled='false'/>
-    <instance name='dgram' enabled='false'/>
-  </service>
-  <service name='network/echo' version='1' type='service'>
-    <instance name='stream' enabled='false'/>
-    <instance name='dgram' enabled='false'/>
-  </service>
-  <service name='network/time' version='1' type='service'>
-    <instance name='stream' enabled='false'/>
-    <instance name='dgram' enabled='false'/>
-  </service>
-  <service name='network/comsat' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/rexec' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/talk' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/stdiscover' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/stlisten' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-
-  <!--
-	default inetd(1M) RPC services enabled
-  -->
-  <service name='network/rpc/gss' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/rpc/mdcomm' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/rpc/smserver' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/security/ktkt_warn' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-
-  <!--
-	default inetd(1M) RPC services disabled
-  -->
-  <service name='network/rpc/rstat' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/rpc/rusers' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/rpc/meta' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/rpc/metamed' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/rpc/metamh' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-
-  <!--
-	non-default inetd(1M) RPC services disabled
-  -->
-  <service name='network/rpc/rex' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/rpc/spray' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-  <service name='network/rpc/wall' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-
-  <!--
-      Disable Avahi mDNS bridge service
-  -->
-  <service name='system/avahi-bridge-dsd' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-
-  <!--
-      Enable CDE/ToolTalk/GDM services.
-  -->
-  <service name='network/rpc/cde-ttdbserver' version='1' type='service'>
-    <instance name='tcp' enabled='false' />
-  </service>
-  <service name='application/graphical-login/gdm' version='1'
-    type='service'>
-    <instance name='default' enabled='false' />
-  </service>
-  <service name='network/rpc/cde-calendar-manager' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-
-  <!--
-      Disable X11 services.
-  -->
-  <service name='application/x11/xfs' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-
-  <!--
-      pkg.depotd service
-  -->
-  <service name='system/pkgserv' version='1' type='service'>
-    <instance name='default' enabled='false'/>
-  </service>
-
-  <!--
-      Enable VNC config service for xVM
-  -->
-  <service name='system/xvm/vnc-config' version='1' type='service'>
-     <instance name='default' enabled='false'/>
-  </service>
-
-  <service name='system/xvm/ipagent' version='1' type='service'>
-     <instance name='default' enabled='false'/>
-  </service>
-
-  <service name='application/print/service-selector' version='1' type='service'>
-     <instance name='default' enabled='false'/>
-  </service>
-
-  <service name='system/dumpadm' version='1' type='service'>
-     <instance name='default' enabled='true'/>
-  </service>
-
-  <service name='system/metasync' version='1' type='service'>
-     <instance name='default' enabled='false'/>
-  </service>
-
-  <service name='application/font/fc-cache' version='1' type='service'>
-     <instance name='default' enabled='false'/>
-  </service>
-
-  <service name='system/consolekit' version='1' type='service'>
-     <instance name='default' enabled='false'/>
-  </service>
-
-  <service name='application/opengl/ogl-select' version='1' type='service'>
-     <instance name='default' enabled='false'/>
-  </service>
-
-  <service name='system/hal' version='1' type='service'>
-     <instance name='default' enabled='false'/>
-  </service>
-
-
-</service_bundle>
diff --git a/overlay/generic/etc/svc/profile/platform.xml b/overlay/generic/etc/svc/profile/platform.xml
deleted file mode 100644
index 855ca94c..00000000
--- a/overlay/generic/etc/svc/profile/platform.xml
+++ /dev/null
@@ -1,36 +0,0 @@
-<?xml version='1.0'?>
-<!DOCTYPE service_bundle SYSTEM '/usr/share/lib/xml/dtd/service_bundle.dtd.1'>
-<!--
- Copyright 2005 Sun Microsystems, Inc.  All rights reserved.
- Use is subject to license terms.
-
- CDDL HEADER START
-
- The contents of this file are subject to the terms of the
- Common Development and Distribution License, Version 1.0 only
- (the "License").  You may not use this file except in compliance
- with the License.
-
- You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
- or http://www.opensolaris.org/os/licensing.
- See the License for the specific language governing permissions
- and limitations under the License.
-
- When distributing Covered Code, include this CDDL HEADER in each
- file and include the License file at usr/src/OPENSOLARIS.LICENSE.
- If applicable, add the following below this CDDL HEADER, with the
- fields enclosed by brackets "[]" replaced with your own identifying
- information: Portions Copyright [yyyy] [name of copyright owner]
-
- CDDL HEADER END
-
-    ident	"%Z%%M%	%I%	%E% SMI"
-
-    NOTE:  This service profile is not editable; its contents will be
-    overwritten by package or patch operations, including operating
-    system upgrade.
-
-    Default service profile, containing non-specific platform services.
--->
-<service_bundle type='profile' name='default'>
-</service_bundle>
diff --git a/overlay/generic/etc/syslog.conf b/overlay/generic/etc/syslog.conf
deleted file mode 100644
index a894b3ed..00000000
--- a/overlay/generic/etc/syslog.conf
+++ /dev/null
@@ -1,60 +0,0 @@
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License, Version 1.0 only
-# (the "License").  You may not use this file except in compliance
-# with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-#ident	"%Z%%M%	%I%	%E% SMI"	/* SunOS 5.0 */
-#
-# Copyright (c) 1991-1998 by Sun Microsystems, Inc.
-# All rights reserved.
-#
-# syslog configuration file.
-#
-# This file is processed by m4 so be careful to quote (`') names
-# that match m4 reserved words.  Also, within ifdef's, arguments
-# containing commas must be quoted.
-#
-*.err;kern.notice;auth.notice			/dev/sysmsg
-*.err;kern.debug;daemon.notice;mail.crit	/var/adm/messages
-
-*.alert;kern.err;daemon.err			operator
-*.alert						root
-
-*.emerg						*
-
-# if a non-loghost machine chooses to have authentication messages
-# sent to the loghost machine, un-comment out the following line:
-#auth.notice			ifdef(`LOGHOST', /var/log/authlog, @loghost)
-
-mail.debug			ifdef(`LOGHOST', /var/log/syslog, @loghost)
-
-#
-# non-loghost machines will use the following lines to cause "user"
-# log messages to be logged locally.
-#
-ifdef(`LOGHOST', ,
-user.err					/dev/sysmsg
-user.err					/var/adm/messages
-user.alert					`root, operator'
-user.emerg					*
-)
-
-auth.info	/var/log/auth.log
-mail.info	/var/log/postfix.log
-#local0.info	/var/log/courier.log
diff --git a/overlay/generic/etc/system b/overlay/generic/etc/system
deleted file mode 100644
index 62b96ef6..00000000
--- a/overlay/generic/etc/system
+++ /dev/null
@@ -1,163 +0,0 @@
-*ident	"%Z%%M%	%I%	%E% SMI" /* SVR4 1.5 */
-*
-* CDDL HEADER START
-*
-* The contents of this file are subject to the terms of the
-* Common Development and Distribution License, Version 1.0 only
-* (the "License").  You may not use this file except in compliance
-* with the License.
-*
-* You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-* or http://www.opensolaris.org/os/licensing.
-* See the License for the specific language governing permissions
-* and limitations under the License.
-*
-* When distributing Covered Code, include this CDDL HEADER in each
-* file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-* If applicable, add the following below this CDDL HEADER, with the
-* fields enclosed by brackets "[]" replaced with your own identifying
-* information: Portions Copyright [yyyy] [name of copyright owner]
-*
-* CDDL HEADER END
-*
-*
-* SYSTEM SPECIFICATION FILE
-*
-
-* moddir:
-*
-*	Set the search path for modules.  This has a format similar to the
-*	csh path variable. If the module isn't found in the first directory
-*	it tries the second and so on. The default is /kernel /usr/kernel
-*
-*	Example:
-*		moddir: /kernel /usr/kernel /other/modules
-
-
-
-* root device and root filesystem configuration:
-*
-*	The following may be used to override the defaults provided by
-*	the boot program:
-*
-*	rootfs:		Set the filesystem type of the root.
-*
-*	rootdev:	Set the root device.  This should be a fully
-*			expanded physical pathname.  The default is the
-*			physical pathname of the device where the boot
-*			program resides.  The physical pathname is
-*			highly platform and configuration dependent.
-*
-*	Example:
-*		rootfs:ufs
-*		rootdev:/sbus@1,f8000000/esp@0,800000/sd@3,0:a
-*
-*	(Swap device configuration should be specified in /etc/vfstab.)
-
-
-
-* exclude:
-*
-*	Modules appearing in the moddir path which are NOT to be loaded,
-*	even if referenced. Note that `exclude' accepts either a module name,
-*	or a filename which includes the directory.
-*
-*	Examples:
-*		exclude: win
-*		exclude: sys/shmsys
-
-
-
-* forceload:
-*
-*	Cause these modules to be loaded at boot time, (just before mounting
-*	the root filesystem) rather than at first reference. Note that
-* 	forceload expects a filename which includes the directory. Also
-*	note that loading a module does not necessarily imply that it will
-*	be installed.
-*
-*	Example:
-*		forceload: drv/foo
-
-
-
-* set:
-*
-*	Set an integer variable in the kernel or a module to a new value.
-*	This facility should be used with caution.  See system(4).
-*
-*	Examples:
-*
-*	To set variables in 'unix':
-*
-*		set nautopush=32
-*		set maxusers=40
-*
-*	To set a variable named 'debug' in the module named 'test_module'
-*
-*		set test_module:debug = 0x13
-
-
-set ibft_noprobe=1
-
-set noexec_user_stack=1
-set noexec_user_stack_log=1
-set rlim_fd_cur=65536
-
-* Ensure that c-states are disabled
-set idle_cpu_no_deep_c=1
-
-* 10 GbE Tuning
-set ip:ip_squeue_fanout=1
-
-*
-* Machines should take a crash dump and reboot when receiving an NMI
-*
-set pcplusmp:apic_panic_on_nmi=1
-set apix:apic_panic_on_nmi=1
-
-*
-* Don't use multi-threaded fast crash dump or a high compression level
-*
-set dump_plat_mincpu=0
-set dump_bzip2_level=1
-
-*
-* See OS-1361 for dealing with the timer woes.
-*
-set pcplusmp:apic_timer_preferred_mode=0
-set apix:apic_timer_preferred_mode=0
-
-*
-* Want additional crash dump metrics
-*
-set dump_metrics_on=1
-
-*
-* The traditional (and essentially entirely brain dead) cfgadm(1M)-centric
-* model of hotpluggin' appears to be basically unnecessary.  This tunable
-* enables the system to create device nodes for newly inserted devices
-* automatically.  See: usr/src/uts/common/io/sata/impl/sata.c:97
-*
-set sata:sata_auto_online=1
-
-*
-* We want to limit the time spent in any one I/O to 10 seconds for targets
-* that are not optical.  This is still a very long time; our queue depth is
-* typically 10 or less, and disks will usually fail a command after 2-3s.
-* So we'd have to have multiple reads of bad sectors queued up to have any
-* chance of timing out.  In practice, timeouts occur because of problems with
-* disk controllers or firmware, not media errors, and in those cases it will
-* not help at all to wait longer.
-*
-set sd:sd_io_time=10
-
-* Use hires tick to improve some scheduling latency issues
-set hires_tick=1
-
-*
-* The "buildstamp" module contains information about the git sources used to
-* build the operating system image.  Once loaded, the driver will refuse to
-* detach.  We load it early to ensure it is in a crash dump wherever possible.
-*
-forceload: drv/buildstamp
diff --git a/overlay/generic/etc/user_attr b/overlay/generic/etc/user_attr
deleted file mode 100644
index f5ee5c67..00000000
--- a/overlay/generic/etc/user_attr
+++ /dev/null
@@ -1,37 +0,0 @@
-#
-# Copyright (c) 1999, 2010, Oracle and/or its affiliates. All rights reserved.
-# Copyright (c) 2011, Joyent, Inc. All rights reserved.
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-# /etc/user_attr
-#
-# user attributes. see user_attr(4)
-#
-#
-adm::::profiles=Log Management
-daemon::::auths=solaris.smf.manage.ilb,solaris.smf.modify.application
-dladm::::auths=solaris.smf.manage.wpa,solaris.smf.modify
-lp::::profiles=Printer Management
-netadm::::type=role;project=default;profiles=Network Autoconf Admin,Network Management,Service Management
-netcfg::::type=role;project=default;profiles=Network Autoconf User;auths=solaris.network.autoconf.write
-root::::auths=solaris.*,solaris.grant;profiles=All;audit_flags=lo\:no;lock_after_retries=no;min_label=admin_low;clearance=admin_high
-zfssnap::::type=role;auths=solaris.smf.manage.zfs-auto-snapshot;profiles=ZFS File System Management
-admin::::profiles=Primary Administrator;roles=root
diff --git a/overlay/generic/etc/vfstab b/overlay/generic/etc/vfstab
deleted file mode 100644
index 8f19c64d..00000000
--- a/overlay/generic/etc/vfstab
+++ /dev/null
@@ -1,10 +0,0 @@
-#device     device      mount       FS  fsck    mount   mount
-#to mount   to fsck     point       type    pass    at boot options
-#
-/devices    -   /devices            devfs    -   no     -
-/proc       -   /proc               proc     -   no     -
-ctfs        -   /system/contract    ctfs     -   no     -
-objfs       -   /system/object      objfs    -   no     -
-sharefs     -   /etc/dfs/sharetab   sharefs  -   no     -
-fd          -   /dev/fd             fd       -   no     -
-swap        -   /tmp                tmpfs    -   yes    -
diff --git a/overlay/generic/etc/zones/Joyent.xml b/overlay/generic/etc/zones/Joyent.xml
deleted file mode 100644
index cbb81030..00000000
--- a/overlay/generic/etc/zones/Joyent.xml
+++ /dev/null
@@ -1,32 +0,0 @@
-<?xml version="1.0"?>
-
-<!--
- Copyright 2010 Joyent, Inc.  All rights reserved.
- Use is subject to license terms.
-
- CDDL HEADER START
-
- The contents of this file are subject to the terms of the
- Common Development and Distribution License (the "License").
- You may not use this file except in compliance with the License.
-
- You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
- or http://www.opensolaris.org/os/licensing.
- See the License for the specific language governing permissions
- and limitations under the License.
-
- When distributing Covered Code, include this CDDL HEADER in each
- file and include the License file at usr/src/OPENSOLARIS.LICENSE.
- If applicable, add the following below this CDDL HEADER, with the
- fields enclosed by brackets "[]" replaced with your own identifying
- information: Portions Copyright [yyyy] [name of copyright owner]
-
- CDDL HEADER END
-
-    DO NOT EDIT THIS FILE.  Use zonecfg(1M) instead.
--->
-
-<!DOCTYPE zone PUBLIC "-//Joyent Inc//DTD Zones//EN" "file:///usr/share/lib/xml/dtd/zonecfg.dtd.1">
-
-<zone name="default" zonepath="" autoboot="false" brand="joyent">
-</zone>
diff --git a/overlay/generic/etc/zones/SUNWdefault.xml b/overlay/generic/etc/zones/SUNWdefault.xml
deleted file mode 100644
index 070412f6..00000000
--- a/overlay/generic/etc/zones/SUNWdefault.xml
+++ /dev/null
@@ -1,32 +0,0 @@
-<?xml version="1.0"?>
-
-<!--
- Copyright 2010 Sun Microsystems, Inc.  All rights reserved.
- Use is subject to license terms.
-
- CDDL HEADER START
-
- The contents of this file are subject to the terms of the
- Common Development and Distribution License (the "License").
- You may not use this file except in compliance with the License.
-
- You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
- or http://www.opensolaris.org/os/licensing.
- See the License for the specific language governing permissions
- and limitations under the License.
-
- When distributing Covered Code, include this CDDL HEADER in each
- file and include the License file at usr/src/OPENSOLARIS.LICENSE.
- If applicable, add the following below this CDDL HEADER, with the
- fields enclosed by brackets "[]" replaced with your own identifying
- information: Portions Copyright [yyyy] [name of copyright owner]
-
- CDDL HEADER END
-
-    DO NOT EDIT THIS FILE.  Use zonecfg(1M) instead.
--->
-
-<!DOCTYPE zone PUBLIC "-//Sun Microsystems Inc//DTD Zones//EN" "file:///usr/share/lib/xml/dtd/zonecfg.dtd.1">
-
-<zone name="default" zonepath="" autoboot="false" brand="joyent">
-</zone>
diff --git a/overlay/generic/etc/zshrc b/overlay/generic/etc/zshrc
deleted file mode 100644
index 1e9c83e5..00000000
--- a/overlay/generic/etc/zshrc
+++ /dev/null
@@ -1,31 +0,0 @@
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-
-#
-# Copyright 2010 Sun Microsystems, Inc.  All rights reserved.
-# Use is subject to license terms.
-#
-# ident	"@(#)zshrc	1.1	10/02/08 SMI"
-#
-
-# Turn on the "new" completion system.  See zshcompsys(1).
-autoload -Uz compinit
-compinit -i
diff --git a/overlay/generic/kernel/drv/buildstamp.conf b/overlay/generic/kernel/drv/buildstamp.conf
deleted file mode 100644
index 0193b620..00000000
--- a/overlay/generic/kernel/drv/buildstamp.conf
+++ /dev/null
@@ -1 +0,0 @@
-name="buildstamp" parent="pseudo" instance=0;
diff --git a/overlay/generic/kernel/drv/intel_nhmex.conf b/overlay/generic/kernel/drv/intel_nhmex.conf
deleted file mode 100644
index 69044583..00000000
--- a/overlay/generic/kernel/drv/intel_nhmex.conf
+++ /dev/null
@@ -1,35 +0,0 @@
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-#
-# Copyright 2009 Sun Microsystems, Inc.  All rights reserved.
-# Use is subject to license terms.
-# Copyright 2015, Joyent, Inc.
-#
-
-ddi-forceattach=1;
-demand-scrub=1;
-patrol-scrub=1;
-
-#
-# intel_nhmex hard codes the use of older smbios structures. Therefore,
-# we disable its use of smbios. See OS-4435 for more information.
-#
-no-smbios=1;
diff --git a/overlay/generic/kernel/drv/mpt_sas.conf b/overlay/generic/kernel/drv/mpt_sas.conf
deleted file mode 100644
index 5848df58..00000000
--- a/overlay/generic/kernel/drv/mpt_sas.conf
+++ /dev/null
@@ -1,7 +0,0 @@
-ddi-vhci-class="scsi_vhci";
-mpxio-disable="no";
-
-#
-# Command/target timeout checking should be done at a 1-second granularity.
-#
-scsi-watchdog-tick=1;
diff --git a/overlay/generic/kernel/drv/sd.conf b/overlay/generic/kernel/drv/sd.conf
deleted file mode 100644
index b0aebdb5..00000000
--- a/overlay/generic/kernel/drv/sd.conf
+++ /dev/null
@@ -1,83 +0,0 @@
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-
-#
-# Copyright (c) 1991, 2010, Oracle and/or its affiliates. All rights reserved.
-#
-
-name="sd" class="scsi" target=0 lun=0;
-name="sd" class="scsi" target=1 lun=0;
-name="sd" class="scsi" target=2 lun=0;
-name="sd" class="scsi" target=3 lun=0;
-name="sd" class="scsi" target=4 lun=0;
-name="sd" class="scsi" target=5 lun=0;
-name="sd" class="scsi" target=6 lun=0;
-name="sd" class="scsi" target=7 lun=0;
-name="sd" class="scsi" target=8 lun=0;
-name="sd" class="scsi" target=9 lun=0;
-name="sd" class="scsi" target=10 lun=0;
-name="sd" class="scsi" target=11 lun=0;
-name="sd" class="scsi" target=12 lun=0;
-name="sd" class="scsi" target=13 lun=0;
-name="sd" class="scsi" target=14 lun=0;
-name="sd" class="scsi" target=15 lun=0;
-
-#
-# The following stub node is needed for pathological bottom-up
-# devid resolution on a self-identifying transport.
-#
-name="sd" class="scsi-self-identifying";
-
-#
-# Associate the driver with devid resolution.
-#
-ddi-devid-registrant=1;
-
-#
-# Certain hardware RAID controllers have nonvolatile caches but do not
-# support the SYNC_NV bit to restrict flushes to the volatile portion of
-# the cache, if any.  In order to get acceptable performance out of these
-# devices, we need to suppress cache flushing on them.  In most (hopefully
-# all) cases, if the battery fails or the cache otherwise becomes volatile,
-# the controller will switch to write-through mode, and ensure that any
-# underlying drive cache is off.  In this case, it should still be safe to
-# dispense with cache flush commands.  Controllers for which this is not the
-# case should have cache-nonvolatile set unless data loss and corruption are
-# acceptable.
-#
-# In addition, *all* devices have their retries capped at 1.  There are an
-# additional 2 retries for "victim" IOs if a reset is needed.  Retrying is
-# very rarely successful, and it is preferable to let ZFS do it where needed.
-#
-# For the Samsung client drives, users have seen data corruption when they use
-# the advertised 512 byte sectors. The actual sector size of the flash
-# translation layer is 4K, so it's relatively safe to make this change which
-# annecdotally solves that problem.
-#
-sd-config-list=
-	"", "retries-timeout:1,retries-busy:1,retries-reset:1,retries-victim:2",
-	"DELL    PERC H710", "cache-nonvolatile:true",
-	"DELL    PERC H700", "cache-nonvolatile:true",
-	"DELL    PERC/6i", "cache-nonvolatile:true",
-	"ATA     Samsung SSD 830", "physical-block-size:4096",
-	"ATA     Samsung SSD 840", "physical-block-size:4096",
-	"ATA     Samsung SSD 850", "physical-block-size:4096",
-	"ATA     Samsung SSD 860", "physical-block-size:4096";
diff --git a/overlay/generic/lib/sdc/config.sh b/overlay/generic/lib/sdc/config.sh
deleted file mode 100644
index 19cc15a2..00000000
--- a/overlay/generic/lib/sdc/config.sh
+++ /dev/null
@@ -1,266 +0,0 @@
-#!/usr/bin/bash
-#
-# functions for getting USB headnode config values (intended to be sourced
-# from other scripts)
-#
-# It is also possible to use this to get a JSON hash of the config options using:
-#
-# bash config.sh -json
-#
-# Copyright 2018 Joyent Inc.
-#
-
-CACHE_FILE_JSON="/tmp/.config.json"
-NET_BOOT_FILE="/system/boot/networking.json"
-NET_BOOT_HN_FILE="/usbkey/boot/networking.json"
-OVERLAY_RULES_DIR="/var/run/smartdc/networking"
-OVERLAY_RULES_FILE="/var/run/smartdc/networking/overlay_rules.json"
-
-#set -o xtrace
-
-function boot_file_config_enabled
-{
-    /usr/lib/sdc/net-boot-config --enabled
-}
-
-function boot_file_config_valid
-{
-    if [[ -e $NET_BOOT_FILE ]]; then
-        /usr/bin/json --validate -f $NET_BOOT_FILE
-        return $?
-
-    elif [[ -e $NET_BOOT_HN_FILE ]]; then
-        /usr/bin/json --validate -f $NET_BOOT_HN_FILE
-        return $?
-
-    else
-        return 0
-    fi
-}
-
-function boot_file_nic_tag_params
-{
-
-    /usr/lib/sdc/net-boot-config | egrep '_nic=|etherstub='
-}
-
-function boot_file_config_init
-{
-    /usr/lib/sdc/net-boot-config --routes | while read dst gw; do
-        route -pR "/" add "$dst" "$gw"
-    done
-
-    mkdir -p $OVERLAY_RULES_DIR
-    rm -f $OVERLAY_RULES_FILE
-    if [[ $(/usr/lib/sdc/net-boot-config --nictag-rules | /usr/bin/json -k | wc -l) != "0" ]]; then
-        /usr/lib/sdc/net-boot-config --nictag-rules > $OVERLAY_RULES_FILE
-    fi
-}
-
-function load_boot_file_config
-{
-    for line in $(/usr/lib/sdc/net-boot-config); do
-        eval "CONFIG_${line}"
-    done
-}
-
-# Loads sysinfo variables with prefix (default: SYSINFO_)
-function load_sdc_sysinfo {
-
-    prefix=$1
-    [[ -z ${prefix} ]] && prefix="SYSINFO_"
-
-    #
-    # We've seen cases where Loader will set boot parameters that have a '#'
-    # character in the name.  Not surprisingly, bash won't let you have a '#'
-    # character in a shell variable name, so we strip any out of the lvalue
-    # as we process the sysinfo output.
-    #
-    tmpfile=$(mktemp -p /tmp)
-    /usr/bin/sysinfo -p | while read -r entry; do
-        lval=$(echo $entry | cut -d= -f 1 | sed -e 's/#//g')
-        rval=$(echo $entry | cut -d= -f 2-)
-        echo ${prefix}${lval}=${rval} >> $tmpfile
-    done
-    eval $(cat $tmpfile)
-    rm -f $tmpfile
-}
-
-# Sets SDC_CONFIG_FILENAME with the location of the config file. This can
-# come from the USB key, /opt/smartdc/config/node.config, or (if on an unsetup
-# CN) /var/tmp/node.config/node.config.
-function load_sdc_config_filename {
-
-    # the default
-    COMPUTE_NODE_CONFIG_FILENAME="/opt/smartdc/config/node.config"
-
-    if [[ -z "${SDC_CONFIG_FILENAME}" ]]; then
-        SDC_CONFIG_FILENAME="$(svcprop -p 'joyentfs/usb_copy_path' svc:/system/filesystem/smartdc:default)/config"
-        if [[ ! -f ${SDC_CONFIG_FILENAME} ]]; then
-            SDC_CONFIG_FILENAME="/mnt/$(svcprop -p 'joyentfs/usb_mountpoint' svc:/system/filesystem/smartdc:default)/config"
-        fi
-
-        if [[ -f ${SDC_CONFIG_FILENAME} ]]; then
-            SDC_CONFIG_INC_DIR="$(dirname ${SDC_CONFIG_FILENAME})/config.inc"
-        elif [[ ! -f ${COMPUTE_NODE_CONFIG_FILENAME} ]]; then
-            if [[ -f /var/tmp/node.config/node.config ]]; then
-                COMPUTE_NODE_CONFIG_FILENAME=/var/tmp/node.config/node.config
-            fi
-        fi
-
-        if [[ -f ${COMPUTE_NODE_CONFIG_FILENAME} ]]; then
-            if [[ -f ${SDC_CONFIG_FILENAME} ]]; then
-                # We write to console to make it clear we don't like this at all.
-                echo "WARNING: ignoring config at ${COMPUTE_NODE_CONFIG_FILENAME} since we have ${SDC_CONFIG_FILENAME}" >> /dev/msglog
-            else
-                SDC_CONFIG_FILENAME=${COMPUTE_NODE_CONFIG_FILENAME}
-                SDC_CONFIG_INC_DIR="$(dirname ${COMPUTE_NODE_CONFIG_FILENAME})"
-            fi
-        fi
-    fi
-}
-
-# Returns "true" if keys in the SDC config file contain the given string,
-# false otherwise
-function sdc_config_keys_contain {
-    search=$1
-    load_sdc_config_filename
-
-    if [[ -f ${SDC_CONFIG_INC_DIR}/generic ]]; then
-        GEN_FILE=${SDC_CONFIG_INC_DIR}/generic
-    else
-        GEN_FILE=/dev/null
-    fi
-
-    if [[ -f ${SDC_CONFIG_FILENAME} ]]; then
-        matches=$((cat ${GEN_FILE} ${SDC_CONFIG_FILENAME}; echo "config_inc_dir=${SDC_CONFIG_INC_DIR}") | \
-            sed -e "s/^ *//" | grep -v "^#" | grep "^[a-zA-Z]" | \
-            sed -e "s/=.*//" | grep $search | wc -l)
-        if [[ $matches -eq 0 ]]; then
-            echo false
-        else
-            echo true
-        fi
-    else
-        echo "FATAL: Unable to load headnode config."
-        exit 1
-    fi
-}
-
-function sdc_config_keys {
-    load_sdc_config_filename
-    if [[ -f ${SDC_CONFIG_INC_DIR}/generic ]]; then
-        GEN_FILE=${SDC_CONFIG_INC_DIR}/generic
-    else
-        GEN_FILE=/dev/null
-    fi
-
-    if [[ -f ${SDC_CONFIG_FILENAME} ]]; then
-        keys=$((cat ${GEN_FILE} ${SDC_CONFIG_FILENAME}; echo "config_inc_dir=${SDC_CONFIG_INC_DIR}") | \
-            sed -e "s/^ *//" | grep -v "^#" | grep "^[a-zA-Z]" | \
-            sed -e "s/=.*//")
-    fi
-    echo "${keys}"
-}
-
-# Loads config variables with prefix (default: CONFIG_)
-function load_sdc_config {
-
-    prefix=$1
-    [[ -z ${prefix} ]] && prefix="CONFIG_"
-
-    if /bin/bootparams | grep "^headnode=true" >/dev/null; then
-        headnode="true"
-    else
-        headnode="false"
-    fi
-
-    load_sdc_config_filename
-    if [[ -f ${SDC_CONFIG_INC_DIR}/generic ]]; then
-        GEN_FILE=${SDC_CONFIG_INC_DIR}/generic
-    else
-        GEN_FILE=/dev/null
-    fi
-
-    # Ignore comments, spaces at the beginning of lines and lines that don't
-    # start with a letter.
-    if [[ -f ${SDC_CONFIG_FILENAME} ]]; then
-        eval $((cat ${GEN_FILE} ${SDC_CONFIG_FILENAME}; echo "config_inc_dir=${SDC_CONFIG_INC_DIR}") | \
-            sed -e "s/^ *//" | grep -v "^#" | grep "^[a-zA-Z]" | \
-            sed -e "s/^/${prefix}/")
-    elif [[ ${headnode} == "true" ]]; then
-        echo "FATAL: Unable to load headnode config."
-        exit 1
-    fi
-}
-
-# Loads bootparams as variables with prefix (default: BOOT_)
-function load_sdc_bootparams {
-    prefix=$1
-    [[ -z ${prefix} ]] && prefix="BOOT_"
-    for line in $(/bin/bootparams); do
-        fields=(${line//=/ })
-        key=$(echo ${fields[0]} | sed -e "s/-/_/g;s/#//g")
-        eval "${prefix}${key}=\"${fields[1]}\""
-    done
-}
-
-# Outputs the keys from bootparams
-function sdc_bootparams_keys {
-    #keys=$(/bin/bootparams | sed -e "s/=.*//")
-    #keys=$(cat /tmp/bootparams | sed -e "s/=.*//")
-    for line in $(/bin/bootparams); do
-        fields=(${line//=/ })
-        key=$(echo ${fields[0]} | sed -e "s/=.*//;s/#//g")
-        echo ${key}
-    done
-}
-
-if [[ $1 == "-json" ]]; then
-
-    update_cache=0
-
-    load_sdc_config_filename
-    if [[ ! -f ${CACHE_FILE_JSON} ]]; then
-        # no cache file, need update
-        update_cache=1
-
-    elif [[ -f ${SDC_CONFIG_FILENAME}
-        && ${SDC_CONFIG_FILENAME} -nt ${CACHE_FILE_JSON} ]]; then
-
-        # /usbkey/config (or CN config) is newer, need update
-        update_cache=1
-
-    elif [[ -f ${SDC_CONFIG_INC_DIR}/generic
-        && ${SDC_CONFIG_INC_DIR}/generic -nt ${CACHE_FILE_JSON} ]]; then
-
-        # /usbkey/config.inc/generic (or CN config) is newer, need update
-        update_cache=1
-    fi
-
-    if [[ ${update_cache} == 1 ]]; then
-
-        # If called to output config as JSON, we'll do that.
-        (
-            echo "{"
-            load_sdc_config
-            first_key=1
-            keys=$(sdc_config_keys)
-            for key in ${keys}; do
-                value=$(eval "echo \${CONFIG_${key}}")
-                # too bad we can't use extra commas
-                if [[ ${first_key} -eq 1 ]]; then
-                    echo "    \"${key}\": \"${value}\""
-                    first_key=0
-                else
-                    echo "  , \"${key}\": \"${value}\""
-                fi
-            done
-            echo "}"
-        ) >${CACHE_FILE_JSON}.new.$$ \
-        && mv ${CACHE_FILE_JSON}.new.$$ ${CACHE_FILE_JSON}
-    fi
-
-    # either we recreated the cache or it already exists
-    exec cat ${CACHE_FILE_JSON}
-fi
diff --git a/overlay/generic/lib/sdc/network.sh b/overlay/generic/lib/sdc/network.sh
deleted file mode 100644
index a1deab2c..00000000
--- a/overlay/generic/lib/sdc/network.sh
+++ /dev/null
@@ -1,195 +0,0 @@
-#!/usr/bin/bash
-#
-# network-related functions (intended to be sourced from other scripts)
-#
-# Copyright 2019 Joyent, Inc.
-#
-
-
-# Converts an IP and netmask to CIDR notation, eg:
-# 10.99.99.7 + 255.255.255.0 -> 10.99.99.0/24
-function ip_netmask_to_cidr {
-    IP=$1
-    NETMASK=$2
-
-    OLDIFS=$IFS
-    IFS=.
-    set -- $IP
-    a=$1
-    b=$2
-    c=$3
-    d=$4
-    set -- $NETMASK
-    a=$(($a & $1))
-    b=$(($b & $2))
-    c=$(($c & $3))
-    d=$(($d & $4))
-    IFS=$OLDIFS
-
-    typeset -i netip=0x$(printf "%02X%02X%02X%02X" $1 $2 $3 $4)
-    bits=32
-    while [ $((${netip} & 1 )) == 0 ] ; do
-        netip=$((${netip} >> 1))
-        bits=$((${bits} - 1))
-    done
-
-    echo "$a.$b.$c.$d/$bits"
-}
-
-function valid_ipv4 {
-    typeset ip=(${1//\./ })
-    typeset ip_type="$2"
-    typeset -i i=0
-
-    if (( ${#ip[@]} != 4 )); then
-        echo "ERROR: IPv4 ${ip_type} '$1' does not have four octets" >&2
-        return 1
-    fi
-
-    while (( i < 4 )); do
-        if [[ ${ip[$i]} != +([0-9]) ]]; then
-            echo "ERROR: IPv4 ${ip_type} '$1' contains a non-numeric octet" \
-                "(${ip[$i]})" >&2
-            return 1
-        fi
-        if (( ip[i] > 255 )); then
-            echo "ERROR: IPv4 ${ip_type} '$1' contains an octet value > 255" \
-                "(${ip[$i]})" >&2
-            return 1
-        fi
-        (( i++ ))
-    done
-
-    return 0
-}
-
-# Check if two IPv4 addresses reside on the same network (as determined by
-# a given netmask.  Typically one of the two IPs are a network address, e.g.
-# ip_in_net 192.168.1.0 192.168.1.42 255.255.255.0, however there is no
-# requirement that this is the case.
-function ip_in_net {
-    typeset ip1=(${1//\./ })
-    typeset ip2=(${2//\./ })
-    typeset mask=(${3//\./ })
-    typeset -i x y i=0
-
-    valid_ipv4 "$1" address && valid_ipv4 "$2" address && \
-        valid_ipv4 "$3" netmask || return 1
-
-    while (( i < ${#ip1[@]} )); do
-        ((x = ip1[i] & mask[i]))
-        ((y = ip2[i] & mask[i]))
-        if (( x != y )); then
-            return 1
-        fi
-        ((i++))
-    done
-
-    return 0
-}
-
-function log_if_state
-{
-    echo "== debug start: $1 =="
-    if ! nictagadm list; then
-        echo "WARNING: 'nictagadm list' failed" 2>&2
-    fi
-    if ! /usr/sbin/dladm show-phys; then
-        echo "WARNING: 'dladm show-phys' failed" >&2
-    fi
-    # NOTE: DO NOT do a 'dladm show-linkprop' when using the bnx driver,
-    # as it puts it into an unusable state!
-    if ! /sbin/ifconfig -a; then
-        echo "WARNING: 'ifconfig -a' failed" >&2
-    fi
-    if ! /usr/bin/netstat -rcn; then
-        echo "WARNING: 'netstat -rcn' failed" >&2
-    fi
-    echo "== debug end: $1 =="
-}
-
-function get_link_state
-{
-    /usr/sbin/dladm show-phys -po state "$1" 2>/dev/null
-}
-
-function wait_for_nic_state
-{
-    typeset interface="$1"
-    typeset state="$2"
-    typeset current_state
-    typeset -i i=1
-
-    echo "wait_for_nic_state: waiting for state '$state'"
-    while (( i <= 10 )); do
-        current_state="$(get_link_state $interface)"
-        [[ "$current_state" == "$state" ]] && break
-        echo "  $i: link_state=$current_state"
-        sleep 1
-        (( i++ ))
-    done
-    echo "wait_for_nic_state: finished in state '$current_state'"
-}
-
-function valid_mac
-{
-    typeset re='^([0-9a-fA-F]{1,2}:){5}[0-9a-fA-F]{1,2}$'
-    [[ "$1" =~ $re ]]
-}
-
-function normalize_mac
-{
-    typeset mac="$1"
-
-    # Note that we want to expand $mac out into multiple parameters
-    # so that printf has enough arguments for the format string.
-    # It is assumed that valid_mac() has been called on $mac prior
-    # to calling normalize_mac()
-    printf '%02x:%02x:%02x:%02x:%02x:%02x\n' 0x${mac//:/ 0x}
-}
-
-function valid_mtu
-{
-    set -o xtrace
-    typeset tag mtu
-
-    tag="$1"
-    mtu="$2"
-
-    if ! [[ $mtu =~ [1-9][0-9][0-9][0-9] ]] ; then
-        echo "Invalid mtu specified for tag $tag: $mtu"
-        echo "Valid MTU range is from 1500-9000"
-        exit $SMF_EXIT_ERR_FATAL
-    fi
-
-    if ((mtu > 9000 || $mtu < 1500 )); then
-        echo "Invalid mtu specified for tag $tag: $mtu"
-        echo "Valid MTU range is from 1500-9000"
-        exit $SMF_EXIT_ERR_FATAL
-    fi
-}
-
-# Plumbs the admin interface, and attempts to work around poorly-behaved
-# drivers that can't handle plumb commands too quicky after one another
-function plumb_admin
-{
-    set -o xtrace
-    typeset admin_if="$1"
-    typeset admin_mtu="${2:-1500}"
-    typeset driver=${admin_if%%[0-9]*}
-
-    if [[ "$(get_link_state "$admin_if")" == "down" ]]; then
-        echo "admin nic '$admin_if' is down: unplumbing"
-        /sbin/ifconfig "$admin_if" down unplumb
-        wait_for_nic_state "$admin_if" unknown
-    fi
-
-    # There's some sort of race condition in the bnx driver: if the plumb
-    # command comes too soon after the unplumb, the interface can come up
-    # in a state where it never fires interrupts for link state changes.
-    if [[ "$driver" == "bnx" ]]; then
-        sleep 5
-    fi
-    /sbin/ifconfig "$admin_if" plumb mtu $admin_mtu
-    wait_for_nic_state "$admin_if" "up"
-}
diff --git a/overlay/generic/lib/sdc/usb-key.sh b/overlay/generic/lib/sdc/usb-key.sh
deleted file mode 100644
index b0a8e988..00000000
--- a/overlay/generic/lib/sdc/usb-key.sh
+++ /dev/null
@@ -1,208 +0,0 @@
-#!/usr/bin/bash
-#
-# Utilities for dealing with the USB key. In general, sdc-usbkey should be used.
-# These routines are for use prior to sdc-usbkey being installed.
-#
-# Copyright (c) 2019, Joyent, Inc.
-#
-
-#
-# Identify the version of this USB key (if it is indeed a USB key).
-#
-# We do this by sniffing fixed offset within the MBR. If we have a (legacy)
-# grub MBR, then we can look at offset 0x3e for COMPAT_VERSION_MAJOR and
-# COMPAT_VERSION_MINOR (and we'll presume 3.2 as a minimum).
-#
-# If we're talking about a loader-based key, we'll peek at 0xfa AKA
-# STAGE1_MBR_VERSION for format_image's IMAGE_MAJOR, which we expect to be 2.
-#
-# Unfortunately there's no standard way to find a version for other MBRs such as
-# grub2's. In these cases we'll end up with a potentially random version here,
-# so this key should not be trusted as ours until mounted and the path
-# .joyusbkey is found.
-#
-function usb_key_version()
-{
-	local readonly devpath=$1
-	local readonly mbr_sig_offset=0x1fe
-	local readonly mbr_grub_offset=0x3e
-	local readonly mbr_stage1_offset=0xfa
-	local readonly mbr_grub_version=0203
-	local readonly mbr_sig=aa55
-
-	sig=$(echo $(/usr/bin/od -t x2 \
-	    -j $mbr_sig_offset -A n -N 2 $devpath) )
-
-	if [[ "$sig" != $mbr_sig ]]; then
-		echo "unknown"
-		return
-	fi
-
-	grub_val=$(echo $(/usr/bin/od -t x2 \
-	    -j $mbr_grub_offset -A n -N 2 $devpath) )
-	loader_major=$(echo $(/usr/bin/od -t x1 \
-	    -j $mbr_stage1_offset -A n -N 1 $devpath) )
-
-	if [[ "$grub_val" = $mbr_grub_version ]]; then
-		echo "1"
-		return
-	fi
-
-	echo $(( 0x$loader_major ))
-}
-
-#
-# Mount the usbkey at the standard mount location (or whatever is specified).
-#
-function mount_usb_key()
-{
-	local mnt=$1
-
-	if [[ -z "$mnt" ]]; then
-		mnt=/mnt/$(svcprop -p "joyentfs/usb_mountpoint" \
-		    "svc:/system/filesystem/smartdc:default")
-	fi
-
-	if [[ -f "$mnt/.joyliveusb" ]]; then
-		echo $mnt
-		return 0
-	fi
-
-	if ! mkdir -p $mnt; then
-		echo "failed to mkdir $mnt" >&2
-		return 1
-	fi
-
-	readonly alldisks=$(/usr/bin/disklist -a)
-
-	for disk in $alldisks; do
-		version=$(usb_key_version "/dev/dsk/${disk}p0")
-
-		case $version in
-		1) devpath="/dev/dsk/${disk}p1" ;;
-		2) devpath="/dev/dsk/${disk}s2" ;;
-		*) continue ;;
-		esac
-
-		fstyp="$(/usr/sbin/fstyp $devpath 2>/dev/null)"
-
-		if [[ "$fstyp" != "pcfs" ]]; then
-			continue
-		fi
-
-		/usr/sbin/mount -F pcfs -o foldcase,noatime $devpath $mnt \
-		    2>/dev/null
-
-		if [[ $? -ne 0 ]]; then
-			continue
-		fi
-
-		if [[ -f $mnt/.joyliveusb ]]; then
-			echo $mnt
-			return 0
-		fi
-
-		if ! /usr/sbin/umount $mnt; then
-			echo "Failed to unmount $mnt" >&2
-			return 1
-		fi
-	done
-
-	echo "Couldn't find USB key" >&2
-	return 1
-}
-
-function unmount_usb_key()
-{
-	local mnt=$1
-
-	if [[ -z "$mnt" ]]; then
-		mnt=/mnt/$(svcprop -p "joyentfs/usb_mountpoint" \
-		    "svc:/system/filesystem/smartdc:default")
-	fi
-
-	typ=$(awk -v "mnt=$mnt" '$2 == mnt { print $3 }' /etc/mnttab)
-
-	[[ -z $typ ]] && return 0
-
-	if [[ ! -f "$mnt/.joyliveusb" ]]; then
-		echo "$mnt does not contain a USB key" >&2
-		return 1
-	fi
-
-	umount "$mnt"
-}
-
-# replace a loader conf value
-function edit_param
-{
-	local readonly file="$1"
-	local readonly key="$2"
-	local readonly value="$3"
-	if ! /usr/bin/grep "^\s*$key\s*=\s*" $file >/dev/null; then
-		echo "$key=\"$value\"" >>$file
-		return
-	fi
-
-	/usr/bin/sed -i '' "s+^\s*$key\s*=.*+$key=\"$value\"+" $file
-}
-
-#
-# Presumes a mounted USB key.
-#
-function usb_key_disable_ipxe()
-{
-	local readonly mnt=/mnt/$(svcprop -p "joyentfs/usb_mountpoint" \
-	    "svc:/system/filesystem/smartdc:default")
-	local readonly dev=$(mount | nawk "\$0~\"^$mnt\" { print \$3 ; }")
-	local readonly dsk=${dev%[ps]?}
-	local readonly version=$(usb_key_version ${dsk}p0)
-
-	case $version in
-	1)
-		sed -i '' "s/^default.*/default 1/" $mnt/boot/grub/menu.lst.tmpl
-		if [[ -f $mnt/boot/grub/menu.lst ]]; then
-			sed -i '' "s/^default.*/default 1/" \
-			    $mnt/boot/grub/menu.lst
-		fi
-		;;
-	2)
-		edit_param $mnt/boot/loader.conf ipxe "false"
-		;;
-	*)
-		echo "unknown USB key version $version" >&2
-		return 1
-		;;
-	esac
-}
-
-#
-# This only sets os_console. Presumes a mounted USB key.
-#
-function usb_key_set_console()
-{
-	local readonly mnt=/mnt/$(svcprop -p "joyentfs/usb_mountpoint" \
-	    "svc:/system/filesystem/smartdc:default")
-	local readonly dev=$(mount | nawk "\$0~\"^$mnt\" { print \$3 ; }")
-	local readonly dsk=${dev%[ps]?}
-	local readonly version=$(usb_key_version ${dsk}p0)
-	local readonly console=$1
-
-	case $version in
-	1)
-		sed -i '' "s/^variable os_console.*/variable os_console ${console}/" \
-		    $mnt/boot/grub/menu.lst.tmpl
-		if [[ -f $mnt/boot/grub/menu.lst ]]; then
-			sed -i '' "s/^variable os_console.*/variable os_console ${console}/" \
-			    $mnt/boot/grub/menu.lst
-		fi
-		;;
-	2)
-		edit_param $mnt/boot/loader.conf os_console "$console"
-		;;
-	*)
-		echo "unknown USB key version $version" >&2
-		return 1
-		;;
-	esac
-}
diff --git a/overlay/generic/lib/sdc/zone.sh b/overlay/generic/lib/sdc/zone.sh
deleted file mode 100644
index 376ece0c..00000000
--- a/overlay/generic/lib/sdc/zone.sh
+++ /dev/null
@@ -1,207 +0,0 @@
-#!/usr/bin/bash
-#
-# functions for interacting with zones
-#
-# Copyright (c) 2010,2011 Joyent Inc., All rights reserved.
-#
-
-# zone_status <zonename>
-#
-# Returns the current status of the specified zone.
-function zone_status {
-    local ZONENAME=$1
-    if [ -z "$ZONENAME" ]; then
-        echo "ERROR: cannot shutdown zone, no zonename defined"
-        exit 1
-    fi
-    echo `zoneadm -z $1 list -p | cut -d':' -f3`    
-}   
-
-# zone_shutdown <zonename> <number_of_status_checks> <time_between_checks>
-#
-# This will attempt to shutdown the zone specified in the background and then
-# periodically check the zone status until the zone is no longer running.
-#
-# This defaults to checking every second for up to 30 attempts.
-function zone_shutdown {
-    local ZONENAME=$1
-    if [ -z "$ZONENAME" ]; then
-        echo "ERROR: cannot shutdown zone, no zonename defined"
-        exit 1
-    fi
- 
-    local TRIES=$(this_or_that "$2" "30")
-    local WAIT=$(this_or_that "$3" "1")
-
-    # Inbetween "running" and "installed" there are two states that can appear very briefly,
-    # "shutting down" and "down". While these generally fly by very quickly, best to double
-    # check
-    local STATUS=$(zone_status "$ZONENAME")
-    if [ "$STATUS" != "running" ] && [ "$STATUS" != "shutting_down" ] && [ "$STATUS" != "down" ]; then
-        return 0
-    fi
-    
-    zoneadm -z $ZONENAME halt 2>/dev/null &
-
-    while [[ "$TRIES" > 0 ]]; do
-        STATUS=$(zone_status "$ZONENAME")
-        
-        if [ "$STATUS" != "running" ] && [ "$STATUS" != "shutting_down" ] && [ "$STATUS" != "down" ]; then
-            break
-        fi
-        
-        sleep $WAIT
-        let TRIES=$TRIES-1
-    done
-
-    if [ "$STATUS" == "running" ] || [ "$STATUS" == "shutting_down" ] || [ "$STATUS" == "down" ]; then
-        echo "ERROR: unable to shutdown zone '$ZONENAME'"
-        return 1
-    fi
-
-    return 0
-}
-
-# zone_startup <zonename> <number_of_status_checks> <time_between_checks>
-#
-# This will attempt to boot the zone specified in the background and then
-# periodically check the zone status until the zone is running.
-#
-# This defaults to checking every second for up to 30 attempts.
-function zone_startup {
-    local ZONENAME=$1
-    if [ -z "$ZONENAME" ]; then
-        echo "ERROR: cannot startup zone, no zonename defined"
-        exit 1
-    fi
- 
-    local TRIES=$(this_or_that "$2" "30")
-    local WAIT=$(this_or_that "$3" "1")
-
-    if [ $(zone_status "$ZONENAME") == "running" ]; then
-        return 0
-    fi
-    
-    zoneadm -z $ZONENAME boot 2>/dev/null &
-
-    local STATUS= 
-    while [[ "$TRIES" > 0 ]]; do
-        STATUS=$(zone_status "$ZONENAME")
-        
-        if [ "$STATUS" == "running" ]; then
-            break
-        fi
-        
-        sleep $WAIT
-        let TRIES=$TRIES-1
-    done
-
-    if [ "$STATUS" != "running" ]; then
-        echo "ERROR: unable to startup zone '$ZONENAME'"
-        return 1
-    fi
-
-    return 0
-}
-
-# zone_detach <zonename> <number_of_status_checks> <time_between_checks>
-#
-# This will attempt to detach the zone specified in the background and then
-# periodically check the zone status until the zone is detached.
-#
-# This defaults to checking every second for up to 30 attempts.
-function zone_detach {
-    local ZONENAME=$1
-    if [ -z "$ZONENAME" ]; then
-        echo "ERROR: cannot detach zone, no zonename defined"
-        exit 1
-    fi
- 
-    local TRIES=$(this_or_that "$2" "30")
-    local WAIT=$(this_or_that "$3" "1")
-
-    if [ $(zone_status "$ZONENAME") == "configured" ]; then
-        return 0
-    fi
-  
-    # TEMPORARY HACK TO GET PAST OS-354
-    zoneadm -z $ZONENAME mark -F configured 2>/dev/null &
-    #zoneadm -z $ZONENAME detach 2>/dev/null &
-
-    local STATUS= 
-    while [[ "$TRIES" > 0 ]]; do
-        STATUS=$(zone_status "$ZONENAME")
-        
-        if [ "$STATUS" == "configured" ]; then
-            break
-        fi
-        
-        sleep $WAIT
-        let TRIES=$TRIES-1
-    done
-
-    if [ "$STATUS" != "configured" ]; then
-        echo "ERROR: unable to detach zone '$ZONENAME'"
-        return 1
-    fi
-
-    return 0
-}
-
-# zone_attach <zonename> <number_of_status_checks> <time_between_checks>
-#
-# This will attempt to attach the zone specified in the background and then
-# periodically check the zone status until the zone is attached.
-#
-# This defaults to checking every second for up to 30 attempts.
-function zone_attach {
-    local ZONENAME=$1
-    if [ -z "$ZONENAME" ]; then
-        echo "ERROR: cannot attach zone, no zonename defined"
-        exit 1
-    fi
- 
-    local TRIES=$(this_or_that "$2" "30")
-    local WAIT=$(this_or_that "$3" "1")
-
-    if [ $(zone_status "$ZONENAME") == "installed" ]; then
-        return 0
-    fi
-    
-    # XXX - TEMPORARY HACK TO GET PAST OS-354
-    zoneadm -z $ZONENAME mark -F installed 2>/dev/null &
-    #zoneadm -z $ZONENAME attach 2>/dev/null &
-
-    local STATUS= 
-    while [[ "$TRIES" > 0 ]]; do
-        STATUS=$(zone_status "$ZONENAME")
-        
-        if [ "$STATUS" == "installed" ]; then
-            break
-        fi
-        
-        sleep $WAIT
-        let TRIES=$TRIES-1
-    done
-
-    if [ "$STATUS" != "installed" ]; then
-        echo "ERROR: unable to attach zone '$ZONENAME'"
-        return 1
-    fi
-
-    return 0
-}
-
-# this_or_that <variable_that_may_be_null> <fallback_variable>
-#
-# This function is available to allow easy defaulting on variables for 
-# functions
-function this_or_that {
-    if [ -z "$1" ]; then
-      echo $2
-    else 
-      echo $1
-    fi
-}
-
-
diff --git a/overlay/generic/lib/svc/manifest/network/ipfilter.xml b/overlay/generic/lib/svc/manifest/network/ipfilter.xml
deleted file mode 100644
index da42c27d..00000000
--- a/overlay/generic/lib/svc/manifest/network/ipfilter.xml
+++ /dev/null
@@ -1,489 +0,0 @@
-<?xml version="1.0"?>
-<!DOCTYPE service_bundle SYSTEM "/usr/share/lib/xml/dtd/service_bundle.dtd.1">
-<!--
- Copyright (c) 2004, 2010, Oracle and/or its affiliates. All rights reserved.
-
- CDDL HEADER START
-
- The contents of this file are subject to the terms of the
- Common Development and Distribution License (the "License").
- You may not use this file except in compliance with the License.
-
- You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
- or http://www.opensolaris.org/os/licensing.
- See the License for the specific language governing permissions
- and limitations under the License.
-
- When distributing Covered Code, include this CDDL HEADER in each
- file and include the License file at usr/src/OPENSOLARIS.LICENSE.
- If applicable, add the following below this CDDL HEADER, with the
- fields enclosed by brackets "[]" replaced with your own identifying
- information: Portions Copyright [yyyy] [name of copyright owner]
-
- CDDL HEADER END
-
-	NOTE:  This service description is not editable; its contents
-	may be overwritten by package or patch operations, including
-	operating system upgrade.  Make customizations in a different
-	file.
-
-	Service manifest for the ipfilter service.
--->
-
-<service_bundle type='manifest' name='SUNWipfr:ipfilter'>
-
-<service
-	name='network/ipfilter'
-	type='service'
-	version='1'>
-
-	<single_instance />
-
-	<dependency
-	    name='filesystem'
-	    grouping='require_all'
-	    restart_on='none'
-	    type='service'>
-		<service_fmri value='svc:/system/filesystem/minimal' />
-	</dependency>
-
-	<dependency
-	    name='physical'
-	    grouping='require_all'
-	    restart_on='restart'
-	    type='service'>
-		<service_fmri value='svc:/network/physical' />
-	</dependency>
-
-	<dependency
-	    name='identity'
-	    grouping='require_all'
-	    restart_on='restart'
-	    type='service'>
-		<service_fmri value='svc:/system/identity:node' />
-	</dependency>
-
-	<dependency
-	    name='domain'
-	    grouping='require_all'
-	    restart_on='restart'
-	    type='service'>
-		<service_fmri value='svc:/system/identity:domain' />
-	</dependency>
-
-	<dependent
-	    name='ipf_network'
-	    grouping='optional_all'
-	    restart_on='restart'>
-		<service_fmri value='svc:/milestone/network' />
-	</dependent>
-
-	<exec_method
-		type='method'
-		name='stop'
-		exec='/lib/svc/method/ipfilter %m'
-		timeout_seconds='60' >
-	</exec_method>
-
-	<exec_method
-		type='method'
-		name='start'
-		exec='/lib/svc/method/ipfilter %m'
-		timeout_seconds='120' >
-	</exec_method>
-
-	<exec_method
-		type='method'
-		name='refresh'
-		exec='/lib/svc/method/ipfilter reload'
-		timeout_seconds='1200' >
-	</exec_method>
-
-	<instance name='default' enabled='true'>
-		<property_group name='firewall_config_default'
-			type='com.sun,fw_configuration'>
-			<propval name='policy' type='astring' value='custom' />
-			<propval name='block_policy' type='astring'
-				value='none' />
-			<propval name='custom_policy_file' type='astring'
-				value='/etc/ipf/ipf.conf' />
-			<propval name='custom_policy_file_6' type='astring'
-				value='/etc/ipf/ipf6.conf' />
-			<propval name='apply_to' type='astring' value='' />
-			<propval name='apply_to_6' type='astring' value='' />
-			<propval name='exceptions' type='astring' value='' />
-			<propval name='exceptions_6' type='astring' value='' />
-			<propval name='target' type='astring' value='' />
-			<propval name='target_6' type='astring' value='' />
-			<propval name='open_ports' type='astring' value='' />
-			<propval name='version' type='count' value='0' />
-			<propval name='value_authorization' type='astring'
-				value='solaris.smf.value.firewall.config' />
-		</property_group>
-
-		<property_group name='firewall_config_override'
-			type='com.sun,fw_configuration'>
-			<propval name='policy' type='astring' value='none' />
-			<propval name='block_policy' type='astring'
-				value='none' />
-			<propval name='apply_to' type='astring' value='' />
-			<propval name='apply_to_6' type='astring' value='' />
-			<propval name='value_authorization' type='astring'
-				value='solaris.smf.value.firewall.config' />
-		</property_group>
-
-		<property_group name='config' type='application'>
-			<propval name='ipf6_config_file' type='astring'
-				value='/etc/ipf/ipf6.conf' />
-			<propval name='ipnat_config_file' type='astring'
-				value='/etc/ipf/ipnat.conf' />
-			<propval name='ippool_config_file' type='astring'
-				value='/etc/ipf/ippool.conf' />
-		</property_group>
-
-	</instance>
-
-	<stability value='Unstable' />
-
-	<template>
-		<common_name>
-			<loctext xml:lang='C'>IP Filter</loctext>
-		</common_name>
-		<description>
-			<loctext xml:lang='C'>
-			Solaris IP Filter - host-based firewall
-			</loctext>
-		</description>
-		<documentation>
-			<manpage title='ipfilter' section='5'
-				manpath='/usr/share/man' />
-		</documentation>
-
-		<pg_pattern name='firewall_config_default'
-		    type='com.sun,fw_configuration' target='this'
-		    required='false'>
-			<common_name>
-				<loctext xml:lang='C'>
-Global Default firewall
-				</loctext>
-			</common_name>
-			<description>
-				<loctext xml:lang='C'>
-The default system-wide firewall policy.
-				</loctext>
-			</description>
-			<prop_pattern name='policy' type='astring'
-			    required='true'>
-				<common_name>
-					<loctext xml:lang='C'>
-Global Default policy 
-					</loctext>
-				</common_name>
-				<description>
-					<loctext xml:lang='C'>
-Firewall policy.
-					</loctext>
-				</description>
-				<visibility value='readwrite'/>
-				<cardinality min='1' max='1'/>
-				<values>
-					<value name='none'>
-						<description>
-							<loctext xml:lang='C'>
-No firewall (allow all), this is the default value. 
-							</loctext>
-
-						</description>
-					</value>
-					<value name='deny'>
-						<description>
-							<loctext xml:lang='C'>
-Deny access to entities specified in 'apply_to' property.
-							</loctext>
-						</description>
-					</value>
-					<value name='allow'>
-						<description>
-							<loctext xml:lang='C'>
-Allow access to entities specified in 'apply_to' property.
-							</loctext>
-						</description>
-					</value>
-					<value name='custom'>
-						<description>
-							<loctext xml:lang='C'>
-Apply the custom ipfilter configuration stored in a custom file (custom file property must be set).
-							</loctext>
-						</description>
-					</value>
-				</values>
-				<choices>
-					<include_values type='values'/>
-				</choices>
-			</prop_pattern>
-			<prop_pattern name='block_policy' type='astring'
-			    required='false'>
-				<common_name>
-					<loctext xml:lang='C'>
-Firewall block policy
-					</loctext>
-				</common_name>
-				<description>
-					<loctext xml:lang='C'>
-Service firewall block policy.
-					</loctext>
-				</description>
-				<visibility value='readwrite'/>
-				<cardinality min='1' max='1'/>
-				<values>
-					<value name='use_global'>
-						<description>
-							<loctext xml:lang='C'>
-Apply Global Default block policy, specified in network/ipfilter for the service. This is the default value.
-							</loctext>
-						</description>
-					</value>
-					<value name='none'>
-						<description>
-							<loctext xml:lang='C'>
-Block by dropping packets.
-							</loctext>
-						</description>
-					</value>
-					<value name='return'>
-						<description>
-							<loctext xml:lang='C'>
-Block by returning RST or ICMP messages.
-							</loctext>
-						</description>
-					</value>
-				</values>
-				<choices>
-					<include_values type='values'/>
-				</choices>
-			</prop_pattern>
-			<prop_pattern name="apply_to" type="astring"
-			    required="false">
-				<common_name>
-					<loctext xml:lang='C'>
-Apply policy to
-					</loctext>
-				</common_name>
-				<description>
-					<loctext xml:lang="C">
-The source host and network IPv4 addresses, incoming network interfaces, and ippools to deny if the policy is set to deny, or accept if the policy is set to accept.
-					</loctext>
-				</description>
-			</prop_pattern>
-			<prop_pattern name="apply_to_6" type="astring"
-			    required="false">
-				<common_name>
-					<loctext xml:lang='C'>
-Apply policy to
-					</loctext>
-				</common_name>
-				<description>
-					<loctext xml:lang="C">
-The source host and network IPv6 addresses, incoming network interfaces, and ippools to deny if the policy is set to deny, or accept if the policy is set to accept.
-					</loctext>
-				</description>
-			</prop_pattern>
-			<prop_pattern name="exceptions" type="astring"
-			    required="false">
-				<common_name>
-					<loctext xml:lang='C'>
-Make exceptions to
-					</loctext>
-				</common_name>
-				<description>
-					<loctext xml:lang="C">
-The source host and network IPv4 addresses, incoming network interfaces, and ippools which will be exempted from the set policy, accept if the policy is set to deny, or deny if the policy is set to accept.
-					</loctext>
-				</description>
-			</prop_pattern>
-			<prop_pattern name="exceptions_6" type="astring"
-			    required="false">
-				<common_name>
-					<loctext xml:lang='C'>
-Make exceptions to
-					</loctext>
-				</common_name>
-				<description>
-					<loctext xml:lang="C">
-The source host and network IPv6 addressess, incoming network interfaces, and ippools to exempt from the set policy. That is, those to accept if the policy is set to deny, or to deny if the policy is set to accept.
-					</loctext>
-				</description>
-			</prop_pattern>
-			<prop_pattern name="target" type="astring"
-			    required="false">
-				<common_name>
-					<loctext xml:lang='C'>
-Apply policy to
-					</loctext>
-				</common_name>
-				<description>
-					<loctext xml:lang="C">
-The destination host and network IPv4 addresses, and ippools to deny if the policy is set to deny, or accept if the policy is set to accept.
-					</loctext>
-				</description>
-			</prop_pattern>
-			<prop_pattern name="target6" type="astring"
-			    required="false">
-				<common_name>
-					<loctext xml:lang='C'>
-Apply policy to
-					</loctext>
-				</common_name>
-				<description>
-					<loctext xml:lang="C">
-The destination host and network IPv6 addresses, and ippools to deny if the policy is set to deny, or accept if the policy is set to accept.
-					</loctext>
-				</description>
-			</prop_pattern>
-			<prop_pattern name="custom_policy_file" type="astring"
-			    required="false">
-				<common_name>
-					<loctext xml:lang='C'>
-Custom policy IPfilter file
-					</loctext>
-				</common_name>
-				<description>
-					<loctext xml:lang='C'>
-The file containing a custom ipfilter configuration to use if a custom policy is enforced.
-					</loctext>
-				</description>
-			</prop_pattern>
-			<prop_pattern name="open_ports" type="astring"
-			    required="false">
-				<common_name>
-					<loctext xml:lang='C'>
-Open ports
-					</loctext>
-				</common_name>
-				<description>
-					<loctext xml:lang='C'>
-A set of ports to leave open regardless of firewall policy.
-					</loctext>
-				</description>
-			</prop_pattern>
-			<prop_pattern name="upgraded" type="boolean"
-			    required="false">
-				<visibility value='hidden'/>
-			</prop_pattern>
-		</pg_pattern>
-
-		<pg_pattern name='firewall_config_override'
-		    type='com.sun,fw_configuration' target='this'
-		    required='false'>
-			<common_name>
-				<loctext xml:lang='C'>
-Global Override firewall
-				</loctext>
-			</common_name>
-			<description>
-				<loctext xml:lang='C'>
-The system-wide firewall policy that overrides default system-wide and all services' policies.
-				</loctext>
-			</description>
-			<prop_pattern name='policy' type='astring'
-			    required='true'>
-				<common_name>
-					<loctext xml:lang='C'>
-Global Override policy 
-					</loctext>
-				</common_name>
-				<description>
-					<loctext xml:lang='C'>
-Firewall policy.
-					</loctext>
-				</description>
-				<visibility value='readwrite'/>
-				<cardinality min='1' max='1'/>
-				<values>
-					<value name='none'>
-						<description>
-							<loctext xml:lang='C'>
-No firewall (allow all), this is the default value. 
-							</loctext>
-						</description>
-					</value>
-					<value name='deny'>
-						<description>
-							<loctext xml:lang='C'>
-Deny access to entities specified in 'apply_to' property.
-							</loctext>
-						</description>
-					</value>
-					<value name='allow'>
-						<description>
-							<loctext xml:lang='C'>
-Allow access to entities specified in 'apply_to' property.
-							</loctext>
-						</description>
-					</value>
-				</values>
-				<choices>
-					<include_values type='values'/>
-				</choices>
-			</prop_pattern>
-			<prop_pattern name='block_policy' type='astring'
-			    required='false'>
-				<common_name>
-					<loctext xml:lang='C'>
-Firewall block policy
-					</loctext>
-				</common_name>
-				<description>
-					<loctext xml:lang='C'>
-Service firewall block policy.
-					</loctext>
-				</description>
-				<visibility value='readwrite'/>
-				<cardinality min='1' max='1'/>
-				<values>
-					<value name='use_global'>
-						<description>
-							<loctext xml:lang='C'>
-Apply Global Default block policy, specified in network/ipfilter for the service. This is the default value.
-							</loctext>
-						</description>
-					</value>
-					<value name='none'>
-						<description>
-							<loctext xml:lang='C'>
-Block by dropping packets.
-							</loctext>
-						</description>
-					</value>
-					<value name='return'>
-						<description>
-							<loctext xml:lang='C'>
-Block by returning RST or ICMP messages.
-							</loctext>
-						</description>
-					</value>
-				</values>
-				<choices>
-					<include_values type='values'/>
-				</choices>
-			</prop_pattern>
-			<prop_pattern name="apply_to" type="astring"
-			    required="false">
-				<common_name>
-					<loctext xml:lang='C'>
-Apply policy to
-					</loctext>
-				</common_name>
-				<description>
-					<loctext xml:lang="C">
-The host and network IPs, network interfaces, and ippools to deny if the
-policy is set to deny, or accept if the policy is set to accept.
-					</loctext>
-				</description>
-			</prop_pattern>
-		</pg_pattern>
-
-	</template>
-</service>
-
-</service_bundle>
diff --git a/overlay/generic/lib/svc/manifest/network/network-early-admin.xml b/overlay/generic/lib/svc/manifest/network/network-early-admin.xml
deleted file mode 100644
index 6566f31b..00000000
--- a/overlay/generic/lib/svc/manifest/network/network-early-admin.xml
+++ /dev/null
@@ -1,73 +0,0 @@
-<?xml version="1.0"?>
-<!DOCTYPE service_bundle SYSTEM "/usr/share/lib/xml/dtd/service_bundle.dtd.1">
-<!--
- Copyright 2019, Joyent, Inc.
-
-  This file and its contents are supplied under the terms of the
-  Common Development and Distribution License ("CDDL"), version 1.0.
-  You may only use this file in accordance with the terms of version
-  1.0 of the CDDL.
-
-  A full copy of the text of the CDDL should have accompanied this
-  source.  A copy of the CDDL is also available via the Internet at
-  http://www.illumos.org/license/CDDL.
-
--->
-
-<service_bundle type='manifest' name='network-early-admin'>
-
-<service
-	name='network/early-admin'
-	type='service'
-	version='1'>
-
-	<!-- ifconfig needs loopback for IPC with dhcpagent -->
-	<dependency
-		name='network'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/network/loopback' />
-		<service_fmri value='svc:/network/datalink-management' />
-		<service_fmri value='svc:/network/ip-interface-management' />
-	</dependency>
-
-	<instance name='default' enabled='true'>
-
-	<exec_method
-		type='method'
-		name='start'
-		exec='/lib/svc/method/net-early-admin'
-		timeout_seconds='600' />
-
-	<exec_method
-		type='method'
-		name='stop'
-		exec=':true'
-		timeout_seconds='3' />
-
-	<property_group name='startd' type='framework'>
-		<propval name='duration' type='astring' value='transient' />
-	</property_group>
-
-	<template>
-		<common_name>
-			<loctext xml:lang='C'>
-				Triton admin network on compute nodes
-			</loctext>
-		</common_name>
-		<documentation>
-			<manpage title='ifconfig' section='1M'
-				manpath='/usr/share/man' />
-			<manpage title='dladm' section='1M'
-				manpath='/usr/share/man' />
-		</documentation>
-	</template>
-
-	</instance>
-
-	<stability value='Unstable' />
-
-</service>
-
-</service_bundle>
diff --git a/overlay/generic/lib/svc/manifest/network/network-location.xml b/overlay/generic/lib/svc/manifest/network/network-location.xml
deleted file mode 100644
index 5e23d924..00000000
--- a/overlay/generic/lib/svc/manifest/network/network-location.xml
+++ /dev/null
@@ -1,238 +0,0 @@
-<?xml version="1.0"?>
-<!DOCTYPE service_bundle SYSTEM "/usr/share/lib/xml/dtd/service_bundle.dtd.1">
-<!--
- Copyright 2010 Sun Microsystems, Inc.  All rights reserved.
- Use is subject to license terms.
-
- CDDL HEADER START
-
- The contents of this file are subject to the terms of the
- Common Development and Distribution License (the "License").
- You may not use this file except in compliance with the License.
-
- You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
- or http://www.opensolaris.org/os/licensing.
- See the License for the specific language governing permissions
- and limitations under the License.
-
- When distributing Covered Code, include this CDDL HEADER in each
- file and include the License file at usr/src/OPENSOLARIS.LICENSE.
- If applicable, add the following below this CDDL HEADER, with the
- fields enclosed by brackets "[]" replaced with your own identifying
- information: Portions Copyright [yyyy] [name of copyright owner]
-
- CDDL HEADER END
-
-	NOTE:  This service manifest is not editable; its contents will
-	be overwritten by package or patch operations, including
-	operating system upgrade.  Make customizations in a different
-	file.
--->
-
-<service_bundle type='manifest' name='SUNWcsr:network-location'>
-
-<!--
-  network/location is used as a medium to refresh and restart SMF
-  services dependent on network/location whenever nwamd(1M) changes
-  locations.  nwamd(1M) updates the different configuration files
-  according to the location being (de)activated and refreshes
-  network/location.  This causes the services dependent on network/location
-  to restart and read in the updated configuration files.
-
-  The following services are dependent on network/location with a
-  "restart_on refresh" dependency:
-
-	svc:/network/dns/client:default
-	svc:/network/nis/client:default
-	svc:/network/ldap/client:default
-	svc:/system/name-service-cache:default
-	svc:/network/nfs/mapid:default
-
-  The following dependents will be refreshed (rather than restarted) and,
-  thus, have a "restart_on none" dependency:
-
-	svc:/network/ipfilter:default
-	svc:/network/ipsec/ike:default
-	svc:/network/ipsec/policy:default
-
-  The name of the location to be activated is set in the location/selected
-  property by nwamd.  If this property group/property does not exist, the
-  NoNet location will be activated as a fallback.
-
--->
-
-<service
-	name='network/location'
-	type='service'
-	version='1'>
-
-	<instance name='default' enabled='false'>
-
-	<!--
-		nwamd(1M) refreshes network/location when a new location is
-		activated, thus the "restart_on none" dependency.
-	-->
-	<dependency
-		name='network-physical'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/network/physical' />
-	</dependency>
-
-	<dependency
-		name='filesystem'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/system/filesystem/usr' />
-	</dependency>
-
-	<!-- 
-		This dependency on system/manifest-import is just for the
-		case of the boot after upgrade.  We don't want
-		network/location starting up until network/netcfg has been
-		imported by manifest-import and enabled.  On top of that,
-		we also want the new manifest for network/ipfilter to be
-		imported before network/location has started.
-	-->
-	<dependency
-		name='manifest-import'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/system/manifest-import:default' />
-	</dependency>
-
-	<!-- The following services are dependent on network/location. -->
-
-	<dependent
-		name='location_dns-client'
-		grouping='optional_all'
-		restart_on='refresh'>
-		<service_fmri value='svc:/network/dns/client' />
-	</dependent>
-
-	<dependent
-		name='location_nis-client'
-		grouping='optional_all'
-		restart_on='refresh'>
-		<service_fmri value='svc:/network/nis/client' />
-	</dependent>
-
-	<dependent
-		name='location_ldap-client'
-		grouping='optional_all'
-		restart_on='refresh'>
-		<service_fmri value='svc:/network/ldap/client' />
-	</dependent>
-
-	<dependent
-		name='location_name-service-cache'
-		grouping='optional_all'
-		restart_on='refresh'>
-		<service_fmri value='svc:/system/name-service-cache' />
-	</dependent>
-
-	<dependent
-		name='location_nfs-mapid'
-		grouping='optional_all'
-		restart_on='refresh'>
-		<service_fmri value='svc:/network/nfs/mapid' />
-	</dependent>
-
-	<dependent
-		name='location_identity-domain'
-		grouping='optional_all'
-		restart_on='refresh'>
-		<service_fmri value='svc:/system/identity:domain' />
-	</dependent>
-
-	<!--
-		The following three dependents will be refreshed by 
-		/lib/svc/method/net-loc, rather than restarted,
-		when network/location is refreshed.
-	-->
-
-	<dependent
-		name='location_ipfilter'
-		grouping='optional_all'
-		restart_on='none'>
-		<service_fmri value='svc:/network/ipfilter' />
-	</dependent>
-
-	<dependent
-		name='location_ipsec-ike'
-		grouping='optional_all'
-		restart_on='none'>
-		<service_fmri value='svc:/network/ipsec/ike' />
-	</dependent>
-
-	<dependent
-		name='location_ipsec-policy'
-		grouping='optional_all'
-		restart_on='none'>
-		<service_fmri value='svc:/network/ipsec/policy' />
-	</dependent>
-
-	<exec_method
-		type='method'
-		name='start'
-		exec='/lib/svc/method/net-loc start'
-		timeout_seconds='60' >
-		<method_context>
-			<method_credential user='netadm' group='netadm'
-				supp_groups='netadm' privileges='zone' />
-		</method_context>
-	</exec_method>
-
-	<exec_method
-		type='method'
-		name='refresh'
-		exec='/lib/svc/method/net-loc refresh'
-		timeout_seconds='60' >
-		<method_context>
-			<method_credential user='netadm' group='netadm'
-				supp_groups='netadm' privileges='zone' />
-		</method_context>
-	</exec_method>
-
-	<exec_method
-		type='method'
-		name='stop'
-		exec=':true'
-		timeout_seconds='60' >
-		<method_context>
-			<method_credential user='netadm' group='netadm'
-				supp_groups='netadm' privileges='zone' />
-		</method_context>
-	</exec_method>
-
-	<property_group name='general' type='framework'>
-		<propval name='action_authorization' type='astring'
-			value='solaris.smf.manage.location' />
-	</property_group>
-
-	<property_group name='startd' type='framework'>
-		<propval name='duration' type='astring' value='transient' />
-	</property_group>
-
-	<template>
-		<common_name>
-			<loctext xml:lang='C'>
-				network interface configuration
-			</loctext>
-		</common_name>
-		<documentation>
-			<manpage title='nwamd' section='1M'
-				manpath='/usr/share/man' />
-		</documentation>
-	</template>
-
-	</instance>
-
-	<stability value='Unstable' />
-
-</service>
-
-</service_bundle>
diff --git a/overlay/generic/lib/svc/manifest/network/network-physical.xml b/overlay/generic/lib/svc/manifest/network/network-physical.xml
deleted file mode 100644
index 62b89bbc..00000000
--- a/overlay/generic/lib/svc/manifest/network/network-physical.xml
+++ /dev/null
@@ -1,112 +0,0 @@
-<?xml version="1.0"?>
-<!DOCTYPE service_bundle SYSTEM "/usr/share/lib/xml/dtd/service_bundle.dtd.1">
-<!--
- Copyright 2010 Sun Microsystems, Inc.  All rights reserved.
- Use is subject to license terms.
-
- Copyright 2019 Joyent, Inc.
-
- CDDL HEADER START
-
- The contents of this file are subject to the terms of the
- Common Development and Distribution License (the "License").
- You may not use this file except in compliance with the License.
-
- You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
- or http://www.opensolaris.org/os/licensing.
- See the License for the specific language governing permissions
- and limitations under the License.
-
- When distributing Covered Code, include this CDDL HEADER in each
- file and include the License file at usr/src/OPENSOLARIS.LICENSE.
- If applicable, add the following below this CDDL HEADER, with the
- fields enclosed by brackets "[]" replaced with your own identifying
- information: Portions Copyright [yyyy] [name of copyright owner]
-
- CDDL HEADER END
-
-	NOTE:  This service manifest is not editable; its contents will
-	be overwritten by package or patch operations, including
-	operating system upgrade.  Make customizations in a different
-	file.
--->
-
-<service_bundle type='manifest' name='SUNWcsr:network-physical'>
-
-<service
-	name='network/physical'
-	type='service'
-	version='1'>
-
-	<!-- ifconfig needs loopback for IPC with dhcpagent -->
-	<dependency
-		name='loopback'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/network/loopback' />
-	</dependency>
-
-	<dependency
-		name='joyent'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/system/filesystem/smartdc' />
-	</dependency>
-
-	<dependency
-		name='mdata-fetch'
-		grouping='optional_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/smartdc/mdata:fetch' />
-	</dependency>
-
-	<!-- Prevent this and network/early-admin from trying to configure the
-		admin interface at the same time -->
-	<dependency
-		name='early-admin'
-		grouping='optional_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/network/early-admin:default' />
-	</dependency>
-
-	<instance name='default' enabled='true'>
-
-	<exec_method
-		type='method'
-		name='start'
-		exec='/lib/svc/method/net-physical'
-		timeout_seconds='600' />
-
-	<exec_method
-		type='method'
-		name='stop'
-		exec=':true'
-		timeout_seconds='3' />
-
-	<property_group name='startd' type='framework'>
-		<propval name='duration' type='astring' value='transient' />
-	</property_group>
-
-	<template>
-		<common_name>
-			<loctext xml:lang='C'>
-				physical network interfaces
-			</loctext>
-		</common_name>
-		<documentation>
-			<manpage title='ifconfig' section='1M'
-				manpath='/usr/share/man' />
-		</documentation>
-	</template>
-
-	</instance>
-
-	<stability value='Unstable' />
-
-</service>
-
-</service_bundle>
diff --git a/overlay/generic/lib/svc/manifest/system/auditd.xml b/overlay/generic/lib/svc/manifest/system/auditd.xml
deleted file mode 100644
index ac0600c9..00000000
--- a/overlay/generic/lib/svc/manifest/system/auditd.xml
+++ /dev/null
@@ -1,343 +0,0 @@
-<?xml version="1.0"?>
-<!DOCTYPE service_bundle SYSTEM "/usr/share/lib/xml/dtd/service_bundle.dtd.1">
-<!--
- Copyright (c) 2005, 2010, Oracle and/or its affiliates. All rights reserved.
-
- CDDL HEADER START
-
- The contents of this file are subject to the terms of the
- Common Development and Distribution License (the "License").
- You may not use this file except in compliance with the License.
-
- You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
- or http://www.opensolaris.org/os/licensing.
- See the License for the specific language governing permissions
- and limitations under the License.
-
- When distributing Covered Code, include this CDDL HEADER in each
- file and include the License file at usr/src/OPENSOLARIS.LICENSE.
- If applicable, add the following below this CDDL HEADER, with the
- fields enclosed by brackets "[]" replaced with your own identifying
- information: Portions Copyright [yyyy] [name of copyright owner]
-
- CDDL HEADER END
-
-    NOTE:  This service manifest is not editable; its contents will
-    be overwritten by package or patch operations, including
-    operating system upgrade.  Make customizations in a different
-    file.
--->
-
-<service_bundle type='manifest' name='SUNWcsr:auditd'>
-
-<service
-	name='system/auditd'
-	type='service'
-	version='1'>
-
-	<single_instance />
-
-	<dependency
-		name='usr'
-		type='service'
-		grouping='require_all'
-		restart_on='none'>
-		<service_fmri value='svc:/system/filesystem/local' />
-	</dependency>
-
-	<dependency
-		name='ns'
-		type='service'
-		grouping='require_all'
-		restart_on='none'>
-		<service_fmri value='svc:/milestone/name-services' />
-	</dependency>
-
-	<dependency
-		name='syslog'
-		type='service'
-		grouping='optional_all'
-		restart_on='none'>
-		<service_fmri value='svc:/system/system-log' />
-	</dependency>
-
-
-	<dependent
-		name='multi-user'
-		grouping='optional_all'
-		restart_on='none'>
-		<service_fmri value='svc:/milestone/multi-user'/>
-	</dependent>
-
-	<dependent
-		name='console-login'
-		grouping='optional_all'
-		restart_on='none'>
-		<service_fmri value='svc:/system/console-login'/>
-	</dependent>
-
-	<exec_method
-		type='method'
-		name='start'
-		exec='/lib/svc/method/svc-auditd'
-		timeout_seconds='60'>
-		<method_context>
-			<method_credential user='root' group='root' />
-		</method_context>
-	</exec_method>
-
-	<exec_method
-		type='method'
-		name='refresh'
-		exec='/lib/svc/method/svc-auditd'
-		timeout_seconds='30'>
-		<method_context>
-			<method_credential user='root' group='root' />
-		</method_context>
-	</exec_method>
-
-	<!--
-	  auditd waits for c2audit to quiet down after catching a -TERM
-	  before exiting; auditd's timeout is 20 seconds
-	-->
-
-	<exec_method
-		type='method'
-		name='stop'
-		exec=':kill -TERM'
-		timeout_seconds='30'>
-		<method_context>
-			<method_credential user='root' group='root' />
-		</method_context>
-	</exec_method>
-
-	<!-- SIGs HUP, TERM, and USR1 are all expected by auditd -->
-	<property_group name='startd' type='framework'>
-		<propval name='ignore_error' type='astring'
-			value='core,signal' />
-	</property_group>
-
-	<property_group name='general' type='framework'>
-		<!-- to start/stop auditd -->
-		<propval name='action_authorization' type='astring'
-			value='solaris.smf.manage.audit' />
-		<propval name='value_authorization' type='astring'
-			value='solaris.smf.manage.audit' />
-	</property_group>
-
-	<instance name='default' enabled='false'>
-
-	<!--
-	  System-wide audit preselection flags - see auditconfig(1M)
-	  and audit_flags(5).
-
-	  The 'flags' property is the system-wide default set of
-	  audit classes that is combined with the per-user audit
-	  flags to configure the process audit at login and role
-	  assumption time.
-
-	  The 'naflags' property is the set of audit classes for
-	  audit event selection when an event cannot be attributed
-	  to an authenticated user.
-	-->
-	<property_group name='preselection' type='application'>
-		<propval name='flags' type='astring'
-			value='lo,ex' />
-		<propval name='naflags' type='astring'
-			value='lo' />
-		<propval name='read_authorization' type='astring'
-			value='solaris.smf.value.audit' />
-		<propval name='value_authorization' type='astring'
-			value='solaris.smf.value.audit' />
-	</property_group>
-
-	<!--
-	  Audit Queue Control Properties - see auditconfig(1M)
-	    
-	    Note, that the default value for all the queue control
-	    configuration parameters is 0, which makes auditd(1M) to
-	    use current active system parameters.
-	-->
-	<property_group name='queuectrl' type='application' >
-		<propval name='qbufsz' type='count'
-			value='0' />
-		<propval name='qdelay' type='count'
-			value='0' />
-		<propval name='qhiwater' type='count'
-			value='0' />
-		<propval name='qlowater' type='count'
-			value='0' />
-		<propval name='read_authorization' type='astring'
-			value='solaris.smf.value.audit' />
-		<propval name='value_authorization' type='astring'
-			value='solaris.smf.value.audit' />
-	</property_group>
-
-	<!--
-	  Audit Policies - see auditconfig(1M)
-
-	    Note, that "all" and "none" policies available as a
-	    auditconfig(1M) policy flags actually means a full/empty set
-	    of other policy flags. Thus they are not configurable in the
-	    auditd service manifest, but set all the policies to true
-	    (all) or false (none).
-	-->
-	<property_group name='policy' type='application' >
-		<propval name='ahlt' type='boolean'
-			value='false' />
-		<propval name='arge' type='boolean'
-			value='false' />
-		<propval name='argv' type='boolean'
-			value='true' />
-		<propval name='cnt' type='boolean'
-			value='true' />
-		<propval name='group' type='boolean'
-			value='false' />
-		<propval name='path' type='boolean'
-			value='false' />
-		<propval name='perzone' type='boolean'
-			value='true' />
-		<propval name='public' type='boolean'
-			value='false' />
-		<propval name='seq' type='boolean'
-			value='false' />
-		<propval name='trail' type='boolean'
-			value='false' />
-		<propval name='windata_down' type='boolean'
-			value='false' />
-		<propval name='windata_up' type='boolean'
-			value='false' />
-		<propval name='zonename' type='boolean'
-			value='false' />
-		<propval name='read_authorization' type='astring'
-			value='solaris.smf.value.audit' />
-		<propval name='value_authorization' type='astring'
-			value='solaris.smf.value.audit' />
-	</property_group>
-
-	<!--
-	  Plugins to configure where to send the audit trail - see
-	  auditconfig(1M), audit_binfile(5), audit_remote(5),
-	  audit_syslog(5) 
-
-	  Each plugin type property group has properties:
-
-	  'active' is a boolean which defines whether or not
-	    to load the plugin.
-
-	  'path' is a string which defines name of the
-	    plugin's shared object in the file system.
-	    Relative paths assume a prefix of
-	    "/usr/lib/security/$ISA"
-
-	  'qsize' is an integer which defines a plugin specific
-	    maximum number of records that auditd will queue
-	    for it. A zero (0) value indicates not defined.
-	    This overrides the system's active queue control
-	    hiwater mark.
-
-	    and various attributes as defined on the plugin's man page
-	-->
-	<property_group name='audit_binfile' type='plugin' >
-		<propval name='active' type='boolean'
-			value='true' />
-		<propval name='path' type='astring'
-			value='audit_binfile.so' />
-		<propval name='qsize' type='count'
-			value='0' />
-		<propval name='p_dir' type='astring'
-			value='/var/audit' />
-		<propval name='p_minfree' type='count'
-			value='0' />
-		<propval name='p_fsize' type='count'
-			value='0' />
-		<property name='read_authorization' type='astring'>
-			<astring_list>
-				<value_node value='solaris.smf.manage.audit' />
-				<value_node value='solaris.smf.value.audit' />
-			</astring_list>
-		</property>
-		<propval name='value_authorization' type='astring'
-			value='solaris.smf.value.audit' />
-	</property_group>
-
-	<property_group name='audit_syslog' type='plugin' >
-		<propval name='active' type='boolean'
-			value='false' />
-		<propval name='path' type='astring'
-			value='audit_syslog.so' />
-		<propval name='qsize' type='count'
-			value='0' />
-		<propval name='p_flags' type='astring'
-			value='' />
-		<property name='read_authorization' type='astring'>
-			<astring_list>
-				<value_node value='solaris.smf.manage.audit' />
-				<value_node value='solaris.smf.value.audit' />
-			</astring_list>
-		</property>
-		<propval name='value_authorization' type='astring'
-			value='solaris.smf.value.audit' />
-	</property_group>
-
-	<property_group name='audit_remote' type='plugin' >
-		<propval name='active' type='boolean'
-			value='false' />
-		<propval name='path' type='astring'
-			value='audit_remote.so' />
-		<propval name='qsize' type='count'
-			value='0' />
-		<propval name='p_hosts' type='astring'
-			value='' />
-		<propval name='p_retries' type='count'
-			value='3' />
-		<propval name='p_timeout' type='count'
-			value='5' />
-		<property name='read_authorization' type='astring'>
-			<astring_list>
-				<value_node value='solaris.smf.manage.audit' />
-				<value_node value='solaris.smf.value.audit' />
-			</astring_list>
-		</property>
-		<propval name='value_authorization' type='astring'
-			value='solaris.smf.value.audit' />
-	</property_group>
-
-	</instance>
-
-	<stability value='Evolving' />
-
-	<template>
-		<common_name>
-			<loctext xml:lang='C'>
-				Solaris audit daemon
-			</loctext>
-		</common_name>
-		<documentation>
-			<manpage title='auditd'
-				section='1M'
-				manpath='/usr/share/man'/>
-			<manpage title='audit'
-				section='1M'
-				manpath='/usr/share/man'/>
-			<manpage title='auditconfig'
-				section='1M'
-				manpath='/usr/share/man'/>
-			<manpage title='audit_flags'
-				section='5'
-				manpath='/usr/share/man'/>
-			<manpage title='audit_binfile'
-				section='5'
-				manpath='/usr/share/man'/>
-			<manpage title='audit_syslog'
-				section='5'
-				manpath='/usr/share/man'/>
-			<manpage title='audit_remote'
-				section='5'
-				manpath='/usr/share/man'/>
-	         </documentation>
-	</template>
-
-</service>
-
-</service_bundle>
diff --git a/overlay/generic/lib/svc/manifest/system/console-login.xml b/overlay/generic/lib/svc/manifest/system/console-login.xml
deleted file mode 100644
index 95784fba..00000000
--- a/overlay/generic/lib/svc/manifest/system/console-login.xml
+++ /dev/null
@@ -1,549 +0,0 @@
-<?xml version="1.0"?>
-<!--
-	Copyright 2008 Sun Microsystems, Inc.  All rights reserved.
-	Use is subject to license terms.
-
-	Copyright 2015 Joyent, Inc.
-
-	NOTE:  This service manifest is not editable; its contents will
-	be overwritten by package or patch operations, including
-	operating system upgrade.  Make customizations in a different
-	file.
--->
-
-<!DOCTYPE service_bundle SYSTEM "/usr/share/lib/xml/dtd/service_bundle.dtd.1">
-
-<service_bundle type='manifest' name='SUNWcsr:console'>
-
-<service
-	name='system/console-login'
-	type='service'
-	version='1'>
-
-	<dependency
-		name='fs'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/system/filesystem/minimal' />
-	</dependency>
-
-	<dependency
-		name='identity'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/system/identity:node' />
-	</dependency>
-
-	<dependency
-		name='utmpx'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/system/utmp:default' />
-	</dependency>
-
-	<!-- Note that console-login should be dependent on any services
-	     that may need to use the console. This requirement can be met
-	     by establishing a dependency on milestone/sysconfig which,
-	     among other things, collects such dependencies.
-	-->
-	<dependency
-		name='sysconfig'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/milestone/sysconfig' />
-	</dependency>
-
-	<exec_method
-		type='method'
-		name='start'
-		exec='/lib/svc/method/console-login %i'
-		timeout_seconds='0'>
-                <method_context>
-                        <method_credential user='root' group='root' />
-                </method_context>
-        </exec_method>
-
-	<exec_method
-		type='method'
-		name='stop'
-		exec=':kill -9'
-		timeout_seconds='3'>
-                <method_context>
-                        <method_credential user='root' group='root' />
-                </method_context>
-        </exec_method>
-
-
-	<property_group name='startd' type='framework'>
-		<propval name='duration' type='astring' value='child' />
-		<propval name='ignore_error' type='astring'
-			value='core,signal' />
-		<propval name='utmpx_prefix' type='astring' value='co' />
-	</property_group>
-
-	<property_group name='general' type='framework'>
-		<propval name='action_authorization' type='astring'
-			value='solaris.smf.manage.vt' />
-		<propval name='value_authorization' type='astring'
-			value='solaris.smf.manage.vt' />
-	</property_group>
-
-	<!-- these are passed to ttymon in the method script.
-	     note that value_authorization is not passed to ttymon
-	     and it's for smf_security(5).
-	-->
-	<property_group name='ttymon' type='application'>
-		<propval name='value_authorization' type='astring'
-			value='solaris.smf.value.vt' />
-		<propval name='device' type='astring' value='/dev/wscons' />
-		<propval name='label' type='astring' value='console' />
-		<propval name='timeout' type='count' value='0' />
-		<propval name='nohangup' type='boolean' value='true' />
-		<propval name='modules' type='astring'
-		    value='ldterm,ttcompat' />
-		<propval name='prompt' type='astring'
-		   value='`uname -n` wscons login:' />
-		<propval name='terminal_type' type='astring'
-		     value='' />
-	</property_group>
-
-
-<instance name='default' enabled='true'>
-</instance>
-
-<instance name='ttya' enabled='true'>
-
-	    <dependency
-		    name='system-console'
-		    grouping='require_all'
-		    restart_on='none'
-		    type='service'>
-		    <service_fmri value='svc:/system/console-login:default' />
-	    </dependency>
-
-        <!-- these are passed to ttymon in the method script -->
-        <property_group name='ttymon' type='application'>
-		<propval name='value_authorization' type='astring'
-			value='solaris.smf.value.vt' />
-		<propval name='device' type='astring' value='/dev/term/a' />
-		<propval name='label' type='astring' value='115200' />
-		<propval name='timeout' type='count' value='0' />
-		<propval name='nohangup' type='boolean' value='true' />
-		<propval name='modules' type='astring'
-			value='ldterm,ttcompat' />
-		<propval name='prompt' type='astring'
-			value='`uname -n` ttya login:' />
-		<propval name='terminal_type' type='astring'
-			value='xterm' />
-	</property_group>
-</instance>
-
-<instance name='ttyb' enabled='true'>
-
-	    <dependency
-		    name='system-console'
-		    grouping='require_all'
-		    restart_on='none'
-		    type='service'>
-		    <service_fmri value='svc:/system/console-login:default' />
-	    </dependency>
-
-        <!-- these are passed to ttymon in the method script -->
-        <property_group name='ttymon' type='application'>
-		<propval name='value_authorization' type='astring'
-			value='solaris.smf.value.vt' />
-		<propval name='device' type='astring' value='/dev/term/b' />
-		<propval name='label' type='astring' value='115200' />
-		<propval name='timeout' type='count' value='0' />
-		<propval name='nohangup' type='boolean' value='true' />
-		<propval name='modules' type='astring'
-			value='ldterm,ttcompat' />
-		<propval name='prompt' type='astring'
-			value='`uname -n` ttyb login:' />
-		<propval name='terminal_type' type='astring'
-			value='xterm' />
-	</property_group>
-</instance>
-
-<instance name='ttyc' enabled='true'>
-
-	    <dependency
-		    name='system-console'
-		    grouping='require_all'
-		    restart_on='none'
-		    type='service'>
-		    <service_fmri value='svc:/system/console-login:default' />
-	    </dependency>
-
-        <!-- these are passed to ttymon in the method script -->
-        <property_group name='ttymon' type='application'>
-		<propval name='value_authorization' type='astring'
-			value='solaris.smf.value.vt' />
-		<propval name='device' type='astring' value='/dev/term/c' />
-		<propval name='label' type='astring' value='115200' />
-		<propval name='timeout' type='count' value='0' />
-		<propval name='nohangup' type='boolean' value='true' />
-		<propval name='modules' type='astring'
-			value='ldterm,ttcompat' />
-		<propval name='prompt' type='astring'
-			value='`uname -n` ttyc login:' />
-		<propval name='terminal_type' type='astring'
-			value='xterm' />
-	</property_group>
-</instance>
-
-<instance name='ttyd' enabled='true'>
-
-	    <dependency
-		    name='system-console'
-		    grouping='require_all'
-		    restart_on='none'
-		    type='service'>
-		    <service_fmri value='svc:/system/console-login:default' />
-	    </dependency>
-
-        <!-- these are passed to ttymon in the method script -->
-        <property_group name='ttymon' type='application'>
-		<propval name='value_authorization' type='astring'
-			value='solaris.smf.value.vt' />
-		<propval name='device' type='astring' value='/dev/term/d' />
-		<propval name='label' type='astring' value='115200' />
-		<propval name='timeout' type='count' value='0' />
-		<propval name='nohangup' type='boolean' value='true' />
-		<propval name='modules' type='astring'
-			value='ldterm,ttcompat' />
-		<propval name='prompt' type='astring'
-			value='`uname -n` ttyd login:' />
-		<propval name='terminal_type' type='astring'
-			value='xterm' />
-	</property_group>
-</instance>
-
-<instance name='vt2' enabled='false'>
-
-	<dependency
-		name='system-console'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/system/console-login:default' />
-	</dependency>
-
-	<dependency
-		name='vtdaemon'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/system/vtdaemon:default' />
-	</dependency>
-
-        <!-- these are passed to ttymon in the method script -->
-        <property_group name='ttymon' type='application'>
-		<propval name='value_authorization' type='astring'
-			value='solaris.smf.value.vt' />
-		<propval name='device' type='astring' value='/dev/vt/2' />
-		<propval name='label' type='astring' value='console' />
-		<propval name='timeout' type='count' value='0' />
-		<propval name='nohangup' type='boolean' value='true' />
-		<propval name='modules' type='astring'
-			value='ldterm,ttcompat' />
-		<propval name='prompt' type='astring'
-			value='`uname -n` vt2 login:' />
-		<propval name='terminal_type' type='astring'
-			value='' />
-	</property_group>
-
-</instance>
-
-
-<instance name='vt3' enabled='false'>
-
-	<dependency
-		name='system-console'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/system/console-login:default' />
-	</dependency>
-
-	<dependency
-		name='vtdaemon'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/system/vtdaemon:default' />
-	</dependency>
-
-        <!-- these are passed to ttymon in the method script -->
-        <property_group name='ttymon' type='application'>
-		<propval name='value_authorization' type='astring'
-			value='solaris.smf.value.vt' />
-		<propval name='device' type='astring' value='/dev/vt/3' />
-		<propval name='label' type='astring' value='console' />
-		<propval name='timeout' type='count' value='0' />
-		<propval name='nohangup' type='boolean' value='true' />
-		<propval name='modules' type='astring'
-			value='ldterm,ttcompat' />
-		<propval name='prompt' type='astring'
-			value='`uname -n` vt3 login:' />
-		<propval name='terminal_type' type='astring'
-			value='' />
-	</property_group>
-
-</instance>
-
-
-<instance name='vt4' enabled='false'>
-
-	<dependency
-		name='system-console'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/system/console-login:default' />
-	</dependency>
-
-	<dependency
-		name='vtdaemon'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/system/vtdaemon:default' />
-	</dependency>
-
-        <!-- these are passed to ttymon in the method script -->
-        <property_group name='ttymon' type='application'>
-		<propval name='value_authorization' type='astring'
-			value='solaris.smf.value.vt' />
-		<propval name='device' type='astring' value='/dev/vt/4' />
-		<propval name='label' type='astring' value='console' />
-		<propval name='timeout' type='count' value='0' />
-		<propval name='nohangup' type='boolean' value='true' />
-		<propval name='modules' type='astring'
-			value='ldterm,ttcompat' />
-		<propval name='prompt' type='astring'
-			value='`uname -n` vt4 login:' />
-		<propval name='terminal_type' type='astring'
-			value='' />
-	</property_group>
-
-</instance>
-
-
-<instance name='vt5' enabled='false'>
-
-	<dependency
-		name='system-console'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/system/console-login:default' />
-	</dependency>
-
-	<dependency
-		name='vtdaemon'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/system/vtdaemon:default' />
-	</dependency>
-
-        <!-- these are passed to ttymon in the method script -->
-        <property_group name='ttymon' type='application'>
-		<propval name='value_authorization' type='astring'
-			value='solaris.smf.value.vt' />
-		<propval name='device' type='astring' value='/dev/vt/5' />
-		<propval name='label' type='astring' value='console' />
-		<propval name='timeout' type='count' value='0' />
-		<propval name='nohangup' type='boolean' value='true' />
-		<propval name='modules' type='astring'
-			value='ldterm,ttcompat' />
-		<propval name='prompt' type='astring'
-			value='`uname -n` vt5 login:' />
-		<propval name='terminal_type' type='astring'
-			value='' />
-	</property_group>
-
-</instance>
-
-
-<instance name='vt6' enabled='false'>
-
-	<dependency
-		name='system-console'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/system/console-login:default' />
-	</dependency>
-
-	<dependency
-		name='vtdaemon'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/system/vtdaemon:default' />
-	</dependency>
-
-        <!-- these are passed to ttymon in the method script -->
-        <property_group name='ttymon' type='application'>
-		<propval name='value_authorization' type='astring'
-			value='solaris.smf.value.vt' />
-		<propval name='device' type='astring' value='/dev/vt/6' />
-		<propval name='label' type='astring' value='console' />
-		<propval name='timeout' type='count' value='0' />
-		<propval name='nohangup' type='boolean' value='true' />
-		<propval name='modules' type='astring'
-			value='ldterm,ttcompat' />
-		<propval name='prompt' type='astring'
-			value='`uname -n` vt6 login:' />
-		<propval name='terminal_type' type='astring'
-			value='' />
-	</property_group>
-
-</instance>
-
-
-	<stability value='Evolving' />
-
-	<template>
-		<common_name>
-			<loctext xml:lang='C'>
-Console login
-			</loctext>
-		</common_name>
-		<documentation>
-			<manpage title='ttymon' section='1M'
-				manpath='/usr/share/man' />
-		</documentation>
-
-		<pg_pattern name='ttymon' type='application' target='this'
-		    required='false'>
-			<prop_pattern name='device' type='astring'
-			    required='false'>
-				<description>
-					<loctext xml:lang='C'>
-The terminal device to be used for the console login prompt.
-					</loctext>
-				</description>
-				<visibility value='readwrite'/>
-				<cardinality min='1' max='1'/>
-				<values>
-					<value name='/dev/console'>
-						<description>
-							<loctext xml:lang='C'>
-The default console device
-							</loctext>
-						</description>
-					</value>
-					<value name='/dev/wscons'>
-						<description>
-							<loctext xml:lang='C'>
-The physical workstation console (i.e. keyboard and monitor)
-							</loctext>
-						</description>
-					</value>
-					<value name='/dev/term/a'>
-						<description>
-							<loctext xml:lang='C'>
-Serial device A
-							</loctext>
-						</description>
-					</value>
-					<value name='/dev/term/b'>
-						<description>
-							<loctext xml:lang='C'>
-Serial device B
-							</loctext>
-						</description>
-					</value>
-				</values>
-				<choices>
-					<include_values type='values'/>
-				</choices>
-			</prop_pattern>
-			<prop_pattern name='label' type='astring'
-			    required='false'>
-				<common_name>
-					<loctext xml:lang='C'>
-/etc/ttydefs entry
-					</loctext>
-				</common_name>
-				<description>
-					<loctext xml:lang='C'>
-The appropriate entry from /etc/ttydefs
-					</loctext>
-				</description>
-				<visibility value='readwrite'/>
-				<cardinality min='1' max='1'/>
-			</prop_pattern>
-			<prop_pattern name='timeout' type='count'
-			    required='false'>
-				<description>
-					<loctext xml:lang='C'>
-If no user input is given within the number of seconds defined by this property after the prompt is printed, ttymon should exit.
-					</loctext>
-				</description>
-				<units>
-					<loctext xml:lang='C'>
-seconds
-					</loctext>
-				</units>
-				<visibility value='readwrite'/>
-				<cardinality min='1' max='1'/>
-			</prop_pattern>
-			<prop_pattern name='nohangup' type='boolean'
-			    required='false'>
-				<description>
-					<loctext xml:lang='C'>
-Do not force a hangup on the line by setting the speed to zero before setting the speed to the default or specified speed.
-					</loctext>
-				</description>
-				<visibility value='readwrite'/>
-				<cardinality min='1' max='1'/>
-			</prop_pattern>
-			<prop_pattern name='modules' type='astring'
-			    required='false'>
-				<common_name>
-					<loctext xml:lang='C'>
-STREAMS modules
-					</loctext>
-				</common_name>
-				<description>
-					<loctext xml:lang='C'>
-STREAMS modules to be pushed on the terminal
-					</loctext>
-				</description>
-				<visibility value='readwrite'/>
-				<internal_separators>,</internal_separators>
-			</prop_pattern>
-			<prop_pattern name='prompt' type='astring'
-			    required='false'>
-				<description>
-					<loctext xml:lang='C'>
-Prompt to be printed on console
-					</loctext>
-				</description>
-				<visibility value='readwrite'/>
-				<cardinality min='1' max='1'/>
-			</prop_pattern>
-			<prop_pattern name='terminal_type' type='astring'
-			    required='false'>
-				<description>
-					<loctext xml:lang='C'>
-Sets the initial value of the TERM environment variable
-					</loctext>
-				</description>
-				<visibility value='readwrite'/>
-				<cardinality min='1' max='1'/>
-			</prop_pattern>
-		</pg_pattern>
-
-	</template>
-</service>
-
-</service_bundle>
diff --git a/overlay/generic/lib/svc/manifest/system/coreadm.xml b/overlay/generic/lib/svc/manifest/system/coreadm.xml
deleted file mode 100644
index c6198f88..00000000
--- a/overlay/generic/lib/svc/manifest/system/coreadm.xml
+++ /dev/null
@@ -1,134 +0,0 @@
-<?xml version="1.0"?>
-<!DOCTYPE service_bundle SYSTEM "/usr/share/lib/xml/dtd/service_bundle.dtd.1">
-<!--
- Copyright 2008 Sun Microsystems, Inc.  All rights reserved.
- Use is subject to license terms.
-
- CDDL HEADER START
-
- The contents of this file are subject to the terms of the
- Common Development and Distribution License (the "License").
- You may not use this file except in compliance with the License.
-
- You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
- or http://www.opensolaris.org/os/licensing.
- See the License for the specific language governing permissions
- and limitations under the License.
-
- When distributing Covered Code, include this CDDL HEADER in each
- file and include the License file at usr/src/OPENSOLARIS.LICENSE.
- If applicable, add the following below this CDDL HEADER, with the
- fields enclosed by brackets "[]" replaced with your own identifying
- information: Portions Copyright [yyyy] [name of copyright owner]
-
- CDDL HEADER END
-
-	NOTE:  This service manifest is not editable; its contents will
-	be overwritten by package or patch operations, including
-	operating system upgrade.  Make customizations in a different
-	file.
-
-	Service manifest for coreadm.
--->
-
-<service_bundle type='manifest' name='SUNWcsr:coreadm'>
-
-<service
-	name='system/coreadm'
-	type='service'
-	version='1'>
-
-	<single_instance />
-
-	<dependency
-		name='usr'
-		type='service'
-		grouping='require_all'
-		restart_on='none'>
-		<service_fmri value='svc:/system/filesystem/minimal' />
-	</dependency>
-
-	<dependency
-		name='coreadm_manifest-import'
-		type='service'
-		grouping='require_all'
-		restart_on='none'>
-		<service_fmri value='svc:/system/manifest-import:default' />
-	</dependency>
-
-	<instance name='default' enabled='false'>
-		<exec_method
-			type='method'
-			name='start'
-			exec='/usr/bin/coreadm -U'
-			timeout_seconds='60' />
-
-		<exec_method
-			type='method'
-			name='refresh'
-			exec='/usr/bin/coreadm -U'
-			timeout_seconds='60' />
-
-		<exec_method
-			type='method'
-			name='stop'
-			exec=':true'
-			timeout_seconds='60' />
-
-		<property_group name='startd' type='framework'>
-			<propval name='duration' type='astring'
-				value='transient' />
-		</property_group>
-
-		<property_group name='general' type='framework'>
-			<propval name='action_authorization' type='astring'
-				value='solaris.smf.manage.coreadm' />
-			<propval name='value_authorization' type='astring'
-				value='solaris.smf.manage.coreadm' />
-		</property_group>
-
-		<property_group name='config_params' type='application'>
-			<propval name='value_authorization' type='astring'
-				value='solaris.smf.value.coreadm' />
-
-			<propval name='global_pattern'
-				type='astring' value='/%Z/cores/core.%f.%p' />
-			<propval name='global_content'
-				type='astring' value='default' />
-			<propval name='init_pattern'
-				type='astring' value='/%Z/cores/core.%f.%p' />
-			<propval name='init_content'
-				type='astring' value='default' />
-			<propval name='global_enabled'
-				type='boolean' value='true' />
-			<propval name='process_enabled'
-				type='boolean' value='false' />
-			<propval name='global_setid_enabled'
-				type='boolean' value='false' />
-			<propval name='process_setid_enabled'
-				type='boolean' value='false' />
-			<propval name='global_log_enabled'
-				type='boolean' value='false' />
-		</property_group>
-	</instance>
-
-	<stability value='Unstable' />
-
-	<template>
-		<common_name>
-			<loctext xml:lang='C'>
-				system-wide core file configuration
-			</loctext>
-		</common_name>
-
-		<documentation>
-			<manpage
-				title='coreadm'
-				section='1M'
-				manpath='/usr/share/man' />
-		</documentation>
-	</template>
-
-</service>
-
-</service_bundle>
diff --git a/overlay/generic/lib/svc/manifest/system/filesystem/joyent-fs.xml b/overlay/generic/lib/svc/manifest/system/filesystem/joyent-fs.xml
deleted file mode 100644
index 3d004e8d..00000000
--- a/overlay/generic/lib/svc/manifest/system/filesystem/joyent-fs.xml
+++ /dev/null
@@ -1,85 +0,0 @@
-<?xml version="1.0"?>
-<!DOCTYPE service_bundle SYSTEM "/usr/share/lib/xml/dtd/service_bundle.dtd.1">
-<!--
- Copyright 2005 Sun Microsystems, Inc.  All rights reserved.
- Use is subject to license terms.
-
- CDDL HEADER START
-
- The contents of this file are subject to the terms of the
- Common Development and Distribution License, Version 1.0 only
- (the "License").  You may not use this file except in compliance
- with the License.
-
- You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
- or http://www.opensolaris.org/os/licensing.
- See the License for the specific language governing permissions
- and limitations under the License.
-
- When distributing Covered Code, include this CDDL HEADER in each
- file and include the License file at usr/src/OPENSOLARIS.LICENSE.
- If applicable, add the following below this CDDL HEADER, with the
- fields enclosed by brackets "[]" replaced with your own identifying
- information: Portions Copyright [yyyy] [name of copyright owner]
-
- CDDL HEADER END
--->
-
-<service_bundle type='manifest' name='SUNWcsr:filesystem-joyent'>
-
-<service
-	name='system/filesystem/smartdc'
-	type='service'
-	version='1'>
-
-	<create_default_instance enabled='true' />
-
-	<single_instance/>
-
-	<dependency
-		name='usr'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/system/filesystem/usr' />
-	</dependency>
-
-	<!--
-	  Start method timeout is infinite to handle potentially unbounded
-	  fsck times.
-        -->
-	<exec_method
-		type='method'
-		name='start'
-		exec='/lib/svc/method/fs-joyent'
-		timeout_seconds='0' />
-
-	<exec_method
-		type='method'
-		name='stop'
-		exec=':true'
-		timeout_seconds='0' />
-
-	<property_group name='startd' type='framework'>
-		<propval name='duration' type='astring' value='transient' />
-	</property_group>
-	<property_group name='joyentfs' type='application'>
-      <stability value='Evolving'/>
-      <propval name='debug' type='boolean' value='false'/>
-      <propval name='usb_copy_path' type='astring' value='/usbkey'/>
-      <propval name='usb_mountpoint' type='astring' value='usbkey'/>
-    </property_group>
-
-
-	<stability value='Unstable' />
-
-	<template>
-		<common_name>
-			<loctext xml:lang='C'>
-				Joyent file system mounts
-			</loctext>
-		</common_name>
-	</template>
-</service>
-
-</service_bundle>
diff --git a/overlay/generic/lib/svc/manifest/system/filesystem/minimal-fs.xml b/overlay/generic/lib/svc/manifest/system/filesystem/minimal-fs.xml
deleted file mode 100644
index 844760ba..00000000
--- a/overlay/generic/lib/svc/manifest/system/filesystem/minimal-fs.xml
+++ /dev/null
@@ -1,93 +0,0 @@
-<?xml version="1.0"?>
-<!DOCTYPE service_bundle SYSTEM "/usr/share/lib/xml/dtd/service_bundle.dtd.1">
-<!--
- Copyright 2005 Sun Microsystems, Inc.  All rights reserved.
- Use is subject to license terms.
-
- CDDL HEADER START
-
- The contents of this file are subject to the terms of the
- Common Development and Distribution License, Version 1.0 only
- (the "License").  You may not use this file except in compliance
- with the License.
-
- You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
- or http://www.opensolaris.org/os/licensing.
- See the License for the specific language governing permissions
- and limitations under the License.
-
- When distributing Covered Code, include this CDDL HEADER in each
- file and include the License file at usr/src/OPENSOLARIS.LICENSE.
- If applicable, add the following below this CDDL HEADER, with the
- fields enclosed by brackets "[]" replaced with your own identifying
- information: Portions Copyright [yyyy] [name of copyright owner]
-
- CDDL HEADER END
-
-	ident	"%Z%%M%	%I%	%E% SMI"
-
-	NOTE:  This service manifest is not editable; its contents will
-	be overwritten by package or patch operations, including
-	operating system upgrade.  Make customizations in a different
-	file.
--->
-
-<service_bundle type='manifest' name='SUNWcsr:filesystem-minimal'>
-
-<service
-	name='system/filesystem/minimal'
-	type='service'
-	version='1'>
-
-	<create_default_instance enabled='true' />
-
-	<single_instance/>
-
-	<dependency
-		name='joyent'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/system/filesystem/smartdc' />
-	</dependency>
-
-	<dependency
-		name='devices'
-		grouping='require_all'
-		restart_on='none'
-		type='service'>
-		<service_fmri value='svc:/system/device/local' />
-	</dependency>
-
-	<!--
-	  Start method timeout is infinite to handle potentially unbounded
-	  fsck times.
-        -->
-	<exec_method
-		type='method'
-		name='start'
-		exec='/lib/svc/method/fs-minimal'
-		timeout_seconds='0' />
-
-	<exec_method
-		type='method'
-		name='stop'
-		exec=':true'
-		timeout_seconds='0' />
-
-	<property_group name='startd' type='framework'>
-		<propval name='duration' type='astring' value='transient' />
-	</property_group>
-
-	<stability value='Unstable' />
-
-	<template>
-		<common_name>
-			<loctext xml:lang='C'>
-				minimal file system mounts
-			</loctext>
-		</common_name>
-	</template>
-</service>
-
-</service_bundle>
diff --git a/overlay/generic/lib/svc/manifest/system/mdata.xml b/overlay/generic/lib/svc/manifest/system/mdata.xml
deleted file mode 100644
index 152a7cb4..00000000
--- a/overlay/generic/lib/svc/manifest/system/mdata.xml
+++ /dev/null
@@ -1,39 +0,0 @@
-<?xml version="1.0"?>
-<!DOCTYPE service_bundle SYSTEM "/usr/share/lib/xml/dtd/service_bundle.dtd.1">
-<service_bundle type="manifest" name="mdata">
-  <service name="smartdc/mdata" type="service" version="1">
-    <dependency name="filesystem" grouping="require_all" restart_on="error" type="service">
-      <service_fmri value="svc:/system/filesystem/minimal" />
-    </dependency>
-    <property_group name="startd" type="framework">
-      <propval name="duration" type="astring" value="transient" />
-      <propval name="ignore_error" type="astring" value="core,signal" />
-    </property_group>
-    <instance name="fetch" enabled="true">
-      <dependency name="boot-file" grouping="exclude_all" restart_on="refresh" type="path">
-        <service_fmri value="file://localhost/tmp/.FIRST_REBOOT_NOT_YET_COMPLETE"/>
-      </dependency>
-      <dependency name="rmtmpfiles" grouping="optional_all" restart_on="error" type="service">
-        <service_fmri value="svc:/system/rmtmpfiles" />
-      </dependency>
-      <exec_method type="method" name="start" exec="/lib/svc/method/mdata-fetch" timeout_seconds="1800" />
-      <exec_method type="method" name="stop" exec=":true" timeout_seconds="60" />
-    </instance>
-    <instance name="execute" enabled="false">
-      <dependency name="network" grouping="require_all" restart_on="error" type="service">
-        <service_fmri value="svc:/milestone/multi-user:default" />
-      </dependency>
-      <dependency name="mdata" grouping="require_all" restart_on="error" type="service">
-        <service_fmri value="svc:/smartdc/mdata:fetch" />
-      </dependency>
-      <exec_method type="method" name="start" exec="/lib/svc/method/mdata-execute" timeout_seconds="300" />
-      <exec_method type="method" name="stop" exec=":true" timeout_seconds="60" />
-    </instance>
-    <stability value="Evolving" />
-    <template>
-      <common_name>
-        <loctext xml:lang="C">Joyent SDC metadata handler</loctext>
-      </common_name>
-    </template>
-  </service>
-</service_bundle>
diff --git a/overlay/generic/lib/svc/manifest/system/smartdc-config.xml b/overlay/generic/lib/svc/manifest/system/smartdc-config.xml
deleted file mode 100644
index bf84d199..00000000
--- a/overlay/generic/lib/svc/manifest/system/smartdc-config.xml
+++ /dev/null
@@ -1,145 +0,0 @@
-<?xml version="1.0"?>
-<!DOCTYPE service_bundle SYSTEM "/usr/share/lib/xml/dtd/service_bundle.dtd.1">
-<!--
- Copyright 2011 Joyent, Inc.  All rights reserved.
- Use is subject to license terms.
-
- CDDL HEADER START
-
- The contents of this file are subject to the terms of the
- Common Development and Distribution License (the "License").
- You may not use this file except in compliance with the License.
-
- You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
- or http://www.opensolaris.org/os/licensing.
- See the License for the specific language governing permissions
- and limitations under the License.
-
- When distributing Covered Code, include this CDDL HEADER in each
- file and include the License file at usr/src/OPENSOLARIS.LICENSE.
- If applicable, add the following below this CDDL HEADER, with the
- fields enclosed by brackets "[]" replaced with your own identifying
- information: Portions Copyright [yyyy] [name of copyright owner]
-
- CDDL HEADER END
-
-    NOTE:  This service manifest is not editable; its contents will
-    be overwritten by package or patch operations, including
-    operating system upgrade.  Make customizations in a different
-    file.
--->
-
-<service_bundle type='manifest' name='smartdc:config'>
-
-<!--
-	This service applies inital configuration for the GZ in smartdc.
--->
-<service
-	name='system/smartdc/config'
-	type='service'
-	version='1'>
-
-	<create_default_instance enabled='true' />
-
-	<single_instance />
-
-	<!--
-	dependency/dependent info
-	We need to wait for fs-joyent to be done so we can access the USB key
-	We need to run before sysconfig so interactive configuration can talk
-	on the console
-		(sysconfig)
-	We don't want anything else running which spews on console
-		(system/identy)
-	We don't want manifest import scribbling on the console while running
-		(manifest-import)
-	network/physical can't run without a config file
-		(network/physical)
-	-->
-	<dependency
-		name='filesystem-joyent'
-		type='service'
-		grouping='require_all'
-		restart_on='none'>
-		<service_fmri value='svc:/system/filesystem/smartdc' />
-	</dependency>
-
-	<!--
-	We don't want ssh starting if we haven't updated the passwords/keys
-	-->
-	<dependent
-		name='ssh_multi-user-server'
-		grouping='require_all'
-		restart_on='none'>
-		<service_fmri value='svc:/network/ssh' />
-	</dependent>
-
-	<!-- Make ntp wait so we can setup the config. -->
-	<dependent
-		name='ntp'
-		grouping='require_all'
-		restart_on='none'>
-		<service_fmri value='svc:/network/ntp' />
-	</dependent>
-
-	<dependent
-		name='headnode_config'
-		grouping='optional_all'
-		restart_on='none'>
-		<service_fmri value='svc:/milestone/sysconfig' />
-	</dependent>
-
-	<dependent
-		name='identity'
-		grouping='optional_all'
-		restart_on='none'>
-                <service_fmri value='svc:/system/identity:node' /> 
-        </dependent>   
-
-	<dependent
-		name='headnode_no_output'
-		grouping='optional_all'
-		restart_on='none'>
-		<service_fmri value='svc:/system/manifest-import' />
-	</dependent>
-
-	<dependent
-		name='network-physical'
-		grouping='optional_all'
-		restart_on='none'>
-		<service_fmri value='svc:/network/physical:default' />
-	</dependent>
-
-	<exec_method
-		type='method'
-		name='start'
-		exec='/lib/svc/method/smartdc-config %m'
-		timeout_seconds='0'>
-	</exec_method>
-
-	<exec_method
-		type='method'
-		name='stop'
-		exec='/lib/svc/method/smartdc-config %m'
-		timeout_seconds='60'>
-	</exec_method>
-
-	<property_group name='startd' type='framework'>
-		<propval name='duration' type='astring' value='transient' />
-	</property_group>
-
-	<stability value='Unstable' />
-
-	<template>
-		<common_name>
-			<loctext xml:lang='C'>
-			SmartDC live-image config management service
-			</loctext>
-		</common_name>
-		<documentation>
-			<manpage title='smartdc' section='5' manpath='/usr/share/man' />
-		</documentation>
-	</template>
-</service>
-
-</service_bundle>
diff --git a/overlay/generic/lib/svc/manifest/system/smartdc-init.xml b/overlay/generic/lib/svc/manifest/system/smartdc-init.xml
deleted file mode 100644
index 266aac53..00000000
--- a/overlay/generic/lib/svc/manifest/system/smartdc-init.xml
+++ /dev/null
@@ -1,124 +0,0 @@
-<?xml version="1.0"?>
-<!DOCTYPE service_bundle SYSTEM "/usr/share/lib/xml/dtd/service_bundle.dtd.1">
-<!--
- Copyright 2012 Joyent, Inc.  All rights reserved.
- Use is subject to license terms.
-
- CDDL HEADER START
-
- The contents of this file are subject to the terms of the
- Common Development and Distribution License (the "License").
- You may not use this file except in compliance with the License.
-
- You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
- or http://www.opensolaris.org/os/licensing.
- See the License for the specific language governing permissions
- and limitations under the License.
-
- When distributing Covered Code, include this CDDL HEADER in each
- file and include the License file at usr/src/OPENSOLARIS.LICENSE.
- If applicable, add the following below this CDDL HEADER, with the
- fields enclosed by brackets "[]" replaced with your own identifying
- information: Portions Copyright [yyyy] [name of copyright owner]
-
- CDDL HEADER END
-
-    NOTE:  This service manifest is not editable; its contents will
-    be overwritten by package or patch operations, including
-    operating system upgrade.  Make customizations in a different
-    file.
--->
-
-<service_bundle type='manifest' name='Joyent:joyent'>
-
-<!--
-	This service imports the zone's zpool on bootup, before zones try to
-	start.  It also sets up configuration data on that zpool, if necessary.
--->
-<service
-	name='system/smartdc/init'
-	type='service'
-	version='1'>
-
-	<create_default_instance enabled='true' />
-
-	<single_instance />
-
-	<!--
-	dependency info
-	This depends on the system/zones svc which seems weird since that
-	svc runs late in boot because it depends on milestone/multi-user-server.
-	Our svc does the initial setup of the infrastructure zones on the
-	headnode so we need the system/zones svc to run first so that we can
-	install and boot the infrastructure zones.  The reason this seems
-	weird is that this svc also sets up the zpool when we first boot,
-	before we reboot to install the infrastructure zones, so it might seem
-	like it should run early in boot, but it can't because of the zone
-	issue described above.
-
-	The dependency on network/physical is needed since all of the earlier
-	svcs which have a dependency on network/physical are using optional_all.
-	That makes sense for those svcs since they can come up without a
-	network, but for SmartOS, by this point we require the network to be
-	there.
-	-->
-	<dependency
-		name='zones'
-		type='service'
-		grouping='require_all'
-		restart_on='none'>
-		<service_fmri value='svc:/system/zones' />
-	</dependency>
-
-        <dependency
-		name='net-physical'
-		type='service'
-		grouping='require_all'
-		restart_on='none'>
-		<service_fmri value='svc:/network/physical' />
-	</dependency>
-
-	<exec_method
-		type='method'
-		name='start'
-		exec='/lib/svc/method/smartdc-init %m'
-		timeout_seconds='0'>
-	</exec_method>
-
-	<exec_method
-		type='method'
-		name='stop'
-		exec='/lib/svc/method/smartdc-init %m'
-		timeout_seconds='60'>
-	</exec_method>
-
-	<property_group name='startd' type='framework'>
-		<propval name='duration' type='astring' value='transient' />
-	</property_group>
-
-	<!--
-		The zpool holding the zones (this must be imported).
-	-->
-	<property_group name='config' type='application'>
-		<propval name='zpool' type='astring' value='zones' />
-	</property_group>
-
-	<stability value='Unstable' />
-
-	<template>
-		<common_name>
-			<loctext xml:lang='C'>
-			Joyent live-image management service
-			</loctext>
-		</common_name>
-		<documentation>
-			<manpage title='zones' section='5' manpath='/usr/share/man' />
-			<manpage
-				title='zpool'
-				section='1M'
-				manpath='/usr/share/man' />
-		</documentation>
-	</template>
-</service>
-
-</service_bundle>
diff --git a/overlay/generic/lib/svc/manifest/system/smartdc-ur.xml b/overlay/generic/lib/svc/manifest/system/smartdc-ur.xml
deleted file mode 100644
index 7ee78dcb..00000000
--- a/overlay/generic/lib/svc/manifest/system/smartdc-ur.xml
+++ /dev/null
@@ -1,62 +0,0 @@
-<?xml version="1.0"?>
-<!DOCTYPE service_bundle SYSTEM "/usr/share/lib/xml/dtd/service_bundle.dtd.1">
-<!--
-    This Source Code Form is subject to the terms of the Mozilla Public
-    License, v. 2.0. If a copy of the MPL was not distributed with this
-    file, You can obtain one at http://mozilla.org/MPL/2.0/.
--->
-
-<!--
-    Copyright (c) 2014, Joyent, Inc.
--->
-
-<service_bundle type="manifest" name="ur">
-  <service name="smartdc/agent/ur" type="service" version="0.0.1">
-
-    <create_default_instance enabled="true"/>
-    <single_instance/>
-
-    <dependency name="smartdc-init" grouping="require_all" restart_on="error" type="service">
-      <service_fmri value="svc:/milestone/single-user"/>
-    </dependency>
-
-    <exec_method
-      type="method"
-      name="start"
-      exec="/lib/svc/method/smartdc-ur %m"
-      timeout_seconds="60">
-      <method_context>
-        <method_credential user="root" group="staff"/>
-      </method_context>
-    </exec_method>
-
-    <exec_method type="method" name="restart" exec=":kill" timeout_seconds="60">
-      <method_context>
-        <method_credential user="root" group="staff"/>
-      </method_context>
-    </exec_method>
-
-    <exec_method type="method" name="stop" exec=":kill" timeout_seconds="60">
-      <method_context>
-        <method_credential user="root" group="staff"/>
-      </method_context>
-    </exec_method>
-
-    <property_group name="startd" type="framework">
-      <propval name="ignore_error" type="astring" value="core,signal"/>
-    </property_group>
-
-    <property_group name="application" type="application">
-    </property_group>
-
-    <stability value="Evolving"/>
-
-    <template>
-      <common_name>
-        <loctext xml:lang="C">Ur Agent (node)</loctext>
-      </common_name>
-    </template>
-
-  </service>
-
-</service_bundle>
diff --git a/overlay/generic/lib/svc/manifest/system/sysidtool.xml b/overlay/generic/lib/svc/manifest/system/sysidtool.xml
deleted file mode 100644
index 25ead0ea..00000000
--- a/overlay/generic/lib/svc/manifest/system/sysidtool.xml
+++ /dev/null
@@ -1,161 +0,0 @@
-<?xml version="1.0"?>
-<!DOCTYPE service_bundle SYSTEM "/usr/share/lib/xml/dtd/service_bundle.dtd.1">
-<!--
-    Copyright 2004 Sun Microsystems, Inc.  All rights reserved.
-    Use is subject to license terms.
-
-    ident	"@(#)sysidtool.xml 1.2	04/12/09 SMI"
--->
-
-<!--
-    This bundle delivers two service instances: sysidtool:net and
-    sysidtool:system.  These take care of running the system identity
-    tools.  The sysconfig milestone is dependent upon these services.
-    A slightly unusual situation arises here because
-    of the cross-consolidation boundary.  While needed quite early in
-    boot, this is *not* part of the seed repository.  On first boot after
-    install, the system may block for a while, while the import-manifests
-    method is running.  Once this manifest is acquired, console-login's
-    dependency can be satisfied by running these services:
-
-	*network* -> identity ->
-		sysidtool:net -> sysidtool:system -> sysconfig -> console-login
-
--->
-<service_bundle type='manifest' name='SUNWadmr:sysidtool'>
-
-<service
-	name='system/sysidtool'
-	type='service'
-	version='1'>
-
-	<dependency name='fs'
-	    grouping='require_all'
-	    restart_on='none'
-	    type='service'>
-		<service_fmri
-		    value='svc:/system/filesystem/minimal:default' />
-	</dependency>
-
-	<dependency name='identity'
-	    grouping='require_all'
-	    restart_on='none'
-	    type='service'>
-		<service_fmri
-		    value='svc:/system/identity:node'/>
-		<service_fmri
-		    value='svc:/system/identity:domain'/>
-	</dependency>
-
-	<property_group name='startd' type='framework'>
-		<propval name='duration' type='astring'
-			value='transient' />
-	</property_group>
-
-	<instance name='net' enabled='true'>
-
-		<dependency name='single-user'
-			grouping='require_all'
-			restart_on='none'
-			type='service'>
-			<service_fmri
-				value='svc:/milestone/single-user:default'/>
-		</dependency>
-
-		<dependency name='filesystem_local'
-			grouping='require_all'
-			restart_on='none'
-			type='service'>
-			<service_fmri
-				value='svc:/system/filesystem/local:default'/>
-		</dependency>
-
-		<dependent
-			name='sysidtoolnet_sysconfig'
-			grouping='optional_all'
-			restart_on='none'>
-			<service_fmri value='svc:/milestone/sysconfig' />
-		</dependent>
-
-		<exec_method
-			type='method'
-			name='start'
-			exec='/bin/true'
-			timeout_seconds='0' />
-
-		<exec_method
-                        type='method'
-                        name='stop'
-                        exec=':true'
-                        timeout_seconds='0' />
-	</instance>
-
-	<instance name='system' enabled='true'>
-
-		<dependency name='single-user'
-			grouping='require_all'
-			restart_on='none'
-			type='service'>
-			<service_fmri
-				value='svc:/milestone/single-user:default'/>
-		</dependency>
-
-		<dependency name='filesystem_local'
-			grouping='require_all'
-			restart_on='none'
-			type='service'>
-			<service_fmri
-				value='svc:/system/filesystem/local:default'/>
-		</dependency>
-
-                <dependency name='sysidnet'
-                    grouping='require_all'
-                    restart_on='none'
-                    type='service'>
-                        <service_fmri
-                            value='svc:/system/sysidtool:net'/>
-                </dependency>
-
-                <dependency name='rpcbind'
-                    grouping='optional_all'
-                    restart_on='none'
-                    type='service'>
-                        <service_fmri
-                            value='svc:/network/rpc/bind:default'/>
-                </dependency>
-
-		<dependent
-			name='sysidtoolsystem_sysconfig'
-			grouping='optional_all'
-			restart_on='none'>
-			<service_fmri value='svc:/milestone/sysconfig' />
-		</dependent>
-
-		<exec_method
-			type='method'
-			name='start'
-			exec='/bin/true'
-			timeout_seconds='0' />
-
-		<exec_method
-			type='method'
-			name='stop'
-			exec=':true'
-			timeout_seconds='0' />
-	</instance>
-
-	<stability value='Unstable' />
-
-	<template>
-		<common_name>
-			<loctext xml:lang='C'>
-			sysidtool
-			</loctext>
-		</common_name>
-		<documentation>
-			<manpage title='sysidtool' section='1M' manpath='/usr/man' />
-		</documentation>
-	</template>
-</service>
-
-</service_bundle>
diff --git a/overlay/generic/lib/svc/method/console-login b/overlay/generic/lib/svc/method/console-login
deleted file mode 100755
index 8ddaaf29..00000000
--- a/overlay/generic/lib/svc/method/console-login
+++ /dev/null
@@ -1,110 +0,0 @@
-#!/sbin/sh
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-
-#
-# Copyright 2008 Sun Microsystems, Inc.  All rights reserved.
-# Use is subject to license terms.
-# Copyright 2015 Joyent, Inc.
-#
-# This method script manages all vt logins including system
-# console login.
-#
-# For modifying parameters passed to ttymon, do not edit
-# this script. Instead use svccfg(1m) to modify the SMF
-# repository. For example:
-#
-# # svccfg
-# svc:> select system/console-login
-# svc:/system/console-login> setprop ttymon/terminal_type = "xterm"
-# svc:/system/console-login> exit
-
-. /lib/svc/share/smf_include.sh
-
-getproparg() {
-	val=`svcprop -p $2 $SMF_FMRI`
-	[ -n "$val" ] && [ "$val" != "\"\"" ] && echo $1 $val
-}
-
-# The service configuration invokes this script with "%i", the name of the
-# instance, as the first argument.
-instance="$1"
-if [ -z "$instance" ]; then
-	exit $SMF_EXIT_ERR_CONFIG
-fi
-
-case "$instance" in
-vt*)
-	# This instance is for one of the virtual terminal devices.  Check to
-	# see if the vt subsystem is initialised:
-	if smf_dont_configure_vt; then
-		/usr/sbin/svcadm disable "$SMF_FMRI"
-		exit $SMF_EXIT_OK
-	fi
-	;;
-esac
-
-args="-g"
-
-val=`svcprop -p ttymon/device $SMF_FMRI`
-# if this isn't set, recover a little
-[ -z "$val" ] && val="/dev/console"
-
-if [ "$val" = "/dev/vt/1" ]; then
-	echo "ERROR: ttymon/device cannot be configured to /dev/vt/1."
-	exit $SMF_EXIT_ERR_CONFIG
-fi
-
-# In SmartOS we use ttyb for metadata so we set to a non-existent device here
-# to disable the service and exit.
-if [[ ${val} == "/dev/term/b" && \
-    $(sysinfo | json "Product") == "SmartDC HVM" ]]; then
-
-    val=/dev/do_not_use_ttyb_in_a_vm
-fi
-
-if [[ ! -e $val ]]; then
-    # This device doesn't exist, can't run a tty on it.
-    /usr/sbin/svcadm disable $SMF_FMRI
-    exit $SMF_EXIT_OK
-fi
-
-args="$args -d $val"
-
-args="$args `getproparg -l ttymon/label`"
-
-args="$args `getproparg -T ttymon/terminal_type`"
-
-args="$args `getproparg -m ttymon/modules`"
-
-val=`svcprop -p ttymon/nohangup $SMF_FMRI`
-[ "$val" = "true" ] && args="$args -h"
-
-val=`svcprop -p ttymon/timeout $SMF_FMRI`
-[ -n "$val" -a "$val" != "0" ] && args="$args -t $val"
-
-val=`svcprop -p ttymon/prompt $SMF_FMRI`
-if [ -n "$val" ]; then
-	prompt=`eval echo $val`
-	exec /usr/lib/saf/ttymon $args -p "`eval echo $prompt` "
-else
-	exec /usr/lib/saf/ttymon $args
-fi
diff --git a/overlay/generic/lib/svc/method/fs-joyent b/overlay/generic/lib/svc/method/fs-joyent
deleted file mode 100755
index 9082f22e..00000000
--- a/overlay/generic/lib/svc/method/fs-joyent
+++ /dev/null
@@ -1,288 +0,0 @@
-#!/bin/bash
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2018, Joyent, Inc.
-#
-
-set -o xtrace
-
-fatal()
-{
-    echo "Error: $1"
-    exit $SMF_EXIT_ERR_FATAL
-}
-
-. /lib/svc/share/smf_include.sh
-. /lib/svc/share/fs_include.sh
-. /lib/sdc/usb-key.sh
-
-# first of all, if we aren't the global zone this doesn't make any sense to run
-
-smf_is_globalzone || exit $SMF_EXIT_OK
-
-# We need the links to /dev/dsk. Rather than trying to play games with manually
-# invoking syseventd ask devfsadm to do some work.
-/usr/sbin/devfsadm -c disk
-
-function destroy_zpools
-{
-    for pool in $(zpool list -p -o name | grep -v NAME) ; do
-        zpool destroy -f ${pool}
-    done
-}
-
-function mount_zfs
-{
-    local dataset=$1
-    local mountpoint=$2
-    local output=
-
-    #
-    # Try to mount the ZFS dataset.  If the mountpoint is busy, wait five
-    # seconds and try again.  Fail if the mount attempt returns EBUSY three
-    # consecutive times.
-    #
-    for i in {1..3}; do
-        output=$(mount -F zfs ${dataset} ${mountpoint} 2>&1)
-        if [[ $? -eq 0 ]]; then
-            break
-        fi
-
-        if [ "${output}" == "mount failed: Device busy" ]; then
-            sleep 5
-        else
-            echo ${output} 1>&2
-            return
-        fi
-    done
-
-    # The mount attempt must have failed
-    echo ${output} 1>&2
-}
-
-/bin/bootparams | grep "^noimport=true" >/dev/null
-if [ $? -ne 0 ]; then
-    # If the zpool doesn't exist, then there's nothing to mount.
-
-    # Assume the system zpool is zones, but if a different system pool
-    # identifies itself (by virtue of the .system_pool file being present in the
-    # pool's root dataset), then use that system pool instead.
-    SYS_ZPOOL=zones
-
-    # Import specified zpools, or all zpools available
-    pools=$(/bin/bootparams | egrep "^zpools?=" | cut -d= -f2 | tr , ' ')
-    if [ -z ${pools} ]; then
-         pools=$(zpool import | grep "pool:" | awk '{print $2}')
-    fi
-
-    for pool in $pools; do
-        zpool import -f $pool
-	# Due to early, failed attempts to support the filesystem_limits
-	# feature we now need to ensure the dependent feature is enabled.
-	zpool set feature@extensible_dataset=enabled $pool
-        if [[ -f /$pool/.system_pool ]]; then
-            SYS_ZPOOL=$pool
-        fi
-    done
-
-    svccfg -s svc:/system/smartdc/init setprop \
-        config/zpool=${SYS_ZPOOL}
-    svccfg -s svc:/system/smartdc/init:default refresh
-
-    # If the destroy_zpools boot parameter is set, destroy all zpools
-    /bin/bootparams | grep "^destroy_zpools=true" >/dev/null
-    if [ $? -eq 0 ]; then
-        destroy_zpools
-    fi
-
-    # A machine is reset to its original unsetup state (i.e. a 'factory reset')
-    # when the smartdc:factoryreset ZFS user property is set on the var dataset.
-    reset=$(zfs get -H -o value smartdc:factoryreset ${SYS_ZPOOL}/var)
-    if [ "${reset}" == "yes" ]; then
-        destroy_zpools
-    fi
-
-    # Capture the zpool's status output in the method's log file for
-    # troubleshooting.
-    #
-    # Note: It is critical that we do not run 'status -v'. If there are errors
-    # in the zpool error log and the zpool is large (e.g. > 200TB), then the
-    # lookup for the error file names can take a very long time (several hours).
-    # This would block the system boot until it completed.
-    zpool status ${SYS_ZPOOL}
-    if [ $? -eq 0 ]; then
-
-        # Stash the SUNWdefault.xml file so we can update the
-        # persistent version after mounting zones/config.
-        cp /etc/zones/SUNWdefault.xml /tmp/
-
-        # Mount and configure all system datasets
-        mount_zfs ${SYS_ZPOOL}/var /var
-        mount_zfs ${SYS_ZPOOL}/config /etc/zones
-        mount_zfs ${SYS_ZPOOL}/opt /opt
-
-        # Update the the persistent SUNWdefault.xml file to match the
-        # contents on ramdisk now that zones/config is mounted.
-        cp /tmp/SUNWdefault.xml /etc/zones/
-        rm -f /tmp/SUNWdefault.xml
-
-        #
-        # We include a manifest of all files shipped in the platform image,
-        # along with an MD5 hash of their contents.  This was originally
-        # shipped as "/var/log/manifest", but once a machine is set up, "/var"
-        # now comes from the pool.  The upshot of this is that every SmartOS
-        # machine has the manifest from the platform at setup time stored in
-        # "/var/log/manifest".  Now that the manifest has moved to an
-        # accessible location, we should remove this file and replace it with a
-        # symbolic link.
-        #
-        if [[ -f '/var/log/manifest' && ! -L '/var/log/manifest' &&
-            ! -e '/var/log/manifest.original' ]]; then
-                mv '/var/log/manifest' '/var/log/manifest.original'
-                ln -s '../../usr/share/smartos/manifest' '/var/log/manifest'
-        fi
-
-        if [[ -z $(/bin/bootparams | grep '^smartos=true') ]]; then
-            mkdir -p /opt/smartdc/agents/smf
-            mount -O -F lofs /var/svc/manifest/site /opt/smartdc/agents/smf
-        fi
-
-        if [[ -n $(/bin/bootparams | grep '^headnode=true') || \
-            -n $(/bin/bootparams | grep '^smartos=true') ]]; then
-            mkdir /usbkey
-            mount_zfs ${SYS_ZPOOL}/usbkey /usbkey
-        fi
-
-        if [[ -n $(/bin/bootparams | grep '^smartos=true') ]]; then
-            mount -F lofs /usbkey/shadow /etc/shadow
-            mount -F lofs /usbkey/ssh /etc/ssh
-        fi
-
-        swap -a /dev/zvol/dsk/${SYS_ZPOOL}/swap || \
-            fatal "failed to configure swap device"
-
-        #
-        # Configure the dump device on top of a ZFS volume.  In addition to the
-        # usual dumpadm(1m) call, there are two prerequisites for using this
-        # volume as a dump device: (1) that zvol must be using the noparity
-        # checksum algorithem, and (2) the MULTI_VDEV_CRASH_DUMP ZFS feature
-        # must be enabled.  Prerequisite (1) is necessary since the exact
-        # on-disk value for ZIO_CHECKSUM_NOPARITY has changed, so to avoid a
-        # flag day on all systems, this service just sets that property again
-        # every time.
-        #
-        zfs set checksum=noparity ${SYS_ZPOOL}/dump || \
-            fatal "failed to set checksum=noparity on dump zvol"
-        zpool set feature@multi_vdev_crash_dump=enabled ${SYS_ZPOOL} || \
-            fatal "failed to enable multi_vdev_crash_dump ZFS feature"
-        dumpadm -y -d /dev/zvol/dsk/${SYS_ZPOOL}/dump || \
-            fatal "failed to configure dump device"
-
-        zfs list -H -o name ${SYS_ZPOOL}/cores/global >/dev/null 2>&1
-        if [ $? -ne 0 ]; then
-            # Booting for the first time on a CN whose cores dataset is setup
-            # in the 6.x style.  Convert to the new style.
-            zfs destroy -r ${SYS_ZPOOL}/cores
-            zfs create -o compression=gzip -o mountpoint=none ${SYS_ZPOOL}/cores
-            zfs create -o quota=10g -o mountpoint=/${SYS_ZPOOL}/global/cores \
-                ${SYS_ZPOOL}/cores/global
-        fi
-
-        ln -s /${SYS_ZPOOL}/global/cores /cores
-
-        [[ -f /${SYS_ZPOOL}/currbooted ]] && \
-            mv /${SYS_ZPOOL}/currbooted /${SYS_ZPOOL}/lastbooted
-        uname -v >/${SYS_ZPOOL}/currbooted
-    fi
-fi
-
-
-# The rest only applies to the headnode
-/bin/bootparams | grep "^headnode=true" >/dev/null || exit $SMF_EXIT_OK
-
-# If we rebooted during an upgrade, we're in deep trouble.
-if [ -d /var/upgrade_in_progress ]; then
-    echo "ERROR: An upgrade was in progress when the system rebooted." \
-        >/dev/console
-    echo "       The system is in an indeterminate state, unable to continue." \
-        >/dev/console
-    exit $SMF_EXIT_ERR_FATAL
-fi
-
-COPYINPOINT=`svcprop -p "joyentfs/usb_copy_path" ${SMF_FMRI}`
-DEBUG=`svcprop -p "joyentfs/debug" ${SMF_FMRI}`
-
-if [[ -d /mnt ]]; then
-    chown root:root /mnt
-    chmod 700 /mnt
-else
-    mkdir -m 700 /mnt
-fi
-
-function make_usb_copy_if_possible
-{
-    [[ -n "${SYS_ZPOOL}" ]] || fatal "don't know system zpool name"
-
-    zpool list -Ho name | grep "^${SYS_ZPOOL}\$"
-    if [[ $? != 0 ]]; then
-        echo "skipping USB copy setup: no ${SYS_ZPOOL} zpool" >/dev/console
-        # Still return OK, because this is the expected case for first headnode
-        # boot.
-        return 0
-    fi
-
-    USBDATASET=${SYS_ZPOOL}/usbkey
-    if ! zfs list -Ho name | grep "^${USBDATASET}\$" >/dev/null; then
-        echo "skipping USB copy setup: no zones/usbkey dataset" >/dev/console
-        # Still return OK, because as of HEAD-2343 a CN being converted to a HN
-        # will not yet have this dataset on its first boot as an HN.
-        return 0
-    fi
-
-    echo "" > /dev/console
-    echo "Moving files from USB boot device onto disk storage." > /dev/console
-    echo "This may take several minutes. Please note the time..." > /dev/console
-    echo "" > /dev/console
-    echo "" > /dev/console
-
-    mkdir ${COPYINPOINT}
-    mount_zfs ${USBDATASET} ${COPYINPOINT}
-
-    (cd ${USBMOUNTPOINT}; rsync -av --log-file=/dev/console --exclude private --exclude os * ${COPYINPOINT})
-    if [[ -d ${USBMOUNTPOINT}/os ]]; then
-        (cd ${USBMOUNTPOINT}/os ; \
-            for dir in $(ls -d *); do
-                # source comes from pcfs which we've got lowering the case
-                # of everything, but we normally use capital T and Z for
-                # buildstamp, so fix it here.
-                source_dir=${dir}
-                target_dir=$(echo ${dir} | tr "[:lower:]" "[:upper:]")
-                mkdir -p ${COPYINPOINT}/os
-                echo "Copying: ${source_dir}/ ${COPYINPOINT}/os/${target_dir}" > /dev/console
-                rsync -a ${source_dir}/ ${COPYINPOINT}/os/${target_dir}
-            done
-        )
-    fi
-
-    echo "" > /dev/console
-    echo "Done copying files from USB device" > /dev/console
-    return 0
-}
-
-USBMOUNTPOINT=$(mount_usb_key "")
-if [[ $? -ne 0 ]]; then
-    fatal "couldn't mount USB key"
-fi
-
-make_usb_copy_if_possible
-exit $?
diff --git a/overlay/generic/lib/svc/method/fs-root b/overlay/generic/lib/svc/method/fs-root
deleted file mode 100755
index 5d4d36bb..00000000
--- a/overlay/generic/lib/svc/method/fs-root
+++ /dev/null
@@ -1,98 +0,0 @@
-#!/sbin/sh
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-#
-# Copyright (c) 1992, 2010, Oracle and/or its affiliates. All rights reserved.
-# Copyright 2016 Joyent, Inc.
-#
-
-# Make sure that the libraries essential to this stage of booting can be found.
-LD_LIBRARY_PATH=/lib; export LD_LIBRARY_PATH
-
-libc_mount() {
-	#
-	# If there is an optimized libc available in /usr that fits this
-	# processor, mount it on top of the base libc.
-	#
-	LIBC_MOE_32=`/usr/bin/moe -32 '/usr/lib/libc/$HWCAP'`
-	if [ -n "$LIBC_MOE_32" ]; then
-		/usr/sbin/mount | egrep -s "^/lib/libc.so.1 on "
-		if [ $? -ne 0 ]; then
-			/usr/sbin/mount -O -F lofs $LIBC_MOE_32 /lib/libc.so.1
-		fi
-	fi
-
-	ARCH64=`isainfo | awk '{print $1}'`
-	LIBC_MOE_64=`/usr/bin/moe -64 /usr/lib/$ARCH64/libc/'$HWCAP'`
-	if [ -n "$LIBC_MOE_64" ]; then
-		/usr/sbin/mount | egrep -s "^/lib/$ARCH64/libc.so.1 on "
-		if [ $? -ne 0 ]; then
-			/usr/sbin/mount -O -F lofs $LIBC_MOE_64 \
-				/lib/$ARCH64/libc.so.1
-		fi
-	fi
-}
-
-. /lib/svc/share/smf_include.sh
-. /lib/svc/share/fs_include.sh
-
-#
-# Most of the operations in this script are only necessary in the global
-# zone but due to the way initialization scripts like this are packaged,
-# it needs to currently exist for all zones.
-#
-if smf_is_nonglobalzone; then
-	libc_mount
-	exit $SMF_EXIT_OK
-fi
-
-/sbin/mount -F ufs -o remount,rw,nologging /devices/ramdisk:a /
-/usr/sbin/lofiadm -X -a /usr.lgz
-
-#
-# Prior to mounting /usr, devfsadm is not yet available.  As such, we must
-# locate the lofi block device node in /devices rather than in /dev.  This
-# path has changed over time so we try both the old (pre-partition support)
-# and new paths.
-#
-lofi_devices_path='/devices/pseudo/lofi@1:disk'
-if [ ! -b "$lofi_devices_path" ]; then
-	lofi_devices_path='/devices/pseudo/lofi@0:1'
-	if [ ! -b "$lofi_devices_path" ]; then
-		echo 'could not locate lofi block device in /devices' >&2
-		exit $SMF_EXIT_ERR_FATAL
-	fi
-fi
-
-if ! /sbin/mount -F ufs -o ro "$lofi_devices_path" /usr; then
-	echo "could not mount /usr from $lofi_devices_path" >&2
-	exit $SMF_EXIT_ERR_FATAL
-fi
-
-#
-# Update kernel driver.conf cache with any additional driver.conf
-# files found on /usr, and device permissions from /etc/minor_perm.
-#
-/usr/sbin/devfsadm -I -P
-
-libc_mount
-
-exit $SMF_EXIT_OK
diff --git a/overlay/generic/lib/svc/method/fs-usr b/overlay/generic/lib/svc/method/fs-usr
deleted file mode 100755
index 529ad8e6..00000000
--- a/overlay/generic/lib/svc/method/fs-usr
+++ /dev/null
@@ -1,36 +0,0 @@
-#!/sbin/sh
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-#
-# Copyright 2012, Joyent, Inc. All rights reserved.
-#
-. /lib/svc/share/smf_include.sh
-
-mount /dev/fd
-
-if smf_is_globalzone; then
-    # svc.startd makes a backup of the repo on boot.  Since this is a
-    # live-image, the backup takes up an unnecessary 4MB in memory, so remove
-    # it now.
-    rm -f /etc/svc/repository-*
-fi
-
-exit $SMF_EXIT_OK
diff --git a/overlay/generic/lib/svc/method/identity-node b/overlay/generic/lib/svc/method/identity-node
deleted file mode 100755
index 16411c3b..00000000
--- a/overlay/generic/lib/svc/method/identity-node
+++ /dev/null
@@ -1,189 +0,0 @@
-#!/sbin/sh
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-#
-# Copyright (c) 1984, 1986, 1987, 1988, 1989 AT&T.
-# All rights reserved.
-#
-#
-# Copyright 2006 Sun Microsystems, Inc.  All rights reserved.
-# Use is subject to license terms.
-#
-# Copyright 2015 Joyent Inc. All rights reserved.
-#
-# ident "%Z%%M% %I% %E% SMI"
-
-. /lib/svc/share/smf_include.sh
-. /lib/svc/share/net_include.sh
-
-set -o xtrace
-
-# Make sure that the libraries essential to this stage of booting can be found.
-LD_LIBRARY_PATH=/lib; export LD_LIBRARY_PATH
-
-#
-# For the GZ, use one of the following values for hostname, in order:
-#   * DHCP hostname (if set on a primary interface)
-#   * hostname value from config file
-#   * hostname bootparam
-#   * if not a headnode:
-#     * admin MAC address
-#     * any other MAC address
-#
-# If none of the above could be found, default to "headnode" for headnodes, and
-# "unknown" for non-headnodes.
-#
-# The hostname must be set to something, because
-# tooltalk will hang unless the name can be locally resolved.
-# Sendmail also requires the name to be resolvable locally.
-# Later, in inetsvc, we create a name "unknown" and create a entry
-# in the local /etc/inet/hosts file pairing "unknown" with the IP
-# address assigned by DHCP.  The use of bootparams as a fallback
-# for all non-DHCP cases provides compatibility with the
-# behavior of the system before netstrategy was introduced.
-#
-# For non-global zones, fall back to the `uname -n` value provided by the
-# kernel if /etc/nodename does not exist, as is expected on an initial boot.
-#
-
-set_gz_hostname() {
-    hostname=${CONFIG_hostname}
-    if [ -z "$hostname" ] || [ "$hostname" == "unknown" ]; then
-        hostname=$SYSINFO_Bootparam_hostname
-    fi
-
-    if [ -n "$hostname" ] && [ "$hostname" != "unknown" ]; then
-        return
-    fi
-
-    # $headnode is set by load_sdc_config()
-    if [ "$headnode" == "true" ]; then
-        hostname="headnode"
-        return
-    fi
-
-    if [[ -n ${SYSINFO_NIC_admin} ]]; then
-        eval "admin_mac=\${SYSINFO_Network_Interface_${SYSINFO_NIC_admin}_MAC_Address}"
-        if [[ -n ${admin_mac} ]]; then
-            hostname=$(echo "${admin_mac}" | tr ':' '-')
-            return
-        fi
-    fi
-
-    fallback_mac=$(set | grep "^SYSINFO_Network_Interface_.*_MAC_Address" | head -n1 | cut -d'=' -f2)
-    if [[ -n ${fallback_mac} ]]; then
-        hostname=$(echo "${fallback_mac}" | tr ':' '-')
-        return
-    fi
-
-    hostname="unknown"
-}
-
-
-smf_netstrategy
-
-case "$_INIT_NET_STRATEGY" in
-    "dhcp") hostname=`/sbin/dhcpinfo Hostname` ;;
-    "rarp") hostname=`/sbin/hostconfig -h -p bootparams`
-        trap 'intr=1' 2 3
-        while [ -z "$hostname" -a ! -f /etc/.UNCONFIGURED -a \
-            -z "$intr" ]; do
-            echo "re-trying host configuration..."
-            # Restrict this to IPv4 interfaces.
-            /sbin/ifconfig -adD4 auto-revarp up
-            hostname=`/sbin/hostconfig -h -p bootparams`
-        done
-        trap 2 3 ;;
-    # /etc/nodename defaults to "unknown" on SmartOS
-    "none") hostname="`shcat /etc/nodename 2>/dev/null`"
-        if [ -z "$hostname" ]; then
-            if smf_is_globalzone; then
-                hostname=`/sbin/hostconfig -h -p bootparams`
-            else
-                hostname=`/sbin/uname -n`
-            fi
-        fi ;;
-esac
-
-# Load sysinfo variables with SYSINFO_ prefix and config variables with
-# CONFIG_ prefix.
-# Note: since we're still starting up, "soft" values like network IP and such could
-# not be set yet.
-
-if smf_is_globalzone; then
-    . /lib/sdc/config.sh
-
-    load_sdc_sysinfo
-
-    if boot_file_config_enabled; then
-        load_boot_file_config
-    else
-        load_sdc_config
-    fi
-fi
-
-#
-# If the netstrategy was unsuccessful and we haven't got a locally configured
-# name, default to "unknown"
-#
-if [ -z "$hostname" ] || [ "$hostname" == "unknown" ]; then
-    hostname="`shcat /etc/nodename 2>/dev/null`"
-    if [ -z "$hostname" ] || [ "$hostname" == "unknown" ]; then
-        if smf_is_globalzone; then
-            set_gz_hostname
-        else
-            hostname="unknown"
-        fi
-    fi
-fi
-
-if smf_is_globalzone; then
-    echo "$hostname" > /etc/nodename
-fi
-
-/sbin/uname -S $hostname
-
-# Reloading sysinfo here serves two purposes:
-#   - getting the IP info (which should exist now)
-#   - updating the host info (which we just set)
-eval $(/usr/bin/sysinfo -f -p | sed -e "s/^/SYSINFO_/")
-
-# Try to add the /etc/hosts entry if we can find an IP
-if [[ -n ${SYSINFO_NIC_admin} ]]; then
-    eval "ipaddr=\${SYSINFO_Network_Interface_${SYSINFO_NIC_admin}_IPv4_Address}"
-fi
-if [[ -z ${ipaddr} ]]; then
-    ipaddr=$(set | grep "^SYSINFO_Network_Interface_.*_IPv4_Address" | head -n1 | cut -d'=' -f2)
-fi
-if [[ -n ${ipaddr} ]]; then
-    fullname=""
-
-    if [ -n "$CONFIG_dns_domain" ]; then
-        fullname=" ${hostname}.${CONFIG_dns_domain}"
-    fi
-
-    printf "${ipaddr}\t${hostname}${fullname}\n" >> /etc/hosts
-fi
-
-# Reset the library path now that we are past the critical stage
-unset LD_LIBRARY_PATH
-
-exit $SMF_EXIT_OK
diff --git a/overlay/generic/lib/svc/method/ipfilter b/overlay/generic/lib/svc/method/ipfilter
deleted file mode 100755
index bb25316b..00000000
--- a/overlay/generic/lib/svc/method/ipfilter
+++ /dev/null
@@ -1,307 +0,0 @@
-#!/sbin/sh
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-#
-# Copyright 2009 Sun Microsystems, Inc.  All rights reserved.
-# Use is subject to license terms.
-#
-# Copyright (c) 2013, Joyent, Inc. All rights reserved.
-# Copyright 2016 Hans Rosenfeld <rosenfeld@grumpf.hope-2000.org>
-#
-
-set -o xtrace
-
-. /lib/svc/share/smf_include.sh
-. /lib/svc/share/ipf_include.sh
-
-PATH=${PATH}:/usr/sbin:/usr/lib/ipf
-PIDFILE=/var/run/ipmon.pid
-PFILCHECKED=no
-
-zone=`smf_zonename`
-ipfid=`/usr/sbin/modinfo 2>&1 | awk '/ipf/ { print $1 } ' - 2>/dev/null`
-if [ -f $PIDFILE ] ; then
-	pid=`cat $PIDFILE 2>/dev/null`
-else
-	pid=`pgrep -z $zone ipmon`
-fi
-
-logmsg()
-{
-	logger -p daemon.warning -t ipfilter "$1"
-	echo "$1" >&2
-}
-
-load_ipf() {
-	bad=0
-	ipf -IFa
-	ipf -6IFa
-
-	for file in $IPFILOVRCONF $CONF_FILES $IPFILCONF; do
-		if [ -r ${file} ]; then
-			ipf -I -f ${file}
-			if [ $? != 0 ]; then
-				echo "$0: load of ${file} into alternate" \
-				    "set failed"
-				bad=1
-			fi
-		fi
-	done
-
-	for file in $IP6FILOVRCONF $CONF6_FILES $IP6FILCONF; do
-		if [ -r ${file} ]; then
-			ipf -6I -f ${file}
-			if [ $? != 0 ]; then
-				echo "$0: load of ${file} into alternate set failed"
-				bad=1
-			fi
-		fi
-	done
-
-	if [ $bad -eq 0 ] ; then
-		ipf -s -y
-		return 0
-	else
-		echo "Not switching config due to load error."
-		return 1
-	fi
-}
-
-
-load_ipnat() {
-	ipnat -CF
-	for nfile in $NAT_FILES $IPNATCONF; do
-		if [ -r ${nfile} ]; then
-			ipnat -f ${nfile}
-			if [ $? != 0 ]; then
-				echo "$0: load of ${nfile} failed"
-				return 1
-			else
-				ipf -y
-			fi
-		fi			
-	done
-}
-
-
-load_ippool() {
-	if [ -r ${IPPOOLCONF} ]; then
-		ippool -F
-		ippool -f ${IPPOOLCONF}
-		if [ $? != 0 ]; then
-			echo "$0: load of ${IPPOOLCONF} failed"
-			return 1
-		else
-			return 0
-		fi
-	else
-		return 0	
-	fi
-}
-
-#
-# Get current configuration version, fails if property doesn't exist.
-# 
-config_get_version()
-{
-        ver=`svcprop -p $FW_CONFIG_DEF_PG/version $SMF_FMRI 2>/dev/null`
-        [ $? -ne 0 -o -z "$ver" ] && return 1
-
-        echo "$ver"
-}
-
-#
-# Version 1 configuration migration - if there's an existing ipf.conf file, set
-# the default system-wide policy to "custom" and set the custom file value to
-# "/etc/ipf/ipf.conf". Do this migration once and set the 'version' property
-# to the current version value.
-#
-upgrade_config()
-{
-	old_ipfconf="/etc/ipf/ipf.conf"
-
-	if [ -f ${old_ipfconf} ]; then
-		grep '^[ \t]*[^# \t]' ${old_ipfconf} >/dev/null 2>&1
-		if [ $? -eq 0 ]; then
-			svccfg -s $SMF_FMRI setprop \
-			    $FW_CONFIG_DEF_PG/$POLICY_PROP = astring: \
-			    "custom" >/dev/null 2>&1
-			svccfg -s $SMF_FMRI setprop \
-			    $FW_CONFIG_DEF_PG/$CUSTOM_FILE_PROP = astring: \
-			    "$old_ipfconf" >/dev/null 2>&1
-		fi
-	fi
-
-	svccfg -s $SMF_FMRI setprop $FW_CONFIG_DEF_PG/version = count: \
-	    "$CURRENT_VERSION" >/dev/null 2>&1
-	svcadm refresh $SMF_FMRI >/dev/null 2>&1
-}
-
-symlink_persistent_file()
-{
-	persist_file=/var/fw/$1
-	etc_file=$ETC_IPF_DIR/$1
-
-	[ ! -e $persist_file ] && return 0
-	[ -L $etc_file ] && return 0
-
-	[ -e $etc_file ] && mv $etc_file{,.orig}
-
-	ln -s $persist_file $etc_file
-}
-
-
-configure_firewall()
-{
-	symlink_persistent_file ipnat.conf
-	symlink_persistent_file ipf.conf
-	symlink_persistent_file ipf6.conf
-	create_global_rules || exit $SMF_EXIT_ERR_CONFIG
-	create_global_ovr_rules || exit $SMF_EXIT_ERR_CONFIG
-	create_services_rules || exit $SMF_EXIT_ERR_CONFIG
-
-	[ ! -f ${IPFILCONF} -a ! -f ${IPNATCONF} ] && exit 0
-	ipf -E
-	load_ippool || exit $SMF_EXIT_ERR_CONFIG
-	load_ipf || exit $SMF_EXIT_ERR_CONFIG
-	load_ipnat || exit $SMF_EXIT_ERR_CONFIG
-}
-
-#
-# We handle configuration migration as well as a model change (transient to
-# contract based service) in the start, stop, and refresh methods.
-#
-# Configuration migration is straightforward, the start method will do the
-# upgrade if the repository version value is not the same as the version
-# defined in ipf_include.sh However, there are two problems. First, ipfilter
-# can start in parallel with manifest-import, thus the new configuration
-# properties and service definition may not be available to the start method
-# on the first reboot after an upgrade. Second, a transient to contract based
-# model change isn't well supported for an online service.
-#
-# - If the start method finds the property missing (manifest-import hasn't
-# completed), it will allow the still transient network/ipfilter to stay
-# 'online' and wait for manifest-import. Once manifest-import completes, the
-# refresh method will run svcadm restart if the version value is not
-# up-to-date and the subsequent start method will perform the upgrade. 
-#
-# - Since the start method allows the service to stay online as a transient
-# service (no contract), the svcadm restart invoked by refresh (described
-# above) will result in a call to the stop method with no existing contract
-# property. The ipfilter manifest cannot include contract/restarter token in
-# its stop method definition since startd will fail to expand that token and
-# place the service in maintenance. Thus, the stop method has to explicitly
-# get the contract id before calling smf_kill_contract.
-#
-case "$1" in
-	start)
-		ver=`config_get_version`
-		if [ $? -eq 1 ]; then
-			echo "Warning: firewall properties are not available"
-			exit $SMF_EXIT_OK
-		fi
-
-		[ "$ver" -ne "$CURRENT_VERSION" ] && upgrade_config
-
-		configure_firewall
-
-		/lib/svc/bin/svc.ipfd
-		/usr/sbin/ipmon -Ds
-		;;
-
-	stop)
-		ctid=`svcprop -p restarter/contract $SMF_FMRI`
-		if [ -n "$ctid" ]; then
-			smf_kill_contract $ctid TERM 1
-		fi
-
-		ipf -D
-		[ "$zone" = "global" -a -n "$ipfid" ] && modunload -i $ipfid
-		;;
-
-	pause)
-		ipfs -l
-		ipfs -d /var/db/ipf -W
-		ipf -D
-		if [ -f $PIDFILE ] ; then
-			if kill -0 $pid; then
-				kill -TERM $pid
-			else    
-				cp /dev/null $PIDFILE
-			fi
-		fi      
-		;;
-
-	resume)
-		ipf -E
-		ipfs -R
-		load_ippool
-		load_ipf
-		load_ipnat
-		if [ -f $PIDFILE -a -n "$pid" ] ; then
-			/usr/sbin/ipmon -Ds
-		fi
-		;;
-
-	reload)
-		ver=`config_get_version`
-		if [ $? -eq 1 ]; then
-			echo "Warning: firewall properties are not available"
-			exit $SMF_EXIT_ERR_CONFIG
-		fi
-
-		if [ "$ver" -ne "$CURRENT_VERSION" ]; then
-			svcadm restart $SMF_FMRI
-			exit $SMF_EXIT_OK
-		fi
-
-		configure_firewall
-		;;
-
-	reipf)
-		load_ipf
-		;;
-
-	reipnat)
-		load_ipnat
-		;;
-
-	fw_update)
-		#
-		# The second argument is the fmri of the service to be updated.
-		# If it's the network/ipfilter, we want to repopulate firewall
-		# configuration for the entire system.
-		#
-		if [ "$2" = "$SMF_FMRI" ]; then
-			configure_firewall
-		else
-			service_update $2 || exit 1
-		fi
-		;;
-
-	*)
-		echo "Usage: $0 \c" >&2
-		echo "(start|stop|reload|reipf|reipnat|pause|resume)" >&2
-		exit 1
-		;;
-
-esac
-exit $SMF_EXIT_OK
diff --git a/overlay/generic/lib/svc/method/manifest-import b/overlay/generic/lib/svc/method/manifest-import
deleted file mode 100755
index 5cc4099c..00000000
--- a/overlay/generic/lib/svc/method/manifest-import
+++ /dev/null
@@ -1,517 +0,0 @@
-#!/bin/ksh
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-# Copyright (c) 2004, 2010, Oracle and/or its affiliates. All rights reserved.
-#
-
-# 0a  Initialization.
-
-[ -f /lib/svc/share/smf_include.sh ] || exit 1
-
-. /lib/svc/share/smf_include.sh
-
-activity=false
-
-EMI_SERVICE="svc:/system/early-manifest-import:default"
-PROFILE_DIR_SITE="/etc/svc/profile/site"
-
-X=
-ALT_REPOSITORY=
-ALT_MFST_DIR=
-early=false
-[ "$SMF_FMRI" == "$EMI_SERVICE" ] && early=true
-
-usage()
-{
-	echo "Usage: /lib/svc/method/manifest-import [-n]" \
-	    "[-f repository-file -d manifest-directory]"
-	echo "\nOptions:"
-	echo "-n dryrun"
-	echo "-f and -d specify alternate repository and" \
-	    "manifest directory for import\n"
-	exit 2
-}
-
-while getopts "nd:f:" opt; do
-	case $opt in
-		n)	X=echo;;
-		d)	ALT_MFST_DIR=$OPTARG;;
-		f)	ALT_REPOSITORY=$OPTARG;;
-		?)	usage;;
-	esac
-done
-
-#
-# Both -f and -d options must be specified together or not specified at all
-#
-[ -n "$ALT_REPOSITORY" -a -z "$ALT_MFST_DIR" ] && usage
-[ -n "$ALT_MFST_DIR" -a -z "$ALT_REPOSITORY" ] && usage
-
-function svccfg_apply {
-	$X /usr/sbin/svccfg apply $1
-	if [ $? -ne 0 ]; then
-		echo "WARNING: svccfg apply $1 failed" | tee /dev/msglog
-	fi
-}
-
-#
-# If the smf/manifest table has file entries that are missing
-# then there is work to be done by the cleanup process.
-#
-function cleanup_needwork {
-	if [ "$early" == true ]; then
-		smfmfiles=`/usr/bin/svcprop smf/manifest | \
-		    awk '(/^lib_/ && /\/manifestfile /) {print $3}'`
-	else
-		smfmfiles=`/usr/bin/svcprop smf/manifest | \
-		    awk '/\/manifestfile / {print $3}'`
-	fi
-
-	nw=`/lib/svc/bin/mfstscan $smfmfiles 2>&1 1>/dev/null`
-	[ "$nw" ] && return 1
-
-	return 0
-}
-
-#
-# Upon upgrading to early manifest import code, preserve hashes of system
-# profiles which lived under /var/svc/profile so that svccfg apply would
-# not re-apply the profiles and overwrite user customizations. Simply 
-# migrate manifestfile and hash values to new property groups named after
-# profiles under /etc/svc/profile. If the profiles don't really exist,
-# svccfg cleanup will remove the property groups in a later step.
-# 
-# Existing generic.xml, inetd_services.xml, and name_service.xml symlinks
-# need to be preserved.
-#
-# Don't process site.xml profile since it is still supported under
-# /var/svc/profile directory.
-#
-function preserve_system_profiles {
-
-	#
-	# If /var is a separate fs, return and let Late Import
-	# preserves the hashes.
-	#	
-	[ -d "/var/svc/profile" ] || return 1
-
-	#
-	# Preserve hashes for the following profiles: generic (two
-	# cases) and platform (uname -i, uname -m outputs).
-	#
-	gn="var_svc_profile_generic_open_xml"
-	gh=`/usr/bin/svcprop -p ${gn}/md5sum smf/manifest 2>/dev/null`
-	[ $? = 0 ] || gh=""
-	gn="etc_svc_profile_generic_open_xml"
-
-	gln="var_svc_profile_generic_limited_net_xml"
-	glh=`/usr/bin/svcprop -p ${gln}/md5sum smf/manifest 2>/dev/null`
-	[ $? = 0 ] || glh=""
-	gln="etc_svc_profile_generic_limited_net_xml"
-
-	LC_ALL=C pl=`/usr/bin/uname -i | /usr/bin/tr , _`
-	pln="var_svc_profile_platform_${pl}_xml"
-	plh=`/usr/bin/svcprop -p ${pln}/md5sum smf/manifest 2>/dev/null`
-	[ $? = 0 ] || plh=""
-	pln="etc_svc_profile_platform_${pl}_xml"
-
-	LC_ALL=C plm=`/usr/bin/uname -m | /usr/bin/tr , _`
-	if [ $plm != $pl ]; then
-		plmn="var_svc_profile_platform_${plm}_xml"
-		plmh=`/usr/bin/svcprop -p ${plmn}/md5sum smf/manifest \
-		    2>/dev/null`
-		[ $? = 0 ] || plmh=""
-		plmn="etc_svc_profile_platform_${plm}_xml"
-	else
-		plmh=""
-	fi
-
-	[ -n "$gh" ] && {
-		echo "Preserving generic hash ($gh)."
-		/usr/sbin/svccfg -s smf/manifest addpg ${gn} framework
-		/usr/sbin/svccfg -s smf/manifest setprop ${gn}/md5sum = \
-		    opaque: $gh
-		/usr/sbin/svccfg -s smf/manifest setprop ${gn}/manifestfile = \
-		    astring: "/etc/svc/profile/generic.xml"
-	}
-	[ -n "$glh" ] && {
-		echo "Preserving generic_limited hash ($glh)."
-		/usr/sbin/svccfg -s smf/manifest addpg ${gln} framework
-		/usr/sbin/svccfg -s smf/manifest setprop ${gln}/md5sum = \
-		    opaque: $glh
-		/usr/sbin/svccfg -s smf/manifest setprop ${gln}/manifestfile = \
-		    astring: "/etc/svc/profile/generic.xml"
-	}
-	[ -n "$plh" ] && {
-		echo "Preserving platform hash ($plh)."
-		/usr/sbin/svccfg -s smf/manifest addpg $pln framework
-		/usr/sbin/svccfg -s smf/manifest setprop $pln/md5sum = \
-		    opaque: $plh
-		/usr/sbin/svccfg -s smf/manifest setprop ${pln}/manifestfile = \
-		    astring: "/etc/svc/profile/platform_${pl}_xml"
-	}
-	[ -n "$plmh" ] && {
-		echo "Preserving platform hash ($plmh)."
-		/usr/sbin/svccfg -s smf/manifest addpg $plmn framework
-		/usr/sbin/svccfg -s smf/manifest setprop $plmn/md5sum = \
-		    opaque: $plmh
-		/usr/sbin/svccfg -s smf/manifest setprop \
-		    ${plmn}/manifestfile = \
-		    astring: "/etc/svc/profile/platform_${plm}_xml"
-	}
-
-	#
-	# Move symlinks from /var/svc/profile to /etc/svc/profile
-	#
-	generic_prof="/var/svc/profile/generic.xml"
-	ns_prof="/var/svc/profile/name_service.xml"
-	inetd_prof="/var/svc/profile/inetd_services.xml"
-	platform_prof="/var/svc/profile/platform.xml"
-	[ -L "$generic_prof" ] && mv $generic_prof /etc/svc/profile/
-	[ -L "$ns_prof" ] && mv $ns_prof /etc/svc/profile/
-	[ -L "$inetd_prof" ] && mv $inetd_prof /etc/svc/profile/
-	[ -L "$platform_prof" ] && mv $platform_prof /etc/svc/profile/
-
-	return 0
-}
-
-#
-# 2.  Manifest import.  Application directories first, then
-# site-specific manifests.
-#
-function import_manifests {
-	typeset basedir=$1
-	typeset console_print=$2
-	typeset logf="/etc/svc/volatile/manifest_import.$$"
-
-	rm -f $logf
-
-	if [ "${basedir}" == "/opt/custom/smf" ]; then
-		# Special case where we will just import from the root, not subdirs
-		nonsite_dirs=${basedir}
-	else
-		nonsite_dirs=`/usr/bin/find $basedir/* -name site \
-			-prune -o -type d -print -prune`
-	fi
-
-	if [ -n "$_MFST_DEBUG" ]; then
-		nonsite_manifests=`/lib/svc/bin/mfstscan $nonsite_dirs`
-		site_manifests=`/lib/svc/bin/mfstscan $basedir/site`
-
-		manifests="$nonsite_manifests $site_manifests"
-
-		echo "Changed manifests to import:"
-		for m in $manifests; do echo "  $m"; done
-	fi
-
-	#
-	# Upon boot, attempt to move the repository to tmpfs.
-	#
-	if [ -z "$ALT_REPOSITORY" -a -z "$ALT_MFST_DIR" ]; then 
-		/usr/sbin/svcadm _smf_repository_switch fast
-	fi
-
-	#
-	# Import the manifests while giving a running display of imports on
-	# console, and a final count in the logfile.
-	#
-	dirs="$nonsite_dirs"
-	[ -d "$basedir/site" ] && dirs="$dirs $basedir/site"
-
-	if [ "$console_print" = "true" ]; then
-		$X /usr/sbin/svccfg import -p /dev/msglog $dirs > $logf 2>&1
-	else
-		$X /usr/sbin/svccfg import $dirs > $logf 2>&1
-	fi
-
-	grep "Loaded .*. smf(5) service descriptions" $logf > /dev/null 2>&1
-	if [ $? -eq 0 ]; then
-		activity=true
-	fi
-
-	if [ -s $logf ]; then
-		grep "smf(5) service descriptions failed to load" $logf > /dev/null 2>&1
-		failures=$?
-		if [ $failures -eq 0 ]; then
-			echo "svccfg warnings:"
-		fi
-		cat $logf
-
-		if [ $failures -eq 0 -a "$console_print" = "true" ]; then
-			msg="svccfg import warnings.  See"
-			msg="$msg /var/svc/log/system-manifest-import:default.log ."
-			echo $msg > /dev/msglog
-		fi
-	fi
-	rm -f $logf
-}
-
-#
-# 3.  Profile application.  We must create the platform profile upon
-# first boot, as we may be a diskless client of a platform or
-# architecture distinct from our NFS server.
-#
-# Generic and platform profiles are only supported in /etc.
-#
-function apply_profile {
-	#
-	# If smf/manifest doesn't have any profile under /etc/var/profile,
-	# this is very likely an import after upgrade so call
-	# preserve_system_profiles in that case.
-	#
-	LC_ALL=C pl=`/usr/bin/uname -i | /usr/bin/tr , _`
-	pln="etc_svc_profile_platform_${pl}_xml"
-
-	LC_ALL=C plm=`/usr/bin/uname -m | /usr/bin/tr , _`
-	[ $plm != $pl ] && plmn="etc_svc_profile_platform_${plm}_xml"
-
-	preserve_profiles=1
-	for prof in $pln $plmn etc_svc_profile_platform_none_xml \
-	    etc_svc_profile_generic_limited_net_xml \
-	    etc_svc_profile_generic_open_xml; do
-		if /usr/bin/svcprop -p $prof smf/manifest >/dev/null 2>&1
-		then
-			preserve_profiles=0
-			break
-		fi
-	done
-
-	if [ $preserve_profiles -eq 1 ]; then
-		echo "/etc/svc system profiles not found: upgrade system profiles"
-		preserve_system_profiles || return
-	fi
-
-	typeset prefix="/etc/svc/profile"
-	svccfg_apply $prefix/generic.xml
-	if [ ! -f $prefix/platform.xml ]; then
-		this_karch=`uname -m`
-		this_plat=`uname -i`
-
-		if [ -f $prefix/platform_$this_plat.xml ]; then
-			platform_profile=platform_$this_plat.xml
-		elif [ -f $prefix/platform_$this_karch.xml ]; then
-			platform_profile=platform_$this_karch.xml
-		else
-			platform_profile=platform_none.xml
-		fi
-
-		ln -s $platform_profile $prefix/platform.xml
-	fi
-
-	svccfg_apply $prefix/platform.xml
-}
-
-#
-# 4.  Upgrade handling.  The upgrade file generally consists of a series
-# of svcadm(1M) and svccfg(1M) commands.
-#
-function handle_upgrade {
-
-	[ -f /var/svc/profile/upgrade ] && activity=true
-
-	(
-		unset SVCCFG_CHECKHASH
-
-		if [ -f /var/svc/profile/upgrade ]; then
-			. /var/svc/profile/upgrade
-
-			/usr/bin/mv /var/svc/profile/upgrade \
-			    /var/svc/profile/upgrade.app.`date +\%Y\%m\%d\%H\%M\%S`
-		fi
-
-		#
-		# Rename the datalink upgrade script file. This script is used in the
-		# network/physical service to upgrade datalink configuration, but
-		# the file cannot be renamed until now (when the file system becomes
-		# read-write).
-		#
-		datalink_script=/var/svc/profile/upgrade_datalink
-		if [ -f "${datalink_script}" ]; then
-			/usr/bin/mv "${datalink_script}" \
-			    "${datalink_script}".app.`date +\%Y\%m\%d\%H\%M\%S`
-		fi
-	)
-}
-
-#
-# 5.  Giving administrator the final say, apply site.xml profile and profiles
-#     under /etc/svc/profile/site directory.
-#
-function apply_site_profile {
-        typeset prefix="$1"
-	[ -f $prefix/site.xml ] && svccfg_apply $prefix/site.xml
-
-	if [ -d $PROFILE_DIR_SITE -a "$1" = "/etc/svc/profile" ]; then
-		svccfg_apply $PROFILE_DIR_SITE
-	fi
-}
-
-#
-# 0b Cleanup deathrow
-#
-if [ "$early" = "false" ];then
-	deathrow=/etc/svc/deathrow
-	if [ -s $deathrow ];then
-		#
-		# svc.startd has unconfigured the services found in deathrow,
-		# clean them now.
-		#
-		while read fmri mfst pkgname; do
-			# Delete services and instances from the deathrow file.
-			/usr/sbin/svccfg delete -f $fmri >/dev/null 2>&1
-			# Remove deathrow manifest hash.
-			/usr/sbin/svccfg delhash -d $mfst >/dev/null 2>&1
-		done < $deathrow
-		/usr/bin/mv $deathrow $deathrow.old
-	fi
-fi
-
-SVCCFG_CHECKHASH=1 export SVCCFG_CHECKHASH
-
-#
-# 0c Clean up repository
-#
-if [ "$early" = "false" ]; then
-	if [ -z "$X" ] && /usr/bin/svcprop smf/manifest 2>/dev/null |
-	    /usr/bin/grep '^ar_svc_[^/]*/md5sum opaque ' >/dev/null
-	then
-		set -- `
-			/usr/bin/svcprop smf/manifest 2>/dev/null |
-			    /usr/bin/grep '^ar_svc[^/]*/md5sum opaque ' |
-			    /usr/bin/tr '/' ' ' |
-			    while read pg prop type value; do
-				echo "$pg/$value"
-			done
-		`
-		backup=`echo "$#/$#" | sed 's/.//g'`
-		fwidth=`echo "$#\c" | wc -c`
-
-		echo "Converting obsolete repository entries: \c" > /dev/msglog
-		i=1; n=$#
-		while [ $# -gt 0 ]; do
-			printf "%${fwidth}s/%${fwidth}s" $i $n > /dev/msglog
-			echo $1 | sed 's:/: :' | (
-				read pg value
-
-				(echo "select /smf/manifest"; echo "delpg v$pg") |
-				    /usr/sbin/svccfg 2>/dev/null >/dev/null
-				(echo "select /smf/manifest"; echo "delpg $pg") |
-				    /usr/sbin/svccfg 2>/dev/null >/dev/null
-				(echo "select /smf/manifest";
-				    echo "addpg v$pg framework") |
-				    /usr/sbin/svccfg 2>/dev/null >/dev/null
-				(echo "select /smf/manifest";
-				    echo "setprop v$pg/md5sum = opaque: $value") |
-				    /usr/sbin/svccfg 2>/dev/null >/dev/null
-			)
-			i=`expr $i + 1`
-			shift
-			echo "$backup\c" > /dev/msglog
-		done
-		echo > /dev/msglog
-		echo "Converted $n obsolete repository entries"
-		activity=true
-	fi
-
-fi
-
-#
-# If the alternate repository and directory are specified, simply set
-# SVCCFG_REPOSITORY env, run svccfg import on the given directory, and
-# exit.
-#
-if [ -n "$ALT_REPOSITORY" -a -n "$ALT_MFST_DIR" ]; then 
-	SVCCFG_REPOSITORY=$ALT_REPOSITORY export SVCCFG_REPOSITORY
-	import_manifests "$ALT_MFST_DIR" false
-	unset SVCCFG_REPOSITORY
-	exit 0
-fi
-
-#
-# Call import and apply profiles here
-#
-if [ "$early" = "true" ]; then
-	import_manifests "/lib/svc/manifest" true
-	apply_profile
-	apply_site_profile "/etc/svc/profile"
-else
-	#
-	# Process both /lib/svc/manifest and /var/svc/manifest
-	# during late manifest-import
-	#
-	# First import the manifests
-	#
-	import_manifests "/lib/svc/manifest" true
-	import_manifests "/var/svc/manifest" true
-
-	if [ -d "/opt/custom/smf" ]; then
-		import_manifests "/opt/custom/smf" true
-	fi
-
-	#
-	# Apply profiles
-	#
-	apply_profile
-	apply_site_profile "/etc/svc/profile"
-
-	#
-	# Run the upgrade script
-	#
-	handle_upgrade
-	apply_site_profile "/var/svc/profile"
-fi
-
-
-#
-# 6.  Final actions.
-#
-
-#if $activity; then
-#	/usr/sbin/svcadm _smf_backup "manifest_import" || true
-#fi
-
-#
-# If the filesystem is NOT read only then move the repo back to perm
-# There is no care wether the switch was made or not, but just want
-# to move it.  If it is already perm this does not affect anything
-# at least on the surface.  REALLY want to improve on this...
-#
-touch /etc/svc/smf_rwtest.$$ > /dev/null 2>&1
-if [ $? -eq 0 ]; then
-	rm -f /etc/svc/smf_rwtest.$$
-	/usr/sbin/svcadm _smf_repository_switch perm || { \
-	    echo "Repository switch back operation failed, \c"
-	    echo "please check the system log for the"
-	    echo "possible fatal error messages."
-	    exit $SMF_EXIT_ERR_FATAL
-	    }
-fi
-
-if $activity; then
-	/usr/sbin/svccfg cleanup | /usr/bin/tee /dev/msglog
-else
-	cleanup_needwork
-	if [ $? -ne 0 ]; then
-		/usr/sbin/svccfg cleanup -a | /usr/bin/tee /dev/msglog
-	fi
-fi
-
-exit 0
diff --git a/overlay/generic/lib/svc/method/mdata-execute b/overlay/generic/lib/svc/method/mdata-execute
deleted file mode 100755
index fca08ffb..00000000
--- a/overlay/generic/lib/svc/method/mdata-execute
+++ /dev/null
@@ -1,53 +0,0 @@
-#!/usr/bin/bash
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License, Version 1.0 only
-# (the "License").  You may not use this file except in compliance
-# with the License.
-#
-# You can obtain a copy of the license at http://smartos.org/CDDL
-#
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file.
-#
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-# Copyright (c) 2012, Joyent, Inc. All rights reserved.
-#
-
-set -o xtrace
-
-. /lib/svc/share/smf_include.sh
-smf_is_globalzone && exit ${SMF_EXIT_OK}
-
-# If we got as far as running the user-script the 'provision' was a success
-# from here out a failure will leave the zone running.
-if [ -f /var/svc/provisioning ]; then
-    mv /var/svc/provision{ing,_success}
-fi
-
-if [[ -x /var/svc/mdata-operator-script ]]; then
-    /var/svc/mdata-operator-script
-    operator_script_exit=$?
-    if [[ ${operator_script_exit} -gt 0 ]]; then
-        echo "WARNING: operator-script failed: exited ${operator_script_exit}" \
-            >&2
-    fi
-fi
-
-user_script_exit=${SMF_EXIT_OK}
-if [ -x /var/svc/mdata-user-script ]; then
-    /var/svc/mdata-user-script
-    [ $? -gt 0 ] && user_script_exit=${SMF_EXIT_ERR_FATAL}
-fi
-
-exit ${user_script_exit}
diff --git a/overlay/generic/lib/svc/method/mdata-fetch b/overlay/generic/lib/svc/method/mdata-fetch
deleted file mode 100755
index cb7222f4..00000000
--- a/overlay/generic/lib/svc/method/mdata-fetch
+++ /dev/null
@@ -1,477 +0,0 @@
-#!/usr/bin/bash
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License, Version 1.0 only
-# (the "License").  You may not use this file except in compliance
-# with the License.
-#
-# You can obtain a copy of the license at http://smartos.org/CDDL
-#
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file.
-#
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-# Copyright (c) 2017, Joyent, Inc. All rights reserved.
-#
-
-export PS4='[\D{%FT%TZ}] ${BASH_SOURCE}:${LINENO}: ${FUNCNAME[0]:+${FUNCNAME[0]}(): }'
-export PATH=/usr/bin:/usr/sbin:$PATH
-
-set -o xtrace
-
-. /lib/svc/share/smf_include.sh
-smf_is_globalzone && exit ${SMF_EXIT_OK}
-
-if [ ! -x /usr/sbin/mdata-get ]; then
-  echo "Metadata mdata-get tool not found."
-  exit ${SMF_EXIT_ERR_FATAL}
-fi
-
-function fatal() {
-  if [[ -n $1 ]]; then
-      echo "FATAL: $*" >&2
-  fi
-  exit ${SMF_EXIT_ERR_FATAL}
-}
-
-# Test if an address looks like an IPv4 address.
-function isIPv4() {
-  [[ "$1" =~ ^([0-9]{1,3}\.){3}[0-9]{1,3}$ ]]
-}
-
-# Test if an address looks like an IPv4 address + CIDR.
-function isIPv4AndCIDR() {
-  [[ "$1" =~ ^([0-9]{1,3}\.){3}[0-9]{1,3}/[0-9]{1,2}$ ]]
-}
-
-# Test if an address looks like an IPv6 address.
-function isIPv6() {
-  [[ "$1" =~ ^[0-9a-f]*:[0-9a-f]*:[:0-9a-f]*$ ]]
-}
-
-# Test if an address looks like an IPv6 address + CIDR.
-function isIPv6AndCIDR() {
-  [[ "$1" =~ ^[0-9a-f]*:[0-9a-f]*:[:0-9a-f]*/[0-9]{1,3}$ ]]
-}
-
-# For old zones that were created prior to OS-2253 and bumping the mdata:fetch
-# start timeout, we need to fix this otherwise we could timeout waiting for the
-# socket.
-cur_timeout=$(svcprop -p start/timeout_seconds svc:/smartdc/mdata:fetch)
-if [[ -z ${cur_timeout} || ${cur_timeout} -lt 1800 ]]; then
-    # The current manifest has an old timeout value, fix in case we timeout
-    # here.  XXX we can still hit OS-2296 here where smf will forget that we
-    # set this.
-    svccfg -s svc:/smartdc/mdata:fetch 'setprop start/timeout_seconds = 1800'
-    svcadm refresh svc:/smartdc/mdata:fetch
-fi
-
-# This waits until /.zonecontrol/metadata.sock exists then exits 0
-/usr/vm/sbin/filewait /.zonecontrol/metadata.sock
-
-if [[ ! -e /.zonecontrol/metadata.sock ]]; then
-    # this is a bug since filewait should not have returned until file existed.
-    fatal "missing /.zonecontrol/metadata.sock, Unable to start mdata:fetch"
-fi
-
-# Update sysinfo to ensure values that come from metadata are populated.
-/usr/bin/sysinfo -fu
-
-echo "Retrieving metadata user-data"
-/usr/sbin/mdata-get user-data >/var/db/mdata-user-data.new
-case $? in
-  0)
-    echo "Metadata user-data successfuly retrieved."
-    mv /var/db/mdata-user-data{.new,}
-    ;;
-  1)
-    echo "Metadata user-data not defined."
-    rm -f /var/db/mdata-user-data{,.new}
-    ;;
-  *)
-    echo "Metadata couldn't be retrieved."
-    exit ${SMF_EXIT_ERR_FATAL}
-    ;;
-esac
-
-echo "Retrieving metadata user-script..."
-/usr/sbin/mdata-get user-script >/var/svc/mdata-user-script.new
-case $? in
-  0)
-    echo "Metadata user-script successfuly retrieved."
-    mv /var/svc/mdata-user-script{.new,}
-    chmod +x /var/svc/mdata-user-script
-    ;;
-  1)
-    echo "Metadata user-script not defined."
-    rm -f /var/svc/mdata-user-script{,.new}
-    ;;
-  *)
-    echo "Metadata couldn't be retrieved."
-    exit ${SMF_EXIT_ERR_FATAL}
-    ;;
-esac
-
-echo "Retrieving metadata operator-script..."
-/usr/sbin/mdata-get sdc:operator-script >/var/svc/mdata-operator-script.new
-case $? in
-  0)
-    echo "Metadata operator-script successfuly retrieved."
-    mv /var/svc/mdata-operator-script{.new,}
-    chmod +x /var/svc/mdata-operator-script
-    ;;
-  1)
-    echo "Metadata operator-script not defined."
-    rm -f /var/svc/mdata-operator-script{,.new}
-    ;;
-  *)
-    echo "Metadata couldn't be retrieved."
-    exit ${SMF_EXIT_ERR_FATAL}
-    ;;
-esac
-
-echo "Retrieving tmpfs value..."
-tmpfs=$(/usr/sbin/mdata-get sdc:tmpfs)
-if [[ $? == 0 && -n ${tmpfs} && -f /etc/vfstab ]]; then
-  check="swap        -   /tmp                tmpfs";
-
-  if [[ ${tmpfs} == "0" ]]; then
-    # When tmpfs is set 0, we remove any entry from /etc/vfstab but cannot
-    # adjust the "live" value as current /tmp will be in-use. On reboot the
-    # new value will take effect.
-
-    grep -v "^${check}" /etc/vfstab > /etc/vfstab.new \
-      && mv /etc/vfstab.new /etc/vfstab
-  else
-    new="swap        -   /tmp                tmpfs    -   yes    size=${tmpfs}m";
-    if ! /usr/bin/grep "^${new}" /etc/vfstab; then
-      if ! /usr/bin/grep "^${check}" /etc/vfstab; then
-        # no tmpfs line. add it.
-        echo "${new}" >> /etc/vfstab
-      else
-        # existing tmpfs line, but wrong value. fix it.
-        /usr/bin/sed -i "" -e "s|^swap.*/tmp.*tmpfs.*$|${new}|" /etc/vfstab
-        echo $?
-      fi
-
-      if mount | grep "^/tmp"; then
-        # Also fix current size, since /etc/vfstab didn't have our correct line
-        # but only if we have /tmp mounted at all. If not, we'll have to wait
-        # until the next reboot since /tmp will be in-use.
-        /usr/sbin/mount -F tmpfs -o remount,size=${tmpfs}m /tmp
-      fi
-
-    fi
-  fi
-fi
-
-#
-# If we have NFS volumes, we'll add them to vfstab, and enable the nfs/client
-# service so that will mount the volumes for us.
-#
-echo "Retrieving volume metadata..."
-
-volumes_added=0
-while IFS="|" read -r nfsvolume mountpoint name mode type; do
-
-  cat >&2 <<EOF
-*** VOLUME ***
-NFSVOLUME: ${nfsvolume}
-MOUNTPOINT: ${mountpoint}
-MODE: ${mode}
-NAME: ${name}
-TYPE: ${type}
-EOF
-
-  if [[ -n ${type} && ${type} != "tritonnfs" ]]; then
-      fatal "unsupported volume type: ${type}"
-  fi
-
-  # if we don't have volume and mountpoint, we can't add vfstab lines
-  if [[ -z ${nfsvolume} || -z ${mountpoint} ]]; then
-      fatal "invalid volume specification (need both volume & mountpoint)"
-  fi
-
-  if ! grep "^${nfsvolume}[ 	]" /etc/vfstab; then
-      if [[ -z ${mode} ]]; then
-          mode="rw"
-      fi
-
-      if [[ ${mode} != "rw" && ${mode} != "ro" ]]; then
-          fatal "invalid volume mode: '${mode}'"
-      fi
-
-      line=$(printf "%s - %s nfs - yes %s\n" "${nfsvolume}" "${mountpoint}" "${mode}")
-      volumes_added=$((${volumes_added}+1))
-
-      mkdir -p ${mountpoint}
-      echo "${line}" >> /etc/vfstab
-  fi
-done < <(/usr/sbin/mdata-get sdc:volumes \
-    | /usr/bin/json \
-        -d '|' \
-        -a nfsvolume mountpoint name mode type)
-
-if [[ ${volumes_added} -gt 0 ]]; then
-    for svc in \
-        svc:/network/nfs/nlockmgr:default \
-        svc:/network/nfs/status:default \
-        svc:/network/rpc/bind:default \
-        svc:/network/nfs/client:default \
-        ; do
-
-        svcadm enable ${svc} || fatal "Unable to enable ${svc}"
-     done
-fi
-
-# We use the special sdc:nics value here though this is not an interface for
-# use elsewhere.  If this is changed please also update agent.js in the metadata
-# agent.
-#
-# We run this every startup in case nics have changed since last boot. As
-# network/physical has an optional_all dependency on this service, we'll have
-# had our chance to write these files out before networking comes up. This
-# might eventually be replaced by network/physical grabbing data directly.
-echo "Retrieving nics data..."
-while IFS="|" read -r iface ip ips netmask primary gateway gateways; do
-
-  # if we don't have interface name, we don't know what files to write out.
-  if [[ -z ${iface} ]]; then
-    continue;
-  fi
-
-  # A VM created on an older platform may not have the "ips" or "gateways"
-  # properties, so we will need to grab the older "ip" and "gateway" versions
-  # instead.
-  [[ -z $ips ]] && ips=$ip
-  [[ -z $gateways ]] && gateways=$gateway
-
-  # We remove the hostname.netX file first, so we can append to a clean file
-  rm -f /etc/hostname.${iface}
-
-  # remove any existing DHCP or addrconf configuration, since we'll create one
-  # if it belongs later
-  rm -f /etc/dhcp.${iface}
-  rm -f /etc/addrconf.${iface}
-
-  OLDIFS=$IFS
-  IFS=$','
-  for ip in $ips; do
-    # so it shows up in the logs
-    echo "iface[${iface}] ip[${ip}] netmask[${netmask}]" \
-      "primary[${primary}] gateway[${gateway}]"
-
-    [[ -z ${ip} ]] && continue;
-
-    if [[ ${ip} == "dhcp" ]]; then
-      touch /etc/dhcp.${iface}
-      if hostname=`mdata-get sdc:hostname`; then
-          echo "inet ${hostname}" >> /etc/hostname.${iface}
-      fi
-    elif [[ ${ip} == "addrconf" ]]; then
-      touch /etc/addrconf.${iface}
-    elif isIPv4 ${ip} && [[ -n ${netmask} ]]; then
-      # We're using an older configuration where the routing prefix is
-      # specified using a mask instead of CIDR notation. We'll need to
-      # invoke ifconfig differently.
-      echo "${ip} netmask ${netmask} up" >> /etc/hostname.${iface}
-    elif isIPv4AndCIDR ${ip} \
-        || isIPv6AndCIDR ${ip} \
-        || isIPv6 ${ip}; then
-      # Either a routing prefix was specified, or, in the case of IPv6, we
-      # won't specify one and fall back on NDP to find it when we configure
-      # our interfaces.
-      echo "${ip} up" >> /etc/hostname.${iface}
-    fi
-  done
-
-  if [[ ${primary} == "true" ]]; then
-    rm -f /etc/defaultrouter
-    for gateway in $gateways; do
-      if [[ -n ${gateway} ]] && isIPv4 ${gateway}; then
-        echo "${gateway}" >> /etc/defaultrouter
-      fi
-    done
-  fi
-  IFS=$OLDIFS
-
-  # XXX we leave old hostname.netX files around and just replace when we have
-  # one next.
-done < <(/usr/sbin/mdata-get sdc:nics \
-    | /usr/bin/json \
-        -d '|' \
-        -e 'this.ips = this.ips ? this.ips.join(",") : ""' \
-        -e 'this.gateways = this.gateways ? this.gateways.join(",") : ""' \
-        -a interface ip ips netmask primary gateway gateways)
-
-# rebuild resolv.conf
-resolvers=$(mdata-get sdc:resolvers)
-resolvers_result=$?
-
-# Determine if resolv.conf is managed for us
-maintain_resolvers=$(mdata-get sdc:maintain_resolvers)
-maintain_result=$?
-if [[ ${maintain_result} != 0 ]]; then
-    echo "Error getting maintain_resolvers, code: ${maintain_result}"
-    maintain_resolvers="false"
-fi
-
-# If this is our first boot, write an initial set of resolvers
-if [[ -f /var/svc/provisioning ]]; then
-    echo "First boot: writing resolvers"
-    maintain_resolvers="true"
-fi
-
-if [[ ${resolvers_result} == 0 && ${maintain_resolvers} == "true" ]]; then
-
-    # if dns_domain is missing or broken, we still write out, just w/o search
-    search="search $(mdata-get sdc:dns_domain)"
-    if [[ $? != 0 ]]; then
-        search=
-    fi
-
-    if [[ ${resolvers} == "[]" ]]; then
-        nameservers=
-    else
-        nameservers=$(echo ${resolvers} | json -a | sed -e "s/^/nameserver /")
-    fi
-
-    rm -f /etc/.resolv.conf.tmp
-    if [[ -n ${search} ]]; then
-        echo "${search}" > /etc/.resolv.conf.tmp
-    fi
-    if [[ -n ${nameservers} ]]; then
-        echo "${nameservers}" >> /etc/.resolv.conf.tmp
-    fi
-
-    cp /etc/.resolv.conf.tmp /etc/resolv.conf \
-        && cat /etc/.resolv.conf.tmp >&2 \
-        && rm -f /etc/.resolv.conf.tmp
-else
-    if [[ ${resolvers_result} == 0 ]]; then
-        echo "Error getting resolvers, code: ${resolvers_result}"
-    fi
-
-    if [[ ${maintain_resolvers} == "true" ]]; then
-        echo "Not setting resolvers, maintain_resolvers=${maintain_resolvers}"
-    fi
-fi
-
-
-# Fetch routes
-
-# It is possible to specify the same route in several different ways using
-# route(1m). We therefore use route(1m) itself to manage adding, deleting
-# and determining duplicates.
-zone_routes_file=/etc/inet/static_routes
-vmadm_routes_file=/etc/inet/static_routes.vmadm
-tmpdir=$(mktemp -d /tmp/mdata.XXXXXX)
-
-if [ -z $tmpdir ]; then
-    echo "Error creating temporary directory."
-    exit ${SMF_EXIT_ERR_FATAL}
-fi
-
-# directory structure for the new copy of static_routes.vmadm (the one that
-# will replace the current static_routes.vmadm once all of the adds and
-# deletes have been applied):
-new_root=${tmpdir}/new-routes
-new_inet=${new_root}/etc/inet
-# directory structure for the previous copy of static_routes.vmadm (used to
-# determine routes that have been removed since the last time mdata-fetch
-# was run):
-old_root=${tmpdir}/old-routes
-old_inet=${old_root}/etc/inet
-# directory structure for the zone's persistent routes - those not created
-# by vmadm (used to determine if vmadm routes are duplicates):
-zone_root=${tmpdir}/zone-routes
-zone_inet=${zone_root}/etc/inet
-
-mkdir -p $new_inet
-mkdir -p ${old_root}/etc/inet
-mkdir -p ${zone_root}/etc/inet
-
-if [[ -f ${vmadm_routes_file} ]]; then
-    cp $vmadm_routes_file ${old_inet}/static_routes
-fi
-
-function route_in_per_zone_file()
-{
-    cp $zone_routes_file $zone_inet
-    output=$(route -pR $zone_root add $* 2>&1)
-    [[ $output =~ "entry exists" ]]
-}
-
-# If re-running this script after initial boot, network/physical and
-# network/routing-setup are already enabled, so apply routing adds and
-# deletes manually
-if [[ $(/usr/bin/svcs -H -o state network/routing-setup) == "online" ]]; then
-    routing_up="true"
-fi
-
-while IFS="|" read -r gateway dst linklocal; do
-    echo "route: gateway[${gateway}] dst[${dst}] linklocal[${linklocal}]"
-    route_type=""
-    if [[ ${linklocal} == "true" ]]; then
-        route_type="-interface "
-    fi
-    route_str="${route_type}${dst} ${gateway}"
-
-    if route_in_per_zone_file $route_str; then
-        echo "not adding duplicate route: ${route_str}"
-        # the zone has also defined this route; do nothing
-    else
-        echo "adding route to file: ${route_str}"
-        route -pR $new_root add $route_str
-        if [[ -n "${routing_up}" ]]; then
-            route add $route_str
-        fi
-    fi
-
-    route -pR $old_root delete $route_str
-done < <(/usr/sbin/mdata-get sdc:routes \
-    | /usr/bin/json -d '|' -a gateway dst linklocal)
-
-
-# Anything left in the old static_routes file is a delete. Don't delete the
-# route from the routing tables if there's a duplicate route in the zone's
-# static_routes file
-if [[ -f ${old_inet}/static_routes ]]; then
-    egrep -v "^(#|$)" ${old_inet}/static_routes | while read -r route_str; do
-        if [[ "${route_str}" == "" ]]; then
-            continue
-        fi
-
-        if route_in_per_zone_file "$route_str"; then
-            echo "not deleting duplicate route: ${route_str}"
-        else
-            if [[ -n "${routing_up}" ]]; then
-                route delete $route_str
-            fi
-        fi
-    done
-fi
-
-if [[ -f ${new_inet}/static_routes ]]; then
-    cp ${new_inet}/static_routes ${vmadm_routes_file}
-else
-    rm ${vmadm_routes_file}
-fi
-rm -rf $tmpdir
-
-
-# Unconditionally enable mdata:execute, so that the last provisioning step
-# is always taken (regardless of whether user-script exists or not)
-svcadm enable smartdc/mdata:execute
-
-exit ${SMF_EXIT_OK}
diff --git a/overlay/generic/lib/svc/method/net-early-admin b/overlay/generic/lib/svc/method/net-early-admin
deleted file mode 100644
index abfd5fbd..00000000
--- a/overlay/generic/lib/svc/method/net-early-admin
+++ /dev/null
@@ -1,214 +0,0 @@
-#!/bin/ksh93
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright 2019 Joyent, Inc.
-#
-
-# Traditionally, when a Triton compute node boots, the network is not
-# configured until after the local filesystems are mounted (in fact
-# network/physical:default depends upon /system/filesystem/smartdc).  Most
-# obviously, in the case of a head node or a standalone SmartOS install, the
-# network configuration is stored on the local zpool, so the network cannot
-# be configured until this happens.
-#
-# For Triton compute nodes with encrypted zpools, we must enable the admin
-# network before the local zpool filesytems are online -- we have to be able
-# to communicate to the head node services to obtain the pin to unlock the
-# local zpool.  For PXE booted Triton compute nodes, we therefore configure
-# the admin network sooner via the network/early-admin:default service.  When
-# network/physical:default runs, it will skip the configuration of the admin
-# network and configuring the remaining interfaces.
-#
-# If we are not a Triton compute node, we exit successfully almost immediately
-# without configuring the admin network.  When the network/physical:default
-# service runs, it will configure all the network interfaces as it traditionally
-# has
-
-PATH=/bin:/usr/bin:/sbin:/usr/sbin
-
-. /lib/svc/share/smf_include.sh
-. /lib/sdc/config.sh
-. /lib/sdc/network.sh
-
-PS4='+ [$LINENO] '
-
-set -o xtrace
-
-if ! smf_is_globalzone; then
-    echo "Non-global zone; no action required; exiting"
-    exit $SMT_EXIT_OK
-fi
-
-if ! boot_file_config_enabled; then
-    echo "Boot-time networking files not present; exiting"
-    exit $SMF_EXIT_OK
-fi
-
-function fatal
-{
-    # XXX: For SMF methods, does it matter/better to redirect to stderr?
-    echo "Error: $*" >&2
-    exit $SMF_EXIT_ERR_FATAL
-}
-
-if ! boot_file_config_valid; then
-    echo "ERROR: boot-time network config file incorrect" >&2
-    exit $SMF_EXIT_ERR_CONFIG
-fi
-
-unset aggrs
-unset tags
-typeset -A tagv
-typeset -A aggr_links aggr_mode
-typeset -A ip ip6 netmask gateway gateway6 mtu mac
-/usr/lib/sdc/net-boot-config | while IFS="=" read var value; do
-    if [[ "$var" =~ _nic$ ]]; then
-        name=${var%_nic}
-        tags+=("${name}")
-        tagv[$name]="$value"
-    elif [[ "$var" =~ _aggr$ ]]; then
-        name=${var%_aggr}
-        aggrs+=(${name})
-        aggr_links[$name]="${value//,/ }"
-    elif [[ "$var" =~ _lacp_mode$ ]]; then
-        name=${var%_lacp_mode}
-        aggr_mode[$name]="$value"
-    elif [[ "$var" =~ _mtu$ ]]; then
-        (( value < 1500 || value > 9000 )) &&
-            fatal "ERROR: $var MTU value \'$value\' is not in" \
-            "range [1500, 9000]"
-
-        name=${var%_mtu}
-        mtu[$name]="$value"
-    elif [[ "$var" =~ _ip$ ]]; then
-        name=${var%_ip}
-        ip[$name]="$value"
-    elif [[ "$var" =~ _ip6$ ]]; then
-        name=${var%_ip6}
-        ip6[$name]="$value"
-    elif [[ "$var" =~ _netmask$ ]]; then
-        name=${var%_netmask}
-        netmask[$name]="$value"
-    elif [[ "$var" =~ _gateway$ ]]; then
-        name=${var%_gateway}
-        gateway[$name]="$value"
-    elif [[ "$var" =~ _gateway6$ ]]; then
-        name=${var%_gateway6}
-        gateway6[$name]="$value"
-    elif [[ "$var" =~ _mac$ ]]; then
-        name=${var%_mac}
-        mac[$name]="$value"
-    elif [[ "$var" == "dns_resolvers" ]]; then
-        dns_resolvers=(${value//,/ })
-    fi
-
-    eval "CONFIG_$var"="$value"
-done
-
-# This must happen befor any other dladm commands (which includes log_if_state)
-# or else dladm commands can fail
-dladm init-phys
-
-log_if_state before
-
-typeset -A mac_to_link
-out=$(dladm show-phys -mpo link,address)
-(( $? == 0 )) || fatal "dladm show-phys failed"
-while IFS=: read link addr; do
-    mac=$(normalize_mac $addr)
-    mac_to_link["$mac"]="$link"
-done <<< "$out"
-
-ADMIN_NIC_TAG=${CONFIG_admin_tag:-"admin"}
-[[ -n "${tagv[$ADMIN_NIC_TAG]}" ]] || \
-    fatal "ERROR: admin nic tag '$ADMIN_NIC_TAG' not present"
-
-nic="${tagv[$ADMIN_NIC_TAG]}"
-
-if [[ -n "${aggr_links[$nic]}" ]]; then
-    mode=${aggr_mode[$nic]:-"off"}
-
-    for l in ${aggr_links[$nic]}; do
-        [[ -n "${mac_to_link[$l]}" ]] || fatal "MAC '$l' not present"
-        links+="${mac_to_link[$l]} "
-    done
-    links="${links% }"
-
-    echo "Creating aggr: $nic (mode=$mode, links=${links})"
-    dladm create-aggr -l ${links// / -l } -L $mode $nic
-
-    if [[ -n "${mtu[$nic]}" ]]; then
-        dladm set-linkprop -p mtu=${mtu[$nic]} $nic || \
-            fatal "ERROR: Failed to set mtu on aggr $nic to ${mtu[$nic]}"
-    fi
-elif valid_mac "$nic"; then
-    [[ -n "${mac_to_link[$nic]}" ]] || \
-        fatal "ERROR: admin mac address $nic not found on system"
-    nic=${mac_to_link[$nic]}
-else
-    fatal "ERROR: Invalid value of ${ADMIN_NIC_TAG}_nic ($nic)"
-fi
-
-driver=${nic%%[0-9]*}
-get_link_state $nic
-if [[ "$link_state" == "down" ]]; then
-    echo "admin nic '${nic}' is down: unplumbing"
-    /sbin/ifconfig $nic down unplumb
-    wait_for_nic_state $nic "unknown"
-fi
-
-# There's some sort of race condition in the bnx driver: if the plumb
-# command comes too soon after the unplumb, the interface can come up
-# in a state where it never fires interrupts for link state changes.
-if [[ "$driver" == "bnx" ]]; then
-    sleep 5
-fi
-
-/sbin/ifconfig $nic plumb mtu ${mtu[$ADMIN_NIC_TAG]}
-wait_for_nic_state $nic "up"
-
-if [[ -n "${ip[$ADMIN_NIC_TAG]}" ]]; then
-    /sbin/ifconfig $nic inet ${ip[$ADMIN_NIC_TAG]} \
-        netmask ${netmask[$ADMIN_NIC_TAG]:-"+"} up
-    [[ -n "${gateway[$ADMIN_NIC_TAG]}" ]] && \
-        /usr/sbin/route add default ${gateway[$ADMIN_NIC_TAG]}
-fi
-
-if [[ -n "${ip6[$ADMIN_NIC_TAG]}" ]]; then
-    /sbin/ifconfig $nic inet6 plumb mtu ${mtu[$ADMIN_NIC_TAG]}
-    [[ "${ip6[$ADMIN_NIC_TAG]}" != "addrconf" ]] && \
-        /sbin/ifconfig $nic inet6 addif ${ip6[$ADMIN_NIC_TAG]} preferred up
-    [[ -n "${gateway6[$ADMIN_NIC_TAG]}" ]] && \
-        /usr/sbin/route add -inet6 default ${gateway6[$ADMIN_NIC_TAG]}
-fi
-
-# Add just the routes reachable through the admin network -- usually these are
-# only present with rack aware networking (RAN)
-/usr/lib/sdc/net-boot-config --routes | while read dst gw; do
-    if ! ip_in_net $gw ${ip[$ADMIN_NIC_TAG]} ${netmask[$ADMIN_NIC_TAG]}; then
-        continue
-    fi
-    route add "$dst" "$gw"
-done
-
-if [[ -n "${CONFIG_dns_domain}" && -n ${dns_resolvers[0]} ]]; then
-    echo "search ${CONFIG_dns_domain}" > /etc/resolv.conf
-    for serv in ${dns_resolvers[@]}; do
-        echo "nameserver $serv" >> /etc/resolv.conf
-    done
-fi
-
-touch /etc/svc/volatile/.early_admin_setup
-
-log_if_state after
diff --git a/overlay/generic/lib/svc/method/net-physical b/overlay/generic/lib/svc/method/net-physical
deleted file mode 100644
index d4868c6d..00000000
--- a/overlay/generic/lib/svc/method/net-physical
+++ /dev/null
@@ -1,845 +0,0 @@
-#!/usr/bin/ksh93
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-#
-# Copyright (c) 1984, 1986, 1987, 1988, 1989 AT&T. All rights reserved.
-# Copyright (c) 1999, 2010, Oracle and/or its affiliates. All rights reserved.
-# Copyright 2019 Joyent, Inc.
-#
-
-. /lib/svc/share/smf_include.sh
-. /lib/sdc/config.sh
-. /lib/sdc/network.sh
-
-set -o errexit
-set -o xtrace
-
-#
-# In a shared-IP zone we need this service to be up, but all of the work
-# it tries to do is irrelevant (and will actually lead to the service
-# failing if we try to do it), so just bail out.
-# In the global zone and exclusive-IP zones we proceed.
-#
-smf_configure_ip || exit ${SMF_EXIT_OK}
-
-# Make sure that the libraries essential to this stage of booting can be found.
-LD_LIBRARY_PATH=/lib; export LD_LIBRARY_PATH
-
-# Time (in seconds) to wait for admin NIC to get DHCP address before continuing.
-ADMIN_DHCP_TIMEOUT=300
-ActiveAggrLinks=
-typeset -A ActiveAggrLinks
-
-smf_netstrategy
-
-function add_active_aggr_links
-{
-    set -o xtrace
-    typeset alink
-
-    for alink in ${2//,/ }; do
-        ActiveAggrLinks[$alink]=$1
-    done
-}
-
-# Waits for up to 10 seconds for the link state to change to the given value
-function wait_for_admin_nic_state
-{
-    wait_for_nic_state "${SYSINFO_NIC_admin}" "$1"
-}
-
-# Plumbs the admin interface, and attempts to work around poorly-behaved
-# drivers that can't handle plumb commands too quickly after one another
-function plumb_admin
-{
-    set -o xtrace
-    driver=${SYSINFO_NIC_admin%%[0-9]*}
-    get_link_state ${SYSINFO_NIC_admin}
-    if [[ "$link_state" == "down" ]]; then
-        echo "admin nic '${SYSINFO_NIC_admin}' is down: unplumbing"
-        /sbin/ifconfig ${SYSINFO_NIC_admin} down unplumb
-        wait_for_admin_nic_state "unknown"
-    fi
-
-    # There's some sort of race condition in the bnx driver: if the plumb
-    # command comes too soon after the unplumb, the interface can come up
-    # in a state where it never fires interrupts for link state changes.
-    if [[ "$driver" == "bnx" ]]; then
-        sleep 5
-    fi
-    /sbin/ifconfig ${SYSINFO_NIC_admin} plumb mtu ${CONFIG_admin_mtu:-1500}
-    wait_for_admin_nic_state "up"
-}
-
-# Creates, plumbs and brings up a vnic with the specified inet parameters
-function vnic_up
-{
-    set -o xtrace
-
-    typeset link="$1"
-    typeset iface="$2"
-    typeset ip="$3"
-    typeset netmask="$4"
-    typeset vlan_id="$5"
-    typeset mac_addr="$6"
-    typeset dhcp_primary="$7"
-    typeset mtu="$8"
-    typeset details=
-    typeset vlan_opt=
-    typeset mac_addr_opt=
-    typeset prop_opt=
-
-    details="link='${link}', iface='${iface}', ip='${ip}'"
-    details="${details}, netmask='${netmask}, vlan_id='${vlan_id}'"
-
-    if [[ -z ${link} ]] || [[ -z ${iface} ]] || \
-       [[ -z ${ip} ]] || ([[ ${ip} != "dhcp" ]] && [[ -z ${netmask} ]]); then
-        echo "WARNING: not bringing up nic (insufficient configuration): " \
-             "$details"
-        return
-    fi
-
-    eval "vnic_already_up=\${vnic_${iface}_up}"
-    if [[ -n "${vnic_already_up}" ]]; then
-        echo "vnic already up: $details"
-        return
-    fi
-
-    if [[ -n ${mac_addr} ]] && [[ -n ${ActiveAggrLinks[${mac_addr}]} ]]; then
-        echo "WARNING: trying to assign MAC address \"${mac_addr}\" to vnic," \
-            " but it already belongs to link aggr " \
-            "\"${ActiveAggrLinks[${mac_addr}]}\""
-        return
-    fi
-
-    echo "Bringing up nic: $details"
-
-    if [[ -n ${vlan_id} ]] && [[ ${vlan_id} != 0 ]]; then
-        vlan_opt="-v ${vlan_id}"
-    fi
-
-    if [[ -n ${mac_addr} ]]; then
-        mac_addr_opt="-m ${mac_addr}"
-    fi
-
-    if [[ -n ${mtu} ]]; then
-        valid_mtu ${iface} ${mtu}
-        prop_opt="-p mtu=${mtu}"
-    fi
-
-    /usr/sbin/dladm create-vnic -t -l ${link} ${prop_opt} ${vlan_opt} \
-        ${mac_addr_opt} ${iface}
-    if [[ $? -ne 0 ]]; then
-        echo "Failed to create VNIC ${iface}"
-        exit $SMF_EXIT_ERR_FATAL
-    fi
-
-    /sbin/ifconfig ${iface} plumb
-    if [[ $? -ne 0 ]]; then
-        echo "Failed to plumb ${iface}"
-        exit $SMF_EXIT_ERR_FATAL
-    fi
-
-    if [[ ${ip} == "dhcp" ]]; then
-        # We ignore errors here because the most common one is that DHCP
-        # is already running.
-
-        if [[ -n ${dhcp_primary} ]]; then
-            /sbin/ifconfig ${iface} dhcp primary || /bin/true
-        else
-            /sbin/ifconfig ${iface} dhcp || /bin/true
-        fi
-    else
-        /sbin/ifconfig ${iface} inet ${ip} netmask ${netmask} up
-    fi
-    eval "vnic_${iface}_up=true"
-}
-
-# Creates, plumbs and brings up a vnic with the specified inet6 parameters
-function vnic_up6
-{
-    set -o xtrace
-
-    typeset link="$1"
-    typeset iface="$2"
-    typeset ip="$3"
-    typeset vlan_id="$4"
-    typeset mac_addr="$5"
-    typeset mtu="$6"
-    typeset details=
-    typeset vlan_opt=
-    typeset mac_addr_opt=
-    typeset prop_opt=
-
-    details="link='${link}', iface='${iface}', ip6='${ip}'"
-    details="${details}, vlan_id='${vlan_id}'"
-
-    if [[ -z ${link} ]] || [[ -z ${iface} ]] || [[ -z ${ip} ]]; then
-        echo "WARNING: not bringing up nic (insufficient configuration): " \
-             "$details"
-        return
-    fi
-
-    if [[ -n ${mac_addr} ]] && [[ -n ${ActiveAggrLinks[${mac_addr}]} ]]; then
-        echo "WARNING: trying to assign MAC address \"${mac_addr}\" to vnic," \
-            " but it already belongs to link aggr " \
-            "\"${ActiveAggrLinks[${mac_addr}]}\""
-        return
-    fi
-
-    # only bring up nic if not already up
-    eval "vnic_already_up=\${vnic_${iface}_up}"
-    if [[ -z "${vnic_already_up}" ]]; then
-        echo "Bringing up nic: $details"
-
-        if [[ -n ${vlan_id} ]] && [[ ${vlan_id} != 0 ]]; then
-            vlan_opt="-v ${vlan_id}"
-        fi
-
-        if [[ -n ${mac_addr} ]]; then
-            mac_addr_opt="-m ${mac_addr}"
-        fi
-
-        if [[ -n ${mtu} ]]; then
-            valid_mtu ${iface} ${mtu}
-            prop_opt="-p mtu=${mtu}"
-        fi
-
-        /usr/sbin/dladm create-vnic -t -l ${link} ${prop_opt} ${vlan_opt} \
-            ${mac_addr_opt} ${iface}
-        if [[ $? -ne 0 ]]; then
-            echo "Failed to create VNIC ${iface}"
-            exit $SMF_EXIT_ERR_FATAL
-        fi
-    fi
-
-    /sbin/ifconfig ${iface} inet6 plumb
-    if [[ $? -ne 0 ]]; then
-        echo "Failed to plumb ${iface}"
-        exit $SMF_EXIT_ERR_FATAL
-    fi
-
-    if [[ -n ${ip} ]]; then
-        /sbin/ifconfig ${iface} inet6 up
-    fi
-    if [[ ${ip} != "addrconf" ]]; then
-        /sbin/ifconfig ${iface} inet6 \
-            addif ${ip} preferred up
-    fi
-    eval "vnic_${iface}_up=true"
-}
-
-# If there are aggregations in sysinfo, set them up.
-function create_aggrs
-{
-    set -o xtrace
-    typeset links macs mode mtu
-    if [[ -z "${SYSINFO_Aggregations}" ]]; then
-        return 0
-    fi
-
-    aggrs=(${SYSINFO_Aggregations//,/ })
-    for aggr in "${aggrs[@]}"; do
-        eval "links=\${SYSINFO_Aggregation_${aggr}_Interfaces}"
-        eval "macs=\${SYSINFO_Aggregation_${aggr}_MACs}"
-        eval "mode=\${SYSINFO_Aggregation_${aggr}_LACP_mode}"
-        eval "mtu=\${CONFIG_${aggr}_mtu}"
-        [[ -z "$mode" ]] && mode="off"
-
-        echo "Creating aggr: ${aggr} (mode=${mode}, links=${links})"
-        dladm create-aggr -l ${links//,/ -l } -L ${mode} ${aggr}
-        if [[ $? -eq 0 ]]; then
-            add_active_aggr_links ${aggr} ${macs}
-        fi
-
-        if [[ -n "$mtu" ]]; then
-            dladm set-linkprop -p mtu=${mtu} ${aggr}
-            if [[ $? -ne 0 ]]; then
-                echo "Failed to set mtu on aggr ${aggr} to ${mtu}"
-                exit $SMF_EXIT_ERR_FATAL
-            fi
-        fi
-    done
-
-    # Creating the aggregations may affect the nic tags in sysinfo, so update:
-    /usr/bin/sysinfo -u
-    load_sdc_sysinfo
-}
-
-#
-# Try various config parameters to set the default route
-#
-function set_default_route
-{
-    set -o xtrace
-    typeset default_gw
-
-    if [[ -n "${CONFIG_headnode_default_gateway}" ]]; then
-        default_gw="${CONFIG_headnode_default_gateway}"
-
-    elif [[ -n ${CONFIG_admin_gateway} ]]; then
-        default_gw="${CONFIG_admin_gateway}"
-
-    elif [[ -n ${BOOT_admin_gateway} ]]; then
-        default_gw=${BOOT_admin_gateway}
-
-    elif [[ -n ${CONFIG_external_gateway} ]]; then
-        default_gw=${CONFIG_external_gateway}
-    fi
-
-    if [[ -n ${default_gw} ]]; then
-        echo "${default_gw}" > /etc/defaultrouter
-    fi
-
-    if [[ -n ${CONFIG_admin_gateway6} ]]; then
-        default_gw6="${CONFIG_admin_gateway6}"
-
-    elif [[ -n ${BOOT_admin_gateway6} ]]; then
-        default_gw6=${BOOT_admin_gateway6}
-
-    elif [[ -n ${CONFIG_external_gateway6} ]]; then
-        default_gw6=${CONFIG_external_gateway6}
-    fi
-
-    if [[ -n ${default_gw6} ]]; then
-        # add static route
-        /usr/sbin/route add -inet6 default ${default_gw6}
-    fi
-}
-
-#
-# Go through and set up the MTU for all of the various nic tags
-#
-function setup_mtu
-{
-    set -o xtrace
-    typeset tag oldifs val mac link curmtu
-    typeset -A mtus
-    typeset -A tagmap
-
-    set -o xtrace
-    oldifs=$IFS
-    IFS=,
-    for tag in ${SYSINFO_Nic_Tags}; do
-        eval "val=\${CONFIG_${tag}_mtu}"
-        eval "mac=\${CONFIG_${tag}_nic}"
-        [[ -z "$val" ]] && continue
-
-        valid_mtu ${tag} $val
-
-        #
-        # Note, it doesn't matter what tag we use for a given mac
-        # address, because we'll always get the same link name later on.
-        #
-        if [[ -z "${tagmap[$mac]}" ]]; then
-            tagmap[$mac]=$tag
-        fi
-
-        if [[ -z "${mtus[$mac]}" ]]; then
-            mtus[$mac]=$val
-        elif [[ "${mtus[$mac]}" -lt $val ]]; then
-            mtus[$mac]=$val
-        fi
-    done
-    IFS=$oldifs
-
-    for mac in ${!mtus[@]}; do
-        tag=${tagmap[$mac]}
-        eval "link=\${SYSINFO_NIC_${tag}}"
-        if [[ -z "${link}" ]]; then
-            echo "/usbkey/config error: Missing link name for ${tag}"
-            exit $SMF_EXIT_ERR_FATAL
-        fi
-
-        #
-        # Check the current MTU of the device. To help out devices which
-        # don't support the setting of the MTU (here's looking at you
-        # bnx), if the MTU is identical to its default, don't do
-        # anything and save the poor folks stuck with bnx some grief.
-        #
-        curmtu=$(/usr/sbin/dladm show-linkprop -c -o value -p mtu ${link})
-        [[ $? -eq 0 ]] && [[ "$curmtu" -eq "${mtus[$mac]}" ]] && continue
-
-            if ! /usr/sbin/dladm set-linkprop -p mtu=${mtus[$mac]} ${link}; then
-                echo "Failed to set mtu to ${mtus[$mac]} for link ${link}"
-                exit $SMF_EXIT_ERR_FATAL
-            fi
-    done
-}
-
-
-# Helper function for plumbing an interface for an address family once
-typeset -A plumbedifs
-function plumbif
-{
-    iface=$1
-    inet=$2
-    addrtype=$3
-    if [[ -z ${plumbedifs[${iface},${inet}]} ]]; then
-        plumbedifs[${iface},${inet}]="true"
-        /sbin/ifconfig ${iface} ${inet} plumb
-        if [[ ! ${addrtype} =~ "^vrrp" ]]; then
-            /sbin/ifconfig ${iface} ${inet} up
-        fi
-    fi
-}
-
-if smf_is_globalzone; then
-    EARLY_ADMIN=
-    [[ -f /etc/svc/volatile/.early_admin_setup ]] && EARLY_ADMIN=1
-    [[ -n "$EARLY_ADMIN" ]] || /usr/sbin/dladm init-phys
-
-    # The next command is for logging purposes only
-    log_if_state before
-
-    # Load sysinfo variables with SYSINFO_ prefix: we primarily care about
-    # the NIC_variables, which contain the actual interface name for a nic
-    # tag (it has mapped the foo_nic=<MAC address> variables to interface
-    # names for us).
-    load_sdc_sysinfo
-
-    if boot_file_config_enabled; then
-        # We have a boot-time networking file present - use its values rather
-        # than ones from the config file or bootparams
-        if ! boot_file_config_valid; then
-            echo "ERROR: boot-time network config file incorrect"
-            exit ${SMF_EXIT_ERR_CONFIG}
-        fi
-
-        load_boot_file_config
-
-        # NOTE: some of the routes boot_file_config_init tries to add may
-        # fail if they are admin network routes added by the
-        # network/early-admin service.  This is expected and not a problem.
-        boot_file_config_init
-    else
-        # Load config variables with CONFIG_ prefix,
-        # and sets the headnode variable
-        load_sdc_config
-        # Load boot params with BOOT_ prefix
-        load_sdc_bootparams
-    fi
-
-    # Set up etherstubs
-    for stub in $(echo "${CONFIG_etherstub}" | sed -e "s/,/ /g"); do
-        /usr/sbin/dladm create-etherstub -t $stub || echo "ERROR: could not create etherstub ${stub}."
-    done
-
-    # Create aggregations
-    create_aggrs
-
-    # Make any mtu adjustments that may be necessary
-    setup_mtu
-
-    # Setup admin NIC
-    ADMIN_NIC_TAG=${CONFIG_admin_tag:-"admin"}
-
-    # If there is no NIC with the admin tag, and the config has
-    # admin_nic_autoselect=true, designate the first NIC reported
-    # by dladm for admin use. This is useful in environments where
-    # the NICs are known to change beneath us.
-    if [[ "${BOOT_smartos}" == "true" ]] && \
-        [[ "${CONFIG_admin_nic_autoselect}" == "true" ]] && \
-        ! nictagadm exists $ADMIN_NIC_TAG ; then
-        autoselected_admin_nic=$(dladm show-phys -m -p -o address | head -n1)
-        if [[ -z ${autoselected_admin_nic} ]] ; then
-            echo "ERROR: no NICs found, unable to autoselect admin NIC."
-            exit ${SMF_EXIT_ERR_CONFIG}
-        fi
-
-        nictagadm add $ADMIN_NIC_TAG "${autoselected_admin_nic}"
-        if [[ $? -ne 0 ]] ; then
-            echo "ERROR: unable to add admin tag to NIC ${autoselected_admin_nic}"
-            exit ${SMF_EXIT_ERR_FATAL}
-        fi
-
-        SYSINFO_NIC_admin=$(dladm show-phys -m -p -o link | head -n1)
-        if [[ -n ${SYSINFO_NIC_admin} ]] ; then
-            echo "Autoselected ${SYSINFO_NIC_admin} for use as admin NIC."
-        fi
-
-        nictagadm list
-    elif [[ -v CONFIG_admin_tag ]]; then
-        #
-        # This handles the case when the 'admin_tag' property is set to
-        # override the default admin nic tag.
-        #
-        eval SYSINFO_NIC_admin='$'SYSINFO_NIC_${CONFIG_admin_tag}
-
-        eval CONFIG_admin_ip='$'CONFIG_${CONFIG_admin_tag}_ip
-        eval CONFIG_admin_ip6='$'CONFIG_${CONFIG_admin_tag}_ip6
-        eval CONFIG_admin_netmask='$'CONFIG_${CONFIG_admin_tag}_netmask
-        eval CONFIG_admin_mtu='$'CONFIG_${CONFIG_admin_tag}_mtu
-        eval CONFIG_admin_gateway='$'CONFIG_${CONFIG_admin_tag}_gateway
-        eval CONFIG_admin_gateway6='$'CONFIG_${CONFIG_admin_tag}_gateway6
-    fi
-
-    if [[ -z "${SYSINFO_NIC_admin}" ]]; then
-        echo "ERROR: admin NIC not found, unable to bring up admin network."
-        exit ${SMF_EXIT_ERR_CONFIG}
-    fi
-
-    [[ -n "$EARLY_ADMIN" ]] || plumb_admin
-
-    # Prefer the config file for admin nic values, but use
-    # bootparams if present
-    admin_ip=${CONFIG_admin_ip}
-    if [[ -z "$admin_ip" ]]; then
-        admin_ip=${BOOT_admin_ip}
-    fi
-
-    admin_netmask=${CONFIG_admin_netmask}
-    if [[ -z "$admin_netmask" ]]; then
-        admin_netmask=${BOOT_admin_netmask}
-    fi
-
-    admin_ip6=${CONFIG_admin_ip6}
-    if [[ -z "$admin_ip6" ]]; then
-        admin_ip6=${BOOT_admin_ip6}
-    fi
-
-    if [[ $admin_ip == 'none' ]]; then
-        echo 'INFO: not configuring IP on admin interface (admin_ip=none)'
-    elif [[ -n "$EARLY_ADMIN" ]]; then
-        echo 'INFO: admin interface already configured (early setup)'
-        ADMIN_NIC_UP=true
-    elif [[ -n $admin_ip ]] && [[ -n $admin_netmask ]]; then
-        /sbin/ifconfig ${SYSINFO_NIC_admin} inet ${admin_ip} \
-            netmask ${admin_netmask} up
-        ADMIN_NIC_UP=true
-
-        # also setup resolv.conf if we can
-        if [[ -n ${CONFIG_dns_domain} ]] && [[ -n ${CONFIG_dns_resolvers} ]]; then
-            echo "search ${CONFIG_dns_domain}" > /etc/resolv.conf
-            if [[ -n ${CONFIG_binder_admin_ips} ]]; then
-               for serv in $(echo "${CONFIG_binder_admin_ips}" | sed -e "s/,/ /g"); do
-                   echo "nameserver ${serv}" >> /etc/resolv.conf
-               done
-            fi
-            for serv in $(echo "${CONFIG_dns_resolvers}" | sed -e "s/,/ /g"); do
-                echo "nameserver ${serv}" >> /etc/resolv.conf
-            done
-        fi
-    else
-        if [[ ${headnode} == "true" ]]; then
-            echo "ERROR: headnode but no admin_{ip,netmask} in config, not bringing up admin network."
-            # Set a flag, but try to plumb the other interfaces anyway
-            ADMIN_NIC_MISCONFIGURED=true
-        else
-            # We ignore errors here because the most common one is that DHCP is
-            # already running.
-            /sbin/ifconfig ${SYSINFO_NIC_admin} dhcp || /bin/true
-
-            # Wait for DHCP
-            timeout=${ADMIN_DHCP_TIMEOUT}
-            dhcp_admin_ip=$(/sbin/ifconfig ${SYSINFO_NIC_admin} | grep inet | awk '{ print $2 }')
-            while [[ (-z ${dhcp_admin_ip} || ${dhcp_admin_ip} == "0.0.0.0") && ${timeout} -gt 0 ]]; do
-                dhcp_admin_ip=$(/sbin/ifconfig ${SYSINFO_NIC_admin} | grep inet | awk '{ print $2 }')
-                timeout=$((${timeout} - 1))
-                sleep 1
-            done
-
-            ADMIN_NIC_UP=true
-        fi
-    fi
-
-    if [[ -n ${admin_ip6} && -z "$EARLY_ADMIN" ]]; then
-        # Plumb interface for inet6
-        ifconfig ${SYSINFO_NIC_admin} inet6 \
-            plumb mtu ${CONFIG_admin_mtu:-1500} up
-
-        # Autodiscovery IPv6 using SLAAC
-        # NOTE: in.ndpd will be started later, due to plumbing the interface.
-        #       this means autodiscovery also happens when configuring a
-        #       static address.
-        #
-        #       in.ndpd also sets a default route and this can't be disabled.
-
-        # Configure static IPv6
-        if [[ ${admin_ip6} != "addrconf" ]]; then
-            /sbin/ifconfig ${SYSINFO_NIC_admin} inet6 \
-                addif ${admin_ip6} preferred up
-        fi
-
-        ADMIN_NIC_UP=true
-
-        # don't setup resolv.conf, IPv6 addresses already work
-    fi
-
-    # If on Parallels or VirtualBox, create a bridge which
-    # allows traffic to flow correctly to the host-only network
-    if [[ "${ADMIN_NIC_UP}" == "true" ]] \
-        && [[ ${SYSINFO_Product} == "Parallels Virtual Platform" \
-              || ${SYSINFO_Product} == "VirtualBox" ]] \
-        && [[ -z $(/usr/sbin/dladm show-bridge -p vmwarebr) ]]; then
-        /usr/sbin/dladm create-bridge -l ${SYSINFO_NIC_admin} vmwarebr
-    fi
-
-    # Setup the external NIC. The installer may have already set up external0,
-    # so, if it exists, we're not going to try and set up the vnic again.
-    if [[ -n ${SYSINFO_NIC_external} ]] \
-        && ! dladm show-vnic external0 > /dev/null; then
-
-        if [[ -n "${CONFIG_external_ip}" ]]; then
-            vnic_up "${SYSINFO_NIC_external}" "external0" \
-                "${CONFIG_external_ip}" "${CONFIG_external_netmask}" \
-                "${CONFIG_external_vlan_id}" "${CONFIG_external_mac}" \
-                "primary" "${CONFIG_external_mtu}"
-        fi
-
-        if [[ -n "${CONFIG_external_ip6}" ]]; then
-            vnic_up6 "${SYSINFO_NIC_external}" "external0" \
-                "${CONFIG_external_ip6}" \
-                "${CONFIG_external_vlan_id}" "${CONFIG_external_mac}" \
-                "${CONFIG_external_mtu}"
-        fi
-    fi
-
-    set_default_route
-
-    # Setup extra nics, if specified in the config file
-    nic_tags="${SYSINFO_Nic_Tags}"
-    if [[ -n "${nic_tags}" ]]; then
-        tags=(${nic_tags//,/ })
-
-        if boot_file_config_enabled; then
-            bootparam_ip_keys=""
-            bootparam_ip6_keys=""
-            config_ip_keys=${CONFIG_bootfile_ip_keys//,/ }
-            config_ip6_keys=${CONFIG_bootfile_ip6_keys//,/ }
-        else
-            bootparam_ip_keys=$(sdc_bootparams_keys | grep -- "-ip$" || true)
-            bootparam_ip6_keys=$(sdc_bootparams_keys | grep -- "-ip6$" || true)
-            config_ip_keys=$(sdc_config_keys | grep "_ip$" || true)
-            config_ip6_keys=$(sdc_config_keys | grep "_ip6$" || true)
-        fi
-
-        for tag in "${tags[@]}"; do
-
-            eval "link=\${SYSINFO_NIC_${tag}}"
-            if [[ -z "${link}" ]]; then
-                echo "WARNING: No link found with tag '${tag}'"
-                continue
-            fi
-
-            for key in ${config_ip_keys}; do
-                if [[ ${key} == ${tag}[0-9]_ip ]] || [[ ${key} == ${tag}[0-9][0-9]_ip ]]; then
-                    iface=${key//_ip/}
-                    #echo "   iface=$iface"
-                    eval "ip=\${CONFIG_${iface}_ip}"
-                    eval "netmask=\${CONFIG_${iface}_netmask}"
-                    eval "vlan=\${CONFIG_${iface}_vlan_id}"
-                    eval "macaddr=\${CONFIG_${iface}_mac}"
-                    eval "mtu=\${CONFIG_${iface}_mtu}"
-
-                    echo vnic_up "${link}" "${iface}" "${ip}" "${netmask}" "${vlan}" "${macaddr}" "${mtu}"
-                    vnic_up "${link}" "${iface}" "${ip}" "${netmask}" \
-                        "${vlan}" "${macaddr}" "" "${mtu}"
-                fi
-            done
-
-            for key in ${bootparam_ip_keys}; do
-                if [[ ${key} == ${tag}[0-9]-ip ]] || [[ ${key} == ${tag}[0-9][0-9]-ip ]]; then
-                    iface=${key//-ip/}
-                    eval "ip=\${BOOT_${iface}_ip}"
-                    eval "netmask=\${BOOT_${iface}_netmask}"
-                    eval "vlan=\${BOOT_${iface}_vlan_id}"
-                    eval "macaddr=\${BOOT_${iface}_mac}"
-                    eval "mtu=\${CONFIG_${iface}_mtu}"
-                    echo vnic_up "${link}" "${iface}" "${ip}" "${netmask}" "${vlan}" "${macaddr}" "${mtu}"
-                    vnic_up "${link}" "${iface}" "${ip}" "${netmask}" \
-                        "${vlan}" "${macaddr}" "" "${mtu}"
-                fi
-            done
-
-            for key in ${config_ip6_keys}; do
-                if [[ ${key} == ${tag}[0-9]_ip6 ]] || [[ ${key} == ${tag}[0-9][0-9]_ip6 ]]; then
-                    iface=${key//_ip6/}
-                    #echo "   iface=$iface"
-                    eval "ip=\${CONFIG_${iface}_ip6}"
-                    eval "vlan=\${CONFIG_${iface}_vlan_id}"
-                    eval "macaddr=\${CONFIG_${iface}_mac}"
-                    eval "mtu=\${CONFIG_${iface}_mtu}"
-
-                    echo vnic_up6 "${link}" "${iface}" "${ip}" "${vlan}" "${macaddr}" "${mtu}"
-                    vnic_up6 "${link}" "${iface}" "${ip}" \
-                        "${vlan}" "${macaddr}" "${mtu}"
-                fi
-            done
-
-            for key in ${bootparam_ip6_keys}; do
-                if [[ ${key} == ${tag}[0-9]-ip6 ]] || [[ ${key} == ${tag}[0-9][0-9]-ip6 ]]; then
-                    iface=${key//-ip6/}
-                    eval "ip=\${BOOT_${iface}_ip6}"
-                    eval "vlan=\${BOOT_${iface}_vlan_id}"
-                    eval "macaddr=\${BOOT_${iface}_mac}"
-                    eval "mtu=\${CONFIG_${iface}_mtu}"
-                    echo vnic_up6 "${link}" "${iface}" "${ip}" "${vlan}" "${macaddr}" "${mtu}"
-                    vnic_up6 "${link}" "${iface}" "${ip}" \
-                        "${vlan}" "${macaddr}" "${mtu}"
-                fi
-            done
-
-        done
-    fi
-else
-    # Non-global zones
-
-    # Bring up statically assigned interfaces, and find the primary DHCP
-    # interface, if it exists
-    while IFS=: read -r iface addrtype; do
-        # Keep track of whether or not we've configured our first IPv4
-        # address on this interface
-        first_ipv4_configured=""
-        iface_configured=""
-
-        if [[ -f /etc/dhcp.${iface} ]]; then
-            plumbif ${iface} inet ${addrtype}
-            if [[ -z "${primary}" ]]; then
-                /sbin/ifconfig ${iface} auto-dhcp primary
-                primary=${iface}
-            else
-                /sbin/ifconfig ${iface} auto-dhcp
-            fi
-            first_ipv4_configured="true"
-            iface_configured="true"
-        fi
-
-        if [[ -f /etc/hostname.${iface} ]]; then
-            while read ifparams; do
-                # For IPv4, we need to set the address on the first logical
-                # interface. For IPv6, the address on the first interface is
-                # the link-local address, and can't be changed.
-                #
-                # Lines starting with inet indicate the hostname for that
-                # interface, and are used by dhcpagent. Skip over them.
-                if [[ -f /etc/dhcp.${iface} && "${ifparams}" == inet* ]]; then
-                    continue
-                elif [[ "${ifparams}" == {3}({1,3}(\d).){1,3}(\d)* ]]; then
-                    plumbif ${iface} inet ${addrtype}
-                    if [[ -z "${first_ipv4_configured}" ]]; then
-                        first_ipv4_configured="true"
-                        ifcommand="inet"
-                    else
-                        ifcommand="inet addif"
-                    fi
-                else
-                    plumbif ${iface} inet6 ${addrtype}
-                    ifcommand="inet6 addif"
-                fi
-
-                # vrrp interfaces can't be brought up with ifconfig: vrrpadm
-                # handles that instead
-                if [[ "${addrtype}" =~ "^vrrp" ]]; then
-                    /sbin/ifconfig ${iface} ${ifcommand} \
-                        `printf "%s" "${ifparams}" | sed -e 's/ up//'`
-                else
-                    /sbin/ifconfig ${iface} ${ifcommand} ${ifparams} up
-                fi
-
-                iface_configured="true"
-            done < /etc/hostname.${iface}
-        fi
-
-        if [[ -f /etc/addrconf.${iface} ]]; then
-            # Enable the NDP daemon, so that once this script finishes, we'll
-            # be able to pick up router advertisments and finish configuring
-            # the network interface. We then just need to plumb the interface,
-            # and let in.ndpd take care of configuring addresses.
-            svcadm enable svc:/network/routing/ndp:default
-            plumbif ${iface} inet6 ${addrtype}
-            iface_configured="true"
-        fi
-
-        # If we didn't configure the device at all, mark it for DHCP if we
-        # don't do DHCP on anyone else.
-        if [[ -z ${iface_configured} && -z "${first_iface}" ]]; then
-            first_iface=${iface}
-        fi
-    done < <(/usr/sbin/dladm show-vnic -p -o link,macaddrtype 2>/dev/null)
-
-    if [[ -z "${primary}" && -n "${first_iface}" ]]; then
-        first_iface_type=$(dladm show-vnic ${first_iface} -p -o macaddrtype)
-        plumbif ${first_iface} inet ${first_iface_type}
-        /sbin/ifconfig ${first_iface} auto-dhcp
-        primary=${first_iface}
-    fi
-
-    while IFS=: read -r iface addrtype; do
-        if [[ "${iface}" == "${primary}"
-              || -f /etc/hostname.${iface}
-              || -f /etc/dhcp.${iface}
-              || -f /etc/addrconf.${iface}
-              || "${addrtype}" =~ "^vrrp" ]]; then
-            continue
-        fi
-
-        plumbif ${iface} inet ${addrtype}
-        /sbin/ifconfig ${iface} auto-dhcp start wait 0
-    done < <(/usr/sbin/dladm show-vnic -p -o link,macaddrtype 2>/dev/null)
-fi
-
-log_if_state after
-
-# Since we hopefully made networking changes here, update the sysinfo cache
-if smf_is_globalzone; then
-    /usr/bin/sysinfo -u
-fi
-
-# Enable symmetric routing: when there are multiple nics configured, always
-# take into account the interface a packet is being sent over when
-# selecting a route. This prevents packets being sent with another nic's
-# source IP.
-/usr/sbin/ndd -set /dev/ip ip_strict_src_multihoming 1
-
-# If the admin nic was missing config options, exit with a config error
-if [[ -n "${ADMIN_NIC_MISCONFIGURED}" ]]; then
-    exit ${SMF_EXIT_ERR_CONFIG}
-fi
-
-if [[ $admin_ip == 'none' ]]; then
-    #
-    # We're done, even if there are not any usable IP addresses.
-    #
-    exit $SMF_EXIT_OK
-fi
-
-# Any non-loopback IPv4 interfaces with usable addresses up?
-if [[ -n "`/sbin/ifconfig -a4u`" ]]; then
-    /sbin/ifconfig -a4u | while read intf addr rest; do
-        [[ ${intf} == "inet" ]] && [[ ${addr} != "127.0.0.1" ]] &&
-        [[ ${addr} != "0.0.0.0" ]] && exit ${SMF_EXIT_OK}
-    done && exit ${SMF_EXIT_OK}
-fi
-
-# Any DHCP interfaces started?
-[[ -n "`/sbin/ifconfig -a4 dhcp status 2>/dev/null`" ]] && exit ${SMF_EXIT_OK}
-
-# Any non-loopback IPv6 interfaces up?
-if [[ -n "`/sbin/ifconfig -au6`" ]]; then
-    /sbin/ifconfig -au6 | while read intf addr rest; do
-        [[ ${intf} = "inet6" ]] && [[ ${addr} != "::1/128" ]] && exit ${SMF_EXIT_OK}
-    done && exit ${SMF_EXIT_OK}
-fi
-
-# This service was supposed to configure something yet didn't.  Exit
-# with config error.
-exit ${SMF_EXIT_ERR_CONFIG}
diff --git a/overlay/generic/lib/svc/method/smartdc-config b/overlay/generic/lib/svc/method/smartdc-config
deleted file mode 100755
index 510c93ad..00000000
--- a/overlay/generic/lib/svc/method/smartdc-config
+++ /dev/null
@@ -1,211 +0,0 @@
-#!/bin/bash
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-# Copyright 2019 Joyent, Inc.
-#
-
-#
-# Despite its "smartdc/config" name, this service is used both for SmartOS and
-# Triton. It has two jobs:
-#
-# During an initial setup, this runs through the initial (possibly interactive)
-# configuration.
-#
-# During normal operation, it does some miscellaneous configuration based on
-# /usbkey/config (which, under Triton, will have already been updated from the
-# USB key by svc:/system/filesystem/smartdc:default).
-#
-
-set -o errexit
-set -o xtrace
-
-. /lib/svc/share/smf_include.sh
-. /lib/sdc/config.sh
-
-export PATH="/usr/sbin:/sbin:/usr/bin"
-
-set_root_password() {
-    enc_password=$1
-
-    sed -e "s|^root:[^\:]*:|root:${enc_password}:|" /etc/shadow > /etc/shadow.new \
-      && chmod 400 /etc/shadow.new \
-      && mv /etc/shadow.new /etc/shadow
-}
-
-case "$1" in
-'start')
-
-    # If we're a headnode, see if we have to do interactive configuration.
-    if /bin/bootparams | grep "^headnode=true" > /dev/null 2>&1; then
-        USB_PATH=/mnt/`svcprop -p "joyentfs/usb_mountpoint" svc:/system/filesystem/smartdc:default`
-
-        # Check for config and run interactive if it doesn't exist.
-        if [[ ! -f ${USB_PATH}/config ]]; then
-            if /bin/bootparams | grep "^noimport=true" >/dev/null 2>&1; then
-                # Skipping interactive config, bypass rest of script.
-                exit $SMF_EXIT_OK
-            fi
-
-            /smartdc/lib/sdc-on-tty -d /dev/console \
-                ${USB_PATH}/scripts/prompt-config.sh "${USB_PATH}"
-
-            # If user quit from interactive configuration then we're done.
-            [[ ! -f ${USB_PATH}/config ]] && exit $SMF_EXIT_OK
-        fi
-    elif /bin/bootparams | grep "^smartos=true" > /dev/null 2>&1; then
-        USB_PATH=/`svcprop -p "joyentfs/usb_copy_path" svc:/system/filesystem/smartdc:default`
-
-        # Check for config and run interactive if it doesn't exist.
-        if [[ ! -f ${USB_PATH}/config ]]; then
-            if /bin/bootparams | grep "^noimport=true" >/dev/null 2>&1; then
-                # Skipping interactive config, bypass rest of script.
-                exit $SMF_EXIT_OK
-            fi
-
-            /smartdc/lib/sdc-on-tty -d /dev/console \
-                /smartdc/lib/smartos_prompt_config.sh "${USB_PATH}"
-
-            # If user quit from interactive configuration then we're done.
-            [[ ! -f ${USB_PATH}/config ]] && exit $SMF_EXIT_OK
-        fi
-    fi
-
-    # This puts config vars in CONFIG_
-    load_sdc_config
-    load_sdc_sysinfo
-
-    # Write the info about this datacenter to /.dcinfo so we can use in the GZ
-    echo "SDC_DATACENTER_NAME='${CONFIG_datacenter_name}'" > /.dcinfo
-
-    if [[ -n "${SYSINFO_Bootparam_smartos}" && -f /usbkey/shadow ]]; then
-        echo "setting root password from /usbkey/shadow"
-    # Boot parameter takes precidence over config
-    elif [[ -n "${SYSINFO_Bootparam_root_shadow}" ]]; then
-        set_root_password "${SYSINFO_Bootparam_root_shadow}"
-        echo "Set root password boot parameters."
-    elif [[ -n "${CONFIG_root_shadow}" ]]; then
-        set_root_password "${CONFIG_root_shadow}"
-        echo "Set root password from config."
-    else
-        echo "No root shadow entry in the config, cannot set."
-    fi
-
-    # Set authorized_keys for root
-    if [[ -n "${CONFIG_root_authorized_keys_file}" ]] \
-        && [[ -n "${CONFIG_config_inc_dir}" ]] \
-        && [[ -d "${CONFIG_config_inc_dir}" ]] \
-        && [[ -f "${CONFIG_config_inc_dir}/${CONFIG_root_authorized_keys_file}" ]]; then
-
-        mkdir -p /root/.ssh
-        cp "${CONFIG_config_inc_dir}/${CONFIG_root_authorized_keys_file}" /root/.ssh/authorized_keys
-        chmod 0600 /root/.ssh/authorized_keys
-        chmod 0700 /root/.ssh
-    fi
-
-    if [[ -n "${CONFIG_ntp_conf_file}" ]] \
-        && [[ -n "${CONFIG_config_inc_dir}" ]] \
-        && [[ -d "${CONFIG_config_inc_dir}" ]] \
-        && [[ -f "${CONFIG_config_inc_dir}/${CONFIG_ntp_conf_file}" ]]; then
-        #
-        # We were given a valid NTP configuration file, so use it without
-        # modification:
-        #
-        cp "${CONFIG_config_inc_dir}/${CONFIG_ntp_conf_file}" \
-          /etc/inet/ntp.conf
-        echo "Copied NTP configuration."
-    else
-        #
-        # If we have an admin network defined, allow time service from this
-        # network:
-        #
-        ntp_aflag=
-        if [[ -n ${CONFIG_admin_network} && -n ${CONFIG_admin_netmask} ]]; then
-            if [[ "${CONFIG_admin_network}" != "..." ]]; then
-                ntp_aflag="-a ${CONFIG_admin_network}/${CONFIG_admin_netmask}"
-            fi
-        fi
-
-        #
-        # If we were given a list of servers, use it:
-        #
-        ntp_hosts="${CONFIG_ntp_hosts}"
-        if [[ -z "${ntp_hosts}" ]]; then
-            #
-            # Otherwise, use the default SmartOS vendor pool from the NTP
-            # Pool Project:
-            #
-            ntp_hosts='0.smartos.pool.ntp.org'
-        fi
-
-        #
-        # Generate NTP configuration:
-        #
-        if ! /smartdc/lib/ntp_config -f /etc/inet/ntp.conf \
-          -s "${ntp_hosts}" ${ntp_aflag}; then
-            echo "FATAL: could not configure NTP" >&2
-            exit ${SMF_EXIT_ERR_CONFIG}
-        fi
-        echo "Generated NTP configuration."
-    fi
-
-    # set the keymap. For dvorak for instance
-    if [[ -n ${CONFIG_default_keymap} ]]; then
-        /usr/bin/loadkeys ${CONFIG_default_keymap}
-    fi
-
-    #
-    # In SmartOS, disabling SMT via the boot option is a pain, so we support a
-    # config option in /usbkey/config, the official mechanism for permanent
-    # configuration.  We'd like to do this earlier but we have to wait for
-    # /usbkey to be mounted first. This does imply we've potentially handed out
-    # "too many" interrupts for the set of CPUs remaining online.
-    #
-    if [[ -n $(/bin/bootparams | grep '^smartos=true') ]]; then
-        if [[ "$CONFIG_smt_enabled" = "false" ]]; then
-            psradm -aS || exit $SMF_EXIT_ERR_FATAL
-        fi
-    fi
-
-    # Enable virtual terminals to support interactive installation
-    vtdaemon="svc:/system/vtdaemon"
-    svccfg -s ${vtdaemon} setprop options/hotkeys=true
-    svcadm refresh ${vtdaemon}
-    svcadm enable ${vtdaemon}
-    svcadm enable svc:/system/console-login:vt2
-    svcadm enable svc:/system/console-login:vt3
-    svcadm enable svc:/system/console-login:vt4
-    svcadm enable svc:/system/console-login:vt5
-    svcadm enable svc:/system/console-login:vt6
-
-    # force update of sysinfo (and dump to stdout so we have in the log)
-    sysinfo -f
-
-    ;;
-
-'stop')
-    ;;
-
-*)
-    echo "Usage: $0 { start | stop }"
-    exit $SMF_EXIT_ERR_FATAL
-    ;;
-esac
-exit $SMF_EXIT_OK
diff --git a/overlay/generic/lib/svc/method/smartdc-init b/overlay/generic/lib/svc/method/smartdc-init
deleted file mode 100755
index 1b2a5500..00000000
--- a/overlay/generic/lib/svc/method/smartdc-init
+++ /dev/null
@@ -1,246 +0,0 @@
-#!/bin/bash
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2018, Joyent, Inc.
-#
-
-export PS4='[\D{%FT%TZ}] ${BASH_SOURCE}:${LINENO}: ${FUNCNAME[0]:+${FUNCNAME[0]}(): }'
-set -o xtrace
-
-. /lib/svc/share/smf_include.sh
-. /lib/sdc/config.sh
-
-# Make sure working directory is / to prevent unmounting problems.
-cd /
-PATH=/usr/sbin:/usr/bin; export PATH
-
-wait_and_clear()
-{
-    while [ true ]; do
-        # It seems like jobs -p can miscount if we don't run jobs first
-        jobs >/dev/null
-        local cnt=`jobs -p | wc -l`
-        [ $cnt -eq 0 ] && break
-        for s in `svcs -x | nawk '{
-            if ($1 ~ /^svc:/) nm=$1
-            if ($1 == "State:" && $2 == "maintenance") print nm
-        }'`
-        do
-            svcadm clear $s
-        done
-        sleep 1
-    done
-}
-
-# Sets the default firewall rules for a node (unless they're already set)
-set_default_fw_rules() {
-    local fw_default_v
-    if [[ -f /var/fw/.default_rules_setup ]]; then
-        read fw_default_v < /var/fw/.default_rules_setup
-    else
-        fw_default_v=0
-    fi
-
-    # Handle empty files from before we started versioning default rules
-    if [[ -z $fw_default_v ]]; then
-        fw_default_v=1
-    fi
-
-    if [[ $fw_default_v -lt 1 ]]; then
-        /usr/sbin/fwadm add -f - <<RULES
-{
-  "rules": [
-  {
-    "description": "allow all ICMPv4 types",
-    "rule": "FROM any TO all vms ALLOW icmp type all",
-    "enabled": true,
-    "global": true
-  }
-  ]
-}
-RULES
-        [[ $? -ne 0 ]] && return 1
-        echo 1 > /var/fw/.default_rules_setup
-    fi
-
-    if [[ $fw_default_v -lt 2 ]]; then
-        /usr/sbin/fwadm add -f - <<RULES
-{
-  "rules": [
-  {
-    "description": "allow all ICMPv6 types",
-    "rule": "FROM any TO all vms ALLOW icmp6 type all",
-    "enabled": true,
-    "global": true
-  }
-  ]
-}
-RULES
-        [[ $? -ne 0 ]] && return 1
-        echo 2 > /var/fw/.default_rules_setup
-    fi
-}
-
-configure_fwadm()
-{
-    if [[ ! -d /var/log/fw/logs ]]; then
-        mkdir -p /var/log/fw/logs
-        mv /var/log/fw/*-*.log /var/log/fw/logs
-    fi
-
-    # See also OS-2635
-    if [[ -f /var/log/fw/fw.log.0 ]]; then
-        for file in /var/log/fw/fw.log.[0-9]*; do
-            mv ${file} "/var/log/fw/fwadm_$(uname -n)_$(stat -c "%y" ${file} | cut -d'.' -f1 | tr ' ' 'T').log"
-        done
-    fi
-    if [[ -f /var/log/fw/fw.log ]]; then
-        mv /var/log/fw/fw.log /var/log/fw/fwadm.log
-    fi
-
-    if [[ ! -e /var/log/fw/fwadm.log ]]; then
-        touch /var/log/fw/fwadm.log
-    fi
-}
-
-configure_vmadm()
-{
-    # ensure /var/log/vm exists for VM.log logs
-    mkdir -p /var/log/vm/logs
-
-    # See also OS-2635
-    if [[ -f /var/log/vm/vm.log.0 ]]; then
-        for file in /var/log/vm/vm.log.[0-9]*; do
-            mv ${file} "/var/log/vm/vmadm_$(uname -n)_$(stat -c "%y" ${file} | cut -d'.' -f1 | tr ' ' 'T').log"
-        done
-    fi
-    if [[ -f /var/log/vm/vm.log ]]; then
-        mv /var/log/vm/vm.log /var/log/vm/vmadm.log
-    fi
-
-    # need to create this file so rotation works
-    if [[ ! -e /var/log/vm/vmadm.log ]]; then
-        touch /var/log/vm/vmadm.log
-    fi
-}
-
-update_root_password()
-{
-
-    enc_password=`nawk -F= '{
-        if ($1 == "root_shadow")
-                print substr($2, 2, length($2) - 2)
-    }' /opt/smartdc/config/node.config`
-
-    [[ -z "$enc_password" ]] && return 0
-
-    sed -e "s|^root:[^\:]*:|root:${enc_password}:|" /etc/shadow \
-      >/etc/shadow.new \
-      && chmod 400 /etc/shadow.new \
-      && mv /etc/shadow.new /etc/shadow
-}
-
-# Loads config file for the node. These are the config values from the headnode
-# plus authorized keys and anything else we want.
-# This function is only invoked on a compute node.
-install_config()
-{
-    # On standalone machines we don't do this update
-    [[ -n $(/usr/bin/bootparams | grep "^standalone=true") ]] && return 0
-
-    load_sdc_config
-
-    curl -k -o /tmp/node.config --silent \
-        "http://${CONFIG_assets_admin_ip}/extra/joysetup/node.config"
-
-    [[ ! -f /tmp/node.config ]] && return 0
-    grep datacenter_name /tmp/node.config >/dev/null 2>&1
-    if [ $? != 0 ]; then
-	# There is no valid config file served by the assets zone
-	rm -f /tmp/node.config
-	return 0
-    fi
-
-    # Install the file if the local copy is different
-    diff /tmp/node.config /opt/smartdc/config/node.config >/dev/null 2>&1
-    if [ $? != 0 ]; then
-	printf "Updating config file\n" >/dev/console
-	mkdir -p /opt/smartdc/config
-	mv /tmp/node.config /opt/smartdc/config
-        update_root_password
-    else
-	rm -f /tmp/node.config
-    fi
-}
-
-case "$1" in
-'start')
-
-    # Always setup socket filter no matter what happens next.
-    /sbin/soconfig -F datafilt datafilt prog '2:2:0,2:2:6,26:2:0,26:2:6'
-
-    USBMOUNT=
-
-    # If we're not importing the pools, we shouldn't try to setup as a headnode
-    # (since there'll be no zpool)
-    if /bin/bootparams | grep "^noimport=true" > /dev/null 2>&1; then
-        exit $SMF_EXIT_OK
-    fi
-
-    # If we're a headnode, we'll not have AMQP args on the cmdline, and we want
-    # to run an initial_script first anyway.
-    if /bin/bootparams | grep "^headnode=true" > /dev/null 2>&1; then
-        USBMOUNT=/mnt/`svcprop -p joyentfs/usb_mountpoint svc:/system/filesystem/smartdc:default`
-
-	# No config file (e.g. user quit during interactive configuration), so
-	# treat as if "noimport=true".
-	[[ ! -f $USBMOUNT/config ]] && exit $SMF_EXIT_OK
-
-        initial_script=${USBMOUNT}/$(grep "^initial_script=" $USBMOUNT/config.inc/generic 2>/dev/null | cut -d'=' -f2-)
-        if [ -n ${initial_script} ] && [ -e ${initial_script} ]; then
-            # Execute the script
-            ${initial_script}
-            result=$?
-            if [ ${result} -eq 2 ]; then
-                # we're rebooting, no need to start ur
-                echo "REBOOTING!" >> /dev/console
-                enable_ur="false"
-            elif [ ${result} -ne 0 ]; then
-                echo "WARNING: initial_script failed with exit code [${result}]."
-                exit $SMF_EXIT_ERR_FATAL
-            fi
-        fi
-    elif /bin/bootparams | grep "^smartos=true" > /dev/null 2>&1; then
-        set_default_fw_rules
-    else
-	install_config
-    fi
-
-    configure_fwadm
-    configure_vmadm
-
-    if /bin/bootparams | grep "^headnode=true" > /dev/null 2>&1; then
-        /usr/sbin/umount $USBMOUNT
-    fi
-
-    ;;
-
-'stop')
-    ;;
-
-*)
-    echo "Usage: $0 { start | stop }"
-    exit $SMF_EXIT_ERR_FATAL
-    ;;
-esac
-exit $SMF_EXIT_OK
diff --git a/overlay/generic/lib/svc/method/smartdc-ur b/overlay/generic/lib/svc/method/smartdc-ur
deleted file mode 100755
index 2c324823..00000000
--- a/overlay/generic/lib/svc/method/smartdc-ur
+++ /dev/null
@@ -1,79 +0,0 @@
-#!/bin/bash
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-#
-# Copyright 2010-2011 Joyent, Inc.  All rights reserved.
-# Use is subject to license terms.
-
-set -o xtrace
-
-. /lib/svc/share/smf_include.sh
-. /lib/sdc/config.sh
-
-PATH=/usr/sbin:/usr/bin; export PATH
-
-if [[ -n "$(/bin/bootparams | grep "^standalone=true")" ||
-  -n "$(/bin/bootparams | grep "^smartos=true")" ]]; then
-    # Standalone and SmartOS systems do not need ur
-    svcadm disable "${SMF_FMRI}"
-    exit $SMF_EXIT_OK
-fi
-
-case "$1" in
-'start')
-    #
-    # Grab AMQP parameters from the kernel command line or headnode config
-    #
-
-    load_sdc_config
-    load_sdc_sysinfo
-
-    if [[ -n ${SYSINFO_Bootparam_rabbitmq} ]]; then
-	rabbit=${SYSINFO_Bootparam_rabbitmq}
-    fi
-    if [[ -z ${rabbit} ]] && [[ -n ${CONFIG_rabbitmq} ]]; then
-        rabbit=${CONFIG_rabbitmq}
-    fi
-
-    if [[ -z $rabbit ]]; then
-	echo "unable to find AMQP parameters!"
-        exit $SMF_EXIT_ERR_FATAL
-    fi
-
-    export AMQP_LOGIN=$(echo $rabbit | cut -d: -f1)
-    export AMQP_PASSWORD=$(echo $rabbit | cut -d: -f2)
-    export AMQP_HOST=$(echo $rabbit | cut -d: -f3)
-    export AMQP_PORT=$(echo $rabbit | cut -d: -f4)
-    export NODE_PATH=/usr/node/node_modules
-
-    /usr/bin/ctrun -l child -o noorphan /smartdc/ur-agent/ur-agent 2>&1 &
-
-    ;;
-
-'stop')
-    ;;
-
-*)
-    echo "Usage: $0 { start | stop }"
-    exit $SMF_EXIT_ERR_FATAL
-    ;;
-esac
-exit $SMF_EXIT_OK
diff --git a/overlay/generic/lib/svc/method/sshd b/overlay/generic/lib/svc/method/sshd
deleted file mode 100755
index 4c8fe33a..00000000
--- a/overlay/generic/lib/svc/method/sshd
+++ /dev/null
@@ -1,132 +0,0 @@
-#!/sbin/sh
-#
-# Copyright 2010 Sun Microsystems, Inc.  All rights reserved.
-# Use is subject to license terms.
-# Copyright 2015 Joyent, Inc.
-#
-
-. /lib/svc/share/ipf_include.sh
-. /lib/svc/share/smf_include.sh
-
-SSHDIR=/etc/ssh
-SSHKEYDIR=/var/ssh
-KEYGEN="/usr/bin/ssh-keygen -q"
-PIDFILE=/var/run/sshd.pid
-
-# Checks to see if RSA, and DSA host keys are available
-# if any of these keys are not present, the respective keys are created.
-create_key_if_configured()
-{
-	keypath=$1
-	keytype=$2
-
-	if [ ! -f $keypath ]; then
-		# 
-		# HostKey keywords in sshd_config may be preceded or
-		# followed by a mix of any number of space or tabs,
-		# and optionally have an = between keyword and
-		# argument.  We use two grep invocations such that we
-		# can match HostKey case insensitively but still have
-		# the case of the path name be significant, keeping
-		# the pattern somewhat more readable.
-		#
-		# The character classes below contain one literal
-		# space and one literal tab.
-		#
-		grep -i "^[ 	]*HostKey[ 	]*=\{0,1\}[ 	]*$keypath" \
-		    $SSHDIR/sshd_config | grep "$keypath" > /dev/null 2>&1
-
-		if [ $? -eq 0 ]; then
-			echo Creating new $keytype public/private host key pair
-			$KEYGEN -f $keypath -t $keytype -N ''
-			if [ $? -ne 0 ]; then
-				echo "Could not create $keytype key: $keypath"
-				exit $SMF_EXIT_ERR_CONFIG
-			fi
-		fi
-	fi
-}
-
-create_host_key()
-{
-	keytype=$1
-	keyname=ssh_host_${keytype}_key
-	if [ -d $SSHKEYDIR ]; then
-		create_key_if_configured $SSHKEYDIR/$keyname $keytype
-	fi
-	create_key_if_configured $SSHDIR/$keyname $keytype
-}
-
-create_ipf_rules()
-{
-	FMRI=$1
-	ipf_file=`fmri_to_file ${FMRI} $IPF_SUFFIX`
-	policy=`get_policy ${FMRI}`
-
-	#
-	# Get port from /etc/ssh/sshd_config
-	#
-	tports=`grep "^Port" /etc/ssh/sshd_config 2>/dev/null | \
-	    awk '{print $2}'`
-
-	echo "# $FMRI" >$ipf_file
-	for port in $tports; do
-		generate_rules $FMRI $policy "tcp" "any" $port $ipf_file
-	done
-}
-
-# This script is being used for two purposes: as part of an SMF
-# start/stop/refresh method, and as a sysidconfig(1M)/sys-unconfig(1M)
-# application.
-#
-# Both, the SMF methods and sysidconfig/sys-unconfig use different
-# arguments..
-
-case $1 in 
-	# sysidconfig/sys-unconfig arguments (-c and -u)
-'-c')
-	create_host_key rsa
-	create_host_key dsa
-	create_host_key ecdsa
-	create_host_key ed25519
-	;;
-
-'-u')
-	# sys-unconfig(1M) knows how to remove ssh host keys, so there's
-	# nothing to do here.
-	:
-	;;
-
-	# SMF arguments (start and restart [really "refresh"])
-
-'ipfilter')
-	create_ipf_rules $2
-	;;
-
-'start')
-	#
-	# If host keys don't exist when the service is started, create
-	# them; sysidconfig is not run in every situation (such as on
-	# the install media).
-	# 
-	create_host_key rsa
-	create_host_key dsa
-	create_host_key ecdsa
-	create_host_key ed25519
-
-	/usr/lib/ssh/sshd
-	;;
-
-'restart')
-	if [ -f "$PIDFILE" ]; then
-		/usr/bin/kill -HUP `/usr/bin/cat $PIDFILE`
-	fi
-	;;
-
-*)
-	echo "Usage: $0 { start | restart }"
-	exit 1
-	;;
-esac	
-
-exit $?
diff --git a/overlay/generic/lib/svc/method/svc-cron b/overlay/generic/lib/svc/method/svc-cron
deleted file mode 100644
index 55033608..00000000
--- a/overlay/generic/lib/svc/method/svc-cron
+++ /dev/null
@@ -1,84 +0,0 @@
-#!/sbin/sh
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-#
-# Copyright 2006 Sun Microsystems, Inc.  All rights reserved.
-# Use is subject to license terms.
-# Copyright 2012 Joyent, Inc.  All rights reserved.
-#
-# Start method script for the cron service.
-#
-
-. /lib/svc/share/smf_include.sh
-
-if [ -p /etc/cron.d/FIFO ]; then
-	if /usr/bin/pgrep -x -u 0 -z `smf_zonename` cron >/dev/null 2>&1; then
-		echo "$0: cron is already running"
-		exit $SMF_EXIT_ERR_NOSMF
-	fi
-fi
-
-if smf_is_globalzone && [ -n "$(bootparams | grep '^headnode=true')" ]; then
-	#
-	# Randomize root's crontab so all HN's are not in sync.
-	#
-	utc_offset=`nawk -F= '{if ($1 == "utc_offset") print $2}' \
-	    /usbkey/config.inc/generic`
-	[ -z "$utc_offset" ] && utc_offset=0
-
-	n=$(date +%S)
-	hr=$(($n % 5))
-	hr=$(($hr + $utc_offset))
-
-	n=$(date +%M)
-	mn=$(($n % 15))
-
-	nawk -v hr=$hr -v mn=$mn '{
-		if (substr($1, 1, 1) == "#") {
-			print $0
-			next
-		}
-		if (substr($2, 1, 1) == "*") {
-			print $0
-			next
-		}
-		if (length($0) == 0) {
-			print $0
-			next
-		}
-
-		printf("%d %d %s %s %s %s", mn, hr, $3, $4, $5, $6)
-		for (i = 7; i <= NF; i++)
-			printf(" %s", $i)
-		printf("\n")
-		mn += 10
-	}' /etc/cron.d/crontabs/root >/etc/cron.d/crontabs/root.$$
-	cp /etc/cron.d/crontabs/root.$$ /etc/cron.d/crontabs/root
-	rm -f /etc/cron.d/crontabs/root.$$
-fi
-
-if [ -x /usr/sbin/cron ]; then
-	/usr/bin/rm -f /etc/cron.d/FIFO
-	/usr/sbin/cron &
-else
-	exit 1
-fi
-exit $SMF_EXIT_OK
diff --git a/overlay/generic/lib/svc/method/svc-resource-mgmt b/overlay/generic/lib/svc/method/svc-resource-mgmt
deleted file mode 100644
index 57fd21c3..00000000
--- a/overlay/generic/lib/svc/method/svc-resource-mgmt
+++ /dev/null
@@ -1,48 +0,0 @@
-#!/sbin/sh
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-#
-# Copyright 2006 Sun Microsystems, Inc.  All rights reserved.
-# Use is subject to license terms.
-# Copyright 2012 Joyent, Inc.  All rights reserved.
-
-. /lib/svc/share/smf_include.sh
-
-# Make sure working directory is / to prevent unmounting problems.
-cd /
-PATH=/usr/sbin:/usr/bin; export PATH
-
-smf_is_globalzone || exit $SMF_EXIT_OK
-
-case "$1" in
-'start')
-	prctl -r -n zone.cpu-shares -v 65535 -t priv -i zone global
-	if [ $? -ne 0 ]; then
-                exit $SMF_EXIT_ERR_FATAL
-        fi
-	;;
-
-*)
-	echo "Usage: $0 start"
-	exit $SMF_EXIT_ERR_FATAL
-	;;
-esac
-exit $SMF_EXIT_OK
diff --git a/overlay/generic/lib/svc/method/svc-zones b/overlay/generic/lib/svc/method/svc-zones
deleted file mode 100644
index c367af8c..00000000
--- a/overlay/generic/lib/svc/method/svc-zones
+++ /dev/null
@@ -1,312 +0,0 @@
-#!/sbin/sh
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-#
-# Copyright (c) 2004, 2010, Oracle and/or its affiliates. All rights reserved.
-# Copyright (c) 2012, Joyent Inc. All rights reserved.
-
-set -o xtrace
-
-. /lib/svc/share/smf_include.sh
-
-ZPOOL=`svcprop -p config/zpool svc:/system/smartdc/init:default 2>/dev/null`
-ZPOOL=${ZPOOL:-zones}
-
-MAN_SRCDIR=/lib/svc/manifest
-MAN_DESTDIR=/$ZPOOL/manifests
-
-MAN_DIRS="\
-	application \
-	milestone \
-	network \
-	network/dns \
-	network/ipsec \
-	network/ldap \
-	network/loadbalancer \
-	network/nfs \
-	network/nis \
-	network/routing \
-	network/rpc \
-	network/security \
-	network/shares \
-	network/smb \
-	network/ssl \
-	site \
-	system \
-	system/device \
-	system/filesystem \
-	system/fm \
-	system/install \
-	system/security \
-	system/svc"
-
-cp_brand_manifests()
-{
-	brand=$1
-
-	# Create the dir hierarchy under the dest dir for SMF manifests.
-	mkdir -m755 $MAN_DESTDIR/$brand
-
-	for dir in $MAN_DIRS
-	do
-		mkdir -m755 $MAN_DESTDIR/$brand/$dir
-	done
-
-	#
-	# Process the SMF SVC configuration list to setup the brand-specific
-	# SMF svcs.
-	#
-	nawk -v base=$MAN_SRCDIR -v dest=$MAN_DESTDIR/$brand '{
-		# Ignore comments and empty lines.
-		if (substr($1, 1, 1) == "#" || length($1) == 0)
-			next
-
-		# entry format is: name status
-		proc_file($1, $2);
-	    }
-
-	    #
-	    # Copy the manifest from the global zone to the brand-specific
-	    # manifest area.  At the same time, update any manifests whose
-	    # status needs to be changed, based on what our configuration
-	    # file indicates.
-	    #
-	    function proc_file(fname, status)
-	    {
-		f = base "/" fname
-		of =  dest "/" fname
-
-		while (getline <f > 0) {
-			# Fix up the console svc to work with zones.
-			if (fname == "system/console-login.xml")
-				sub("wscons", "console")
-
-			if (($1 == "<instance" &&
-			    $2 == "name=\047default\047") ||
-			    $1 == "<create_default_instance") {
-				if (status == "enabled")
-					n=sub("\047false\047", "\047true\047")
-				else
-					n=sub("\047true\047", "\047false\047")
-
-				if (n > 0)
-					printf("update svc state: %s %s\n",
-					    fname, $0)
-			}
-
-			print $0 >of
-		}
-		close(f)
-		close(of)
-	}' /usr/lib/brand/$brand/manifests
-}
-
-#
-# If we're running off of a live-image, setup a zone-specific collection of
-# manifest files which are mounted in a zone's /lib/svc/manifest directory.
-#
-# Regenerate the manifest data each time this service starts, so that it's
-# always in sync with the running platform (and any fixes included there).
-#
-setup_manifests()
-{
-	echo "Initializing manifest dir."
-
-	rm -rf $MAN_DESTDIR
-	mkdir -m755 -p $MAN_DESTDIR
-
-	for i in /usr/lib/brand/*
-	do
-		brand=`basename $i`
-		[[ ! -f /usr/lib/brand/$brand/manifests ]] && continue
-		# joyent-minimal uses /zones/manifests/joyent too
-		[[ "$brand" == "joyent-minimal" ]] && continue
-		cp_brand_manifests $brand
-	done
-}
-
-#
-# Return a list of running, non-global zones for which a shutdown via
-# "/sbin/init 0" may work (typically only Solaris zones.)
-#
-shutdown_zones()
-{
-	zoneadm list -p | nawk -F: '{
-		if ($2 != "global") {
-			print $2
-		}
-	}'
-}
-
-[ ! -x /usr/sbin/zoneadm ] && exit 0	# SUNWzoneu not installed
-
-if [ -z "$SMF_FMRI" ]; then
-	echo "this script can only be invoked by smf(5)"	
-	exit $SMF_EXIT_ERR_NOSMF
-fi
-
-# Make sure working directory is / to prevent unmounting problems.
-cd /
-PATH=/usr/sbin:/usr/bin; export PATH
-
-case "$1" in
-'start')
-	#
-	# Generate the manifest, even if no zones, since zones could be
-	# provisioned later.
-	#
-	zfs list -H -o name $ZPOOL >/dev/null 2>&1 
-	[ $? -eq 0 ] && setup_manifests
-
-	# Create directory for zone sockets
-	mkdir -m755 -p /var/zonecontrol
-
-	egrep -vs '^#|^global:' /etc/zones/index || exit 0  # no local zones
-
-	#
-	# Boot the installed zones for which the "autoboot" zone property is
-	# set and invoke the sysboot hook for all other installed zones.
-	#
-	ZONES=""
-	for zone in `zoneadm list -pi | nawk -F: '{
-			if ($3 == "installed") {
-				print $2
-			}
-		}'`; do
-		zonecfg -z $zone info autoboot | grep "true" >/dev/null 2>&1
-		if [ $? -eq 0 ]; then
-			[ -z "$ZONES" ] && echo "Booting zones:\c"
-			ZONES=yes
-			echo " $zone\c"
-
-			#
-			# Make sure a site dir exists, it wasn't initially
-			# being created.
-			#
-			zonepath=`zonecfg -z $zone info zonepath | cut -d: -f2`
-			[ ! -d $zonepath/site ] && mkdir -m755 $zonepath/site
-
-			#
-			# zoneadmd puts itself into its own contract so
-			# this service will lose sight of it.  We don't
-			# support restart so it is OK for zoneadmd to
-			# to be in an orphaned contract.
-			#
-			zoneadm -z $zone boot &
-		else
-			zoneadm -z $zone sysboot &
-		fi
-	done
-
-	#
-	# Wait for all zoneadm processes to finish before allowing the
-	# start method to exit.
-	#
-	wait
-	[ -n "$ZONES" ] && echo .
-	;;
-
-'stop')
-	egrep -vs '^#|^global:' /etc/zones/index || exit 0  # no local zones
-	[ "`zoneadm list`" = "global" ] && exit 0   # no zones running
-
-	SVC_TIMEOUT=`svcprop -p stop/timeout_seconds $SMF_FMRI`
-
-	#
-	# First, try shutting down any running zones for which an "init 0" may
-	# work.
-	#
-	MAXSHUT=`expr 3 \* $SVC_TIMEOUT \/ 4` # 3/4 of time to zone shutdown
-	MAXHALT=`expr $SVC_TIMEOUT \/ 4`      # rest of time goes to halt
-
-	zonelist=`shutdown_zones`
-
-	if [ -n "$zonelist" ]; then
-		SHUTDOWN=0
-		echo "Shutting down running zones (for up to $MAXSHUT" \
-		    "seconds):\c"
-
-		for zone in $zonelist; do
-			echo " $zone\c"
-			zlogin -S $zone /sbin/init 0 < /dev/null >&0 2>&0 &
-			SHUTDOWN=1
-		done
-
-		[ $SHUTDOWN -eq 1 ] && echo "."
-
-		# Allow time for zones to shutdown cleanly
-
-		while [ $MAXSHUT -gt 0 -a "`shutdown_zones`" != "" ]; do
-			MAXSHUT=`expr $MAXSHUT - 1`
-			sleep 1	# wait a bit longer
-		done
-	fi
-
-	#
-	# Second, try halting any non-global zones still running
-	#
-	WAITPIDS=""
-	for zone in `zoneadm list`; do
-		if [ "$zone" != "global" ]; then
-			[ -z "$WAITPIDS" ] &&
-			    echo "Zones failed to shutdown; trying to halt " \
-			    "(for up to $MAXHALT seconds):\c"
-			echo " $zone\c"
-			zoneadm -z $zone halt &
-			WAITPIDS="$WAITPIDS $!"
-		fi
-	done
-	[ ! -z "$WAITPIDS" ] && echo .
-
-	# Wait for the 'zoneadm halt' commands to complete.  We will let this
-	# run forever, since the restart daemon will eventually kill us off
-	# anyway if the halts do not complete after a certain period of time.
-	wait $WAITPIDS
-
-	# If the halts complete but a zone is still not shutdown, it might
-	# be in a state like 'shutting_down' or 'down'.  So we give it some
-	# time to come all the way down.
-
-	while [ $MAXHALT -gt 0 -a "`zoneadm list`" != "global" ]; do
-		MAXHALT=`expr $MAXHALT - 1`
-		sleep 1	# wait a bit longer
-	done
-
-	# If there are any remaining file systems in zones, try to unmount them.
-	umountall -Z
-
-	#
-	# Report on zones which failed to shutdown.
-	#
-	for zone in `zoneadm list`; do
-		if [ "$zone" != "global" ]; then
-			echo "Zone '$zone' failed to halt."
-		fi
-	done
-	[ "`zoneadm list`" != "global" ] && exit 1   # zones still running
-	;;
-
-*)
-	echo "Usage: $0 { start | stop }"
-	exit 1
-	;;
-esac
-exit 0
diff --git a/overlay/generic/lib/svc/method/sysidtool-net b/overlay/generic/lib/svc/method/sysidtool-net
deleted file mode 100755
index 039e4d00..00000000
--- a/overlay/generic/lib/svc/method/sysidtool-net
+++ /dev/null
@@ -1,2 +0,0 @@
-#!/bin/sh
-exit 0
diff --git a/overlay/generic/lib/svc/method/sysidtool-system b/overlay/generic/lib/svc/method/sysidtool-system
deleted file mode 100755
index 039e4d00..00000000
--- a/overlay/generic/lib/svc/method/sysidtool-system
+++ /dev/null
@@ -1,2 +0,0 @@
-#!/bin/sh
-exit 0
diff --git a/overlay/generic/lib/svc/method/system-log b/overlay/generic/lib/svc/method/system-log
deleted file mode 100644
index 7f7ad92d..00000000
--- a/overlay/generic/lib/svc/method/system-log
+++ /dev/null
@@ -1,186 +0,0 @@
-#!/sbin/sh
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-# Copyright 2006 Sun Microsystems, Inc.  All rights reserved.
-# Use is subject to license terms.
-# Copyright 2016, Joyent, Inc.  All rights reserved.
-#
-
-OLD_CONF=/etc/default/syslogd
-DFLT_SUM="7c87d765805cc45a0dad9fb5c86cc4f2"
-CONF_SUM="$DFLT_SUM"
-
-. /lib/svc/share/smf_include.sh
-
-convert()
-{
-	svccfg -s svc:/system/system-log setprop config/log_from_remote = $1
-	if [ $? -ne 0 ]; then
-		svccfg -s svc:/system/system-log addpg config application
-		svccfg -s svc:/system/system-log \
-		    addpropvalue config/log_from_remote boolean: $1
-		if [ $? -ne 0 ] ; then
-			echo 'Failed to set remote syslog-logging'
-			exit $SMF_EXIT_ERR_CONFIG
-		fi
-	fi
-	echo "Incorporated ${OLD_CONF} settings into SMF. See syslogd(1m)."
-	awk '{
-		if ($1 ~ /^LOG_FROM_REMOTE=/) {
-			print "# LOG_FROM_REMOTE is now set using "
-			    "svccfg(1m), see syslog(1m).";
-		} else {
-			print $0;
-		}
-	}' ${OLD_CONF} >${OLD_CONF}.new && cp ${OLD_CONF}.new ${OLD_CONF}
-	rm -f ${OLD_CONF}.new
-}
-
-#
-# If the rsyslog.conf file doesn't exist and the syslog.conf file has not
-# been customized, generate the default rsyslog.conf.
-#
-generate_rsyslog_conf()
-{
-	if [ ! -f /etc/syslog.conf ]; then
-		return
-	fi
-
-	CONF_SUM=`nawk '{
-	    if (substr($1, 1, 1) != "#" && NF != 0) print $0
-	    }' /etc/syslog.conf | sum -x md5`
-
-	if [ "$CONF_SUM" != "$DFLT_SUM" ]; then
-		return
-	fi
-
-	cat <<-DONE >/etc/rsyslog.conf
-	#
-	# Sample rsyslog configuration file
-	#
-
-	$ModLoad immark
-	$ModLoad imsolaris
-	$ModLoad imtcp
-	$ModLoad imudp
-
-	*.err;kern.notice;auth.notice			/dev/sysmsg
-	*.err;kern.debug;daemon.notice;mail.crit	/var/adm/messages
-
-	*.alert;kern.err;daemon.err			operator
-	*.alert						root
-
-	*.emerg						*
-
-	mail.debug					/var/log/syslog
-
-	auth.info					/var/log/auth.log
-	mail.info					/var/log/postfix.log
-	DONE
-}
-
-if [ ! -f /etc/rsyslog.conf -a -x /usr/sbin/rsyslogd ]; then
-	generate_rsyslog_conf
-fi
-
-if [ -f /etc/rsyslog.conf ]; then
-	if [ ! -x /usr/sbin/rsyslogd ]; then
-		echo "Executable /usr/sbin/rsyslogd not found or not executable. Exiting."
-		exit $SMF_EXIT_ERR_CONFIG
-	fi
-else
-	#
-	# Fall back to old syslogd
-	#
-	echo "/etc/rsyslog.conf is missing. Using syslogd instead."
-	if [ ! -f /etc/syslog.conf ]; then
-		echo "/etc/syslog.conf is missing. Exiting."
-		exit $SMF_EXIT_ERR_CONFIG
-	fi
-
-	if [ ! -x /usr/sbin/syslogd ]; then
-		echo "Executable /usr/sbin/syslogd not found or not executable. Exiting."
-		exit $SMF_EXIT_ERR_CONFIG
-	fi
-fi
-
-if smf_is_globalzone; then
-	#
-	# Before syslogd starts, save any messages from
-	# previous crash dumps so that messages appear
-	# in chronological order.
-	#
-	/usr/bin/savecore -m
-	if [ -r /etc/dumpadm.conf ]; then
-		. /etc/dumpadm.conf
-		[ -n "$DUMPADM_DEVICE" -a \
-	    	"x$DUMPADM_DEVICE" != xswap ] && \
-	    	/usr/bin/savecore -m -f $DUMPADM_DEVICE
-	fi
-fi
-if [ ! -f /var/adm/messages ]; then
-	/usr/bin/cp /dev/null /var/adm/messages
-	/usr/bin/chmod 0644 /var/adm/messages
-fi
-
-if [ -f /etc/rsyslog.conf ]; then
-	#
-	# If we have a config file for the old syslogd, only run rsyslogd
-	# if there are no customizations in the old syslog.conf file.
-	#
-	if [ -f /etc/syslog.conf ]; then
-		CONF_SUM=`nawk '{
-		    if (substr($1, 1, 1) != "#" && NF != 0) print $0
-		    }' /etc/syslog.conf | sum -x md5`
-	fi
-
-	if [ "$CONF_SUM" == "$DFLT_SUM" ]; then
-		/usr/sbin/rsyslogd -c5 -n &
-		exit $SMF_EXIT_OK
-	fi
-fi
-
-#
-# Run the old syslogd
-#
-remote=`awk -F= '
-	/^LOG_FROM_REMOTE=[yY][Ee][Ss]/ {print "true"}
-	/^LOG_FROM_REMOTE=[Nn][Oo]/     {print "false"}' < ${OLD_CONF}`
-case ${remote} in
-"")
-    ;;
-"true"|"false")
-    convert ${remote}
-    ;;
-*)
-    echo "Unsupported value in for LOG_FROM_REMOTE in ${OLD_CONF}"
-    exit $SMF_EXIT_ERR_CONFIG
-    ;;
-esac
-
-/usr/sbin/syslogd >/dev/msglog 2>&1 &
-
-if [ -f /etc/rsyslog.conf ]; then
-	logger -p daemon.err \
-	    "Not using rsyslogd because there is a custom /etc/syslog.conf file"
-fi
-
-exit $SMF_EXIT_OK
diff --git a/overlay/generic/mancheck.conf b/overlay/generic/mancheck.conf
deleted file mode 100644
index d35058a5..00000000
--- a/overlay/generic/mancheck.conf
+++ /dev/null
@@ -1,15 +0,0 @@
-/*
- * Copyright 2015 Joyent, Inc.
- */
-
-/*
- * WARNING:  STOP NOW.  DO NOT MODIFY THIS FILE.
- *
- * mancheck configuration files must comply with the rules detailed in:
- *
- *	smartos-live.git :: tools/mancheck/README.md
- *
- * You should not be making modifications here until you've read the most
- * current copy of that file.  If you need help, contact a gatekeeper for
- * guidance.
- */
diff --git a/overlay/generic/manifest b/overlay/generic/manifest
deleted file mode 100644
index c273c0d9..00000000
--- a/overlay/generic/manifest
+++ /dev/null
@@ -1,194 +0,0 @@
-f .smartdc_version 0444 root root
-d boot/forth 0755 root root
-f boot/forth/menu.rc 0444 root root
-d etc/bash 0755 root sys
-f etc/bash/bash_completion 0644 root sys
-d etc/bash/bash_completion.d 0755 root sys
-f etc/bash/bash_completion.d/dladm 0644 root sys
-f etc/bash/bash_completion.d/zones 0644 root sys
-d etc/cron.d 0755 root sys
-d etc/cron.d/crontabs 0755 root sys
-f etc/cron.d/crontabs/root 0600 root root
-d etc/crypto 0755 root sys
-f etc/crypto/pkcs11.conf 0644 root sys
-d etc/curl 0555 root sys
-d etc/default 0755 root sys
-f etc/default/init 0644 root sys
-f etc/default/login 0644 root sys
-f etc/default/passwd 0644 root sys
-f etc/dispadmin.conf 0644 root sys
-f etc/driver_aliases 0644 root sys
-f etc/driver_classes 0644 root sys
-f etc/dumpadm.conf 0644 root other
-f etc/group 0644 root sys
-d etc/inet 0755 root sys
-f etc/inet/ntp.conf 0644 root sys
-f etc/inet/services 0644 root sys
-f etc/inittab 0644 root sys
-f etc/issue 0644 root sys
-f etc/logadm.conf 0644 root sys
-f etc/minor_perm 0644 root sys
-f etc/motd 0644 root sys
-f etc/name_to_major 0644 root sys
-f etc/nodename 0644 root root
-d etc/notices 0755 root sys
-f etc/notices/COPYRIGHT 0444 root sys
-f etc/nsswitch.conf 0644 root sys
-f etc/opasswd 0644 root sys
-f etc/ouser_attr 0644 root sys
-f etc/passwd 0644 root sys
-f etc/path_to_inst 0444 root root
-f etc/ppt_matches 0444 root root
-f etc/profile 0644 root sys
-f etc/resolv.conf 0644 netadm netadm
-f etc/rtc_config 0644 root root
-f etc/shadow 0400 root sys
-d etc/skel 0755 root sys
-f etc/skel/.bashrc 0644 root other
-d etc/ssh 0755 root sys
-f etc/ssh/sshd_config 0644 root sys
-d etc/svc 0755 root sys
-d etc/svc/profile 0755 root sys
-f etc/svc/profile/generic.xml 0444 root sys
-f etc/svc/profile/platform.xml 0444 root sys
-f etc/syslog.conf 0644 root sys
-f etc/system 0644 root sys
-f etc/user_attr 0644 root sys
-f etc/vfstab 0644 root sys
-d etc/zones 0755 root sys
-f etc/zones/Joyent.xml 0444 root bin
-f etc/zones/SUNWdefault.xml 0444 root bin
-f etc/zshrc 0644 root bin
-d kernel/drv 0755 root sys
-f kernel/drv/amd64/bnx 0755 root sys
-f kernel/drv/buildstamp.conf 0644 root sys
-f kernel/drv/mpt_sas.conf 0644 root sys
-f kernel/drv/sd.conf 0644 root sys
-d lib/sdc 0755 root bin
-f lib/sdc/config.sh 0444 root bin
-f lib/sdc/usb-key.sh 0444 root bin
-f lib/sdc/network.sh 0444 root bin
-f lib/sdc/zone.sh 0444 root bin
-d lib/svc 0755 root bin
-d lib/svc/manifest 0755 root sys
-d lib/svc/manifest/network 0755 root sys
-f lib/svc/manifest/network/ipfilter.xml 0444 root sys
-f lib/svc/manifest/network/network-physical.xml 0444 root sys
-f lib/svc/manifest/network/network-early-admin.xml 0444 root sys
-d lib/svc/manifest/system 0755 root sys
-f lib/svc/manifest/system/auditd.xml 0444 root sys
-f lib/svc/manifest/system/console-login.xml 0444 root sys
-f lib/svc/manifest/system/coreadm.xml 0444 root sys
-d lib/svc/manifest/system/filesystem 0755 root sys
-f lib/svc/manifest/system/filesystem/joyent-fs.xml 0444 root sys
-f lib/svc/manifest/system/filesystem/minimal-fs.xml 0444 root sys
-f lib/svc/manifest/system/mdata.xml 0444 root sys
-f lib/svc/manifest/system/smartdc-config.xml 0444 root sys
-f lib/svc/manifest/system/smartdc-init.xml 0444 root sys
-f lib/svc/manifest/system/smartdc-ur.xml 0444 root sys
-f lib/svc/manifest/system/sysidtool.xml 0444 root sys
-f lib/svc/method/console-login 0555 root bin
-f lib/svc/method/fs-joyent 0555 root sys
-f lib/svc/method/fs-root 0555 root bin
-f lib/svc/method/fs-usr 0555 root bin
-f lib/svc/method/identity-node 0555 root bin
-f lib/svc/method/ipfilter 0555 root sys
-f lib/svc/method/manifest-import 0555 root bin
-f lib/svc/method/mdata-execute 0555 root bin
-f lib/svc/method/mdata-fetch 0555 root bin
-f lib/svc/method/net-early-admin 0555 root bin
-f lib/svc/method/net-physical 0555 root sys
-f lib/svc/method/smartdc-config 0555 root bin
-f lib/svc/method/smartdc-init 0555 root sys
-f lib/svc/method/smartdc-ur 0555 root bin
-f lib/svc/method/sshd 0555 root bin
-f lib/svc/method/sysidtool-net 0555 root bin
-f lib/svc/method/sysidtool-system 0555 root bin
-d root 0755 root root
-f root/.bash_profile 0644 root root
-f root/.bashrc 0644 root root
-f root/.profile 0644 root root
-d smartdc 0555 root bin
-d smartdc/bin 0555 root bin
-f smartdc/bin/sdc-factoryreset 0555 root bin
-f smartdc/bin/sdc-lastcomm 0555 root bin
-f smartdc/bin/sdc-zfs-io-throttle.d 0555 root bin
-f smartdc/lib/smartos_prompt_config.sh 0555 root bin
-d smartdc/man 0555 root bin
-d smartdc/man/man1 0555 root bin
-f smartdc/man/man1/sdc-lastcomm.1 0444 root bin
-f smartdc/man/man1/sdc-zfs-io-throttle.1 0444 root bin
-d smartdc/vm-upgrade 0755 root root
-f smartdc/vm-upgrade/001_upgrade 0555 root bin
-f usr/bin/json 0555 root bin
-f usr/include/usb.h 0444 root bin
-d usr/lib/brand 0755 root bin
-d usr/lib/brand/jcommon 0755 root bin
-f usr/lib/brand/jcommon/cattach 0444 root root
-f usr/lib/brand/jcommon/cdetach 0444 root root
-f usr/lib/brand/jcommon/cinstall 0444 root root
-f usr/lib/brand/jcommon/cuninstall 0444 root root
-f usr/lib/brand/jcommon/libhooks.ksh 0444 root root
-f usr/lib/brand/jcommon/poststate 0444 root root
-f usr/lib/brand/jcommon/prestate 0444 root root
-f usr/lib/brand/jcommon/query 0555 root root
-f usr/lib/brand/jcommon/statechange 0444 root root
-d usr/lib/brand/joyent 0755 root bin
-d usr/lib/brand/joyent-minimal 0755 root bin
-f usr/lib/brand/joyent-minimal/config.xml 0444 root root
-f usr/lib/brand/joyent-minimal/jattach 0555 root root
-f usr/lib/brand/joyent-minimal/jdetach 0555 root root
-f usr/lib/brand/joyent-minimal/jinstall 0555 root root
-f usr/lib/brand/joyent-minimal/juninstall 0555 root root
-f usr/lib/brand/joyent-minimal/manifests 0444 root root
-f usr/lib/brand/joyent-minimal/platform.xml 0444 root root
-f usr/lib/brand/joyent-minimal/poststate 0555 root root
-f usr/lib/brand/joyent-minimal/prestate 0555 root root
-s usr/lib/brand/joyent-minimal/query=../jcommon/query
-f usr/lib/brand/joyent-minimal/statechange 0555 root root
-f usr/lib/brand/joyent/config.xml 0444 root root
-f usr/lib/brand/joyent/jattach 0755 root root
-f usr/lib/brand/joyent/jdetach 0755 root root
-f usr/lib/brand/joyent/jinstall 0755 root root
-f usr/lib/brand/joyent/juninstall 0755 root root
-f usr/lib/brand/joyent/manifests 0444 root root
-f usr/lib/brand/joyent/platform.xml 0444 root root
-f usr/lib/brand/joyent/poststate 0755 root root
-f usr/lib/brand/joyent/prestate 0755 root root
-s usr/lib/brand/joyent/query=../jcommon/query
-f usr/lib/brand/joyent/statechange 0755 root root
-d usr/lib/brand/kvm 0755 root bin
-f usr/lib/brand/kvm/config.xml 0444 root root
-f usr/lib/brand/kvm/kattach 0755 root root
-f usr/lib/brand/kvm/kdetach 0755 root root
-f usr/lib/brand/kvm/kinstall 0755 root root
-f usr/lib/brand/kvm/kuninstall 0755 root root
-f usr/lib/brand/kvm/platform.xml 0444 root root
-f usr/lib/brand/kvm/poststate 0755 root root
-f usr/lib/brand/kvm/prestate 0755 root root
-f usr/lib/brand/kvm/statechange 0755 root root
-d usr/lib/brand/lx 0755 root bin
-f usr/lib/brand/lx/config.xml 0444 root root
-f usr/lib/brand/lx/lx_install 0755 root root
-f usr/lib/brand/lx/lx_uninstall 0755 root root
-f usr/lib/brand/lx/poststate 0755 root root
-f usr/lib/brand/lx/prestate 0755 root root
-f usr/lib/brand/lx/statechange 0755 root root
-d usr/lib/localedef 0755 root bin
-d usr/lib/localedef/extensions 0755 root bin
-f usr/lib/localedef/extensions/UTF-8.x 0444 root bin
-f usr/sbin/fssstat 0555 root bin
-f usr/sbin/zonememstat 0555 root bin
-f usr/sbin/zonemon 0555 root bin
-d usr/share/bhyve 0555 root bin
-f usr/share/bhyve/uefi-csm-rom.bin 0444 root bin
-f usr/share/bhyve/uefi-rom.bin 0444 root bin
-f usr/share/man/man1/json.1 0444 root bin
-f usr/share/man/man1m/fssstat.1m 0444 root bin
-d var/db 0755 root sys
-d var/db/imgadm 0755 root bin
-d var/fw 0755 root bin
-d var/log 0755 root sys
-d var/log/sdc 0755 root sys
-d var/log/sdc/upload 0755 root sys
-d var/log/vm 0755 root sys
diff --git a/overlay/generic/root/.bash_profile b/overlay/generic/root/.bash_profile
deleted file mode 100644
index dc732f68..00000000
--- a/overlay/generic/root/.bash_profile
+++ /dev/null
@@ -1,12 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-#
-
-#
-# Copyright (c) 2014, Joyent, Inc.
-#
-
-[ -f /root/.profile ] && source /root/.profile
-[ -f /root/.bashrc ] && source /root/.bashrc
diff --git a/overlay/generic/root/.bashrc b/overlay/generic/root/.bashrc
deleted file mode 100644
index 0f06d70e..00000000
--- a/overlay/generic/root/.bashrc
+++ /dev/null
@@ -1,57 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-#
-
-#
-# Copyright (c) 2014, Joyent, Inc.
-#
-
-if [ "$PS1" ]; then
-    mt_tty=$(/usr/bin/tty 2>/dev/null)
-    if [[ $mt_tty =~ ^/dev/term/[abcd] ]]; then
-        # If we're on the serial console, we generally won't know how
-        # big our terminal is.  Attempt to ask it using control sequences
-        # and resize our pty accordingly.
-        mt_output=$(/usr/lib/measure_terminal 2>/dev/null)
-        if [[ $? -eq 0 ]]; then
-            eval "$mt_output"
-        else
-            # We could not read the size, but we should set a 'sane'
-            # default as the dimensions of the previous user's terminal
-            # persist on the tty device.
-            export LINES=25
-            export COLUMNS=80
-        fi
-        /usr/bin/stty rows ${LINES} columns ${COLUMNS} 2>/dev/null
-    fi
-    unset mt_output mt_tty
-    shopt -s checkwinsize
-    if [[ -f /.dcinfo ]]; then
-        . /.dcinfo
-        DC_NAME="${SDC_DATACENTER_NAME}"
-    fi
-    if [[ -n "${DC_NAME}" ]]; then
-       PS1="[\u@\h (${DC_NAME}) \w]\\$ "
-    else
-       PS1="[\u@\h \w]\\$ "
-    fi
-    alias ll='ls -lF'
-    alias ls='ls --color=auto'
-    [ -n "${SSH_CLIENT}" ] && export PROMPT_COMMAND='echo -ne "\033]0;${HOSTNAME} \007" && history -a'
-fi
-
-# Load bash completion
-[ -f /etc/bash/bash_completion ] && . /etc/bash/bash_completion
-
-svclog() {
-  if [[ -z "$PAGER" ]]; then
-    PAGER=less
-  fi
-  $PAGER `svcs -L $1`
-}
-
-svclogf() {
-  /usr/bin/tail -f `svcs -L $1`
-}
diff --git a/overlay/generic/root/.profile b/overlay/generic/root/.profile
deleted file mode 100644
index 906d43ba..00000000
--- a/overlay/generic/root/.profile
+++ /dev/null
@@ -1,14 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-#
-
-#
-# Copyright (c) 2018, Joyent, Inc.
-#
-
-PATH=/usr/bin:/usr/sbin:/smartdc/bin:/opt/smartdc/bin:/opt/local/bin:/opt/local/sbin:/opt/tools/bin:/opt/tools/sbin:/opt/smartdc/agents/bin
-MANPATH=/usr/share/man:/smartdc/man:/opt/smartdc/man:/opt/local/man:/opt/tools/man
-PAGER=less
-export PATH MANPATH PAGER
diff --git a/overlay/generic/smartdc/bin/sdc-factoryreset b/overlay/generic/smartdc/bin/sdc-factoryreset
deleted file mode 100755
index dad333fb..00000000
--- a/overlay/generic/smartdc/bin/sdc-factoryreset
+++ /dev/null
@@ -1,78 +0,0 @@
-#!/usr/bin/bash
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-#
-
-#
-# Copyright (c) 2014, Joyent, Inc.
-#
-
-#
-# Sets a ZFS property to perform a factory reset, that is, discards all state on
-# this machine and runs setup again.
-#
-
-set -o errexit
-set -o pipefail
-
-myname=$(basename $0)
-
-function abort()
-{
-	printf "\nFactory reset aborted.\n"
-	exit 1
-}
-
-function usage()
-{
-	printf "\nUsage: $myname [-h | --help]\n\n"
-	printf "Resets a machine to its originally installed state.  See "
-	printf "sdc-factoryreset(1)\nfor more information.\n"
-	exit 1
-}
-
-if [[ -n $1 ]] && [[ $1 = "--help" ]]; then
-	usage
-fi
-
-while getopts "h" opt
-do
-	case "$opt" in
-		h)	usage;;
-		*)	usage;;
-	esac
-done
-
-trap abort SIGINT
-
-printf "WARNING: This machine will reboot and destroy its ZFS pools after "
-printf "rebooting.\n"
-
-read -p "Do you want to proceed with the factory reset? (y/n) " -n 1
-
-if [[ $REPLY =~ ^[Yy]$ ]]; then
-	printf "\n\nThis will destroy ALL DATA on the system, including "
-	printf "potential customer data.\n"
-
-	read -p "Are you sure? (y/n) " -n 1
-
-	if [[ $REPLY =~ ^[Yy]$ ]]; then
-		printf "\n\nRebooting in 5 seconds ... "
-		sleep 5
-		printf "now!\n"
-
-		SYS_ZPOOL=$(svcprop -p config/zpool smartdc/init)
-		[[ -n ${SYS_ZPOOL} ]] || SYS_ZPOOL=zones
-
-		zfs set smartdc:factoryreset=yes ${SYS_ZPOOL}/var
-		reboot
-	else
-		abort
-	fi
-else
-	abort
-fi
-
-exit 0
diff --git a/overlay/generic/smartdc/bin/sdc-lastcomm b/overlay/generic/smartdc/bin/sdc-lastcomm
deleted file mode 100755
index f6dcfdf0..00000000
--- a/overlay/generic/smartdc/bin/sdc-lastcomm
+++ /dev/null
@@ -1,122 +0,0 @@
-#!/bin/sh
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-# Copyright 2012, Joyent, Inc.  All rights reserved.
-#
-
-PATH=/usr/bin:/usr/sbin
-export PATH
-unset LD_LIBRARY_PATH
-
-OPT_V=0
-OPT_X=0
-DIR=/var/audit
-while getopts "d:R:vx" opt
-do
-	case "$opt" in
-		d)	DIR="$OPTARG";;
-		R)	DAYS="$OPTARG";;
-		v)	OPT_V="1";;
-		x)	OPT_X="1";;
-		*)	echo "usage: [-d path] [-R days] [-v] [-x]"
-			exit 1
-			;;
-	esac
-done
-shift OPTIND-1
-
-if [[ -n $DAYS ]]; then
-	if [ "$DIR" != "/var/audit" ]; then
-		echo "-R is not valid with -d"
-		exit 1
-	fi
-	# Rotate and trim the audit logs
-	audit -n
-	cd "$DIR" || exit 1
-	find . -type f -mtime +$DAYS -print0 2>/dev/null | xargs -0 rm -f
-	exit 0
-fi
-
-f=`ls $DIR/* | wc -l`
-if [ $f -eq 0 ]; then
-	echo "no audit files"
-	exit 0
-fi
-
-if [ $OPT_X -eq 1 ]; then
-	files=$DIR/*
-else
-	files=`ls -t $DIR/*not* | head -1`
-fi
-
-for i in $files
-do
-    praudit -x $i | nawk -v verbose=$OPT_V '{
-	if ($1 == "<record") {
-		pos = index($0, "iso8601=");
-		if (pos == 0) {
-			dt = "ND";
-		} else {
-			tstr=substr($0, pos + 9)
-			split(tstr, da);
-			dt = da[1] " " da[2];
-		}
-		printf("%s ", dt);
-
-		if ($3 == "event=\"login")
-			cmd="<login>";
-		else if ($3 == "event=\"logout\"")
-			cmd="<logout>";
-		else if ($3 == "event=\"system")
-			cmd="- - <boot>";
-	} else if ($1 == "<subject") {
-		pos = index($0, "tid=");
-		if (pos == 0) {
-			id = "NID";
-		} else {
-			tstr=substr($0, pos + 5)
-			tstr=substr(tstr, 1, length(tstr) - 3)
-			split(tstr, addr);
-			id = addr[1] " " addr[3];
-		}
-		printf("%s ", id);
-	} else if (substr($1, 1, 6) == "<path>") {
-		if (verbose == 1)
-			next;
-		cmd=substr($1, 7);
-		cmd=substr(cmd, 1, length(cmd) - 7);
-
-	} else if (substr($1, 1, 11) == "<exec_args>") {
-		if (verbose == 0)
-			next;
-		cmd=substr($0, 17)
-		pos = index(cmd, "</arg><arg>");
-		while (pos != 0) {
-			head=substr(cmd, 1, pos - 1);
-			tail=substr(cmd, pos + 11, length(cmd));
-			cmd=head " " tail;
-			pos = index(cmd, "</arg><arg>");
-		}
-	} else if ($1 == "</record>") {
-		printf("%s\n", cmd);
-	}
-    }'
-done
diff --git a/overlay/generic/smartdc/bin/sdc-zfs-io-throttle.d b/overlay/generic/smartdc/bin/sdc-zfs-io-throttle.d
deleted file mode 100755
index 91bbc4f1..00000000
--- a/overlay/generic/smartdc/bin/sdc-zfs-io-throttle.d
+++ /dev/null
@@ -1,35 +0,0 @@
-#!/usr/sbin/dtrace -s
-/*
- * This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/.
- */
-
-/*
- * Copyright (c) 2014, Joyent, Inc.
- */
-
-/*
- * Prints the calculations and activity of the ZFS I/O throttle.
- */
-
-#pragma D option quiet
-
-sdt:::zfs-zone-stats
-{
-	printf("Overall: read_t %d, writ_t %d, %d active zones, zone util %d, zone pri %d, disk util %d\n",
-	    arg0, arg1, arg2, arg3, arg4, arg5);
-}
-
-sdt:::zfs-zone-throttle
-/ arg1 != 0 || arg2 != 0 /
-{
-	printf("    Zone %d: Delay %d -> %d  Fairutil: %d, Actutil: %d\n",
-	    arg0, arg1, arg2, arg3, arg4);
-}
-
-sdt:::zfs-zone-utilization
-{
-	printf("    Zone %d: Rops %d, Wops %d, LWops %d, Util %d, Pri %d\n",
-	    arg0, arg1, arg2, arg3, arg4, arg5);
-}
diff --git a/overlay/generic/smartdc/lib/smartos_prompt_config.sh b/overlay/generic/smartdc/lib/smartos_prompt_config.sh
deleted file mode 100755
index 1f76ed68..00000000
--- a/overlay/generic/smartdc/lib/smartos_prompt_config.sh
+++ /dev/null
@@ -1,1345 +0,0 @@
-#!/usr/bin/bash
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-#
-
-#
-# Copyright 2019 Joyent, Inc.
-#
-
-# XXX - TODO
-# - if $ntp_hosts == "local", configure ntp for no external time source
-
-exec 4>>/var/log/prompt-config.log
-echo "=== Starting prompt-config on $(tty) at $(date) ===" >&4
-export PS4='[\D{%FT%TZ}] $(tty): ${BASH_SOURCE}:${LINENO}: ${FUNCNAME[0]:+${FUNCNAME[0]}(): }'
-export BASH_XTRACEFD=4
-set -o xtrace
-
-if [[ -z $(/bin/bootparams | grep "^smartos=true") ]]; then
-	echo "This script should only be run on SmartOS"
-	exit 1
-fi
-
-PATH=/usr/sbin:/usr/bin
-export PATH
-
-. /lib/svc/share/smf_include.sh
-
-. /lib/sdc/config.sh
-load_sdc_sysinfo
-load_sdc_config
-
-# ERRORS (for getanswer's errno)
-ENOTFOUND=1
-EBADJSON=2
-EUNKNOWN=3
-
-# Defaults
-mail_to="root@localhost"
-ntp_hosts="0.smartos.pool.ntp.org"
-dns_resolver1="8.8.8.8"
-dns_resolver2="8.8.4.4"
-
-# Globals
-declare -a states
-declare -a nics
-declare -a assigned
-declare prmpt_str
-
-#
-# Generate a horizontal ruler of appropriate length.  Doing this each time we
-# emit a ruler appears to induce a surprisingly noticeable latency, so we just
-# do it once.
-#
-ruler=
-while (( ${#ruler} < 80 )); do
-	ruler+='-'
-done
-
-#
-# Determine whether we need a trailing newline after the horizontal ruler.  It
-# would seem that most modern terminal emulators behave like the VT100: if the
-# cursor has naturally progressed to the rightmost column _and_ the next
-# character is a newline, the terminal will discard what is effectively a
-# redundant newline.  Unfortunately, the framebuffer terminal emulator in
-# illumos does not currently do this.  Attempt to guess if we are attached to a
-# serial line or not, so as to decide whether we should send the extra newline.
-#
-console=$(bootparams | awk -F= '$1 == "console" { print $2 }')
-if [[ $(/bin/tty) != '/dev/console' ]] || [[ $console =~ ^tty ]]; then
-	ruler+='\n'
-fi
-
-nicsup_done=0
-
-fatal()
-{
-	echo
-	if [[ -n "$1" ]]; then
-		echo "ERROR: $1"
-	fi
-	echo
-	echo "System configuration failed, launching a shell."
-	echo "You must reboot to re-run system configuration."
-	echo "A log of setup may be found in /var/log/prompt-config.log"
-	echo
-	/usr/bin/bash
-}
-
-
-sig_doshell()
-{
-	echo
-	echo
-	echo "Bringing up a shell.  When you are done in the shell hit ^D to"
-	echo "return to the system configuration tool."
-	echo
-
-	/usr/bin/bash
-
-	echo
-	echo "Resuming the system configuration tool."
-	echo
-	printf "$prmpt_str"
-}
-
-ip_to_num()
-{
-	IP=$1
-
-	OLDIFS=$IFS
-	IFS=.
-	set -- $IP
-	num_a=$(($1 << 24))
-	num_b=$(($2 << 16))
-	num_c=$(($3 << 8))
-	num_d=$4
-	IFS=$OLDIFS
-
-	num=$((num_a + $num_b + $num_c + $num_d))
-}
-
-num_to_ip()
-{
-	NUM=$1
-
-	fld_d=$(($NUM & 255))
-	NUM=$(($NUM >> 8))
-	fld_c=$(($NUM & 255))
-	NUM=$(($NUM >> 8))
-	fld_b=$(($NUM & 255))
-	NUM=$(($NUM >> 8))
-	fld_a=$NUM
-
-	ip_addr="$fld_a.$fld_b.$fld_c.$fld_d"
-}
-
-#
-# Converts an IP and netmask to their numeric representation.
-# Sets the global variables IP_NUM, NET_NUM, NM_NUM and BCAST_ADDR to their
-# respective numeric values.
-#
-ip_netmask_to_network()
-{
-	ip_to_num $1
-	IP_NUM=$num
-
-	ip_to_num $2
-	NM_NUM=$num
-
-	NET_NUM=$(($NM_NUM & $IP_NUM))
-
-	ip_to_num "255.255.255.255"
-	local bcasthost=$((~$NM_NUM & $num))
-	BCAST_ADDR=$(($NET_NUM + $bcasthost))
-}
-
-# Sets two variables, USE_LO and USE_HI, which are the usable IP addrs for the
-# largest block of available host addresses on the subnet, based on the two
-# addrs the user has chosen for the GW and External Host IP.
-# We look at the three ranges (upper, middle, lower) defined by the two addrs.
-calc_ext_default_range()
-{
-	local a1=$1
-	local a2=$2
-
-	local lo=
-	local hi=
-	if [ $a1 -lt $a2 ]; then
-		lo=$a1
-		hi=$a2
-	else
-		lo=$a2
-		hi=$a1
-	fi
-
-	u_start=$(($hi + 1))
-	m_start=$(($lo + 1))
-	l_start=$(($NET_NUM + 1))
-
-	u_max=$(($BCAST_ADDR - 1))
-	m_max=$(($hi - 1))
-	l_max=$(($lo - 1))
-
-	up_range=$(($u_max - $u_start))
-	mid_range=$(($m_max - $m_start))
-	lo_range=$(($l_max - $l_start))
-
-	if [ $up_range -gt $mid_range ]; then
-		USE_LO=$u_start
-		USE_HI=$u_max
-		range=$up_range
-	else
-		USE_LO=$m_start
-		USE_HI=$m_max
-		range=$mid_range
-	fi
-
-	if [ $range -lt $lo_range ]; then
-		USE_LO=$l_start
-		USE_HI=$l_max
-	fi
-}
-
-# Tests whether entire string is a number.
-isdigit ()
-{
-	[ $# -eq 1 ] || return 1
-
-	case $1 in
-	*[!0-9]*|"") return 1;;
-	*) return 0;;
-	esac
-}
-
-# Tests network numner (num.num.num.num)
-is_net()
-{
-	NET=$1
-
-	OLDIFS=$IFS
-	IFS=.
-	set -- $NET
-	a=$1
-	b=$2
-	c=$3
-	d=$4
-	IFS=$OLDIFS
-
-	isdigit "$a" || return 1
-	isdigit "$b" || return 1
-	isdigit "$c" || return 1
-	isdigit "$d" || return 1
-
-	[ -z $a ] && return 1
-	[ -z $b ] && return 1
-	[ -z $c ] && return 1
-	[ -z $d ] && return 1
-
-	[ $a -lt 0 ] && return 1
-	[ $a -gt 255 ] && return 1
-	[ $b -lt 0 ] && return 1
-	[ $b -gt 255 ] && return 1
-	[ $c -lt 0 ] && return 1
-	[ $c -gt 255 ] && return 1
-	[ $d -lt 0 ] && return 1
-	return 0
-}
-
-# Tests if input is an email address
-is_email() {
-	regex="^[a-z0-9!#\$%&'*+/=?^_\`{|}~-]+(\.[a-z0-9!#$%&'*+/=?^_\`{|}~-]+)*@([a-z0-9]([a-z0-9-]*[a-z0-9])?\.?)+[a-z0-9]([a-z0-9-]*[a-z0-9])?\$"
-	ADDRESS=$1
-
-	[[ $ADDRESS =~ $regex ]] && return 0
-	return 1
-}
-
-# You can call this like:
-#
-#  value=$(getanswer "foo")
-#  [[ $? == 0 ]] || fatal "no answer for question foo"
-#
-getanswer()
-{
-	local key=$1
-	local answer=""
-	local potential=""
-
-	if [[ -z ${answer_file} ]]; then
-		return ${ENOTFOUND}
-	fi
-
-	# json does not distingush between an empty string and a key that's not
-	# there with the normal output, so we fix that so we can distinguish.
-	answer=$(/usr/bin/cat ${answer_file} \
-		| /usr/bin/json -e "if (this['${key}'] === undefined) this['${key}'] = '<<undefined>>';" \
-		"${key}" 2>&1)
-	if [[ $? != 0 ]]; then
-		if [[ -n $(echo "${answer}" | grep "input is not JSON") ]]; then
-			return ${EBADJSON}
-		else
-			return ${EUNKNOWN}
-		fi
-	fi
-
-	if [[ ${answer} == "<<undefined>>" ]]; then
-		return ${ENOTFOUND}
-	fi
-
-	echo "${answer}"
-	return 0
-}
-
-# Optional input
-promptopt()
-{
-	val=""
-	def="$2"
-	key="$3"
-
-	if [[ -n ${key} ]]; then
-		val=$(getanswer "${key}")
-		if [[ $? == 0 ]]; then
-			if [[ ${val} == "<default>" ]]; then
-				val=${def}
-			fi
-			return
-		fi
-	fi
-
-	if [ -z "$def" ]; then
-		prmpt_str="$1 [press enter for none]: "
-	else
-		prmpt_str="$1 [$def]: "
-	fi
-	printf "$prmpt_str"
-	read val
-	# If def was null and they hit return, we just assign null to val
-	[ -z "$val" ] && val="$def"
-}
-
-promptval()
-{
-	val=""
-	def="$2"
-	key="$3"
-
-	if [[ -n ${key} ]]; then
-		val=$(getanswer "${key}")
-		if [[ ${val} == "<default>" && -n ${def} ]]; then
-			val=${def}
-			return
-		fi
-	fi
-
-	while [ -z "$val" ]; do
-		if [ -n "$def" ]; then
-			prmpt_str="$1 [$def]: "
-		else
-			prmpt_str="$1: "
-		fi
-		printf "$prmpt_str"
-		read val
-		[ -z "$val" ] && val="$def"
-		# Forward and back quotes not allowed
-		echo $val | nawk '{
-		    if (index($0, "\047") != 0)
-		        exit 1
-		    if (index($0, "`") != 0)
-		        exit 1
-		}'
-		if [ $? != 0 ]; then
-			echo "Single quotes are not allowed."
-			val=""
-			continue
-		fi
-		[ -n "$val" ] && break
-		echo "A value must be provided."
-	done
-}
-
-prompt_host_ok_val()
-{
-	val=""
-	def="$2"
-	key="$3"
-
-	if [[ -n ${key} ]]; then
-		val=$(getanswer "${key}")
-		if [[ ${val} == "<default>" && -n ${def} ]]; then
-			val=${def}
-		fi
-	fi
-
-	while [ -z "$val" ]; do
-		if [ -n "$def" ]; then
-			prmpt_str="$1 [$def]: "
-		else
-			prmpt_str="$1: "
-		fi
-		printf "$prmpt_str"
-		read val
-		[ -z "$val" ] && val="$def"
-		if [ -n "$val" ]; then
-			trap "" SIGINT
-			printf "Checking connectivity..."
-			ping $val >/dev/null 2>&1
-			if [ $? != 0 ]; then
-				printf "UNREACHABLE\n"
-			else
-				printf "OK\n"
-			fi
-			trap sig_doshell SIGINT
-			break
-		else
-			echo "A value must be provided."
-		fi
-	done
-}
-
-promptemail()
-{
-	val=""
-	def="$2"
-	key="$3"
-
-	if [[ -n ${key} ]]; then
-		val=$(getanswer "${key}")
-		if [[ ${val} == "<default>" && -n ${def} ]]; then
-			val=${def}
-			is_email "$val" || val=""
-		elif [[ -n ${val} ]]; then
-			is_email "$val" || val=""
-		fi
-	fi
-
-	while [ -z "$val" ]; do
-		if [ -n "$def" ]; then
-			prmpt_str="$1 [$def]: "
-		else
-			prmpt_str="$1: "
-		fi
-		printf "$prmpt_str"
-		read val
-		[ -z "$val" ] && val="$def"
-		is_email "$val" || val=""
-		[ -n "$val" ] && break
-		echo "A valid email address must be provided."
-	done
-}
-
-# Input must be a valid network number (see is_net())
-promptnet()
-{
-	val=""
-	def="$2"
-	key="$3"
-
-	if [[ -n ${key} ]]; then
-		val=$(getanswer "${key}")
-		if [[ ${val} == "<default>" && -n ${def} ]]; then
-			val=${def}
-		fi
-		if [[ ${val} != "none" && ${val} != "dhcp" ]]; then
-			is_net "$val" || val=""
-		fi
-	fi
-
-	while [ -z "$val" ]; do
-		if [ -n "$def" ]; then
-			prmpt_str="$1 [$def]: "
-		else
-			prmpt_str="$1: "
-		fi
-		printf "$prmpt_str"
-		read val
-		[ -z "$val" ] && val="$def"
-		if [[ ${val} != "none" && ${val} != "dhcp" ]]; then
-			is_net "$val" || val=""
-		fi
-		[ -n "$val" ] && break
-		echo "A valid network number (n.n.n.n) or 'dhcp' must be provided."
-	done
-}
-
-printnics()
-{
-	i=1
-	printf "%-6s %-9s %-18s %-7s %-10s\n" "Number" "Link" "MAC Address" \
-	    "State" "Network"
-	while [ $i -le $nic_cnt ]; do
-		printf "%-6d %-9s %-18s %-7s %-10s\n" $i ${nics[$i]} \
-		    ${macs[$i]} ${states[$i]} ${assigned[i]}
-		((i++))
-	done
-}
-
-# Must choose a valid NIC on this system
-promptnic()
-{
-    tag=$(echo $1 | cut -d"'" -f2)
-    if [[ -n ${tag} ]]; then
-        mac=$(getanswer "${tag}_nic")
-        if [[ -n ${mac} ]]; then
-            for idx in ${!macs[*]}; do
-                if [[ ${mac} == ${macs[${idx}]} ]]; then
-                    mac_addr="${macs[${idx}]}"
-                    val="${macs[${idx}]}"
-                    nic_val="${nics[${idx}]}"
-                    return
-                fi
-            done
-        fi
-    fi
-
-    if [[ $nic_cnt -eq 1 ]]; then
-        val="${macs[1]}"
-        nic_val=${nics[1]}
-        return
-    fi
-
-    printnics
-    num=0
-    while [ /usr/bin/true ]; do
-        prmpt_str="Enter the number of the NIC for the $1 interface: "
-        printf "$prmpt_str"
-        read num
-        if ! [[ "$num" =~ ^[0-9]+$ ]] ; then
-                echo ""
-        elif [ $num -ge 1 -a $num -le $nic_cnt ]; then
-                mac_addr="${macs[$num]}"
-                assigned[$num]=$1
-                nic_val=${nics[$num]}
-                break
-        fi
-        # echo "You must choose between 1 and $nic_cnt."
-        updatenicstates
-        printnics
-    done
-
-    val=$mac_addr
-}
-
-readpw()
-{
-	IFS='' read -r -s pw
-	printf '%s' "$pw"
-}
-
-promptpw()
-{
-	def="$3"
-	key="$4"
-
-	if [[ -n ${key} ]]; then
-		preset_val="$(getanswer "${key}")"
-	fi
-
-	trap "" SIGINT
-	while [ /usr/bin/true ]; do
-		val=""
-		while [ -z "$val" ]; do
-			if [[ -n ${preset_val} ]]; then
-				val="${preset_val}"
-			else
-				if [ -z "$def" ]; then
-					printf "%s: " "$1"
-				else
-					printf "%s [enter to keep existing]: " "$1"
-				fi
-				val="$(readpw)"
-				echo
-			fi
-			if [ -n "$val" ]; then
-				if [ "$2" == "chklen" -a ${#val} -lt 6 ]; then
-					echo "The password must be at least" \
-						"6 characters long."
-					val=""
-					preset_val=""
-				else
-					break
-				fi
-			else
-				if [ -n "$def" ]; then
-					val="$def"
-					return
-				else
-					echo "A value must be provided."
-				fi
-			fi
-		done
-
-		cval=""
-		while [ -z "$cval" ]; do
-			if [[ -n ${preset_val} ]]; then
-				cval="${preset_val}"
-			else
-				printf "%s: " "Confirm password"
-				cval="$(readpw)"
-				echo
-			fi
-			[ -n "$cval" ] && break
-			echo "A value must be provided."
-		done
-
-		[ "$val" == "$cval" ] && break
-
-		echo "The entries do not match, please re-enter."
-	done
-	trap sig_doshell SIGINT
-}
-
-updatenicstates()
-{
-	states=(1)
-	#states[0]=1
-	while IFS=: read -r link state ; do
-		states=( ${states[@]-} $(echo "$state") )
-	done < <(dladm show-phys -po link,state 2>/dev/null)
-}
-
-printruler()
-{
-	#
-	# Print the horizontal ruler we have generated for this terminal.  Note
-	# that the ruler string is a printf(1) format string which may include
-	# a newline escape sequence.
-	#
-	printf -- "$ruler"
-}
-
-printheader()
-{
-	local subheader=$1
-
-	if [[ $(getanswer "simple_headers") == "true" ]]; then
-		echo "> ${subheader}"
-		return
-	fi
-
-	clear
-	printf " %-40s\n" "SmartOS Setup"
-	printf " %-40s%38s\n" "$subheader" "https://wiki.smartos.org/install"
-
-	printruler
-}
-
-print_warning()
-{
-	clear
-	printf "WARNING\n"
-	printruler
-	printf "\n$1\n"
-
-	prmpt_str="\nPress [enter] to continue "
-	printf "$prmpt_str"
-	read continue
-}
-
-nicsup()
-{
-	[ $nicsup_done -eq 1 ] && return
-
-	local vlan_opts=""
-	if [[ "$admin_ip" == "dhcp" ]]; then
-		ifconfig $admin_iface up
-		ifconfig $admin_iface dhcp
-	else
-		ifconfig $admin_iface inet $admin_ip netmask $admin_netmask up
-	fi
-
-	if [[ -n ${external_nic} ]]; then
-		if [ -n "$external_vlan_id" ]; then
-			vlan_opts="-v $external_vlan_id"
-		fi
-
-		dladm create-vnic -l $external_iface $vlan_opts external0
-		ifconfig external0 plumb
-		ifconfig external0 inet $external_ip netmask $external_netmask up
-	fi
-
-	if [[ -n ${headnode_default_gateway}
-	    && ${headnode_default_gateway} != "none" ]]; then
-
-		route add default $headnode_default_gateway >/dev/null
-	fi
-
-	nicsup_done=1
-}
-
-nicsdown()
-{
-	ifconfig ${admin_iface} inet down unplumb
-	if [[ -n ${external_nic} ]]; then
-		ifconfig external0 inet down unplumb
-		dladm delete-vnic external0
-	fi
-}
-
-printdisklayout()
-{
-  json -f "$1" | json -e '
-    out = "vdevs:\n";
-    disklist = [];
-    for (var i = 0; i < vdevs.length; i++) {
-      var x = vdevs[i];
-      if (!x.type) {
-        out += "   " + x.name + "\n";
-        continue;
-      }
-      if (x.type === "mirror") {
-        out += "   " + x.type + "  " + x.devices[0].name + " " +
-          x.devices[1].name + "\n";
-        continue;
-      }
-      out += "   " + x.type + "\n";
-      var lout = "      ";
-      for (var j = 0; j < x.devices.length; j++) {
-        if ((lout + x.devices[j].name).length > 80) {
-          out += lout + "\n";
-          lout = "      " + x.devices[j].name + " ";
-        } else {
-          lout += x.devices[j].name + " ";
-        }
-      }
-      out += lout + "\n";
-    }
-    if (typeof (spares) !== "undefined" && spares.length > 0) {
-      out += "spares:\n";
-      var lout = "      ";
-      for (var i = 0; i < spares.length; i++) {
-        if ((lout + spares[i].name).length > 80) {
-          out += lout + "\n";
-          lout += "      " + spares[i].name + " ";
-        } else {
-          lout += spares[i].name + " ";
-        }
-      }
-      out += lout + "\n";
-    }
-    if (typeof (logs) !== "undefined" && logs.length > 0) {
-      out += "logs:\n";
-      var lout = "      ";
-      for (var i = 0; i < logs.length; i++) {
-        if ((lout + logs[i].name).length > 80) {
-          out += lout + "\n";
-          lout += "      " + logs[i].name + " ";
-        } else {
-          lout += logs[i].name + " ";
-        }
-      }
-      out += lout + "\n";
-    }
-    out += "total capacity:   " + Number(capacity / 1073741824).toFixed(2)
-      + " GB";
-    ' out
-}
-
-promptpool()
-{
-	local layout=""
-	local disks=
-	while [[ /usr/bin/true ]]; do
-		# Skip USB devices and the VMware boot image by default.
-		diskinfo -Hp | nawk '
-			$1 != "USB" {
-				diskinfo = $0;
-				bootdisk = 0;
-				cmd = "fstyp -v /dev/dsk/" $2 "p1 2>/dev/null";
-				while ((cmd | getline) > 0) {
-					if ($0 ~ /^Volume Label:/ && $3 == "SMARTOSBOOT")
-						bootdisk = 1;
-				}
-				close(cmd);
-				cmd = "fstyp -v /dev/dsk/" $2 "s2 2>/dev/null";
-				while ((cmd | getline) > 0) {
-					if ($0 ~ /^Volume Label:/ && $3 == "SMARTOSBOOT")
-						bootdisk = 1;
-				}
-				close(cmd);
-				if (bootdisk)
-					next;
-				print diskinfo;
-			}' > /var/tmp/mydisks
-		disklayout -f /var/tmp/mydisks $layout > /var/tmp/disklayout.json
-
-		if [[ $? -ne 0 ]]; then
-			#
-			# There are two classes of errors that we need to
-			# distinguish between. Those which are endemic to the
-			# system itself and those which are as a result of a
-			# user issue.  This is a bad way to tell these apart,
-			# but for the moment this is the primary case.
-			#
-			if ! grep -q 'no primary storage disks' /var/tmp/disklayout.json; then
-				cat /var/tmp/disklayout.json
-				layout=""
-				continue
-			fi
-			cat >&2 <<EOF
-
-WARNING: failed to determine possible disk layout. It is possible that
-the system detected no disks. We are launching a shell to allow you to
-investigate the problem. Check for disks and their sizes with the
-diskinfo(1M) command. If you do not see disks that you expect, please
-determine your storage controller and reach out to the SmartOS community
-if you require assistence.
-
-If you create or import a zpool named "zones" then installation will continue.
-If you cannot, you should shutdown your system.
-
-EOF
-			/usr/bin/bash
-			zpool list zones >/dev/null 2>/dev/null
-			[[ $? -eq 0 ]] && return
-
-			printheader "Storage"
-			continue
-		fi
-		json error < /var/tmp/disklayout.json 2>/dev/null | grep . && layout="" && continue
-		prmpt_str="$(printdisklayout /var/tmp/disklayout.json)\n\n"
-		[[ -z "$layout" ]] && layout="default"
-		prmpt_str+="This is the '${layout}' storage configuration.  To use it, type 'yes'.\n"
-		prmpt_str+=" To see a different configuration, type: 'raidz2', 'mirror', or 'default'.\n"
-		prmpt_str+=" To specify a manual configuration, type: 'manual'.\n\n"
-		print $prmpt_str
-		promptval "Selected zpool layout" "yes"
-		if [[ $val == "raidz2" || $val == "mirror" ]]; then
-			# go around again
-			layout=$val
-		elif [[ $val == "default" ]]; then
-			layout=""
-		elif [[ $val == "yes" ]]; then
-			DISK_LAYOUT=/var/tmp/disklayout.json
-			return
-		elif [[ $val == "manual" ]]; then
-			# let the user manually create the zpool
-			layout=""
-			DISK_LAYOUT="manual"
-			echo "Launching a shell."
-			echo "Please manually create/import a zpool named \"zones\"."
-			echo "If you no longer wish to manually create a zpool,"
-			echo "simply exit the shell."
-			/usr/bin/bash
-			zpool list zones >/dev/null 2>/dev/null
-			[[ $? -eq 0 ]] && return
-		else
-			layout=""
-		fi
-	done
-}
-
-#
-# The original setup capped the dumpvol at 4G, however this is too small for
-# large memory servers.  This function will setup a dumpvol based on the size
-# of the dumpadm -e estimate.
-#
-# We take the value and double it to ensure that we have an appropriately sized
-# dumpvol out of the box.  We also set the smallest dumpvol to 1G.  The reason
-# to double the estimate is this is the cleanest way to get a usable dump size
-# on most systems. Setting the minimum to 1G should allow the dumpvol to work
-# even on small ram setups without consuming too much disk space.
-#
-create_dump()
-{
-	local dumpsize=$(LC_ALL=C LANG=C dumpadm -e | awk '
-		/Estimated dump size:/ {
-			sz = $NF;
-			outsz = 0;
-			if (index(sz, "M") > 0) {
-				outsz = sz * 1;
-			} else if (index(sz, "G") > 0) {
-				outsz = sz * 1024;
-			}
-		}
-		END {
-			outsz *= 2;
-			printf("%d\n", outsz < 1024 ? 1024 : outsz);
-		}
-	')
-
-	# Create the dump zvol
-	zfs create -V ${dumpsize}mb -o checksum=noparity ${SYS_ZPOOL}/dump || \
-	    fatal "failed to create the dump zvol"
-	dumpadm -d /dev/zvol/dsk/${SYS_ZPOOL}/dump >/dev/null
-	[[ $? -eq 0 ]] || fatal "failed to enable dump device"
-}
-
-#
-# Setup the persistent datasets on the zpool.
-#
-setup_datasets()
-{
-	datasets=$(zfs list -H -o name | xargs)
-
-	if ! echo $datasets | grep dump > /dev/null; then
-		printf "%-56s" "Making dump zvol... "
-		create_dump
-		printf "%4s\n" "done"
-	fi
-
-	if ! echo $datasets | grep ${CONFDS} > /dev/null; then
-		printf "%-56s" "Initializing config dataset for zones... "
-		zfs create ${CONFDS} || fatal "failed to create the config dataset"
-		chmod 755 /${CONFDS}
-		cp -p /etc/zones/* /${CONFDS}
-		zfs set mountpoint=legacy ${CONFDS}
-		printf "%4s\n" "done"
-	fi
-
-	if ! echo $datasets | grep ${USBKEYDS} > /dev/null; then
-		printf "%-56s" "Creating config dataset... "
-		zfs create -o mountpoint=legacy ${USBKEYDS} || \
-		  fatal "failed to create the config dataset"
-		mkdir /usbkey
-		mount -F zfs ${USBKEYDS} /usbkey
-		printf "%4s\n" "done"
-	fi
-
-	if ! echo $datasets | grep ${COREDS} > /dev/null; then
-		printf "%-56s" "Creating global cores dataset... "
-		zfs create -o quota=10g -o mountpoint=/${SYS_ZPOOL}/global/cores \
-		-o compression=gzip ${COREDS} || \
-		fatal "failed to create the cores dataset"
-		printf "%4s\n" "done"
-	fi
-
-	if ! echo $datasets | grep ${OPTDS} > /dev/null; then
-		printf "%-56s" "Creating opt dataset... "
-		zfs create -o mountpoint=legacy ${OPTDS} || \
-		fatal "failed to create the opt dataset"
-		printf "%4s\n" "done"
-	fi
-
-	if ! echo $datasets | grep ${VARDS} > /dev/null; then
-		printf "%-56s" "Initializing var dataset... "
-		zfs create ${VARDS} || \
-		fatal "failed to create the var dataset"
-		chmod 755 /${VARDS}
-		cd /var
-		if ( ! find . -print | cpio -pdm /${VARDS} 2>/dev/null ); then
-			fatal "failed to initialize the var directory"
-		fi
-
-		zfs set mountpoint=legacy ${VARDS}
-		printf "%4s\n" "done"
-	fi
-
-	if ! echo $datasets | grep ${SWAPVOL} > /dev/null; then
-		printf "%-56s" "Creating swap zvol... "
-
-		#
-		# We cannot allow the swap size to be less than the size of
-		# DRAM, lest we run into the availrmem double accounting
-		# issue for locked anonymous memory that is backed by
-		# in-memory swap (which will severely and artificially limit
-		# VM tenancy).  We will therfore not create a swap device
-		# smaller than DRAM -- but we still allow for the
-		# configuration variable to account for actual consumed space
-		# by using it to set the refreservation on the swap volume
-		# if/when the specified size is smaller than DRAM.
-		#
-
-		size=${SYSINFO_MiB_of_Memory}
-		zfs create -V ${size}mb ${SWAPVOL} || fatal \
-		    "failed to create swap partition"
-
-		swap -a /dev/zvol/dsk/${SWAPVOL}
-	    fi
-	    printf "%4s\n" "done"
-}
-
-create_zpool()
-{
-	layout=$1
-	disks=$2
-	pool=zones
-
-	# If the pool already exists, don't create it again.
-	if /usr/sbin/zpool list -H -o name $pool >/dev/null 2>/dev/null; then
-		printf "%-56s\n" "Pool '$pool' exists, skipping creation... "
-		return 0
-	fi
-
-	printf "%-56s" "Creating pool $pool... "
-
-	# If this is not a manual layout, then we've been given
-	# a JSON file describing the desired pool, so use that:
-	mkzpool -f $pool $layout || \
-	    fatal "failed to create pool ${pool}"
-
-	zfs set atime=off ${pool} || \
-	    fatal "failed to set atime=off for pool ${pool}"
-
-	printf "%4s\n" "done"
-}
-
-create_zpools()
-{
-	layout=$1
-	devs=$2
-
-	export SYS_ZPOOL="zones"
-	create_zpool "$layout" "$devs"
-	sleep 5
-
-	svccfg -s svc:/system/smartdc/init setprop config/zpool="zones"
-	svccfg -s svc:/system/smartdc/init:default refresh
-
-	export CONFDS=${SYS_ZPOOL}/config
-	export COREDS=${SYS_ZPOOL}/cores
-	export OPTDS=${SYS_ZPOOL}/opt
-	export VARDS=${SYS_ZPOOL}/var
-	export USBKEYDS=${SYS_ZPOOL}/usbkey
-	export SWAPVOL=${SYS_ZPOOL}/swap
-
-	setup_datasets
-	#
-	# Since there may be more than one storage pool on the system, put a
-	# file with a certain name in the actual "system" pool.
-	#
-	touch /${SYS_ZPOOL}/.system_pool
-}
-
-trap "" SIGINT
-
-while getopts "f:" opt
-do
-	case "$opt" in
-		f)	answer_file=${OPTARG};;
-	esac
-done
-
-shift $(($OPTIND - 1))
-
-USBMNT=$1
-
-if [[ -n ${answer_file} ]]; then
-	if [[ ! -f ${answer_file} ]]; then
-		echo "ERROR: answer file '${answer_file}' does not exist!"
-		exit 1
-	fi
-elif [[ -f ${USBMNT}/private/answers.json ]]; then
-	answer_file=${USBMNT}/private/answers.json
-fi
-
-#
-# Get local NIC info
-#
-nic_cnt=0
-
-while IFS=: read -r link addr ; do
-	((nic_cnt++))
-	nics[$nic_cnt]=$link
-	macs[$nic_cnt]=`echo $addr | sed 's/\\\:/:/g'`
-	# reformat the nic so that it's in the proper 00:00:ab... form not 0:0:ab...
-	macs[$nic_cnt]=$(printf "%02x:%02x:%02x:%02x:%02x:%02x" \
-	    $(echo "${macs[${nic_cnt}]}" \
-	    | tr ':' ' ' | sed -e "s/\([A-Fa-f0-9]*\)/0x\1/g"))
-	assigned[$nic_cnt]="-"
-done < <(dladm show-phys -pmo link,address 2>/dev/null)
-
-if [[ $nic_cnt -lt 1 ]]; then
-	echo "ERROR: cannot configure the system, no NICs were found."
-	exit 0
-fi
-
-# Don't do an 'ifconfig -a' - this causes some nics (bnx) to not
-# work when combined with the later dladm commands
-for iface in $(dladm show-phys -pmo link); do
-	ifconfig $iface plumb 2>/dev/null
-done
-updatenicstates
-
-export TERM=xterm-color
-
-trap sig_doshell SIGINT
-
-printheader "Joyent"
-
-message="
-You must answer the following questions to configure your SmartOS node.
-You will have a chance to review and correct your answers, as well as a
-chance to edit the final configuration, before it is applied.
-
-At the prompts, if you type ^C you will be placed into a shell. When you
-exit the shell the configuration process will resume from where it was
-interrupted.
-
-Press [enter] to continue"
-
-if [[ $(getanswer "skip_instructions") != "true" ]]; then
-	printf "$message"
-fi
-
-console=$(getanswer "config_console")
-# If we've asked for automatic configuration, but are not running on the
-# primary boot console (as selected in the bootloader menu), then pause at a
-# prompt:
-if [[ -z ${console} || $(tty) != "/dev/console" ]]; then
-	read continue;
-fi
-
-if [ -f /tmp/config_in_progress ]; then
-	message="
-Configuration is already in progress on another terminal.
-This session can no longer perform system configuration.\n"
-	while [ /usr/bin/true ]; do
-		printf "$message"
-		read continue;
-	done
-
-fi
-touch /tmp/config_in_progress
-
-#
-# Main loop to prompt for user input
-#
-while [ /usr/bin/true ]; do
-
-	printheader "Networking"
-	message="
-To set up networking you must first configure a network tag. A network tag
-refers to a physical NIC or an aggregation. Virtual machines will be created on
-top of a network tag. Setup will first create a network tag and configure a NIC
-so that you can access the SmartOS global zone. After setup has been completed,
-you will have the option of creating additional network tags and configuring
-additional NICs for accessing the global zone through the nictagadm(1M) command.
-
-Press [enter] to continue"
-
-	if [[ $(getanswer "skip_instructions") != "true" ]]; then
-		printf "$message"
-		prmpt_str="\nPress [enter] to continue "
-		read continue
-	fi
-
-	printheader "Networking - Admin"
-	message="
-The admin network is the primary network in SmartOS. It is the default network
-that is created. The configured NIC will be used to access the global zone. If
-you wish to use a VLAN on this network, you must configure VLAN ACCESS mode for
-this network.\n\n"
-
-	if [[ $(getanswer "skip_instructions") != "true" ]]; then
-		printf "$message"
-	fi
-
-	promptnic "'admin'"
-	admin_nic="$val"
-	admin_iface="$nic_val"
-
-	valid=0
-	while [ $valid -ne 1 ]; do
-		promptnet "(admin) IP address (or dhcp)" "$admin_ip" "admin_ip"
-		admin_ip="$val"
-
-		if [[ "$admin_ip" != "dhcp" ]]; then
-			[[ -z "$admin_netmask" ]] && \
-			    admin_netmask="255.255.255.0"
-
-			promptnet "(admin) netmask" "$admin_netmask" \
-			    "admin_netmask"
-			admin_netmask="$val"
-			ip_netmask_to_network "$admin_ip" "$admin_netmask"
-			[ $IP_NUM -ne $BCAST_ADDR ] && valid=1
-		else
-			valid=1
-		fi
-	done
-
-	printheader "Networking - Continued"
-	message=""
-
-	if [[ $(getanswer "skip_instructions") != "true" ]]; then
-		printf "$message"
-	fi
-
-	message="
-The default gateway will determine which router will be used to connect the
-global zone to other networks. This will almost certainly be the router
-connected to your 'admin' network. Use 'none' if you have no gateway.\n\n"
-
-	if [[ $(getanswer "skip_instructions") != "true" ]]; then
-		printf "$message"
-	fi
-
-	# default to external_gateway if that's set, if not, use 'none'
-	[[ -z "$headnode_default_gateway" && -n ${external_gateway} ]] && \
-	    headnode_default_gateway="$external_gateway"
-	[[ -z "$headnode_default_gateway" ]] && \
-	    headnode_default_gateway="none"
-
-	promptnet "Enter the default gateway IP" "$headnode_default_gateway" "headnode_default_gateway"
-	headnode_default_gateway="$val"
-
-	# Bring the admin and external nics up now: they need to be for the
-	# connectivity checks in the next section
-	nicsup
-
-	message="
-The DNS servers set here will be used to provide name resolution abilities to
-the SmartOS global zone itself. These DNS servers are independent of anything
-you use to create virtual machines through vmadm(1M).\n\n"
-
-	if [[ $(getanswer "skip_instructions") != "true" ]]; then
-		printf "$message"
-	fi
-
-	prompt_host_ok_val "Enter the Primary DNS server IP" "$dns_resolver1" "dns_resolver1"
-	dns_resolver1="$val"
-	prompt_host_ok_val "Enter the Secondary DNS server IP" "$dns_resolver2" "dns_resolver2"
-	dns_resolver2="$val"
-	promptval "Default DNS search domain" "$dns_domain" "dns_search"
-	dns_domain="$val"
-	cat > /etc/resolv.conf <<EOF
-nameserver $dns_resolver1
-nameserver $dns_resolver2
-EOF
-
-
-	message="
-By default the headnode acts as an NTP server for the admin network. You can
-set the headnode to be an NTP client to synchronize to another NTP server.\n"
-
-	if [[ $(getanswer "skip_instructions") != "true" ]]; then
-		printf "$message"
-	fi
-
-	prompt_host_ok_val \
-	    "Enter an NTP server IP address or hostname" "$ntp_hosts" "ntp_host"
-	ntp_hosts="$val"
-
-skip_ntp=$(getanswer "skip_ntp_check")
-if [[ -z ${skip_ntp} || ${skip_ntp} != "true" ]]; then
-		ntpdate -b $ntp_hosts >/dev/null 2>&1
-		[ $? != 0 ] && print_warning "NTP failure setting date and time"
-fi
-
-	printheader "Storage"
-
-	message="
-SmartOS will automatically determine what we think is
-the best zpool layout from your current disks. You may use this
-suggestion, change to another built in storage profile, or simply create
-your own zpool.\n"
-
-	if [[ $(getanswer "skip_instructions") != "true" ]]; then
-		printf "$message"
-	fi
-
-	promptpool
-
-
-	printheader "System Configuration"
-	message="
-Setup will now go through and prompt for final pieces of account configuration.
-This includes setting the root password for the global zone and optionally
-setting a hostname.\n\n"
-
-	if [[ $(getanswer "skip_instructions") != "true" ]]; then
-		printf "$message"
-	fi
-
-	promptpw "Enter root password" "nolen" "$root_shadow" "root_password"
-	root_shadow="$val"
-
-	promptopt "Enter system hostname" "$hostname" "hostname"
-	hostname="$val"
-
-	printheader "Verify Configuration"
-	message="
-Please verify your SmartOS Configuration. After this point the system will set
-up and all data on the disks will be erased.\n\n"
-
-	if [[ $(getanswer "skip_instructions") != "true" ]]; then
-		printf "$message"
-	fi
-
-	if [[ $(getanswer "skip_final_summary") != "true" ]]; then
-		printf "%8s %17s %15s %15s\n" "Net" "MAC" \
-		    "IP addr." "Netmask"
-		if [[ "$admin_ip" == "dhcp" ]]; then
-		printf "%8s %17s %15s %15s\n" "Admin" $admin_nic \
-		    $admin_ip "N/A"
-		else
-		printf "%8s %17s %15s %15s\n" "Admin" $admin_nic \
-		    $admin_ip $admin_netmask
-		fi
-		echo
-		printf "DNS Servers: (%s, %s), Search Domain: %s\n" \
-		    "$dns_resolver1" "$dns_resolver2" "$dns_domain"
-		printf "Hostname: %s\n" "$hostname"
-		printf "NTP server: $ntp_hosts\n"
-		echo
-	fi
-
-	if [[ $(getanswer "skip_final_confirm") != "true" ]]; then
-		promptval "Is this correct, proceed with installation?" "y"
-		[ "$val" == "y" ] && break
-		clear
-	else
-		break
-	fi
-done
-
-tmp_config=/tmp/config
-touch $tmp_config
-chmod 600 $tmp_config
-
-echo "#" >$tmp_config
-echo "# This file was auto-generated and must be source-able by bash." \
-    >>$tmp_config
-echo "#" >>$tmp_config
-echo >>$tmp_config
-
-# If in a VM, setup coal so networking will work.
-platform=$(smbios -t1 | nawk '{if ($1 == "Product:") print $2}')
-[ "$platform" == "VMware" ] && echo "coal=true" >>$tmp_config
-
-echo "admin_nic=$admin_nic" >>$tmp_config
-echo "admin_ip=$admin_ip" >>$tmp_config
-if [[ "$admin_ip" != "dhcp" ]]; then
-	echo "admin_netmask=$admin_netmask" >>$tmp_config
-	echo "admin_network=$admin_network" >>$tmp_config
-	echo "admin_gateway=$admin_ip" >>$tmp_config
-	echo >>$tmp_config
-fi
-
-echo "headnode_default_gateway=$headnode_default_gateway" >>$tmp_config
-echo >>$tmp_config
-
-echo "dns_resolvers=$dns_resolver1,$dns_resolver2" >>$tmp_config
-echo "dns_domain=$dns_domain" >>$tmp_config
-echo >>$tmp_config
-
-echo "ntp_hosts=$ntp_hosts" >>$tmp_config
-echo "compute_node_ntp_hosts=$admin_ip" >>$tmp_config
-echo >>$tmp_config
-
-echo "hostname=$hostname" >> $tmp_config
-echo >>$tmp_config
-
-echo "smt_enabled=true" >>$tmp_config
-echo >>$tmp_config
-
-create_zpools "$DISK_LAYOUT"
-
-mv $tmp_config /usbkey/config || fatal "failed to persist configuration"
-
-# set the root password
-root_shadow=$(/usr/lib/cryptpass "$root_shadow")
-sed -e "s|^root:[^\:]*:|root:${root_shadow}:|" /etc/shadow > /usbkey/shadow \
-      && chmod 400 /usbkey/shadow
-[[ $? -eq 0 ]] || fatal "failed to preserve root pasword"
-
-cp -rp /etc/ssh /usbkey/ssh || fatal "failed to set up preserve host keys"
-
-printf "System setup has completed.\n\nPress enter to reboot.\n"
-
-read foo
-reboot
diff --git a/overlay/generic/smartdc/man/man1/sdc-lastcomm.1 b/overlay/generic/smartdc/man/man1/sdc-lastcomm.1
deleted file mode 100644
index cffd9ceb..00000000
--- a/overlay/generic/smartdc/man/man1/sdc-lastcomm.1
+++ /dev/null
@@ -1,106 +0,0 @@
-'\" te
-.\"  Copyright 2000, Sun Microsystems, Inc. All Rights Reserved
-.\"  Copyright 2012, Joyent, Inc. All Rights Reserved
-.\" The contents of this file are subject to the terms of the Common Development and Distribution License (the "License").  You may not use this file except in compliance with the License.
-.\" You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE or http://www.opensolaris.org/os/licensing.  See the License for the specific language governing permissions and limitations under the License.
-.\" When distributing Covered Code, include this CDDL HEADER in each file and include the License file at usr/src/OPENSOLARIS.LICENSE.  If applicable, add the following below this CDDL HEADER, with the fields enclosed by brackets "[]" replaced with your own identifying information: Portions Copyright [yyyy] [name of copyright owner]
-.TH sdc-lastcomm 1 "30 Mar 2012" "SDC" "User Commands"
-.SH NAME
-sdc-lastcomm \- display the last commands executed, in reverse order
-.SH SYNOPSIS
-.LP
-.nf
-\fBsdc-lastcomm\fR [\fB-d path\fR] [\fB-R days\fR] [\fB-v\fR] [\fB-x\fR]
-.fi
-
-.SH DESCRIPTION
-.sp
-.LP
-The \fBsdc-lastcomm\fR command is similar to the \fBlastcomm\fR command but uses the audit records to give single-line summarized information on commands previously executed in the global zone. \fBsdc-lastcomm\fR with no arguments displays information about all the commands recorded during the current auditing session's lifetime.
-.sp
-.LP
-For each process entry, \fBsdc-lastcomm\fR displays the following items of information:
-
-.RS +4
-.TP
-.ie t \(bu
-.el o
-The date and time the command was run.
-.RE
-
-.RS +4
-.TP
-.ie t \(bu
-.el o
-The port on which the user was logged in.
-.RE
-
-.RS +4
-.TP
-.ie t \(bu
-.el o
-The IP address on which the user was logged in.
-.RE
-
-.RS +4
-.TP
-.ie t \(bu
-.el o
-The command name under which the process was called.
-.RE
-
-.SH OPTIONS
-.sp
-.LP
-The following options are supported:
-.sp
-.ne 2
-.mk
-.na
-\fB\fB-d\fR \fBpath\fR\fR 
-.ad
-.RS 11n
-.rt  
-Specifies an alternate path to the directory of audit records.
-.RE
-
-.sp
-.ne 2
-.mk
-.na
-\fB\fB-R\fR \fBdays\fR\fR 
-.ad
-.RS 11n
-.rt  
-Rotates the audit log and removes any logs older than \fBdays\fR.  This option cannot be used with any other options.
-.RE
-
-.sp
-.ne 2
-.mk
-.na
-\fB\fB-v\fR\fR
-.ad
-.RS 11n
-.rt  
-Displays the full set of command arguments
-.RE
-
-.sp
-.ne 2
-.mk
-.na
-\fB\fB-x\fR\fR
-.ad
-.RS 11n
-.rt  
-Displays information from all audit files on the system.
-.RE
-
-.SH "COPYRIGHT"
-sdc\-lastcomm Copyright (c) 2012, Joyent Inc\., All rights reserved\.
-
-.SH SEE ALSO
-.sp
-.LP
-\fBlastcomm\fR(1), \fBpraudit\fR(1M)
diff --git a/overlay/generic/smartdc/man/man1/sdc-zfs-io-throttle.1 b/overlay/generic/smartdc/man/man1/sdc-zfs-io-throttle.1
deleted file mode 100644
index d5221975..00000000
--- a/overlay/generic/smartdc/man/man1/sdc-zfs-io-throttle.1
+++ /dev/null
@@ -1,20 +0,0 @@
-'\" te
-.\"
-.\" This Source Code Form is subject to the terms of the Mozilla Public
-.\" License, v. 2.0. If a copy of the MPL was not distributed with this
-.\" file, You can obtain one at http://mozilla.org/MPL/2.0/.
-.\"
-.TH "sdc\-zfs\-io\-throttle" "1" "June 2011" "" ""
-.
-.SH "NAME"
-\fBsdc-zfs-io-throttle\fR \-\- report on the ZFS I/O throttle
-.
-.SH "SYNOPSIS"
-\fBsdc\-sdc\-zfs\-io\-throttle\fR
-.
-.SH "DESCRIPTION"
-This utility uses dtrace to print information on the calculations and
-activity of the ZFS I/O throttle.
-
-.SH "COPYRIGHT"
-sdc\-sdc\-zfs\-io\-throttle Copyright (c) 2014, Joyent, Inc\.
diff --git a/overlay/generic/smartdc/vm-upgrade/001_upgrade b/overlay/generic/smartdc/vm-upgrade/001_upgrade
deleted file mode 100755
index c0b8c77b..00000000
--- a/overlay/generic/smartdc/vm-upgrade/001_upgrade
+++ /dev/null
@@ -1,49 +0,0 @@
-#!/usr/bin/bash
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-#
-
-#
-# Copyright (c) 2014, Joyent, Inc.
-#
-
-#
-# This script exists to apply SDC specific changes to zones on upgrade from
-# SDC6.5 to SDC7. It is run by vmadmd the first time a zone missing the 'v'
-# property is booted on SDC7. See also OS-1103.
-#
-# The only argument that is passed is the UUID of the VM to be upgraded. It
-# should exit 0 when the upgrade was successful and non-zero when it failed.
-#
-
-set -o xtrace
-set -o errexit
-
-UUID=$1
-if [[ -z ${UUID} || -n $2 ]]; then
-    echo "Usage: $0 <uuid>"
-    exit 2
-fi
-
-# In 6.5 we supported only taking snapshots of the zoneroot of a joyent brand
-# zone, and the snapshots were all just named <snapname>. In SDC7 snapshots
-# are named vmsnap-<snapname> when visible to customers, so we need to rename
-# these.
-
-parts=$(vmadm lookup -j -o brand,zfs_filesystem uuid=${UUID} | json -a brand zfs_filesystem)
-brand=${parts%% *}
-zfs_filesystem=${parts##* }
-
-if [[ ${brand} != "joyent" ]]; then
-    echo "not converting snapshots for brand ${brand}"
-    exit 0
-fi
-
-for snap in $(zfs list -t snapshot -Hpo name | grep -v "@vmsnap-" | grep "^${zfs_filesystem}"); do
-    snapname=${snap##*@}
-    zfs rename ${zfs_filesystem}@${snapname} ${zfs_fileystem}@vmsnap-${snapname}
-done
-
-exit 0
diff --git a/overlay/generic/usr/bin/json b/overlay/generic/usr/bin/json
deleted file mode 100755
index 081535bc..00000000
--- a/overlay/generic/usr/bin/json
+++ /dev/null
@@ -1,1326 +0,0 @@
-#!/usr/node/bin/node
-//
-// json -- a 'json' command for massaging JSON on the command line
-//
-// See <https://github.com/trentm/json>.
-//
-
-var VERSION = "5.1.1";
-
-var util = require('util');
-var pathlib = require('path');
-var vm = require('vm');
-var fs = require('fs');
-var warn = console.warn;
-var EventEmitter = require('events').EventEmitter;
-
-
-
-//--- exports for module usage
-
-exports.main = main;
-exports.getVersion = getVersion;
-exports.parseLookup = parseLookup;
-
-// As an exported API, these are still experimental:
-exports.lookupDatum = lookupDatum;
-exports.printDatum = printDatum;
-
-
-
-//---- globals and constants
-
-// Output modes.
-var OM_JSONY = 1;
-var OM_JSON = 2;
-var OM_INSPECT = 3;
-var OM_COMPACT = 4;
-var OM_FROM_NAME = {
-  "jsony": OM_JSONY,
-  "json": OM_JSON,
-  "inspect": OM_INSPECT,
-  "compact": OM_COMPACT
-}
-
-
-
-//---- support functions
-
-function getVersion() {
-  return VERSION;
-}
-
-/**
- * Return a *shallow* copy of the given object.
- *
- * Only support objects that you get out of JSON, i.e. no functions.
- */
-function objCopy(obj) {
-  var copy;
-  if (Array.isArray(obj)) {
-    copy = obj.slice();
-  } else if (typeof(obj) === 'object') {
-    copy = {};
-    Object.keys(obj).forEach(function (k) {
-      copy[k] = obj[k];
-    });
-  } else {
-    copy = obj;  // immutable type
-  }
-  return copy;
-}
-
-if (util.format) {
-  format = util.format;
-} else {
-  // From <https://github.com/joyent/node/blob/master/lib/util.js#L22>:
-  var formatRegExp = /%[sdj%]/g;
-  function format(f) {
-    if (typeof f !== 'string') {
-      var objects = [];
-      for (var i = 0; i < arguments.length; i++) {
-        objects.push(util.inspect(arguments[i]));
-      }
-      return objects.join(' ');
-    }
-    var i = 1;
-    var args = arguments;
-    var len = args.length;
-    var str = String(f).replace(formatRegExp, function(x) {
-      if (i >= len) return x;
-      switch (x) {
-        case '%s': return String(args[i++]);
-        case '%d': return Number(args[i++]);
-        case '%j': return JSON.stringify(args[i++]);
-        case '%%': return '%';
-        default:
-          return x;
-      }
-    });
-    for (var x = args[i]; i < len; x = args[++i]) {
-      if (x === null || typeof x !== 'object') {
-        str += ' ' + x;
-      } else {
-        str += ' ' + util.inspect(x);
-      }
-    }
-    return str;
-  };
-}
-
-/**
- * Parse the given string into a JS string. Basically: handle escapes.
- */
-function _parseString(s) {
-  var quoted = '"' + s.replace(/\\"/, '"').replace('"', '\\"') + '"';
-  return eval(quoted);
-}
-
-// json_parse.js (<https://github.com/douglascrockford/JSON-js>)
-// START json_parse
-var json_parse=function(){"use strict";var a,b,c={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},d,e=function(b){throw{name:"SyntaxError",message:b,at:a,text:d}},f=function(c){return c&&c!==b&&e("Expected '"+c+"' instead of '"+b+"'"),b=d.charAt(a),a+=1,b},g=function(){var a,c="";b==="-"&&(c="-",f("-"));while(b>="0"&&b<="9")c+=b,f();if(b==="."){c+=".";while(f()&&b>="0"&&b<="9")c+=b}if(b==="e"||b==="E"){c+=b,f();if(b==="-"||b==="+")c+=b,f();while(b>="0"&&b<="9")c+=b,f()}a=+c;if(!isFinite(a))e("Bad number");else return a},h=function(){var a,d,g="",h;if(b==='"')while(f()){if(b==='"')return f(),g;if(b==="\\"){f();if(b==="u"){h=0;for(d=0;d<4;d+=1){a=parseInt(f(),16);if(!isFinite(a))break;h=h*16+a}g+=String.fromCharCode(h)}else if(typeof c[b]=="string")g+=c[b];else break}else g+=b}e("Bad string")},i=function(){while(b&&b<=" ")f()},j=function(){switch(b){case"t":return f("t"),f("r"),f("u"),f("e"),!0;case"f":return f("f"),f("a"),f("l"),f("s"),f("e"),!1;case"n":return f("n"),f("u"),f("l"),f("l"),null}e("Unexpected '"+b+"'")},k,l=function(){var a=[];if(b==="["){f("["),i();if(b==="]")return f("]"),a;while(b){a.push(k()),i();if(b==="]")return f("]"),a;f(","),i()}}e("Bad array")},m=function(){var a,c={};if(b==="{"){f("{"),i();if(b==="}")return f("}"),c;while(b){a=h(),i(),f(":"),Object.hasOwnProperty.call(c,a)&&e('Duplicate key "'+a+'"'),c[a]=k(),i();if(b==="}")return f("}"),c;f(","),i()}}e("Bad object")};return k=function(){i();switch(b){case"{":return m();case"[":return l();case'"':return h();case"-":return g();default:return b>="0"&&b<="9"?g():j()}},function(c,f){var g;return d=c,a=0,b=" ",g=k(),i(),b&&e("Syntax error"),typeof f=="function"?function h(a,b){var c,d,e=a[b];if(e&&typeof e=="object")for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=h(e,c),d!==undefined?e[c]=d:delete e[c]);return f.call(a,b,e)}({"":g},""):g}}();
-// END json_parse
-
-function printHelp() {
-  util.puts("Usage:");
-  util.puts("  <something generating JSON on stdout> | json [OPTIONS] [LOOKUPS...]");
-  util.puts("  json -f FILE [OPTIONS] [LOOKUPS...]");
-  util.puts("");
-  util.puts("Pipe in your JSON for pretty-printing, JSON validation, filtering, ");
-  util.puts("and modification. Supply one or more `LOOKUPS` to extract a ");
-  util.puts("subset of the JSON. HTTP header blocks are skipped by default.");
-  util.puts("Roughly in order of processing, features are:");
-  util.puts("");
-  util.puts("Grouping:");
-  util.puts("  Use '-g' or '--group' to group objects or arrays separated ");
-  util.puts("  by no space or by a newline. This can be helpful for, e.g.: ");
-  util.puts("     $ cat *.json | json -g ... ");
-  util.puts("  and similar.");
-  util.puts("");
-  util.puts("Execution:");
-  util.puts("  Use the '-e CODE' option to execute code on the input JSON.");
-  util.puts("     $ echo '{\"name\":\"trent\",\"age\":38}' | json -e 'age++'");
-  util.puts("     {");
-  util.puts("       \"name\": \"trent\",");
-  util.puts("       \"age\": 39");
-  util.puts("     }");
-  util.puts("  If input is an array, this will automatically process each");
-  util.puts("  item separately.");
-  util.puts("");
-  util.puts("Conditional filtering:");
-  util.puts("  Use the '-c CODE' option to filter the input JSON.");
-  util.puts("     $ echo '[{\"age\":38},{\"age\":4}]' | json -c 'age>21'");
-  util.puts("     [{\"age\":38}]");
-  util.puts("  If input is an array, this will automatically process each");
-  util.puts("  item separately.");
-  util.puts("");
-  util.puts("Lookups:");
-  util.puts("  Use lookup arguments to extract particular values:");
-  util.puts("     $ echo '{\"name\":\"trent\",\"age\":38}' | json name");
-  util.puts("     trent");
-  util.puts("");
-  util.puts("  Use '-a' for *array processing* of lookups and *tabular output*:");
-  util.puts("     $ echo '{\"name\":\"trent\",\"age\":38}' | json name age");
-  util.puts("     trent");
-  util.puts("     38");
-  util.puts("     $ echo '[{\"name\":\"trent\",\"age\":38},");
-  util.puts("              {\"name\":\"ewan\",\"age\":4}]' | json -a name age");
-  util.puts("     trent 38");
-  util.puts("     ewan 4");
-  util.puts("");
-  util.puts("Pretty-printing:");
-  util.puts("  Output is 'jsony' by default: 2-space indented JSON, except a");
-  util.puts("  single string value is printed without quotes.");
-  util.puts("     $ echo '{\"name\": \"trent\", \"age\": 38}' | json");
-  util.puts("     {");
-  util.puts("       \"name\": \"trent\",");
-  util.puts("       \"age\": 38");
-  util.puts("     }");
-  util.puts("     $ echo '{\"name\": \"trent\", \"age\": 38}' | json name");
-  util.puts("     trent");
-  util.puts("");
-  util.puts("  Use '-j' or '-o json' for explicit JSON, '-o json-N' for N-space indent:");
-  util.puts("     $ echo '{\"name\": \"trent\", \"age\": 38}' | json -o json-0");
-  util.puts("     {\"name\":\"trent\",\"age\":38}");
-  util.puts("");
-  util.puts("Options:");
-  util.puts("  -h, --help    Print this help info and exit.");
-  util.puts("  --version     Print version of this command and exit.");
-  util.puts("  -q, --quiet   Don't warn if input isn't valid JSON.");
-  util.puts("");
-  util.puts("  -f FILE       Path to a file to process. If not given, then");
-  util.puts("                stdin is used.");
-  util.puts("");
-  util.puts("  -H            Drop any HTTP header block (as from `curl -i ...`).");
-  util.puts("  -g, --group   Group adjacent objects or arrays into an array.");
-  util.puts("  --merge       Merge adjacent objects into one. Keys in last ");
-  util.puts("                object win.");
-  util.puts("  --deep-merge  Same as '--merge', but will recurse into objects ");
-  util.puts("                under the same key in both.")
-  util.puts("  -a, --array   Process input as an array of separate inputs");
-  util.puts("                and output in tabular form.");
-  util.puts("  -A            Process input as a single object, i.e. stop");
-  util.puts("                '-e' and '-c' automatically processing each");
-  util.puts("                item of an input array.");
-  util.puts("  -d DELIM      Delimiter char for tabular output (default is ' ').");
-  util.puts("  -D DELIM      Delimiter char between lookups (default is '.'). E.g.:");
-  util.puts("                  $ echo '{\"a.b\": {\"b\": 1}}' | json -D / a.b/b");
-  util.puts("");
-  util.puts("  -e CODE       Execute the given code on the input. If input is an");
-  util.puts("                array, then each item of the array is processed");
-  util.puts("                separately (use '-A' to override).");
-  util.puts("  -c CODE       Filter the input with `CODE`. If `CODE` returns");
-  util.puts("                false-y, then the item is filtered out. If input");
-  util.puts("                is an array, then each item of the array is ");
-  util.puts("                processed separately (use '-A' to override).");
-  util.puts("");
-  util.puts("  -k, --keys    Output the input object's keys.");
-  util.puts("  --validate    Just validate the input (no processing or output).");
-  util.puts("                Use with '-q' for silent validation (exit status).");
-  util.puts("");
-  util.puts("  -o, --output MODE   Specify an output mode. One of");
-  util.puts("                  jsony (default): JSON with string quotes elided");
-  util.puts("                  json: JSON output, 2-space indent");
-  util.puts("                  json-N: JSON output, N-space indent, e.g. 'json-4'");
-  util.puts("                  inspect: node.js `util.inspect` output");
-  util.puts("  -i            shortcut for `-o inspect`");
-  util.puts("  -j            shortcut for `-o json`");
-  util.puts("");
-  util.puts("See <http://trentm.com/json> for more docs and ");
-  util.puts("<https://github.com/trentm/json> for project details.");
-}
-
-
-/**
- * Parse the command-line options and arguments into an object.
- *
- *    {
- *      'args': [...]       // arguments
- *      'help': true,       // true if '-h' option given
- *       // etc.
- *    }
- *
- * @return {Object} The parsed options. `.args` is the argument list.
- * @throws {Error} If there is an error parsing argv.
- */
-function parseArgv(argv) {
-  var parsed = {
-    args: [],
-    help: false,
-    quiet: false,
-    dropHeaders: false,
-    exeSnippets: [],
-    condSnippets: [],
-    outputMode: OM_JSONY,
-    jsonIndent: 2,
-    array: null,
-    delim: ' ',
-    lookupDelim: '.',
-    outputKeys: false,
-    group: false,
-    merge: null,    // --merge -> "shallow", --deep-merge -> "deep"
-    inputFiles: [],
-    validate: false
-  };
-
-  // Turn '-iH' into '-i -H', except for argument-accepting options.
-  var args = argv.slice(2);  // drop ['node', 'scriptname']
-  var newArgs = [];
-  var optTakesArg = {'d': true, 'o': true, 'D': true};
-  for (var i = 0; i < args.length; i++) {
-    if (args[i].charAt(0) === "-" && args[i].charAt(1) !== '-' && args[i].length > 2) {
-      var splitOpts = args[i].slice(1).split("");
-      for (var j = 0; j < splitOpts.length; j++) {
-        newArgs.push('-' + splitOpts[j])
-        if (optTakesArg[splitOpts[j]]) {
-          var optArg = splitOpts.slice(j+1).join("");
-          if (optArg.length) {
-            newArgs.push(optArg);
-          }
-          break;
-        }
-      }
-    } else {
-      newArgs.push(args[i]);
-    }
-  }
-  args = newArgs;
-
-  endOfOptions = false;
-  while (args.length > 0) {
-    var arg = args.shift();
-    switch(arg) {
-      case "--":
-        endOfOptions = true;
-        break;
-      case "-h": // display help and exit
-      case "--help":
-        parsed.help = true;
-        break;
-      case "--version":
-        parsed.version = true;
-        break;
-      case "-q":
-      case "--quiet":
-        parsed.quiet = true;
-        break;
-      case "-H": // drop any headers
-        parsed.dropHeaders = true;
-        break;
-      case "-o":
-      case "--output":
-        var name = args.shift();
-        if (!name) {
-          throw new Error("no argument given for '-o|--output' option");
-        }
-        var idx = name.lastIndexOf('-');
-        if (idx !== -1) {
-          var indent = Number(name.slice(idx+1));
-          if (! isNaN(indent)) {
-            parsed.jsonIndent = indent;
-            name = name.slice(0, idx);
-          }
-        }
-        parsed.outputMode = OM_FROM_NAME[name];
-        if (parsed.outputMode === undefined) {
-          throw new Error("unknown output mode: '"+name+"'");
-        }
-        break;
-      case "-i": // output with util.inspect
-        parsed.outputMode = OM_INSPECT;
-        break;
-      case "-j": // output with JSON.stringify
-        parsed.outputMode = OM_JSON;
-        break;
-      case "-a":
-      case "--array":
-        parsed.array = true;
-        break;
-      case "-A":
-        parsed.array = false;
-        break;
-      case "-d":
-        parsed.delim = _parseString(args.shift());
-        break;
-      case "-D":
-        parsed.lookupDelim = args.shift();
-        if (parsed.lookupDelim.length !== 1) {
-          throw new Error(format(
-            "invalid lookup delim '%s' (must be a single char)",
-            parsed.lookupDelim));
-        }
-        break;
-      case "-e":
-        parsed.exeSnippets.push(args.shift());
-        break;
-      case "-c":
-        parsed.condSnippets.push(args.shift());
-        break;
-      case "-k":
-      case "--keys":
-        parsed.outputKeys = true;
-        break;
-      case "-g":
-      case "--group":
-        parsed.group = true;
-        break;
-      case "--merge":
-        parsed.merge = "shallow";
-        break;
-      case "--deep-merge":
-        parsed.merge = "deep";
-        break;
-      case "-f":
-        parsed.inputFiles.push(args.shift());
-        break;
-      case "--validate":
-        parsed.validate = true;
-        break;
-      default: // arguments
-        if (!endOfOptions && arg.length > 0 && arg[0] === '-') {
-          throw new Error("unknown option '"+arg+"'");
-        }
-        parsed.args.push(arg);
-        break;
-    }
-  }
-
-  if (parsed.group && parsed.merge) {
-    throw new Error("cannot use -g|--group and --merge options together");
-  }
-  if (parsed.outputKeys && parsed.args.length > 0) {
-    throw new Error("cannot use -k|--keys option and lookup arguments together");
-  }
-
-  return parsed;
-}
-
-
-
-/**
- * Streams chunks from given file paths or stdin.
- *
- * @param opts {Object} Parsed options.
- * @returns {Object} An emitter that emits 'chunk', 'error', and 'end'.
- *    - `emit('chunk', chunk, [obj])` where chunk is a complete block of JSON
- *       ready to parse. If `obj` is provided, it is the already parsed
- *       JSON.
- *    - `emit('error', error)` when an underlying stream emits an error
- *    - `emit('end')` when all streams are done
- */
-function chunkEmitter(opts) {
-  var emitter = new EventEmitter();
-  var streaming = true;
-  var chunks = [];
-  var leftover = '';
-  var finishedHeaders = false;
-
-  function stripHeaders(s) {
-    // Take off a leading HTTP header if any and pass it through.
-    while (true) {
-      if (s.slice(0,5) === "HTTP/") {
-        var index = s.indexOf('\r\n\r\n');
-        var sepLen = 4;
-        if (index == -1) {
-          index = s.indexOf('\n\n');
-          sepLen = 2;
-        }
-        if (index != -1) {
-          if (! opts.dropHeaders) {
-            emit(s.slice(0, index+sepLen));
-          }
-          var is100Continue = (s.slice(0, 21) === "HTTP/1.1 100 Continue");
-          s = s.slice(index+sepLen);
-          if (is100Continue) {
-            continue;
-          }
-          finishedHeaders = true;
-        }
-      } else {
-        finishedHeaders = true;
-      }
-      break;
-    }
-    //console.warn("XXX stripHeaders done, finishedHeaders=%s", finishedHeaders)
-    return s;
-  }
-
-  function emitChunks(block, emitter) {
-    //console.warn("XXX emitChunks start: block='%s'", block)
-    var splitter = /(})(\s*\n\s*)?({\s*")/;
-    var leftTrimmedBlock = block.trimLeft();
-    if (leftTrimmedBlock && leftTrimmedBlock[0] !== '{') {
-      // Currently (at least), only support streaming consecutive *objects*.
-      streaming = false;
-      chunks.push(block);
-      return '';
-    }
-    /* Example:
-     * > '{"a":"b"}\n{"a":"b"}\n{"a":"b"}'.split(/(})(\s*\n\s*)?({\s*")/)
-     * [ '{"a":"b"',
-     *   '}',
-     *   '\n',
-     *   '{"',
-     *   'a":"b"',
-     *   '}',
-     *   '\n',
-     *   '{"',
-     *   'a":"b"}' ]
-     */
-    var bits = block.split(splitter);
-    //console.warn("XXX emitChunks: bits (length %d): %j", bits.length, bits);
-    if (bits.length === 1) {
-      /*
-       * An unwanted side-effect of using a regex to find newline-separated
-       * objects *with a regex*, is that we are looking for the end of one
-       * object leading into the start of a another. That means that we
-       * can end up buffering a complete object until a subsequent one
-       * comes in. If the input stream has large delays between objects, then
-       * this is unwanted buffering.
-       *
-       * One solution would be full stream parsing of objects a la
-       * <https://github.com/creationix/jsonparse>. This would nicely also
-       * remove the artibrary requirement that the input stream be newline
-       * separated. jsonparse apparently has some issues tho, so I don't
-       * want to use it right now. It also isn't *small* so not sure I
-       * want to inline it (`json` doesn't have external deps).
-       *
-       * An alternative: The block we have so far one of:
-       * 1. some JSON that we don't support grouping (e.g. a stream of
-       *    non-objects),
-       * 2. a JSON object fragment, or
-       * 3. a complete JSON object (with a possible trailing '{')
-       *
-       * If #3, then we can just emit this as a chunk right now.
-       *
-       * TODO(PERF): Try out avoiding the first more complete regex split
-       * for a presumed common case of single-line newline-separated JSON
-       * objects (e.g. a bunyan log).
-       */
-      // An object must end with '}'. This is an early out to avoid
-      // `JSON.parse` which I *presuming* is slower.
-      var trimmed = block.split(/\s*\r?\n/)[0];
-      //console.warn("XXX trimmed: '%s'", trimmed);
-      if (trimmed[trimmed.length - 1] === '}') {
-        var obj;
-        try {
-          obj = JSON.parse(block);
-        } catch (e) {
-          /* pass through */
-        }
-        if (obj !== undefined) {
-          // Emit the parsed `obj` to avoid re-parsing it later.
-          emitter.emit('chunk', block, obj);
-          block = '';
-        }
-      }
-      return block;
-    } else {
-      var n = bits.length - 2;
-      emitter.emit('chunk', bits[0] + bits[1]);
-      for (var i = 3; i < n; i += 4) {
-        emitter.emit('chunk', bits[i] + bits[i+1] + bits[i+2]);
-      }
-      return bits[n] + bits[n+1];
-    }
-  }
-
-  function addDataListener(stream) {
-    stream.on('data', function (chunk) {
-      var s = leftover + chunk;
-      if (!finishedHeaders) {
-        s = stripHeaders(s);
-      }
-      if (!finishedHeaders) {
-        leftover = s;
-      } else {
-        if (!streaming) {
-          chunks.push(chunk);
-          return;
-        }
-        leftover = emitChunks(s, emitter);
-        //console.warn("XXX leftover: '%s'", leftover)
-      }
-    });
-  }
-
-  if (opts.inputFiles.length > 0) {
-    // Stream each file in order.
-    var i = 0;
-    function addErrorListener(file) {
-      file.on('error', function (err) {
-        emitter.emit(
-          'error',
-          format('could not read "%s": %s', opts.inputFiles[i], e)
-        );
-      });
-    }
-    function addEndListener(file) {
-      file.on('end', function () {
-        if (i < opts.inputFiles.length) {
-          var next = opts.inputFiles[i++];
-          var nextFile = fs.createReadStream(next, {encoding: 'utf8'});
-          addErrorListener(nextFile);
-          addEndListener(nextFile);
-          addDataListener(nextFile);
-        } else {
-          if (!streaming) {
-            emitter.emit('chunk', chunks.join(''));
-          } else if (leftover) {
-            leftover = emitChunks(leftover, emitter);
-            emitter.emit('chunk', leftover);
-          }
-          emitter.emit('end');
-        }
-      });
-    }
-    var first = fs.createReadStream(opts.inputFiles[i++], {encoding: 'utf8'});
-    addErrorListener(first);
-    addEndListener(first);
-    addDataListener(first);
-  } else {
-    // Streaming from stdin.
-    var stdin = process.openStdin();
-    stdin.setEncoding('utf8');
-    addDataListener(stdin);
-    stdin.on('end', function () {
-      if (!streaming) {
-        emitter.emit('chunk', chunks.join(''));
-      } else if (leftover) {
-        leftover = emitChunks(leftover, emitter);
-        emitter.emit('chunk', leftover);
-      }
-      emitter.emit('end');
-    });
-  }
-  return emitter;
-}
-
-/**
- * Get input from either given file paths or stdin.
- *
- * @param opts {Object} Parsed options.
- * @param callback {Function} `function (err, callback)` where err is an
- *    error string if there was a problem.
- */
-function getInput(opts, callback) {
-  if (opts.inputFiles.length === 0) {
-    // Read from stdin.
-    var chunks = [];
-
-    var stdin = process.openStdin();
-    stdin.setEncoding('utf8');
-    stdin.on('data', function (chunk) {
-      chunks.push(chunk);
-    });
-
-    stdin.on('end', function () {
-      callback(null, chunks.join(''));
-    });
-  } else {
-    // Read input files.
-    var i = 0;
-    var chunks = [];
-    try {
-      for (; i < opts.inputFiles.length; i++) {
-        chunks.push(fs.readFileSync(opts.inputFiles[i], 'utf8'));
-      }
-    } catch (e) {
-      return callback(
-        format('could not read "%s": %s', opts.inputFiles[i], e));
-    }
-    callback(null, chunks.join(''));
-  }
-}
-
-
-function isInteger(s) {
-  return (s.search(/^-?[0-9]+$/) == 0);
-}
-
-
-// Parse a lookup string into a list of lookup bits. E.g.:
-//    "a.b.c" -> ["a","b","c"]
-//    "b['a']" -> ["b","['a']"]
-// Optionally receives an alternative lookup delimiter (other than '.')
-function parseLookup(lookup, lookupDelim) {
-  //var debug = console.warn;
-  var debug = function () {};
-
-  var bits = [];
-  debug("\n*** "+lookup+" ***")
-
-  bits = [];
-  lookupDelim = lookupDelim || ".";
-  var bit = "";
-  var states = [null];
-  var escaped = false;
-  var ch = null;
-  for (var i=0; i < lookup.length; ++i) {
-    var escaped = (!escaped && ch === '\\');
-    var ch = lookup[i];
-    debug("-- i="+i+", ch="+JSON.stringify(ch)+" escaped="+JSON.stringify(escaped))
-    debug("states: "+JSON.stringify(states))
-
-    if (escaped) {
-      bit += ch;
-      continue;
-    }
-
-    switch (states[states.length-1]) {
-    case null:
-      switch (ch) {
-      case '"':
-      case "'":
-        states.push(ch);
-        bit += ch;
-        break;
-      case '[':
-        states.push(ch);
-        if (bit !== "") {
-          bits.push(bit);
-          bit = ""
-        }
-        bit += ch;
-        break;
-      case lookupDelim:
-        if (bit !== "") {
-          bits.push(bit);
-          bit = ""
-        }
-        break;
-      default:
-        bit += ch;
-        break;
-      }
-      break;
-
-    case '[':
-      bit += ch;
-      switch (ch) {
-      case '"':
-      case "'":
-      case '[':
-        states.push(ch);
-        break;
-      case ']':
-        states.pop();
-        if (states[states.length-1] === null) {
-          bits.push(bit);
-          bit = ""
-        }
-        break;
-      }
-      break;
-
-    case '"':
-      bit += ch;
-      switch (ch) {
-      case '"':
-        states.pop();
-        if (states[states.length-1] === null) {
-          bits.push(bit);
-          bit = ""
-        }
-        break;
-      }
-      break;
-
-    case "'":
-      bit += ch;
-      switch (ch) {
-      case "'":
-        states.pop();
-        if (states[states.length-1] === null) {
-          bits.push(bit);
-          bit = ""
-        }
-        break;
-      }
-      break;
-    }
-    debug("bit: "+JSON.stringify(bit))
-    debug("bits: "+JSON.stringify(bits))
-  }
-
-  if (bit !== "") {
-    bits.push(bit);
-    bit = ""
-  }
-
-  debug(JSON.stringify(lookup)+" -> "+JSON.stringify(bits))
-  return bits
-}
-
-
-/**
- * Parse the given stdin input into:
- *  {
- *    "error": ... error object if there was an error ...,
- *    "datum": ... parsed object if content was JSON ...
- *   }
- *
- * @param buffer {String} The text to parse as JSON.
- * @param obj {Object} Optional. Some streaming code paths will provide
- *    this, an already parsed JSON object. Use this to avoid reparsing.
- * @param group {Boolean} Default false. If true, then non-JSON input
- *    will be attempted to be "arrayified" (see inline comment).
- * @param merge {Boolean} Default null. Can be "shallow" or "deep". An
- *    attempt will be made to interpret the input as adjacent objects to
- *    be merged, last key wins. See inline comment for limitations.
- */
-function parseInput(buffer, obj, group, merge) {
-  if (obj) {
-    return {datum: obj};
-  } else if (group) {
-    // Special case: Grouping (previously called auto-arrayification)
-    // of unjoined list of objects:
-    //    {"one": 1}{"two": 2}
-    // and auto-concatenation of unjoined list of arrays:
-    //    ["a", "b"]["c", "d"]
-    //
-    // This can be nice to process a stream of JSON objects generated from
-    // multiple calls to another tool or `cat *.json | json`.
-    //
-    // Rules:
-    // - Only JS objects and arrays. Don't see strong need for basic
-    //   JS types right now and this limitation simplifies.
-    // - The break between JS objects has to include a newline:
-    //      {"one": 1}
-    //      {"two": 2}
-    //   or no spaces at all:
-    //      {"one": 1}{"two": 2}
-    //   I.e., not this:
-    //      {"one": 1}  {"two": 2}
-    //   This condition should be fine for typical use cases and ensures
-    //   no false matches inside JS strings.
-    var newBuffer = buffer;
-    [/(})\s*\n\s*({)/g, /(})({")/g].forEach(function (pat) {
-      newBuffer = newBuffer.replace(pat, "$1,\n$2");
-    });
-    [/(\])\s*\n\s*(\[)/g, /(\])(\[)/g].forEach(function (pat) {
-      newBuffer = newBuffer.replace(pat, ",\n");
-    });
-    newBuffer = newBuffer.trim();
-    if (newBuffer[0] !== '[') {
-      newBuffer = '[\n' + newBuffer;
-    }
-    if (newBuffer.slice(-1) !== ']') {
-      newBuffer = newBuffer + '\n]\n';
-    }
-    try {
-      return {datum: JSON.parse(newBuffer)};
-    } catch (e2) {
-      return {error: e2};
-    }
-  } else if (merge) {
-    // See the "Rules" above for limitations on boundaries for "adjacent"
-    // objects: KISS.
-    var newBuffer = buffer;
-    [/(})\s*\n\s*({)/g, /(})({")/g].forEach(function (pat) {
-      newBuffer = newBuffer.replace(pat, "$1,\n$2");
-    });
-    newBuffer = '[\n' + newBuffer + '\n]\n';
-    var objs;
-    try {
-      objs = JSON.parse(newBuffer);
-    } catch(e) {
-      return {error: e};
-    }
-    var merged = objs[0];
-    if (merge === "shallow") {
-      for (var i = 1; i < objs.length; i++) {
-        var obj = objs[i];
-        Object.keys(obj).forEach(function (k) {
-          merged[k] = obj[k];
-        });
-      }
-    } else if (merge === "deep") {
-      function deepExtend(a, b) {
-        Object.keys(b).forEach(function (k) {
-          if (a[k] && b[k] && toString.call(a[k]) === '[object Object]'
-              && toString.call(b[k]) === '[object Object]') {
-            deepExtend(a[k], b[k])
-          } else {
-            a[k] = b[k];
-          }
-        });
-      }
-      for (var i = 1; i < objs.length; i++) {
-        deepExtend(merged, objs[i]);
-      }
-    } else {
-      throw new Error(format('unknown value for "merge": "%s"', merge));
-    }
-    return {datum: merged};
-  } else {
-    try {
-      return {datum: JSON.parse(buffer)};
-    } catch(e) {
-      return {error: e};
-    }
-  }
-}
-
-
-/**
- * Apply a lookup to the given datum.
- *
- * @argument datum {Object}
- * @argument lookup {Array} The parsed lookup (from
- *    `parseLookup(<string>, <string>)`). Might be empty.
- * @returns {Object} The result of the lookup.
- */
-function lookupDatum(datum, lookup) {
-  // Put it back together with some convenience transformations.
-  var lookupCode = "";
-  var isJSIdentifier = /^[$A-Za-z_][0-9A-Za-z_]*$/;
-  var isNegArrayIndex = /^-\d+$/;
-  for (var i=0; i < lookup.length; i++) {
-    var bit = lookup[i];
-    if (bit[0] === '[') {
-      lookupCode += bit;
-    // Support Python-style negative array indexing.
-    } else if (bit === '-1') {
-      lookupCode += '.slice(-1)[0]';
-    } else if (isNegArrayIndex.test(bit)) {
-      lookupCode += format('.slice(%s, %d)[0]', bit, Number(bit) + 1);
-    } else if (! isJSIdentifier.test(bit)) {
-      // Allow a non-JS-indentifier token, e.g. `json foo-bar`. This also
-      // works for array index lookups: `json 0` becomes a `["0"]` lookup.
-      lookupCode += '["' + bit.replace(/"/g, '\\"') + '"]';
-    } else {
-      lookupCode += '.' + bit;
-    }
-  }
-  try {
-    return vm.runInNewContext("(" + JSON.stringify(datum) + ")" + lookupCode);
-  } catch (e) {
-    if (e.name === 'TypeError') {
-      // Skip the following for a lookup 'foo.bar' where 'foo' is undefined:
-      //    TypeError: Cannot read property 'bar' of undefined
-      // TODO: Are there other potential TypeError's in here to avoid?
-      return undefined;
-    }
-    throw e;
-  }
-}
-
-
-
-/**
- * Print out a single result, considering input options.
- */
-function printDatum(datum, opts, sep, alwaysPrintSep) {
-  var output = null;
-  switch (opts.outputMode) {
-  case OM_INSPECT:
-    output = util.inspect(datum, false, Infinity, process.stdout.isTTY);
-    break;
-  case OM_JSON:
-    if (typeof datum !== 'undefined') {
-      output = JSON.stringify(datum, null, opts.jsonIndent);
-    }
-    break;
-  case OM_COMPACT:
-    // Dev Note: A still relatively experimental attempt at a more
-    // compact ouput somewhat a la Python's repr of a dict. I.e. try to
-    // fit elements on one line as much as reasonable.
-    if (datum === undefined) {
-      // pass
-    } else if (Array.isArray(datum)) {
-      var bits = ['[\n'];
-      datum.forEach(function (d) {
-        bits.push('  ')
-        bits.push(JSON.stringify(d, null, 0).replace(/,"(?![,:])/g, ', "'));
-        bits.push(',\n');
-      });
-      bits.push(bits.pop().slice(0, -2) + '\n')  // drop last comma
-      bits.push(']');
-      output = bits.join('');
-    } else {
-      output = JSON.stringify(datum, null, 0);
-    }
-    break;
-  case OM_JSONY:
-    if (typeof datum === 'string') {
-      output = datum;
-    } else if (typeof datum !== 'undefined') {
-      output = JSON.stringify(datum, null, opts.jsonIndent);
-    }
-    break;
-  default:
-    throw new Error("unknown output mode: "+opts.outputMode);
-  }
-  if (output && output.length) {
-    emit(output);
-    emit(sep);
-  } else if (alwaysPrintSep) {
-    emit(sep);
-  }
-}
-
-
-var stdoutFlushed = true;
-function emit(s) {
-  // TODO:PERF If this is try/catch is too slow (too granular): move up to
-  //    mainline and be sure to only catch this particular error.
-  try {
-    stdoutFlushed = process.stdout.write(s);
-  } catch (e) {
-    // Handle any exceptions in stdout writing in the "error" event above.
-  }
-}
-
-process.stdout.on("error", function (err) {
-  if (err.code === "EPIPE") {
-    // See <https://github.com/trentm/json/issues/9>.
-    drainStdoutAndExit(0);
-  } else {
-    warn(err)
-    drainStdoutAndExit(1);
-  }
-});
-
-
-/**
- * A hacked up version of "process.exit" that will first drain stdout
- * before exiting. *WARNING: This doesn't stop event processing.* IOW,
- * callers have to be careful that code following this call isn't
- * accidentally executed.
- *
- * In node v0.6 "process.stdout and process.stderr are blocking when they
- * refer to regular files or TTY file descriptors." However, this hack might
- * still be necessary in a shell pipeline.
- */
-function drainStdoutAndExit(code) {
-  process.stdout.on('drain', function () {
-    process.exit(code);
-  });
-  if (stdoutFlushed) {
-    process.exit(code);
-  }
-}
-
-
-
-
-//---- mainline
-
-function main(argv) {
-  var opts;
-  try {
-    opts = parseArgv(argv);
-  } catch (e) {
-    warn("json: error: %s", e.message)
-    return drainStdoutAndExit(1);
-  }
-  //warn(opts);
-  if (opts.help) {
-    printHelp();
-    return;
-  }
-  if (opts.version) {
-    util.puts("json " + getVersion());
-    return;
-  }
-  var lookupStrs = opts.args;
-
-  if (opts.group && opts.array && opts.outputMode !== OM_JSON) {
-    // streaming
-    var chunker = chunkEmitter(opts);
-    chunker.on('error', function(error) {
-        warn("json: error: %s", err);
-        return drainStdoutAndExit(1);
-    });
-    chunker.on('chunk', parseChunk);
-  } else {
-    // not streaming
-    getInput(opts, function (err, buffer) {
-      if (err) {
-        warn("json: error: %s", err)
-        return drainStdoutAndExit(1);
-      }
-      // Take off a leading HTTP header if any and pass it through.
-      while (true) {
-        if (buffer.slice(0,5) === "HTTP/") {
-          var index = buffer.indexOf('\r\n\r\n');
-          var sepLen = 4;
-          if (index == -1) {
-            index = buffer.indexOf('\n\n');
-            sepLen = 2;
-          }
-          if (index != -1) {
-            if (! opts.dropHeaders) {
-              emit(buffer.slice(0, index+sepLen));
-            }
-            var is100Continue = (buffer.slice(0, 21) === "HTTP/1.1 100 Continue");
-            buffer = buffer.slice(index+sepLen);
-            if (is100Continue) {
-              continue;
-            }
-          }
-        }
-        break;
-      }
-      parseChunk(buffer);
-    });
-  }
-
-  /**
-   * Parse a single chunk of JSON. When not streaming, this will just be
-   * called once.
-   *
-   * @param chunk {String} The JSON-encoded string.
-   * @param obj {Object} Optional. For some code paths while streaming `obj`
-   *    will be provided. This is an already parsed JSON object.
-   */
-  function parseChunk(chunk, obj) {
-    // Expect the chunk to be JSON.
-    if (! chunk.length) {
-      return;
-    }
-    // parseInput() -> {datum: <input object>, error: <error object>}
-    var input = parseInput(chunk, obj, opts.group, opts.merge);
-    if (input.error) {
-      // Doesn't look like JSON. Just print it out and move on.
-      if (! opts.quiet) {
-        // Use JSON-js' "json_parse" parser to get more detail on the
-        // syntax error.
-        var details = "";
-        var normBuffer = chunk.replace(/\r\n|\n|\r/, '\n');
-        try {
-          json_parse(normBuffer);
-          details = input.error;
-        } catch(err) {
-          // err.at has the position. Get line/column from that.
-          var at = err.at - 1;  // `err.at` looks to be 1-based.
-          var lines = chunk.split('\n');
-          var line, col, pos = 0;
-          for (line = 0; line < lines.length; line++) {
-            pos += lines[line].length + 1;
-            if (pos > at) {
-              col = at - (pos - lines[line].length - 1);
-              break;
-            }
-          }
-          var spaces = '';
-          for (var i=0; i<col; i++) {
-            spaces += '.';
-          }
-          details = err.message+" at line "+(line+1)+", column "+(col+1)
-            + ":\n        "+lines[line]+"\n        "+spaces+"^";
-        }
-        warn("json: error: input is not JSON: %s", details);
-      }
-      if (!opts.validate) {
-        emit(chunk);
-        if (chunk.length && chunk[chunk.length-1] !== "\n") {
-          emit('\n');
-        }
-      }
-      return drainStdoutAndExit(1);
-    }
-    if (opts.validate) {
-      return drainStdoutAndExit(0);
-    }
-    var data = input.datum;
-
-    // Process: executable (-e).
-    var i, j;
-    var exeScripts = [];
-    for (i = 0; i < opts.exeSnippets.length; i++) {
-      exeScripts[i] = vm.createScript(opts.exeSnippets[i]);
-    }
-    if (!exeScripts.length) {
-      /* pass */
-    } else if (opts.array || (opts.array === null && Array.isArray(data))) {
-      var arrayified = false;
-      if (!Array.isArray(data)) {
-        arrayified = true;
-        data = [data];
-      }
-      for (i = 0; i < data.length; i++) {
-        var datum = data[i];
-        for (j = 0; j < exeScripts.length; j++) {
-          exeScripts[j].runInNewContext(datum);
-        }
-      }
-      if (arrayified) {
-        data = data[0];
-      }
-    } else {
-      for (j = 0; j < exeScripts.length; j++) {
-        exeScripts[j].runInNewContext(data);
-      }
-    }
-
-    // Process: conditionals (-c).
-    var condScripts = [];
-    for (i = 0; i < opts.condSnippets.length; i++) {
-      condScripts[i] = vm.createScript(opts.condSnippets[i]);
-    }
-    if (!condScripts.length) {
-      /* pass */
-    } else if (opts.array || (opts.array === null && Array.isArray(data))) {
-      var arrayified = false;
-      if (!Array.isArray(data)) {
-        arrayified = true;
-        data = [data];
-      }
-      var filtered = [];
-      for (i = 0; i < data.length; i++) {
-        var datum = data[i];
-        var datumCopy = objCopy(datum);
-        var keep = true;
-        for (j = 0; j < condScripts.length; j++) {
-          if (! condScripts[j].runInNewContext(datumCopy)) {
-            keep = false;
-            break;
-          }
-        }
-        if (keep) {
-          filtered.push(datum);
-        }
-      }
-      if (arrayified) {
-        data = (filtered.length ? filtered[0] : []);
-      } else {
-        data = filtered;
-      }
-    } else {
-      var keep = true;
-      var dataCopy = objCopy(data);
-      for (j = 0; j < condScripts.length; j++) {
-        if (! condScripts[j].runInNewContext(dataCopy)) {
-          keep = false;
-          break;
-        }
-      }
-      if (!keep) {
-        data = undefined;
-      }
-    }
-
-    // Process: lookups
-    var lookupsAreIndeces = false;
-    var lookups = lookupStrs.map(function(lookup) {
-        return parseLookup(lookup, opts.lookupDelim);
-    });
-    if (lookups.length) {
-      if (opts.array) {
-        if (!Array.isArray(data)) data = [data];
-        var table = [];
-        for (j=0; j < data.length; j++) {
-          var datum = data[j];
-          var row = {};
-          for (i=0; i < lookups.length; i++) {
-            var lookup = lookups[i];
-            var value = lookupDatum(datum, lookup);
-            if (value !== undefined) {
-              row[lookup.join('.')] = value;
-            }
-          }
-          table.push(row);
-        }
-        data = table;
-      } else {
-        // Special case handling: Note if the "lookups" are indeces into an
-        // array. This may be used below to change the output representation.
-        if (Array.isArray(data)) {
-          lookupsAreIndeces = true;
-          for (i = 0; i < lookups.length; i++) {
-            if (lookups[i].length !== 1 || isNaN(Number(lookups[i]))) {
-              lookupsAreIndeces = false;
-              break;
-            }
-          }
-        }
-        var row = {};
-        for (i = 0; i < lookups.length; i++) {
-          var lookup = lookups[i];
-          var value = lookupDatum(data, lookup);
-          if (value !== undefined) {
-            row[lookup.join('.')] = value;
-          }
-        }
-        data = row;
-      }
-    }
-
-    // --keys
-    if (opts.outputKeys) {
-      var data = Object.keys(data);
-    }
-
-    // Output
-    if (opts.outputMode === OM_JSON) {
-      if (lookups.length === 1 && !opts.array) {
-        // Special case: For JSON output of a *single* lookup, *don't* use
-        // the full table structure, else there is no way to get string
-        // quoting for a single value:
-        //      $ echo '{"a": [], "b": "[]"}' | json -j a
-        //      []
-        //      $ echo '{"a": [], "b": "[]"}' | json -j b
-        //      "[]"
-        // See <https://github.com/trentm/json/issues/35> for why.
-        data = data[lookups[0].join('.')];
-      } else if (lookupsAreIndeces) {
-        // Special case: Lookups that are all indeces into an input array
-        // are more likely to be wanted as an array of selected items rather
-        // than a "JSON table" thing that we use otherwise.
-        var flattened = [];
-        for (i = 0; i < lookups.length; i++) {
-          var lookupStr = lookups[i].join('.');
-          if (data.hasOwnProperty(lookupStr)) {
-            flattened.push(data[lookupStr])
-          }
-        }
-        data = flattened;
-      }
-      // If JSON output mode, then always just output full set of data to
-      // ensure valid JSON output.
-      printDatum(data, opts, '\n', false);
-    } else if (lookups.length) {
-      if (opts.array) {
-        // Output `data` as a "table" of lookup results.
-        for (j = 0; j < data.length; j++) {
-          var row = data[j];
-          for (i = 0; i < lookups.length-1; i++) {
-            printDatum(row[lookups[i].join('.')], opts, opts.delim, true);
-          }
-          printDatum(row[lookups[i].join('.')], opts, '\n', true);
-        }
-      } else {
-        for (i = 0; i < lookups.length; i++) {
-          printDatum(data[lookups[i].join('.')], opts, '\n', false);
-        }
-      }
-    } else if (opts.array) {
-      if (!Array.isArray(data)) data = [data];
-      for (j = 0; j < data.length; j++) {
-        printDatum(data[j], opts, '\n', false);
-      }
-    } else {
-      // Output `data` as is.
-      printDatum(data, opts, '\n', false);
-    }
-  }
-}
-
-if (require.main === module) {
-  // HACK guard for <https://github.com/trentm/json/issues/24>.
-  // We override the `process.stdout.end` guard that core node.js puts in
-  // place. The real fix is that `.end()` shouldn't be called on stdout
-  // in node core. Hopefully node v0.6.9 will fix that. Only guard
-  // for v0.6.0..v0.6.8.
-  var nodeVer = process.versions.node.split('.').map(Number);
-  if ([0,6,0] <= nodeVer && nodeVer <= [0,6,8]) {
-    var stdout = process.stdout;
-    stdout.end = stdout.destroy = stdout.destroySoon = function() {
-      /* pass */
-    };
-  }
-
-  main(process.argv);
-}
diff --git a/overlay/generic/usr/include/usb.h b/overlay/generic/usr/include/usb.h
deleted file mode 100644
index 0076a437..00000000
--- a/overlay/generic/usr/include/usb.h
+++ /dev/null
@@ -1,332 +0,0 @@
-/*
- * Copyright (c) 2004, 2010, Oracle and/or its affiliates. All rights reserved.
- */
-/*
- *
- * Prototypes, structure definitions and macros.
- *
- * Copyright (c) 2000-2003 Johannes Erdfelt <johannes@erdfelt.com>
- *
- * This file (and only this file) may alternatively be licensed under the
- * BSD license as well, read LICENSE for details.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- * 1. Redistributions of source code must retain the above copyright
- *    notice, this list of conditions and the following disclaimer.
- * 2. Redistributions in binary form must reproduce the above copyright
- *    notice, this list of conditions and the following disclaimer in the
- *    documentation and/or other materials provided with the distribution.
- * 3. The name of the author may not be used to endorse or promote products
- *    derived from this software without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
- * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
- * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
- * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
- * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
- * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
- * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
- * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
- * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
-#ifndef _SYS_USB_LIBUSB_USB_H
-#define	_SYS_USB_LIBUSB_USB_H
-
-#pragma ident	"@(#)usb.h	1.5	10/08/18 SMI"
-
-#ifdef	__cplusplus
-extern "C" {
-#endif
-
-
-#include <unistd.h>
-#include <stdlib.h>
-#include <limits.h>
-#include <dirent.h>
-
-/*
- * USB spec information
- *
- * This is all stuff grabbed from various USB specs and is pretty much
- * not subject to change
- */
-
-/*
- * Device and/or Interface Class codes
- */
-#define	USB_CLASS_PER_INTERFACE		0	/* for DeviceClass */
-#define	USB_CLASS_AUDIO			1
-#define	USB_CLASS_COMM			2
-#define	USB_CLASS_HID			3
-#define	USB_CLASS_PRINTER		7
-#define	USB_CLASS_MASS_STORAGE		8
-#define	USB_CLASS_HUB			9
-#define	USB_CLASS_DATA			10
-#define	USB_CLASS_VENDOR_SPEC		0xff
-
-/*
- * Descriptor types
- */
-#define	USB_DT_DEVICE			0x01
-#define	USB_DT_CONFIG			0x02
-#define	USB_DT_STRING			0x03
-#define	USB_DT_INTERFACE		0x04
-#define	USB_DT_ENDPOINT			0x05
-
-#define	USB_DT_HID			0x21
-#define	USB_DT_REPORT			0x22
-#define	USB_DT_PHYSICAL			0x23
-#define	USB_DT_HUB			0x29
-
-/*
- * Descriptor sizes per descriptor type
- */
-#define	USB_DT_DEVICE_SIZE		18
-#define	USB_DT_CONFIG_SIZE		9
-#define	USB_DT_INTERFACE_SIZE		9
-#define	USB_DT_ENDPOINT_SIZE		7
-#define	USB_DT_ENDPOINT_AUDIO_SIZE	9	/* Audio extension */
-#define	USB_DT_HUB_NONVAR_SIZE		7
-
-/* All standard descriptors have these 2 fields in common */
-struct usb_descriptor_header {
-	uint8_t  bLength;
-	uint8_t  bDescriptorType;
-};
-
-/* String descriptor */
-struct usb_string_descriptor {
-	uint8_t  bLength;
-	uint8_t  bDescriptorType;
-	uint16_t wData[1];
-};
-
-/* HID descriptor */
-struct usb_hid_descriptor {
-	uint8_t  bLength;
-	uint8_t  bDescriptorType;
-	uint16_t bcdHID;
-	uint8_t  bCountryCode;
-	uint8_t  bNumDescriptors;
-	/* u_int8_t  bReportDescriptorType; */
-	/* u_int16_t wDescriptorLength; */
-	/* ... */
-};
-
-/* Endpoint descriptor */
-#define	USB_MAXENDPOINTS	32
-struct usb_endpoint_descriptor {
-	uint8_t  bLength;
-	uint8_t  bDescriptorType;
-	uint8_t  bEndpointAddress;
-	uint8_t  bmAttributes;
-	uint16_t wMaxPacketSize;
-	uint8_t  bInterval;
-	uint8_t  bRefresh;
-	uint8_t  bSynchAddress;
-
-	unsigned char *extra;	/* Extra descriptors */
-	int extralen;
-};
-
-#define	USB_ENDPOINT_ADDRESS_MASK	0x0f	/* in bEndpointAddress */
-#define	USB_ENDPOINT_DIR_MASK		0x80
-
-#define	USB_ENDPOINT_TYPE_MASK		0x03	/* in bmAttributes */
-#define	USB_ENDPOINT_TYPE_CONTROL	0
-#define	USB_ENDPOINT_TYPE_ISOCHRONOUS	1
-#define	USB_ENDPOINT_TYPE_BULK		2
-#define	USB_ENDPOINT_TYPE_INTERRUPT	3
-
-/* Interface descriptor */
-#define	USB_MAXINTERFACES	32
-struct usb_interface_descriptor {
-	uint8_t  bLength;
-	uint8_t  bDescriptorType;
-	uint8_t  bInterfaceNumber;
-	uint8_t  bAlternateSetting;
-	uint8_t  bNumEndpoints;
-	uint8_t  bInterfaceClass;
-	uint8_t  bInterfaceSubClass;
-	uint8_t  bInterfaceProtocol;
-	uint8_t  iInterface;
-
-	struct usb_endpoint_descriptor *endpoint;
-
-	unsigned char *extra;	/* Extra descriptors */
-	int extralen;
-};
-
-#define	USB_MAXALTSETTING	128	/* Hard limit */
-struct usb_interface {
-	struct usb_interface_descriptor *altsetting;
-
-	int num_altsetting;
-};
-
-/* Configuration descriptor information.. */
-#define	USB_MAXCONFIG		8
-struct usb_config_descriptor {
-	uint8_t  bLength;
-	uint8_t  bDescriptorType;
-	uint16_t wTotalLength;
-	uint8_t  bNumInterfaces;
-	uint8_t  bConfigurationValue;
-	uint8_t  iConfiguration;
-	uint8_t  bmAttributes;
-	uint8_t  MaxPower;
-
-	struct usb_interface *interface; /* array of interface descriptors */
-
-	unsigned char *extra;	/* Extra descriptors */
-	int extralen;
-};
-
-/* Device descriptor */
-struct usb_device_descriptor {
-	uint8_t  bLength;
-	uint8_t  bDescriptorType;
-	uint16_t bcdUSB;
-	uint8_t  bDeviceClass;
-	uint8_t  bDeviceSubClass;
-	uint8_t  bDeviceProtocol;
-	uint8_t  bMaxPacketSize0;
-	uint16_t idVendor;
-	uint16_t idProduct;
-	uint16_t bcdDevice;
-	uint8_t  iManufacturer;
-	uint8_t  iProduct;
-	uint8_t  iSerialNumber;
-	uint8_t  bNumConfigurations;
-};
-
-struct usb_ctrl_setup {
-	uint8_t  bRequestType;
-	uint8_t  bRequest;
-	uint16_t wValue;
-	uint16_t wIndex;
-	uint16_t wLength;
-};
-
-/*
- * Standard requests
- */
-#define	USB_REQ_GET_STATUS		0x00
-#define	USB_REQ_CLEAR_FEATURE		0x01
-/* 0x02 is reserved */
-#define	USB_REQ_SET_FEATURE		0x03
-/* 0x04 is reserved */
-#define	USB_REQ_SET_ADDRESS		0x05
-#define	USB_REQ_GET_DESCRIPTOR		0x06
-#define	USB_REQ_SET_DESCRIPTOR		0x07
-#define	USB_REQ_GET_CONFIGURATION	0x08
-#define	USB_REQ_SET_CONFIGURATION	0x09
-#define	USB_REQ_GET_INTERFACE		0x0A
-#define	USB_REQ_SET_INTERFACE		0x0B
-#define	USB_REQ_SYNCH_FRAME		0x0C
-
-#define	USB_TYPE_STANDARD		(0x00 << 5)
-#define	USB_TYPE_CLASS			(0x01 << 5)
-#define	USB_TYPE_VENDOR			(0x02 << 5)
-#define	USB_TYPE_RESERVED		(0x03 << 5)
-
-#define	USB_RECIP_DEVICE		0x00
-#define	USB_RECIP_INTERFACE		0x01
-#define	USB_RECIP_ENDPOINT		0x02
-#define	USB_RECIP_OTHER			0x03
-
-/*
- * Various libusb API related stuff
- */
-
-#define	USB_ENDPOINT_IN			0x80
-#define	USB_ENDPOINT_OUT		0x00
-
-/* Error codes */
-#define	USB_ERROR_BEGIN			500000
-
-#define	USB_LE16_TO_CPU(x) do { \
-	x = ((x & 0xff) << 8) | ((x & 0xff00) >> 8); \
-	} while (0)
-
-/* Data types */
-struct usb_device {
-	struct usb_device	*next, *prev;
-	char			filename[PATH_MAX + 1];
-	struct usb_bus		*bus;
-	struct usb_device_descriptor descriptor;
-	struct usb_config_descriptor *config;  /* array of config descriptors */
-	void			*dev;	/* OS specific */
-	uint8_t			devnum;	/* not supported */
-	unsigned char		num_children; /* not supported */
-	struct usb_device	**children; /* not supported */
-};
-
-struct usb_bus {
-	struct usb_bus		*next, *prev;
-	char			dirname[PATH_MAX + 1];
-	struct usb_device	*devices;
-	uint32_t 		location;
-	struct usb_device	*root_dev; /* not supported */
-};
-
-typedef struct usb_dev_handle usb_dev_handle;
-
-/* Variables */
-extern struct usb_bus *usb_busses;
-
-/* Function prototypes */
-usb_dev_handle	*usb_open(struct usb_device *dev);
-int		usb_close(usb_dev_handle *dev);
-
-int		usb_bulk_write(usb_dev_handle *dev, int ep, char *bytes,
-			int size, int timeout);
-int		usb_bulk_read(usb_dev_handle *dev, int ep, char *bytes,
-			int size, int timeout);
-
-int		usb_interrupt_write(usb_dev_handle *dev, int ep, char *bytes,
-			int size, int timeout);
-int		usb_interrupt_read(usb_dev_handle *dev, int ep, char *bytes,
-			int size, int timeout);
-
-int		usb_control_msg(usb_dev_handle *dev, int requesttype,
-			int request, int value, int index, char *bytes,
-			int size, int timeout);
-
-int		usb_set_configuration(usb_dev_handle *dev,
-			int configuration);
-int		usb_claim_interface(usb_dev_handle *dev, int interface);
-int		usb_release_interface(usb_dev_handle *dev, int interface);
-int		usb_set_altinterface(usb_dev_handle *dev, int alternate);
-int		usb_resetep(usb_dev_handle *dev, unsigned int ep);
-int		usb_clear_halt(usb_dev_handle *dev, unsigned int ep);
-int		usb_reset(usb_dev_handle *dev);
-
-int		usb_get_string(usb_dev_handle *dev, int index, int langid,
-			char *buf, size_t buflen);
-int		usb_get_string_simple(usb_dev_handle *dev, int index,
-			char *buf, size_t buflen);
-int		usb_get_descriptor_by_endpoint(usb_dev_handle *dev, int ep,
-			uchar_t type, uchar_t index, void *buf, int size);
-int 		usb_get_descriptor(usb_dev_handle *dev, uchar_t type,
-			uchar_t index, void *buf, int size);
-
-char		*usb_strerror(void);
-
-void		usb_init(void);
-void		usb_set_debug(int level);
-int		usb_find_busses(void);
-int		usb_find_devices(void);
-
-struct usb_device *usb_device(usb_dev_handle *dev);
-struct usb_bus	*usb_get_busses(void);
-
-#ifdef __cplusplus
-}
-#endif
-
-#endif /* _SYS_USB_LIBUSB_USB_H */
diff --git a/overlay/generic/usr/lib/brand/README.smf b/overlay/generic/usr/lib/brand/README.smf
deleted file mode 100644
index 64cd3ade..00000000
--- a/overlay/generic/usr/lib/brand/README.smf
+++ /dev/null
@@ -1,107 +0,0 @@
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright 2015 Joyent, Inc.
-#
-
-There are a few rather brand specific issues related to how SMF works inside of
-them. This README describes how the different pieces interact and where they are
-defined. Note that this README only applies to the Joyent-style sparse zones. It
-does not apply to the KVM brand or the traditional ipkg and S10 branded zones.
-
-#
-# Per-brand manifests file
-#
-
-Each brand has a file called `manifests`. This file lists the set of manifests
-that the brand cares about being available to the zone. It is formatted as:
-
-<manifest_name> <enabled | disabled>
-
-Examples are:
-
-network/smb/client.xml		disabled
-network/ssh.xml			enabled
-
-The use of enabled or disabled determines the default disposition of the service
-when it is imported.
-
-This list is used in various places throughout the rest of the system for
-determining what shows up in the SMF repositories by default and what shows up
-in /lib/svc/manifest.
-
-#
-# Files in /lib/svc/manifest
-#
-
-/lib/svc/manifest is part of the sparse filesystem that gets placed into every
-zone. Unlike /usr, /lib/svc/manifest is brand specific. The zones service
-(svc:/system/zones:default) is responsible for creating the per-brand
-/lib/svc/manifest directories and they live in /zones/manifests/<brand-name>.
-This brand specific directory is lofs-mounted read-only into each zone.
-
-The presence of the enabled and disabled option in the brand's manifests file
-determine whether or not the service is enabled by default when imported. The
-xml file is changed to match the setting.
-
-#
-# Initial SMF repositories
-#
-
-SMF in the minimal brand works differently than it does in the normal Joyent
-Brand when it comes to specifying the initial services that are inside of the
-dataset and what files are in the SMF repository.
-
-SMF has the notion of a `seed repository`. This repository is the initial one
-that is used or copied for new zones. This repository contains various services
-already imported, whether or not they are enabled or disabled, and the various
-service properties.
-
-The traditional `joyent` brand gets this from the dataset itself. In other words,
-the database is already populated with the proper SMF state.
-
-In the `joyent-minimal` brand we handle this differently. We want to be able to
-reuse the datasets that exist but not be stuck with their rather large seed
-repositories that contain many things which are harmful in the minimal context,
-particularly manifest import (both the early and normal kind). To handle this
-the joyent-minimal brand defines a seed repository of its own that gets
-installed at zone creation time and replaces any existing repository.
-
-This seed repository is generated using the `svc.configd-native` and
-`svccfg-native` binaries. Every manifest listed in the brand's manifests file is
-included.
-
-Manifests available to the `joyent` brand not imported into the database are
-available for manual import in /lib/svc/manifest. With the minimal brand, only
-the bare minimum number of manifests should be imported.
-
-#
-# Using non-imported manifests
-#
-
-To use one of the manifests that exists but hasn't been imported is pretty easy.
-At some point in time after the initial creation of the zone (during the first
-boot setup script for example), you can import the service. For example, if you
-were going to import the cron service you would run:
-
-svccfg import /lib/svc/manifest/system/cron.xml
-
-Next, you need to potentially enable the service depending on the default
-disposition of the service. You enable the service by running:
-
-svcadm enable -s <service>
-
-Adding the `-s` flag causes the enabling to be synchronous. If you do not
-include the flag then it will poke svc.startd to enable the service and return.
-If the service is already enabled by default, then this is safe to run and it
-won't change anything. It is safer to just always enable or disable the service
-after importing it based on your needs.
diff --git a/overlay/generic/usr/lib/brand/jcommon/cattach b/overlay/generic/usr/lib/brand/jcommon/cattach
deleted file mode 100644
index 4f2e65ad..00000000
--- a/overlay/generic/usr/lib/brand/jcommon/cattach
+++ /dev/null
@@ -1,63 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-unset LD_LIBRARY_PATH
-PATH=/usr/bin:/usr/sbin
-export PATH
-
-. /usr/lib/brand/shared/common.ksh
-
-ZONENAME=""
-ZONEPATH=""
-# Default to 10GB diskset quota
-ZQUOTA=10
-
-while getopts "R:t:U:q:z:" opt
-do
-	case "$opt" in
-		R)	ZONEPATH="$OPTARG";;
-		q)	ZQUOTA="$OPTARG";;
-		z)	ZONENAME="$OPTARG";;
-		*)	printf "$m_usage\n"
-			exit $ZONE_SUBPROC_USAGE;;
-	esac
-done
-shift OPTIND-1
-
-if [[ -z $ZONEPATH || -z $ZONENAME ]]; then
-	print -u2 "Brand error: No zone path or name"
-	exit $ZONE_SUBPROC_USAGE
-fi
-
-# The dataset quota must be a number.
-case $ZQUOTA in *[!0-9]*)
-	print -u2 "Brand error: The quota $ZQUOTA is not a number"
-	exit $ZONE_SUBPROC_USAGE;;
-esac
-
-ZROOT=$ZONEPATH/root
-
-# Get the dataset of the parent directory of the zonepath.
-dname=${ZONEPATH%/*}
-bname=${ZONEPATH##*/}
-PDS_NAME=`mount | nawk -v p=$dname '{if ($1 == p) print $3}'`
-[ -z "$PDS_NAME" ] && \
-    print -u2 "Brand error: missing parent ZFS dataset for $dname"
-
-jcommon_attach_hook
-
-exit $ZONE_SUBPROC_OK
diff --git a/overlay/generic/usr/lib/brand/jcommon/cdetach b/overlay/generic/usr/lib/brand/jcommon/cdetach
deleted file mode 100644
index 4b67b31f..00000000
--- a/overlay/generic/usr/lib/brand/jcommon/cdetach
+++ /dev/null
@@ -1,50 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-unset LD_LIBRARY_PATH
-PATH=/usr/bin:/usr/sbin
-export PATH
-
-. /usr/lib/brand/shared/common.ksh
-
-ZONENAME=""
-ZONEPATH=""
-
-while getopts "R:t:U:z:" opt
-do
-	case "$opt" in
-		R)	ZONEPATH="$OPTARG";;
-		z)	ZONENAME="$OPTARG";;
-		*)	printf "$m_usage\n"
-			exit $ZONE_SUBPROC_USAGE;;
-	esac
-done
-shift OPTIND-1
-
-if [[ -z $ZONEPATH || -z $ZONENAME ]]; then
-	print -u2 "Brand error: No zone path or name"
-	exit $ZONE_SUBPROC_USAGE
-fi
-
-#
-# We just need a brand hook so that we can bypass the mount checking
-# that zoneadm does.  This is needed because we have the cores dataset
-# mounted under {zonepath}/root.
-#
-cp /etc/zones/${ZONENAME}.xml ${ZONEPATH}/SUNWdetached.xml
-
-exit $ZONE_SUBPROC_OK
diff --git a/overlay/generic/usr/lib/brand/jcommon/cinstall b/overlay/generic/usr/lib/brand/jcommon/cinstall
deleted file mode 100644
index 98b9322b..00000000
--- a/overlay/generic/usr/lib/brand/jcommon/cinstall
+++ /dev/null
@@ -1,183 +0,0 @@
-#!/bin/ksh -p
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-# Copyright (c) 2016, Joyent, Inc. All rights reserved.
-# Use is subject to license terms.
-#
-
-unset LD_LIBRARY_PATH
-PATH=/usr/bin:/usr/sbin
-export PATH
-
-. /usr/lib/brand/shared/common.ksh
-
-REPROVISONING=""
-ZONENAME=""
-ZONEPATH=""
-# Default to 10GB diskset quota
-ZQUOTA=10
-ZVOL_NAME=`/usr/bin/uuid -v 4`
-
-#
-# The following are the list of features that a corresponding brand may
-# enable. If they wish to do so, then they must set the following flags
-# to values such that [[ -z $flag ]] is true. The following are the
-# currently supported flags:
-#
-# o jst_reprovision - Brand supports reprovision
-# o jst_tmplopt - Template image optional
-#
-
-function fixup_images
-{
-	# New imgadm renames the dataset's snapshot at import to @final for us
-	# and when it exists, we use that. However, when it does not exist we
-	# still use the old method of creating a zones/<uuid>@<uuid> snapshot
-	# so we can support old datasets.
-	exists=$(zfs list -Ho name ${PDS_NAME}/${TMPLZONE}@final 2>&1)
-	if [[ $? == 0 && ${exists} == "${PDS_NAME}/${TMPLZONE}@final" ]]; then
-		zfs clone -o devices=off -F ${QUOTA_ARG} ${PDS_NAME}/${TMPLZONE}@final \
-		    ${PDS_NAME}/${bname} || fatal "failed to clone zone dataset"
-	elif [[ ${exists} =~ "dataset does not exist" ]]; then
-		zfs snapshot ${PDS_NAME}/${TMPLZONE}@${bname}
-		zfs clone -o devices=off -F ${QUOTA_ARG} ${PDS_NAME}/${TMPLZONE}@${bname} \
-		    ${PDS_NAME}/${bname} || fatal "failed to clone zone dataset"
-	else
-		fatal "Unable to determine snapshot for ${PDS_NAME}/${TMPLZONE}"
-	fi
-}
-
-while getopts "rR:t:U:q:z:" opt
-do
-	case "$opt" in
-		r)
-			set -x
-			if [[ -z "$jst_reprovision" ]]; then
-				print -u2 "unsupported reprovision requested"
-				exit $ZONE_SUBPROC_USAGE
-			fi
-			REPROVISIONING="true"
-			;;
-		R)	ZONEPATH="$OPTARG";;
-		t)	TMPLZONE="$OPTARG";;
-			# UUID is only used in the postinstall script
-		U)	UUID="$OPTARG";;
-		q)	ZQUOTA="$OPTARG";;
-		z)	ZONENAME="$OPTARG";;
-		*)	printf "$m_usage\n"
-			exit $ZONE_SUBPROC_USAGE;;
-	esac
-done
-shift OPTIND-1
-
-#
-# IMPORTANT: all actions below need to consider reprovision. If the action
-# modifies files in the zoneroot itself, it should be run on reprovision
-# any other changes to the zone or dataset should not be done on reprovision.
-#
-
-if [[ -z ${REPROVISIONING} \
-    && -n $(zonecfg -z "${ZONENAME}" info attr name=transition \
-    | grep "value: receiving:") ]]; then
-
-	# Here we're doing an install for a received zone, the dataset should have
-	# already been created.
-	exit $ZONE_SUBPROC_OK
-fi
-
-if [[ -z $ZONEPATH || -z $ZONENAME ]]; then
-	print -u2 "Brand error: No zone path or name"
-	exit $ZONE_SUBPROC_USAGE
-fi
-
-if [[ -z ${REPROVISIONING} ]]; then
-	# The install may requires a template zone.
-	if [[ -z $TMPLZONE && -z "$jst_tmplopt" ]]; then
-		print -u2 "Brand error: a zone template is required"
-		exit $ZONE_SUBPROC_USAGE
-	fi
-
-	# The dataset quota must be a number.
-	case $ZQUOTA in *[!0-9]*)
-		print -u2 "Brand error: The quota $ZQUOTA is not a number"
-		exit $ZONE_SUBPROC_USAGE;;
-	esac
-fi
-
-ZROOT=$ZONEPATH/root
-
-if [[ -z ${REPROVISIONING} ]]; then
-	# Get the dataset of the parent directory of the zonepath.
-	dname=${ZONEPATH%/*}
-	bname=${ZONEPATH##*/}
-	PDS_NAME=`mount | nawk -v p=$dname '{if ($1 == p) print $3}'`
-	[ -z "$PDS_NAME" ] && \
-	    print -u2 "Brand error: missing parent ZFS dataset for $dname"
-
-	# We expect that zoneadm was invoked with '-x nodataset', so it won't have
-	# created the dataset.
-
-	QUOTA_ARG=
-	if [[ ${ZQUOTA} != "0" ]]; then
-		QUOTA_ARG="-o quota=${ZQUOTA}g"
-	fi
-
-	#
-	# Some zone brands (KVM) optionally have a top level dataset. If
-	# they don't have one, we need to set the quota on the data
-	# disk.  Otherwise, we set it on the normal top level dataset.
-	#
-	if [[ -z ${TMPLZONE} ]]; then
-		zfs set quota=${ZQUOTA}g ${PDS_NAME}/${bname}
-	else
-		fixup_images
-	fi
-
-fi
-
-# The rest should be run when REPROVISIONING is set as well.
-
-# Make sure zoneinit is setup to use -o xtrace, this handles old datasets where
-# is not yet enabled by default.
-if [[ -f ${ZROOT}/root/zoneinit && \
-	-z $(grep "^set -o xtrace" ${ZROOT}/root/zoneinit) ]]; then
-	sed -i "" -e "s/^#set -o xtrace/set -o xtrace/" ${ZROOT}/root/zoneinit
-fi
-
-if [ ! -d ${ZONEPATH}/config ]; then
-	mkdir -p ${ZONEPATH}/config
-	chmod 755 ${ZONEPATH}/config
-fi
-
-if [ ! -d ${ZROOT}/tmp ]; then
-	mkdir -p ${ZROOT}/tmp
-	chmod 1777 ${ZROOT}/tmp
-fi
-
-# make /var/svc for the 'provisioning file'
-if [ ! -d ${ZROOT}/var/svc ]; then
-	mkdir -p ${ZROOT}/var/svc
-	chmod 0755 ${ZROOT}/var/svc
-fi
-
-jcommon_attach_hook
-
-exit $ZONE_SUBPROC_OK
diff --git a/overlay/generic/usr/lib/brand/jcommon/cuninstall b/overlay/generic/usr/lib/brand/jcommon/cuninstall
deleted file mode 100644
index 9be35bc7..00000000
--- a/overlay/generic/usr/lib/brand/jcommon/cuninstall
+++ /dev/null
@@ -1,74 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2016 Joyent, Inc.  All rights reserved.
-#
-
-unset LD_LIBRARY_PATH
-PATH=/usr/bin:/usr/sbin
-export PATH
-
-. /usr/lib/brand/shared/common.ksh
-
-ZONENAME=""
-ZONEPATH=""
-
-while getopts "FR:z:" opt
-do
-	case "$opt" in
-		F)	;;
-		R)	ZONEPATH="$OPTARG";;
-		z)	ZONENAME="$OPTARG";;
-		*)	printf "$m_usage\n"
-			exit $ZONE_SUBPROC_USAGE;;
-	esac
-done
-shift OPTIND-1
-
-if [[ -z $ZONEPATH || -z $ZONENAME ]]; then
-	print -u2 "Brand error: No zone path or name"
-	exit $ZONE_SUBPROC_USAGE
-fi
-
-# Get the dataset of the parent directory of the zonepath.
-dname=${ZONEPATH%/*}
-bname=${ZONEPATH##*/}
-PDS_NAME=`mount | nawk -v p=$dname '{if ($1 == p) print $3}'`
-if [[ -z "$PDS_NAME" ]]; then
-	print -u2 "Brand error: missing parent ZFS dataset for $dname"
-	exit $ZONE_SUBPROC_USAGE
-fi
-
-# check if the origin is not an @final dataset, if not, we'll destroy it
-ORIGIN=`zfs get -H -ovalue origin $PDS_NAME/$bname | grep -v "@final$"`
-
-zfs destroy -rF $PDS_NAME/cores/$bname
-zfs destroy -rF $PDS_NAME/$bname
-if [[ $? != 0 ]]; then
-    echo "processes in zone: "
-    fuser ${ZONEPATH}
-    # Since we are destroying the zone, we don't want to leave a zoneroot behind
-    # just because something couldn't be umounted. So we'll also force the
-    # umount with the 'f' option here.
-    zfs destroy -rfF $PDS_NAME/$bname
-fi
-
-[[ -n ${ORIGIN} && ${ORIGIN} != "-" ]] && zfs destroy -F $ORIGIN
-
-rm -rf $ZONEPATH
-rm -rf /var/zonecontrol/${ZONENAME}
-
-jcommon_uninstall_hook
-
-exit $ZONE_SUBPROC_OK
diff --git a/overlay/generic/usr/lib/brand/jcommon/libhooks.ksh b/overlay/generic/usr/lib/brand/jcommon/libhooks.ksh
deleted file mode 100644
index 34635651..00000000
--- a/overlay/generic/usr/lib/brand/jcommon/libhooks.ksh
+++ /dev/null
@@ -1,96 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-#
-# This file contains various hooks that are used by nore than a single
-# brand. This file should be included by the brand-specific files.
-#
-
-jattach_kvm_final_setup()
-{
-	ZRAM=$(zonecfg -z ${ZONENAME} info attr name=ram | \
-		grep "value: " | cut -d ':' -f2 | tr -d ' ')
-
-	if [[ -z ${ZRAM} ]]; then
-		echo "Unable to find RAM value for KVM VM"
-		exit $ZONE_SUBPROC_FATAL
-	fi
-
-	# 100G unless the VM has 80G or more DRAM, in which case: DRAM + 20G.
-	CORE_QUOTA=102400
-	if [[ ${ZRAM} -gt 81920 ]]; then
-		CORE_QUOTA=$((${ZRAM} + 20480))
-	fi
-
-	# The cores quota exists to control run-away zones. As such we make it
-	# such that it will protect the system from a single run-away, but
-	# still allow us to get most cores.
-	rm -rf $ZONEPATH/cores
-	zfs create -o quota=${CORE_QUOTA}m -o mountpoint=/${PDS_NAME}/$bname/cores \
-	    ${PDS_NAME}/cores/$bname
-}
-
-jattach_zone_final_setup()
-{
-	if [[ -z ${REPROVISIONING} ]]; then
-		# The cores quota exists to control run-away zones. As such we make it
-		# such that it will protect the system from a single run-away, but
-		# still allow us to get most cores. 100G seems good enough based on
-		# samples from JPC.
-		rm -rf $ZONEPATH/cores
-		CORE_QUOTA=102400
-		zfs create -o quota=${CORE_QUOTA}m -o mountpoint=/${PDS_NAME}/$bname/cores \
-		    ${PDS_NAME}/cores/$bname
-
-		chmod 700 $ZONEPATH
-	fi
-
-	egrep -s "netcfg:" $ZROOT/etc/passwd
-	if (( $? != 0 )); then
-		echo "netcfg:x:17:65:Network Configuration Admin:/:" \
-		    >> $ZROOT/etc/passwd
-		echo "netcfg:*LK*:::::::" >> $ZROOT/etc/shadow
-	fi
-	egrep -s "netadm:" $ZROOT/etc/group
-	(( $? != 0 )) && echo "netadm::65:" >> $ZROOT/etc/group
-
-	# /etc/svc/profile needs to be a directory with some contents which we
-	# can get from the template.  The early manifest import svc
-	# (lib/svc/method/manifest-import) copies some symlinks from the
-	# template's var/svc/profile dir and we need to make sure those are
-	# pointing at the right files and not left dangling.
-	ZPROFILE=$ZROOT/etc/svc/profile
-	if [ ! -d $ZPROFILE ]; then
-		mkdir $ZPROFILE
-		cp -p $ZROOT/var/svc/profile/generic_limited_net.xml $ZPROFILE
-		cp -p $ZROOT/var/svc/profile/inetd_generic.xml $ZPROFILE
-		cp -p $ZROOT/var/svc/profile/ns_dns.xml $ZPROFILE
-		cp -p $ZROOT/var/svc/profile/platform_none.xml $ZPROFILE
-	fi
-
-	touch $ZROOT/var/log/courier.log
-}
-
-function juninstall_delegated_dataset
-{
-	# Now destroy any delegated datasets. Redirect to /dev/null in case they
-	# were already destroyed when we removed the zonepath dataset.
-	DD=`zonecfg -z $ZONENAME info dataset | nawk '{if ($1 == "name:") print $2}'`
-	for i in $DD; do
-		zfs destroy -rF $i >/dev/null 2>&1
-	done
-}
diff --git a/overlay/generic/usr/lib/brand/jcommon/poststate b/overlay/generic/usr/lib/brand/jcommon/poststate
deleted file mode 100644
index 4e4b1207..00000000
--- a/overlay/generic/usr/lib/brand/jcommon/poststate
+++ /dev/null
@@ -1,34 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-unset LD_LIBRARY_PATH
-PATH=/usr/bin:/usr/sbin
-export PATH
-
-if [[ -n $_ZONEADMD_brand_debug ]]; then
-	logfile=/var/log/zone_bh.$1
-	date >>$logfile
-	echo "zone $1 post-state-change $3 $4" >>$logfile
-	ksh -x /usr/lib/brand/$ps_brand/statechange "post" $@ 2>>$logfile
-	res=$?
-	echo "zone $1 post-state-change result $res" >>$logfile
-else
-	/usr/lib/brand/$ps_brand/statechange "post" $@
-	res=$?
-fi
-
-exit $res
diff --git a/overlay/generic/usr/lib/brand/jcommon/prestate b/overlay/generic/usr/lib/brand/jcommon/prestate
deleted file mode 100644
index a61af897..00000000
--- a/overlay/generic/usr/lib/brand/jcommon/prestate
+++ /dev/null
@@ -1,34 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-unset LD_LIBRARY_PATH
-PATH=/usr/bin:/usr/sbin
-export PATH
-
-if [[ -n $_ZONEADMD_brand_debug ]]; then
-	logfile=/var/log/zone_bh.$1
-	date >>$logfile
-	echo "zone $1 pre-state-change $3 $4" >>$logfile
-	ksh -x /usr/lib/brand/$ps_brand/statechange "pre" $@ 2>>$logfile
-	res=$?
-	echo "zone $1 pre-state-change result $res" >>$logfile
-else
-	/usr/lib/brand/$ps_brand/statechange "pre" $@
-	res=$?
-fi
-
-exit $res
diff --git a/overlay/generic/usr/lib/brand/jcommon/query b/overlay/generic/usr/lib/brand/jcommon/query
deleted file mode 100755
index 70ea39d8..00000000
--- a/overlay/generic/usr/lib/brand/jcommon/query
+++ /dev/null
@@ -1,52 +0,0 @@
-#!/bin/ksh -p
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-#
-# Copyright (c) 2011, Oracle and/or its affiliates. All rights reserved.
-#
-
-PATH=/usr/bin:/usr/sbin
-export PATH
-
-. /usr/lib/brand/shared/common.ksh
-
-zonename=$1
-zonepath=$2
-cmd=$3
-
-if [ $3 == "env" ]; then
-	#
-	# zoneadmd reads one (arbitrary length) line of input from the query
-	# hook.  If there is more than one environment variable to pass back,
-	# delimit each one with tabs.  zoneadmd will split the line at the tabs
-	# and set each key/value pair in its environment.
-	#
-	# Currently, only _ZONEADMD_ZPOOL is used to set the %P substitution
-	# for the brand configuration.
-	#
-	entry=$(svccfg -s smartdc/init listprop '*/zpool')
-	if [ -n "$entry" ]; then
-		val=${entry##* * }
-		[ -n "$val" ] && echo "_ZONEADMD_ZPOOL=/${val}\c"
-	fi
-fi
-
-exit $ZONE_SUBPROC_OK
diff --git a/overlay/generic/usr/lib/brand/jcommon/statechange b/overlay/generic/usr/lib/brand/jcommon/statechange
deleted file mode 100644
index 58eae5ab..00000000
--- a/overlay/generic/usr/lib/brand/jcommon/statechange
+++ /dev/null
@@ -1,906 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2018 Joyent, Inc.  All rights reserved.
-#
-
-unset LD_LIBRARY_PATH
-PATH=/usr/bin:/usr/sbin
-export PATH
-
-. /lib/sdc/config.sh
-
-# subcommand:
-# pre
-# post
-
-# state
-# ZONE_STATE_CONFIGURED		0 (script will never see this)
-# ZONE_STATE_INCOMPLETE		1 (script will never see this)
-# ZONE_STATE_INSTALLED		2
-# ZONE_STATE_READY		3
-# ZONE_STATE_RUNNING		4
-# ZONE_STATE_SHUTTING_DOWN	5
-# ZONE_STATE_DOWN		6
-# ZONE_STATE_MOUNTED		7
-
-# cmd
-#
-# ready				0
-# boot				1
-# forceboot			2
-# reboot			3
-# halt				4
-# uninstalling			5
-# mount				6
-# forcemount			7
-# unmount			8
-
-subcommand=$1
-ZONENAME=$2
-ZONEPATH=$3
-state=$4
-cmd=$5
-
-VNDADM=/usr/sbin/vndadm
-SNAPSHOT_DIR=root/checkpoints
-OVERLAY_RULES=/var/run/smartdc/networking/overlay_rules.json
-DEFAULT_MTU=1500
-
-#
-# The following are the list of features that a corresponding brand may
-# enable. If they wish to do so, then they must set the following flags
-# to values such that [[ -z $flag ]] is true. The following are the
-# currently supported flags:
-#
-# o jst_vrrp - Enables vrrp
-# o jst_ufpromisc - Supports unfiltered promiscuous mode
-# o jst_createvnd - Create vnd devices
-# o jst_simplefs - Only setup lastbooted in the FS
-# o jst_showsnap - Show snapshots in the FS
-#
-# In addition, the brand must also specify the following parameters:
-#
-# o jst_mdatapath - The path the metadata socket is expected in the zone
-#
-
-get_boolean_nic_property()
-{
-	bool_val=$(eval echo \$_ZONECFG_net_${1}_${2})
-	if [[ "${bool_val}" == "1" ]] || [[ "${bool_val}" == "true" ]]; then
-		echo "true"
-	else
-		echo "false"
-	fi
-}
-
-nm2prefix()
-{
-	prefix=0
-	numparts=0
-	OLDIFS=$IFS
-	IFS=.
-	for digit in $1 ; do
-		(( numparts+=1 ))
-		case $digit in
-		255)
-			(( prefix+=8 ))
-			;;
-		254)
-			(( prefix+=7 ))
-			;;
-		252)
-			(( prefix+=6 ))
-			;;
-		248)
-			(( prefix+=5 ))
-			;;
-		240)
-			(( prefix+=4 ))
-			;;
-		224)
-			(( prefix+=3 ))
-			;;
-		192)
-			(( prefix+=2 ))
-			;;
-		128)
-			(( prefix+=1 ))
-			;;
-		0);;
-		*)
-			echo "Invalid digit in netmask: $digit" 1>&2;
-			IFS=$OLDIFS
-			return 1;;
-		esac
-	done
-	if [[ $numparts -ne 4 ]]; then
-		echo "Too many parts in the IP address" 1>&2;
-		IFS=$OLDIFS
-		return 1
-	fi
-	IFS=$OLDIFS
-	echo "$prefix"
-}
-
-#
-# Set up the vnic(s) for the zone.
-#
-setup_net()
-{
-	typeset tmp overlay tag id rule
-	for nic in $_ZONECFG_net_resources
-	do
-		# Get simplified versions of the network config. variables.
-		address=$(eval echo \$_ZONECFG_net_${nic}_address)
-		# If address set, must be a shared stack zone
-		[[ -n $address ]] && exit 0
-
-		global_nic=$(eval echo \$_ZONECFG_net_${nic}_global_nic)
-		# If no global-nic, must be a dedicated physical NIC instead
-		# of a vnic
-		[[ -z $global_nic ]] && continue
-
-		dhcp_server=$(get_boolean_nic_property ${nic} dhcp_server)
-		mac_addr=$(eval echo \$_ZONECFG_net_${nic}_mac_addr)
-		vlan_id=$(eval echo \$_ZONECFG_net_${nic}_vlan_id)
-		blocked_outgoing_ports=$(eval \
-		    echo \$_ZONECFG_net_${nic}_blocked_outgoing_ports)
-		zone_ips=$(eval echo \$_ZONECFG_net_${nic}_ips)
-		zone_ip=$(eval echo \$_ZONECFG_net_${nic}_ip)
-		zone_netmask=$(eval echo \$_ZONECFG_net_${nic}_netmask)
-		allow_dhcp_spoof=$(get_boolean_nic_property ${nic} allow_dhcp_spoofing)
-		allow_ip_spoof=$(get_boolean_nic_property ${nic} allow_ip_spoofing)
-		allow_mac_spoof=$(get_boolean_nic_property ${nic} allow_mac_spoofing)
-		allow_restricted_traffic=$(get_boolean_nic_property ${nic} \
-		    allow_restricted_traffic)
-		allow_unfiltered_promisc=$(get_boolean_nic_property ${nic} \
-		    allow_unfiltered_promisc)
-		allowed_ips=$(eval echo \$_ZONECFG_net_${nic}_allowed_ips)
-		allowed_dhcp_cids=$(eval echo \$_ZONECFG_net_${nic}_allowed_dhcp_cids)
-		vrid=$(eval echo \$_ZONECFG_net_${nic}_vrrp_vrid)
-		vrrp_primary_ip=$(eval \
-		    echo \$_ZONECFG_net_${nic}_vrrp_primary_ip)
-		mtu=$(eval echo \$_ZONECFG_net_${nic}_mtu)
-		isoverlay=
-
-		# If we don't have our zone_ips, it may be because the configuration
-		# was made on an older platform. In that case, use the "ip" and
-		# "netmask" properties for this NIC, and save it as "ips".
-		if [[ -z $zone_ips && -n $zone_ip ]]; then
-			[[ -n $zone_netmask ]] &&
-			    zone_ip=$zone_ip/`nm2prefix $zone_netmask`
-
-			zone_ips=$zone_ip
-		fi
-
-
-
-		orig_global=$global_nic
-
-		#
-		# The nic tag for a device (the zonecfg global_nic) can come in
-		# one of a few forms. It may:
-		#
-		# 1) Be a traditional tag which refers to a physical device or
-		#    aggregation to create a VNIC over. The source of this
-		#    mapping is sysinfo.
-		#
-		# 2) It can be the name of an etherstub. The source of these is
-		#    from dladm show-etherstub
-		#
-		# 3) It can take the form of an overlay device rule. An overlay
-		#    device rule is an invalid DLPI device and invalid nic tag.
-		#    It has the form of <name>/<number>. For example,
-		#    sdc_sdn/23. That refers to the overlay rule sdc_sdn. If we
-		#    have an overlay rule, we may need to dynamically create the
-		#    overlay device if it doesn't exist.
-		#
-		# To handle these cases, we first check if it's an overlay
-		# device, and then if not, check the other cases.
-		#
-
-		tmp=$(echo $orig_global | sed -E 's_[a-zA-Z_0-9]+/[0-9]+__')
-		if [[ -n "$tmp" ]]; then
-
-			#
-			# We only need sysinfo if we get here, and we only need to load it
-			# once.  Loading is about the same cost as looking up a single
-			# value.
-			#
-			if [[ -z $SYSINFO_LOADED ]]; then
-				load_sdc_sysinfo
-				SYSINFO_LOADED="LOADED"
-			fi
-			global_nic=$(eval echo \$SYSINFO_NIC_${orig_global})
-
-			# If the global nic is specified as a device or etherstub name
-			# rather than a tag.
-			if [[ -z $global_nic ]]; then
-				echo "$(dladm show-phys -p -o LINK) $(dladm show-etherstub -p -o LINK)" \
-				| egrep "(^| )${orig_global}( |$)" > /dev/null
-				(( $? == 0 )) && global_nic=${orig_global}
-			fi
-		else
-			isoverlay="true"
-			tag=${orig_global%/*}
-			num=${orig_global#*/}
-			global_nic="$tag$num"
-			rule=$(json -f $OVERLAY_RULES $tag)
-			if [[ $? -ne 0 || -z "$rule" ]]; then
-				logger -p daemon.err "zone $ZONENAME had tag " \
-				    "$tag which indicates an overlay rule, " \
-				    "no corresponding overlay rule found."
-				exit 1
-			fi
-		fi
-
-		# For backwards compatibility with the other parts of the
-		# system, check if this zone already has this vnic setup.
-		# If so, move on to the next vnic.
-		dladm show-vnic -p -o LINK -z $ZONENAME $nic >/dev/null 2>&1
-		(( $? == 0 )) && continue
-
-		if [[ -z $global_nic ]]; then
-			echo "undefined VNIC $nic " \
-			    "(global NIC $orig_global)"
-			logger -p daemon.err "zone $ZONENAME " \
-			    "undefined VNIC $nic (global NIC $orig_global)"
-			exit 1
-		fi
-
-		#
-		# If we have an overlay device, do we need to create it, or does
-		# it already exist?
-		#
-		if [[ -n "$isoverlay" ]]; then
-			if ! dladm show-overlay $global_nic 2>/dev/null; then
-				dladm create-overlay $rule -v $num $global_nic
-				if [[ $? -ne 0 ]]; then
-				    # If creation fails, ALSO check
-				    # for existence again, in case
-				    # someone beat us to it.
-				    if ! dladm show-overlay $global_nic \
-					 2> /dev/null; then
-					logger -p daemon.err "zone $ZONENAME " \
-					    "failed to create overlay device " \
-					     "$global_nic with command " \
-					     "'dladm create-overlay $rule -v " \
-					     "$num $global_nic"
-					exit 1
-				    fi
-				fi
-			fi
-		fi
-
-
-		#
-		# Create the vnic.
-		#
-
-		opt_str="-p "
-
-		#
-		# Traditionally we created VNICs without ever specifying
-		# the MTU. In the world before we supported any kind of
-		# jumbo frames, this is fine, because it would always
-		# match the physical which was 1500 by default for
-		# almost all of our devices. However, when we added
-		# support for mtu in nictagadm and changing it in boot
-		# up, we didn't properly assert the default MTU. This
-		# has led to VMs potentially getting the wrong MTU and
-		# ending up using jumbo frames when the network is
-		# expecting 1500 byte frames. Marx Brothers-esque comedy
-		# and despair ensues.
-		#
-		# Thus we always assert that if no MTU is specified by
-		# the VM, then we go back to the traditional 'default'
-		# value which is 1500.
-		#
-		if [[ -z "$mtu" ]]; then
-			mtu=$DEFAULT_MTU
-		fi
-
-		opt_str="$opt_str mtu=$mtu,"
-
-		#
-		# Always append the zone as the last property. This is
-		# to work around the fact that once we associate it with
-		# a zone, the zone will have a hold on the device and
-		# we'll not be able to delete it if a create fails due
-		# to a bad property (say an invalid MTU). Note if we
-		# have other properties, it is their responsibility to
-		# put a trailing comma on it.
-		#
-		opt_str="${opt_str}zone=$ZONENAME"
-
-		if [[ -n "$jst_vrrp" && -n $vrid ]]; then
-			# MAC addresses for VRRP vnics are determined by the VRID
-			mac_addr="vrrp"
-			opt_str="$opt_str -V $vrid -A inet"
-		fi
-
-		[[ -n $mac_addr ]] && opt_str="$opt_str -m $mac_addr"
-
-		[[ -n $vlan_id && $vlan_id != 0 ]] && \
-		    opt_str="$opt_str -v $vlan_id"
-
-
-		#
-		# Creating a VNIC in a zone is a multi-step process internally.
-		# This means there is a short window where the VNIC exists in
-		# the global zone and that could lead to a race condition if
-		# two zones boot at the same time with the same VNIC name.  Use
-		# a temp. name to create the VNIC then rename it to have the
-		# correct name.
-		#
-		tname=tmp$$0
-		dout=`dladm create-vnic -t -l $global_nic $opt_str $tname 2>&1`
-		if (( $? != 0 )); then
-			printf "error creating VNIC %s (global NIC %s)\n" \
-			   "$nic" "$orig_global"
-			printf "msg: %s\n" "$dout"
-			printf "Failed cmd: dladm create-vnic %s" \
-			    "-t -l $global_nic $opt_str $tname"
-			logger -p daemon.err "zone $ZONENAME error creating " \
-			    "VNIC $nic (global NIC $orig_global $global_nic)"
-			logger -p daemon.err "msg: $dout"
-			logger -p daemon.err "Failed cmd: dladm create-vnic " \
-			    "-t -l $global_nic $opt_str $tname"
-
-			# Show more info if dup MAC addr.
-			echo $dout | egrep -s "MAC address is already in use"
-			if (( $? == 0 )); then
-				entry=`dladm show-vnic -olink,macaddress,zone \
-				    | nawk -v addr=$mac_addr '{
-					if ($2 == addr)
-						print $0
-				    }'`
-				if [[ -n $entry ]]; then
-					print -f "LINK\tMACADDRESS\tZONE\n"
-					print -f "%s\n" "$entry"
-				fi
-			fi
-			exit 1
-		fi
-		dladm rename-link -z $ZONENAME $tname $nic
-		if (( $? != 0 )); then
-			echo "error renaming VNIC $tname $nic"
-			logger -p daemon.err "zone $ZONENAME error renaming " \
-			    "VNIC $tname $nic"
-			exit 1
-		fi
-
-		if [[ -z $mac_addr ]]; then
-			# There was no assigned mac address
-
-			# Get newly assigned mac address.
-			mac_addr=$(dladm show-vnic -z $ZONENAME -p -o \
-			    MACADDRESS ${nic})
-
-			# Save newly assigned mac address
-			[[ -n $mac_addr ]] && zonecfg -z $ZONENAME \
-			    "select net physical=$nic; " \
-			    "set mac-addr=$mac_addr; end; exit"
-		fi
-
-		# Set up antispoof options
-
-		if [[ $dhcp_server == "true" ]] || [[ $allow_dhcp_spoof == "true" ]]; then
-			enable_dhcp="true"
-			# This needs to be off for dhcp server zones
-			allow_ip_spoof="true"
-		else
-			enable_dhcp="false"
-		fi
-
-		comma=""
-		spoof_opts=""
-		if [[ $allow_mac_spoof != "true" ]]; then
-			spoof_opts="${spoof_opts}${comma}mac-nospoof"
-			comma=","
-		fi
-		if [[ $allow_ip_spoof != "true" ]]; then
-			spoof_opts="${spoof_opts}${comma}ip-nospoof"
-			comma=","
-		fi
-		if [[ $allow_restricted_traffic != "true" ]]; then
-			spoof_opts="${spoof_opts}${comma}restricted"
-			comma=","
-		fi
-		if [[ ${enable_dhcp} == "false" ]]; then
-			spoof_opts="${spoof_opts}${comma}dhcp-nospoof"
-			comma=","
-		fi
-
-		if [[ -n ${spoof_opts} ]]; then
-			dladm set-linkprop -t -z $ZONENAME -p \
-			"protection=${spoof_opts}" ${nic}
-			if (( $? != 0 )); then
-				echo "error setting VNIC protection $nic $spoof_opts"
-				    logger -p daemon.err "zone $ZONENAME error setting " \
-				    "VNIC protection $nic $spoof_opts"
-			exit 1
-			fi
-		fi
-
-		# If we aren't using IP spoofing, we'll need to set the allowed-ips
-		# property on the NIC so that the zone will be able to ifconfig the
-		# proper addresses.
-		if [[ $allow_ip_spoof != "true" ]]; then
-			unset allowed_ip_map
-			typeset -A allowed_ip_map
-
-			dynamic_methods=""
-			separator=""
-			OLDIFS=$IFS
-			IFS=,
-
-			for zone_ip in $zone_ips; do
-				# For each static IP available, add it to the list.
-				if [[ $zone_ip == "dhcp" ]]; then
-					dynamic_methods+="${separator}dhcpv4"
-					separator=","
-				elif [[ $zone_ip == "addrconf" ]]; then
-					dynamic_methods+="${separator}addrconf"
-					separator=","
-				else
-					clean_ip=`printf "%s" "${zone_ip}" | sed 's|^\([^/]*\)/.*|\1|'`
-					allowed_ip_map[${clean_ip}]=true
-				fi
-			done
-
-			# If any additional IPs have been specified (for example, older
-			# VMs set up for IPv6 before vmadm gained support), add them to
-			# the list.
-			for allowed_ip in $allowed_ips; do
-				allowed_ip_map[${allowed_ip}]=true
-			done
-			IFS=$OLDIFS
-
-			# If we're using VRRP and have the IP, add it to the list.
-			if [[ -n "$jst_vrrp" && -n $vrrp_primary_ip ]]; then
-				allowed_ip_map[${vrrp_primary_ip}]=true
-			fi
-
-			allowed_ip_list=""
-
-			separator=""
-			for allowed_ip in ${!allowed_ip_map[@]}; do
-				allowed_ip_list+="${separator}${allowed_ip}"
-				separator=","
-			done
-
-			# Set the allowed-ips property on the NIC
-			if [[ -n ${allowed_ip_list} ]] &&
-			    ! dladm set-linkprop -t -z $ZONENAME \
-			    -p "allowed-ips=${allowed_ip_list}" ${nic}; then
-				log_and_exit \
-				    "error setting VNIC allowed-ips $nic $allowed_ip_list"
-			fi
-
-			# Set the dynamic-methods property on the NIC
-			if [[ -n ${dynamic_methods} ]] &&
-			    ! dladm set-linkprop -t -z $ZONENAME \
-			    -p "dynamic-methods=${dynamic_methods}" ${nic}; then
-				log_and_exit \
-				    "error setting VNIC dynamic-methods $nic $dynamic_methods"
-			fi
-		fi
-
-		if [[ "$enable_dhcp" != "true" ]] && [[ -n "$allowed_dhcp_cids" ]] &&
-		    ! dladm set-linkprop -p "allowed-dhcp-cids=${allowed_dhcp_cids}" \
-		    -t -z $ZONENAME $nic; then
-			log_and_exit \
-			    "error setting VNIC allowed-dhcp-cids $nic $allowed_dhcp_cids"
-		fi
-
-		if [[ "$enable_dhcp" != "true" ]] && [[ -z "$allowed_dhcp_cids" ]] &&
-		    [[ "$zone_ips" == *dhcp* || "$zone_ips" == *addrconf* ]] &&
-		    ! dladm set-linkprop -p "allow-all-dhcp-cids=true" \
-		    -t -z $ZONENAME $nic; then
-			log_and_exit "error setting VNIC allow-all-dhcp-cids $nic"
-		fi
-
-		if [[ -n "$jst_ufpromisc" && ${allow_unfiltered_promisc} == "true" ]]; then
-			dladm set-linkprop -t -z $ZONENAME -p "promisc-filtered=off" ${nic}
-		fi
-
-		if [[ -n $blocked_outgoing_ports ]]; then
-			OLDIFS=$IFS
-			IFS=,
-			for port in $blocked_outgoing_ports; do
-				# br='block remote'.  Flow names should be < 31
-				# chars in length so that they get unique
-				# kstats.
-				# Use the VNIC mac addr. to generate a unique
-				# name.
-				mac_addr=`dladm show-vnic -z $ZONENAME -p \
-				    -o MACADDRESS $nic | tr ':' '_'`
-				flowadm add-flow -t -l $nic -z $ZONENAME \
-				    -a transport=tcp,remote_port=$port \
-				    -p maxbw=0 f${mac_addr}_br_${port}
-				if (( $? != 0 )); then
-					echo "error adding flow " \
-					    "$nic f${mac_addr}_br_${port}"
-					logger -p daemon.err "zone $ZONENAME " \
-					    "error adding flow " \
-					    "$nic f${mac_addr}_br_${port}"
-					exit 1
-				fi
-			done
-			IFS=$OLDIFS
-		fi
-
-		if [[ -n "$jst_createvnd" ]]; then
-			#
-			# At this point we should go ahead and set up
-			# the vnd interface for this datalink.
-			#
-			$VNDADM create -z $ZONENAME $nic
-			if [[ $? -ne 0 ]]; then
-				echo "failed to create vnd device"
-				exit 1
-			fi
-		fi
-	done
-}
-
-#
-# Log a message, then exit
-#
-log_and_exit()
-{
-	echo "$1"
-	logger -p daemon.err "zone $ZONENAME $1"
-	exit 1
-}
-
-#
-# Set up the firewall for the zone.
-#
-setup_fw()
-{
-	ipf_conf=$ZONEPATH/config/ipf.conf
-	ipf6_conf=$ZONEPATH/config/ipf6.conf
-	if [ -e $ipf_conf ]; then
-		echo "starting firewall ($ipf_conf)"
-		/usr/sbin/ipf -GE $ZONENAME
-		if (( $? != 0 )); then
-			log_and_exit "error enabling ipfilter"
-		fi
-
-		/usr/sbin/ipf -GFa $ZONENAME
-		if (( $? != 0 )); then
-			log_and_exit "error flushing ipfilter (IPv4)"
-		fi
-
-		/usr/sbin/ipf -6GFa $ZONENAME
-		if (( $? != 0 )); then
-			log_and_exit "error flushing ipfilter (IPv6)"
-		fi
-
-		/usr/sbin/ipf -Gf $ipf_conf $ZONENAME
-		if (( $? != 0 )); then
-			log_and_exit "error loading ipfilter config for IPv4"
-		fi
-
-		if [[ -e $ipf6_conf ]] &&
-		    ! /usr/sbin/ipf -6Gf $ipf6_conf $ZONENAME; then
-			log_and_exit "error loading ipfilter config for IPv6"
-		fi
-
-		/usr/sbin/ipf -Gy $ZONENAME
-		if (( $? != 0 )); then
-			log_and_exit "error syncing ipfilter interfaces"
-		fi
-	fi
-}
-
-#
-# We're readying the zone.  Make sure the per-zone writable
-# directories exist so that we can lofs mount them.  We do this here,
-# instead of in the install script, since this list has evolved and
-# there are already zones out there in the installed state.
-#
-setup_fs()
-{
-	# create directory for metadata socket
-	mkdir -m755 -p /var/zonecontrol/${ZONENAME}
-
-	uname -v > $ZONEPATH/lastbooted
-	[[ -n "$jst_simplefs" ]] && return
-
-	[ ! -d $ZONEPATH/site ] && mkdir -m755 $ZONEPATH/site
-	[ ! -d $ZONEPATH/local ] && mkdir -m755 $ZONEPATH/local
-	[ ! -d $ZONEPATH/$SNAPSHOT_DIR ] && mkdir -m755 $ZONEPATH/$SNAPSHOT_DIR
-	if [ ! -d $ZONEPATH/ccs ]; then
-		mkdir -m755 $ZONEPATH/ccs
-		(cd /usr/ccs; tar cbf 512 - *) | \
-		    (cd $ZONEPATH/ccs; tar xbf 512 -)
-	fi
-
-}
-
-setup_snapshots()
-{
-	#
-	# Because the top-level directory of each ZFS snapshot contains some
-	# internal information, mount the /root directory of each snapshot
-	# separately.
-	#
-	for snap in $(ls -1 $ZONEPATH/.zfs/snapshot); do
-		snapdir=$ZONEPATH/$SNAPSHOT_DIR/$(echo ${snap} | sed -e "s/^vmsnap-//")
-		mkdir -p ${snapdir}
-		mount -F lofs -o ro,setuid,nodevices \
-		    $ZONEPATH/.zfs/snapshot/${snap}/root ${snapdir}
-	done
-}
-
-#
-# If the zone has a CPU cap, calculate the CPU baseline and set it so we can
-# track when we're bursting.  There are many ways that the baseline can be
-# calculated based on the other settings in the zones (e.g. a simple way would
-# be as a precentage of the cap).
-#
-# For SmartMachines, our CPU baseline is calculated off of the system's
-# provisionable memory and the memory cap of the zone. We assume that 83% of
-# the system's memory is usable by zones (the rest is for the OS) and we assume
-# that the zone memory cap is set so that we're proportional to how many zones
-# we can provision on the system (i.e. we don't overprovision memory).  Using
-# these assumptions, we calculate the proportion of CPU for the zone based on
-# its proportion of memory. Thus, the zone's CPU baseline is calculated using:
-#     ((zone capped memsize in MB) * 100) / (MB/core).
-# Uncapped zones have no baseline (i.e. infrastructure zones).
-#
-# Remember that the cpu-cap rctl and the baseline are expressed in units of
-# a percent of a CPU, so 100 is 1 full CPU.
-#
-setup_cpu_baseline()
-{
-	# A brand can override the setup of bursting.
-	[ -n "$NO_BURSTING" ] && return
-
-	# If there is already a baseline, don't set one heuristically
-	curr_base=`prctl -P -n zone.cpu-baseline -i zone $ZONENAME | nawk '{
-		if ($2 == "privileged") print $3
-	    }'`
-	[ -n "$curr_base" ] && return
-
-	# Get current cap and convert from zonecfg format into rctl format
-	cap=`zonecfg -z $ZONENAME info capped-cpu | nawk '{
-	    if ($1 == "[ncpus:") print (substr($2, 1, length($2) - 1) * 100)
-	}'`
-	[ -z "$cap" ] && return
-
-	# Get zone's memory cap in MB times 100
-	zmem=`zonecfg -z $ZONENAME info capped-memory | nawk '{
-	    if ($1 == "[physical:") {
-	        val = substr($2, 1, length($2) - 2)
-	        units = substr($2, length($2) - 1, 1)
-
-	        # convert GB to MB
-	        if (units == "G")
-	            val *= 1024
-	        print (val * 100)
-	    }
-	}'`
-	[ -z "$zmem" ] && return
-
-	# Get system's total memory in MB
-	smem=`prtconf -m`
-	# provisionable memory is 83% of total memory (bash can't do floats)
-	prov_mem=$((($smem * 83) / 100))
-	nprocs=`psrinfo -v | \
-	    nawk '/virtual processor/ {cnt++} END {print cnt}'`
-
-	mb_per_core=$(($prov_mem / $nprocs))
-
-	baseline=$(($zmem / $mb_per_core))
-	[[ $baseline == 0 ]] && baseline=1
-	[[ $baseline -gt $cap ]] && baseline=$cap
-
-	prctl -n zone.cpu-baseline -v $baseline -t priv -i zone $ZONENAME
-}
-
-cleanup_snapshots()
-{
-	#
-	# Each ZFS snapshot is mounted separately, so find all mounted
-	# snapshots for this zone, and unmount them.
-	#
-	snaps=$(ls -1 $ZONEPATH/$SNAPSHOT_DIR)
-
-	for snap in ${snaps}; do
-		snapdir=$ZONEPATH/$SNAPSHOT_DIR/$(echo ${snap} | sed -e "s/^vmsnap-//")
-		umount ${snapdir}
-		rmdir ${snapdir}
-	done
-}
-
-#
-# We're halting the zone, perform network cleanup.
-#
-cleanup_net()
-{
-	# Cleanup any flows that were setup.
-	for nic in $_ZONECFG_net_resources
-	do
-		flowadm remove-flow -t -z $ZONENAME -l $nic
-		if (( $? != 0 )); then
-			echo "error removing flows for $nic"
-			logger -p daemon.err "zone $ZONENAME " \
-			    "error removing flows for $nic"
-		fi
-	done
-}
-
-id_gz_sockholder()
-{
-	echo "searching for GZ process holding socket $1"
-	logger -p daemon.err "zone $ZONENAME " \
-	    "searching for GZ process holding socket $1"
-
-	pid=`(cd /proc;
-	for i in *;
-	do
-		pfiles $i 2>/dev/null | egrep -s "AF_UNIX $1";
-		[ $? == 0 ] && echo "$i";
-	done)`
-
-	[ -z "$pid" ] && return
-
-	echo "Error: GZ process $pid holding socket $1 blocking shutdown"
-	logger -p daemon.err "Error: zone $ZONENAME:" \
-	    "GZ process $pid holding socket $1 blocking shutdown"
-}
-
-# zonadmd unable to unmount the given path, try to cleanup so unmount can
-# succeed.
-cleanup_mount()
-{
-	echo "attempting to cleanup mount $1"
-	logger -p daemon.err "zone $ZONENAME attempting to cleanup mount $1"
-
-	fnd_procs=0
-	for i in `fuser -c $1 2>/dev/null`
-	do
-		fnd_procs=1
-
-		pty=`ps -otty -p $i | \
-		    nawk '{if ($1 != "TT" && $1 != "?") print $0}'`
-
-		if [ -n "$pty" ]; then
-			echo "shell process $i blocking zone" \
-			    "$ZONENAME shutdown, killing the process" | wall
-			echo "killing GZ user shell $i under $1"
-			logger -p daemon.err "zone $ZONENAME:" \
-			    "killing GZ user shell $i under $1"
-			kill -9 $i
-		else
-			echo "Error: GZ process $i under $1 blocking shutdown"
-			logger -p daemon.err "Error: zone $ZONENAME:" \
-			    "GZ process $i under $1 blocking shutdown"
-
-			local args="pargs: `pargs $i`"
-			echo "$args"
-			logger -p daemon.err "$args"
-
-			local tree="ptree: `ptree $i`"
-			echo "$tree"
-			logger -p daemon.err "$tree"
-		fi
-	done
-
-	if [ $fnd_procs -eq 1 ]; then
-		# Exit out to give the zoneadmd umount a chance to suceed now.
-		# Zoneadmd will give us another shot if it still can't umount.
-		sleep 1
-		exit 0
-	fi
-
-	# Processes which are injected into a zone and then open a file as a
-	# socket end-point will show in pfiles with the path relative to the
-	# zone's root. For example, a zone with its root at /zones/foo/root and
-	# an open socket as /zones/foo/root/var/run/x will show up in a pfiles
-	# search as /var/run/x. This is a problem since we have no way to
-	# narrow down which process is the culprit.
-	#
-	# Because the socket doesn't have enough information for us to tie to
-	# the specific GZ process, we hardcode to id things we know will open
-	# sockets into the zone:
-	#    $jst_mdatapath/metadata.sock
-	#    /var/run/.smartdc-amon.sock
-
-	ZVR=$ZONEPATH/root/var/run
-	[ -S $ZVR/smartdc/metadata.sock ] &&
-	    id_gz_sockholder $jst_mdatapath/metadata.sock
-
-	[ -S $ZVR/.smartdc-amon.sock ] &&
-	    id_gz_sockholder /var/run/.smartdc-amon.sock
-}
-
-function fix_forced_attrs {
-	typeset attr
-
-	for attr in ${!FORCED_ATTRS[@]}; do
-		typeset nval=${FORCED_ATTRS["$attr"]}
-		typeset -n envvar=_ZONECFG_attr_${attr//-/_}
-		typeset cval=$envvar
-
-		if [[ $cval == $nval ]]; then
-			# In most cases, $nval and $cval will be the same and
-			# nothing needs to be done. This includes the case where
-			# $nval and $cval are "".
-			continue
-		elif [[ -z $nval ]]; then
-			logger -p daemon.error "[zone $ZONENAME]" \
-			    "Illegal value for attr '$attr': '$cval'." \
-			    "Removing attr '$attr'"
-			zonecfg -z "$ZONENAME" "remove -F attr name=$attr"
-
-			unset ${!envvar}
-		else
-			logger -p daemon.error "[zone $ZONENAME]" \
-			    "Illegal value for attr '$attr': '$cval'." \
-			    "Setting to '$nval'"
-			zonecfg -z "$ZONENAME" "remove -F attr name=$attr;" \
-			    "add attr; set type=string;" \
-			    "set name=$attr; set value=\"$nval\"; end;"
-
-			export ${!envvar}="$nval"
-		fi
-	done
-}
-
-#
-# Main
-#
-
-case $subcommand in
-pre)
-	case $cmd in
-	0)	# pre-ready
-		fix_forced_attrs
-		setup_fs
-		;;
-	4)	# pre-halt
-		[[ -n "$jst_showsnap" ]] && cleanup_snapshots
-		cleanup_net
-		;;
-	esac
-	;;
-post)
-	case $cmd in
-	0)	# post-ready
-		[[ -n "$jst_showsnap" ]] && setup_snapshots
-		setup_net
-		setup_fw
-		;;
-	1)	# post-boot
-		# We can't set a rctl until we have a process in the zone to
-		# grab
-		setup_cpu_baseline
-		;;
-	8)	# post-unmount
-		# Zone halt is hung unmounting, try to recover
-		if [[ $state == 6 ]]; then
-			cleanup_mount "$6"
-		fi
-		;;
-	esac
-	;;
-esac
-
-exit 0
diff --git a/overlay/generic/usr/lib/brand/joyent-minimal/config.xml b/overlay/generic/usr/lib/brand/joyent-minimal/config.xml
deleted file mode 100644
index 64e92464..00000000
--- a/overlay/generic/usr/lib/brand/joyent-minimal/config.xml
+++ /dev/null
@@ -1,115 +0,0 @@
-<?xml version="1.0"?>
-
-<!--
- CDDL HEADER START
-
- The contents of this file are subject to the terms of the
- Common Development and Distribution License (the "License").
- You may not use this file except in compliance with the License.
-
- You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
- or http://www.opensolaris.org/os/licensing.
- See the License for the specific language governing permissions
- and limitations under the License.
-
- When distributing Covered Code, include this CDDL HEADER in each
- file and include the License file at usr/src/OPENSOLARIS.LICENSE.
- If applicable, add the following below this CDDL HEADER, with the
- fields enclosed by brackets "[]" replaced with your own identifying
- information: Portions Copyright [yyyy] [name of copyright owner]
-
- CDDL HEADER END
-
- Copyright 2015 Joyent, Inc.  All rights reserved.
- Use is subject to license terms.
-
- DO NOT EDIT THIS FILE.
--->
-
-<!DOCTYPE brand PUBLIC "-//Joyent Inc//DTD Brands//EN"
-    "file:///usr/share/lib/xml/dtd/brand.dtd.1">
-
-<brand name="joyent-minimal">
-	<modname></modname>
-
-	<initname>/sbin/init</initname>
-	<login_cmd>/usr/bin/login -z %Z %u</login_cmd>
-	<forcedlogin_cmd>/usr/bin/login -z %Z -f %u</forcedlogin_cmd>
-	<user_cmd>/usr/bin/getent passwd %u</user_cmd>
-
-	<install>/usr/lib/brand/joyent-minimal/jinstall -z %z -R %R</install>
-	<installopts>R:t:U:q:z:</installopts>
-	<boot></boot>
-	<halt></halt>
-	<verify_cfg></verify_cfg>
-	<verify_adm></verify_adm>
-	<postclone></postclone>
-	<postinstall></postinstall>
-	<attach>/usr/lib/brand/joyent-minimal/jattach -z %z -R %R</attach>
-	<detach>/usr/lib/brand/joyent-minimal/jdetach -z %z -R %R</detach>
-	<clone></clone>
-	<uninstall>/usr/lib/brand/joyent-minimal/juninstall -z %z -R %R</uninstall>
-	<prestatechange>/usr/lib/brand/joyent-minimal/prestate %z %R</prestatechange>
-	<poststatechange>/usr/lib/brand/joyent-minimal/poststate %z %R</poststatechange>
-	<query>/usr/lib/brand/joyent-minimal/query %z %R</query>
-
-	<privilege set="default" name="contract_event" />
-	<privilege set="default" name="contract_identity" />
-	<privilege set="default" name="contract_observer" />
-	<privilege set="default" name="dtrace_proc" />
-	<privilege set="default" name="dtrace_user" />
-	<privilege set="default" name="file_chown" />
-	<privilege set="default" name="file_chown_self" />
-	<privilege set="default" name="file_dac_execute" />
-	<privilege set="default" name="file_dac_read" />
-	<privilege set="default" name="file_dac_search" />
-	<privilege set="default" name="file_dac_write" />
-	<privilege set="default" name="file_owner" />
-	<privilege set="default" name="file_setid" />
-	<privilege set="default" name="ipc_dac_read" />
-	<privilege set="default" name="ipc_dac_write" />
-	<privilege set="default" name="ipc_owner" />
-	<privilege set="default" name="net_bindmlp" />
-	<privilege set="default" name="net_icmpaccess" />
-	<privilege set="default" name="net_mac_aware" />
-	<privilege set="default" name="net_observability" />
-	<privilege set="default" name="net_privaddr" />
-	<privilege set="default" name="net_rawaccess" ip-type="exclusive" />
-	<privilege set="default" name="proc_chroot" />
-	<privilege set="default" name="sys_audit" />
-	<privilege set="default" name="proc_audit" />
-	<privilege set="default" name="proc_lock_memory" />
-	<privilege set="default" name="proc_owner" />
-	<privilege set="default" name="proc_prioup" />
-	<privilege set="default" name="proc_secflags" />
-	<privilege set="default" name="proc_setid" />
-	<privilege set="default" name="proc_taskid" />
-	<privilege set="default" name="sys_acct" />
-	<privilege set="default" name="sys_admin" />
-	<privilege set="default" name="sys_fs_import" />
-	<privilege set="default" name="sys_ip_config" ip-type="exclusive" />
-	<privilege set="default" name="sys_iptun_config" ip-type="exclusive" />
-	<privilege set="default" name="sys_mount" />
-	<privilege set="default" name="sys_nfs" />
-	<privilege set="default" name="sys_smb" />
-	<privilege set="default" name="sys_resource" />
-	<privilege set="default" name="sys_ppp_config" ip-type="exclusive" />
-
-	<privilege set="prohibited" name="dtrace_kernel" />
-	<privilege set="prohibited" name="proc_zone" />
-	<privilege set="prohibited" name="sys_config" />
-	<privilege set="prohibited" name="sys_devices" />
-	<privilege set="prohibited" name="sys_ip_config" ip-type="shared" />
-	<privilege set="prohibited" name="sys_linkdir" />
-	<privilege set="prohibited" name="sys_net_config" />
-	<privilege set="prohibited" name="sys_res_config" />
-	<privilege set="prohibited" name="sys_suser_compat" />
-	<privilege set="prohibited" name="xvm_control" />
-	<privilege set="prohibited" name="virt_manage" />
-	<privilege set="prohibited" name="sys_ppp_config" ip-type="shared" />
-
-	<privilege set="required" name="proc_exec" />
-	<privilege set="required" name="proc_fork" />
-	<privilege set="required" name="sys_ip_config" ip-type="exclusive" />
-	<privilege set="required" name="sys_mount" />
-</brand>
diff --git a/overlay/generic/usr/lib/brand/joyent-minimal/jattach b/overlay/generic/usr/lib/brand/joyent-minimal/jattach
deleted file mode 100755
index b99c0211..00000000
--- a/overlay/generic/usr/lib/brand/joyent-minimal/jattach
+++ /dev/null
@@ -1,26 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-. /usr/lib/brand/jcommon/libhooks.ksh
-
-function jcommon_attach_hook
-{
-	jattach_zone_final_setup
-}
-
-ps_brand="joyent-minimal"
-. /usr/lib/brand/jcommon/cattach
diff --git a/overlay/generic/usr/lib/brand/joyent-minimal/jdetach b/overlay/generic/usr/lib/brand/joyent-minimal/jdetach
deleted file mode 100755
index 5671f06b..00000000
--- a/overlay/generic/usr/lib/brand/joyent-minimal/jdetach
+++ /dev/null
@@ -1,19 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-ps_brand="joyent-minimal"
-. /usr/lib/brand/jcommon/cdetach
diff --git a/overlay/generic/usr/lib/brand/joyent-minimal/jinstall b/overlay/generic/usr/lib/brand/joyent-minimal/jinstall
deleted file mode 100755
index 167566bd..00000000
--- a/overlay/generic/usr/lib/brand/joyent-minimal/jinstall
+++ /dev/null
@@ -1,32 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-# Does this brand support reprovisioning?
-jst_reprovision="yes"
-
-# Is a template image optional?
-# jst_tmplopt="yes"
-
-. /usr/lib/brand/jcommon/libhooks.ksh
-
-function jcommon_attach_hook
-{
-	jattach_zone_final_setup
-	cp /usr/lib/brand/joyent-minimal/repository.db ${ZROOT}/etc/svc
-}
-
-. /usr/lib/brand/jcommon/cinstall
diff --git a/overlay/generic/usr/lib/brand/joyent-minimal/juninstall b/overlay/generic/usr/lib/brand/joyent-minimal/juninstall
deleted file mode 100755
index 09051a17..00000000
--- a/overlay/generic/usr/lib/brand/joyent-minimal/juninstall
+++ /dev/null
@@ -1,25 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-. /usr/lib/brand/jcommon/libhooks.ksh
-
-function jcommon_uninstall_hook
-{
-	juninstall_delegated_dataset
-}
-
-. /usr/lib/brand/jcommon/cuninstall
diff --git a/overlay/generic/usr/lib/brand/joyent-minimal/manifests b/overlay/generic/usr/lib/brand/joyent-minimal/manifests
deleted file mode 100644
index 955d4670..00000000
--- a/overlay/generic/usr/lib/brand/joyent-minimal/manifests
+++ /dev/null
@@ -1,127 +0,0 @@
-#
-# This file lists the SMF manifests which are available in the global
-# zone and which should be setup for use in non-global zones.  Not
-# all SMF services are usable within a zone, so only those that are usable
-# should be listed here.
-#
-# The format of the file is:
-#	manifest_name enable/disable
-# The manifest_name is found relative to /lib/svc/manifest on the system.
-# The second field is used to indicate if the svc should be enabled or
-# disabled by default within zones, independently of its current status in
-# the global zone.
-#
-# The following is a list of SMF svcs which could be run in a zone, but
-# which we're not currently installing on our live image.  If we add any
-# of these to the image and we want it to also be available in zones,
-# then we need to move the entry to the end and uncomment it out.
-#
-# application/cups.xml
-# application/font/fc-cache.xml
-# application/graphical-login/gdm.xml
-# application/management/net-snmp.xml
-# application/management/seaport.xml
-# application/management/snmpdx.xml
-# application/opengl/ogl-select.xml
-# application/print/service-selector.xml
-# application/security/tcsd.xml
-# application/x11/x11-server.xml
-# application/x11/xfs.xml
-# application/x11/xvnc-inetd.xml
-# network/ldap/client.xml
-# network/rpc/keyserv.xml
-# network/socket-filter-kssl.xml
-# network/ssl/kssl-proxy.xml
-# network/nfs/rquota.xml
-# network/smb/server.xml
-# network/dns/server.xml
-# network/ftp.xml
-# network/finger.xml
-# network/comsat.xml
-# network/rpc/rstat.xml
-# network/rpc/rusers.xml
-# network/rpc/spray.xml
-# network/rpc/wall.xml
-# network/talk.xml
-# network/ntp.xml
-# network/sendmail-client.xml
-# network/smtp-sendmail.xml
-# network/telnet.xml
-# network/wpa.xml
-# network/rpc/gss.xml
-# network/security/kadmin.xml
-# network/security/krb5kdc.xml
-# network/security/ktkt_warn.xml
-# network/rpc/smserver.xml
-# network/nfs/cbd.xml
-# network/nfs/mapid.xml
-# network/nfs/status.xml
-# network/ipmievd.xml
-# network/nis/client.xml
-# network/http-apache22.xml
-# system/consolekit.xml
-# system/device/devices-audio.xml
-# system/fm/notify-params.xml
-# system/install/system-config.xml
-# system/pkgserv.xml
-#
-
-#
-# The following is a list of SMF svcs which are installed on our live image and
-# which could be run in a zone, but which we choose not to run in our zones.
-# If we ever do want to run any of these, move the entry to the end and
-# uncomment it out.
-#
-# network/nfs/client.xml
-# network/nfs/nlockmgr.xml
-# system/boot-archive-update.xml
-# system/boot-archive.xml
-# system/boot-config.xml
-# system/cron.xml
-# system/fmd.xml
-# system/sac.xml
-#
-
-#
-# The following is a list of SMF svc manifests under /lib/svc/manifest.  These
-# are available on our live image and are runnable in a zone.  Since the zones
-# are sharing the base file system with the global zone, we set up so that
-# only these svcs are configured in zones, independently of the global zone
-# /lib/svc/manifest hierarchy.
-#
-
-system/svc/restarter.xml	enabled
-network/dlmgmt.xml		enabled
-system/filesystem/root-fs.xml	enabled
-#
-# This was running, but not in our set of manifests. Maybe it came in
-# from /var.
-#
-system/boot-archive.xml		enabled 
-network/network-ipmgmt.xml	enabled
-system/filesystem/usr-fs.xml	enabled
-network/network-loopback.xml	enabled
-system/device/devices-local.xml	enabled
-milestone/single-user.xml	enabled
-network/network-physical.xml	enabled
-system/filesystem/minimal-fs.xml	enabled
-milestone/network.xml		enabled
-system/filesystem/joyent-fs.xml	enabled
-system/filesystem/local-fs.xml	enabled
-system/name-service-cache.xml	enabled
-system/process-security.xml	enabled
-milestone/name-services.xml	enabled
-system/identity.xml		enabled
-network/network-initial.xml	enabled
-network/network-service.xml	enabled
-network/dns/client.xml		enabled
-network/network-netmask.xml	enabled
-network/network-routing-setup.xml	enabled
-milestone/sysconfig.xml		enabled
-system/system-log.xml		enabled
-milestone/multi-user-server.xml	enabled
-milestone/multi-user.xml	enabled
-milestone/name-services.xml	enabled
-system/early-manifest-import.xml	disabled
-system/manifest-import.xml	disabled
-system/mdata.xml	enabled
diff --git a/overlay/generic/usr/lib/brand/joyent-minimal/platform.xml b/overlay/generic/usr/lib/brand/joyent-minimal/platform.xml
deleted file mode 100644
index 025d0e9d..00000000
--- a/overlay/generic/usr/lib/brand/joyent-minimal/platform.xml
+++ /dev/null
@@ -1,171 +0,0 @@
-<?xml version="1.0"?>
-
-<!--
- CDDL HEADER START
-
- The contents of this file are subject to the terms of the
- Common Development and Distribution License (the "License").
- You may not use this file except in compliance with the License.
-
- You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
- or http://www.opensolaris.org/os/licensing.
- See the License for the specific language governing permissions
- and limitations under the License.
-
- When distributing Covered Code, include this CDDL HEADER in each
- file and include the License file at usr/src/OPENSOLARIS.LICENSE.
- If applicable, add the following below this CDDL HEADER, with the
- fields enclosed by brackets "[]" replaced with your own identifying
- information: Portions Copyright [yyyy] [name of copyright owner]
-
- CDDL HEADER END
-
- Copyright 2017 Joyent, Inc.
-
- DO NOT EDIT THIS FILE.
--->
-
-<!DOCTYPE platform PUBLIC "-//Joyent Inc//Zones Platform//EN"
-    "file:///usr/share/lib/xml/dtd/zone_platform.dtd.1">
-
-<platform name="joyent-minimal" allow-exclusive-ip="true">
-
-	<!-- Global filesystems to mount when booting the zone -->
-	<global_mount special="/dev" directory="/dev" type="dev"
-	    opt="attrdir=%R/root/dev"/>
-
-	<global_mount special="/var/zonecontrol/%z" directory="/.zonecontrol"
-	    opt="ro,nodevices,nosetuid,noexec" type="lofs" />
-
-	<global_mount special="/lib" directory="/lib"
-	    opt="ro,nodevices" type="lofs" />
-	<global_mount special="%P/manifests/joyent" directory="/lib/svc/manifest"
-	    opt="ro,nodevices" type="lofs" />
-	<global_mount special="%R/site" directory="/lib/svc/manifest/site"
-	    opt="nodevices" type="lofs" />
-	<global_mount special="/sbin" directory="/sbin"
-	    opt="ro,nodevices" type="lofs" />
-	<global_mount special="/usr" directory="/usr"
-	    opt="ro,nodevices" type="lofs" />
-	<global_mount special="%R/local" directory="/usr/local"
-	    opt="nodevices" type="lofs" />
-	<global_mount special="%R/ccs" directory="/usr/ccs"
-	    opt="nodevices" type="lofs" />
-
-	<!-- Local filesystems to mount when booting the zone -->
-	<mount special="/proc" directory="/proc" type="proc" />
-	<mount special="ctfs" directory="/system/contract" type="ctfs" />
-	<mount special="mnttab" directory="/etc/mnttab" type="mntfs" />
-	<mount special="objfs" directory="/system/object" type="objfs" />
-	<mount special="lxproc" directory="/system/lxproc" type="lxproc" />
-	<mount special="swap" directory="/etc/svc/volatile" type="tmpfs" />
-
-	<!-- Devices to create under /dev -->
-	<device match="arp" />
-	<device match="bpf" />
-	<device match="conslog" />
-	<device match="cpu/self/cpuid" />
-	<device match="crypto" />
-	<device match="cryptoadm" />
-	<device match="dsk" />
-	<device match="dtrace/*" />
-	<device match="dtrace/provider/*" />
-	<device match="eventfd" />
-	<device match="fd" />
-	<device match="full" />
-	<device match="inotify" />
-	<device match="ipnet" />
-	<device match="kstat" />
-	<device match="lo0" />
-	<device match="lofictl" />
-	<device match="lofi" />
-	<device match="log" />
-	<device match="logindmux" />
-	<device match="nsmb" />
-	<device match="net/*" />
-	<device match="null" />
-	<device match="openprom" arch="sparc" />
-	<device match="poll" />
-	<device match="pool" />
-	<device match="ptmx" />
-	<device match="pts/*" />
-	<device match="random" />
-	<device match="rdsk" />
-	<device match="rlofi" />
-	<device match="rmt" />
-	<device match="sad/user" />
-	<device match="smbsrv" />
-	<device match="signalfd" />
-	<device match="svvslo0" />
-	<device match="svvslo1" />
-	<device match="svvslo2" />
-	<device match="svvslo3" />
-	<device match="swap" />
-	<device match="sysevent" />
-	<device match="tap" />
-	<device match="tcp" />
-	<device match="tcp6" />
-	<device match="term" />
-	<device match="ticlts" />
-	<device match="ticots" />
-	<device match="ticotsord" />
-	<device match="timerfd" />
-	<device match="tty" />
-	<device match="tun" />
-	<device match="udp" />
-	<device match="udp6" />
-	<device match="urandom" />
-	<device match="vnd/*" />
-	<device match="zero" />
-	<device match="zfd/%z/slave/0" name="zfd/0" />
-	<device match="zfd/%z/slave/1" name="zfd/1" />
-	<device match="zfd/%z/slave/2" name="zfd/2" />
-	<device match="zfs" />
-	<device match="zvol/dsk/%P/%z/*" />
-	<device match="zvol/rdsk/%P/%z/*" />
-
-	<!-- Devices to create in exclusive IP zone only -->
-	<device match="dld" ip-type="exclusive" />
-	<device match="icmp" ip-type="exclusive" />
-	<device match="icmp6" ip-type="exclusive" />
-	<device match="ip" ip-type="exclusive" />
-	<device match="ip6" ip-type="exclusive" />
-	<device match="ipauth" ip-type="exclusive" />
-	<device match="ipd" ip-type="exclusive" />
-	<device match="ipf" ip-type="exclusive" />
-	<device match="ipl" ip-type="exclusive" />
-	<device match="iplookup" ip-type="exclusive" />
-	<device match="ipmpstub" ip-type="exclusive" />
-	<device match="ipnat" ip-type="exclusive" />
-	<device match="ipscan" ip-type="exclusive" />
-	<device match="ipsecah" ip-type="exclusive" />
-	<device match="ipsecesp" ip-type="exclusive" />
-	<device match="ipstate" ip-type="exclusive" />
-	<device match="ipsync" ip-type="exclusive" />
-	<device match="keysock" ip-type="exclusive" />
-	<device match="rawip" ip-type="exclusive" />
-	<device match="rawip6" ip-type="exclusive" />
-	<device match="rts" ip-type="exclusive" />
-	<device match="sad/admin" ip-type="exclusive" />
-	<device match="sctp" ip-type="exclusive" />
-	<device match="sctp6" ip-type="exclusive" />
-	<device match="spdsock" ip-type="exclusive" />
-	<device match="sppp" ip-type="exclusive" />
-	<device match="sppptun" ip-type="exclusive" />
-	<device match="vni" ip-type="exclusive" />
-
-	<!-- Renamed devices to create under /dev -->
-	<device match="zcons/%z/zoneconsole" name="zconsole" />
-
-	<!-- Symlinks to create under /dev -->
-	<symlink source="console" target="zconsole" />
-	<symlink source="dtremote" target="/dev/null" />
-	<symlink source="msglog" target="zconsole" />
-	<symlink source="stderr" target="./fd/2" />
-	<symlink source="stdin" target="./fd/0" />
-	<symlink source="stdout" target="./fd/1" />
-	<symlink source="syscon" target="zconsole" />
-	<symlink source="sysmsg" target="zconsole" />
-	<symlink source="systty" target="zconsole" />
-
-</platform>
diff --git a/overlay/generic/usr/lib/brand/joyent-minimal/poststate b/overlay/generic/usr/lib/brand/joyent-minimal/poststate
deleted file mode 100755
index be489ef5..00000000
--- a/overlay/generic/usr/lib/brand/joyent-minimal/poststate
+++ /dev/null
@@ -1,19 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-ps_brand="joyent-minimal"
-. /usr/lib/brand/jcommon/poststate
diff --git a/overlay/generic/usr/lib/brand/joyent-minimal/prestate b/overlay/generic/usr/lib/brand/joyent-minimal/prestate
deleted file mode 100755
index e6aeb1cb..00000000
--- a/overlay/generic/usr/lib/brand/joyent-minimal/prestate
+++ /dev/null
@@ -1,19 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-ps_brand="joyent-minimal"
-. /usr/lib/brand/jcommon/prestate
diff --git a/overlay/generic/usr/lib/brand/joyent-minimal/statechange b/overlay/generic/usr/lib/brand/joyent-minimal/statechange
deleted file mode 100755
index 5e2eeff0..00000000
--- a/overlay/generic/usr/lib/brand/joyent-minimal/statechange
+++ /dev/null
@@ -1,42 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2018 Joyent, Inc.  All rights reserved.
-#
-
-# Do we support vrrp?
-jst_vrrp="yes"
-
-# Do we support unfiltered promiscuous mode
-# jst_ufpromisc="yes"
-
-# Do we use vnd devices
-# jst_createvnd="yes"
-
-# Do we not need to have various SMF and ccs stuff created for us?
-# jst_simplefs="yes"
-
-# Should we show snapshots?
-jst_showsnap="yes"
-
-# Where does the mdata socket live?
-jst_mdatapath="/.zonecontrol/"
-
-# Ensure docker zfd(7D) log is not put in the wrong place
-if [[ "$_ZONECFG_attr_docker" == true ]]; then
-	typeset -A FORCED_ATTRS
-	FORCED_ATTRS["zlog-name"]=
-fi
-
-. /usr/lib/brand/jcommon/statechange
diff --git a/overlay/generic/usr/lib/brand/joyent/config.xml b/overlay/generic/usr/lib/brand/joyent/config.xml
deleted file mode 100644
index c6fdb574..00000000
--- a/overlay/generic/usr/lib/brand/joyent/config.xml
+++ /dev/null
@@ -1,115 +0,0 @@
-<?xml version="1.0"?>
-
-<!--
- CDDL HEADER START
-
- The contents of this file are subject to the terms of the
- Common Development and Distribution License (the "License").
- You may not use this file except in compliance with the License.
-
- You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
- or http://www.opensolaris.org/os/licensing.
- See the License for the specific language governing permissions
- and limitations under the License.
-
- When distributing Covered Code, include this CDDL HEADER in each
- file and include the License file at usr/src/OPENSOLARIS.LICENSE.
- If applicable, add the following below this CDDL HEADER, with the
- fields enclosed by brackets "[]" replaced with your own identifying
- information: Portions Copyright [yyyy] [name of copyright owner]
-
- CDDL HEADER END
-
- Copyright 2015 Joyent, Inc.  All rights reserved.
- Use is subject to license terms.
-
- DO NOT EDIT THIS FILE.
--->
-
-<!DOCTYPE brand PUBLIC "-//Joyent Inc//DTD Brands//EN"
-    "file:///usr/share/lib/xml/dtd/brand.dtd.1">
-
-<brand name="joyent">
-	<modname></modname>
-
-	<initname>/sbin/init</initname>
-	<login_cmd>/usr/bin/login -z %Z %u</login_cmd>
-	<forcedlogin_cmd>/usr/bin/login -z %Z -f %u</forcedlogin_cmd>
-	<user_cmd>/usr/bin/getent passwd %u</user_cmd>
-
-	<install>/usr/lib/brand/joyent/jinstall -z %z -R %R</install>
-	<installopts>R:t:U:q:z:</installopts>
-	<boot></boot>
-	<halt></halt>
-	<verify_cfg></verify_cfg>
-	<verify_adm></verify_adm>
-	<postclone></postclone>
-	<postinstall></postinstall>
-	<attach>/usr/lib/brand/joyent/jattach -z %z -R %R</attach>
-	<detach>/usr/lib/brand/joyent/jdetach -z %z -R %R</detach>
-	<clone></clone>
-	<uninstall>/usr/lib/brand/joyent/juninstall -z %z -R %R</uninstall>
-	<prestatechange>/usr/lib/brand/joyent/prestate %z %R</prestatechange>
-	<poststatechange>/usr/lib/brand/joyent/poststate %z %R</poststatechange>
-	<query>/usr/lib/brand/joyent/query %z %R</query>
-
-	<privilege set="default" name="contract_event" />
-	<privilege set="default" name="contract_identity" />
-	<privilege set="default" name="contract_observer" />
-	<privilege set="default" name="dtrace_proc" />
-	<privilege set="default" name="dtrace_user" />
-	<privilege set="default" name="file_chown" />
-	<privilege set="default" name="file_chown_self" />
-	<privilege set="default" name="file_dac_execute" />
-	<privilege set="default" name="file_dac_read" />
-	<privilege set="default" name="file_dac_search" />
-	<privilege set="default" name="file_dac_write" />
-	<privilege set="default" name="file_owner" />
-	<privilege set="default" name="file_setid" />
-	<privilege set="default" name="ipc_dac_read" />
-	<privilege set="default" name="ipc_dac_write" />
-	<privilege set="default" name="ipc_owner" />
-	<privilege set="default" name="net_bindmlp" />
-	<privilege set="default" name="net_icmpaccess" />
-	<privilege set="default" name="net_mac_aware" />
-	<privilege set="default" name="net_observability" />
-	<privilege set="default" name="net_privaddr" />
-	<privilege set="default" name="net_rawaccess" ip-type="exclusive" />
-	<privilege set="default" name="proc_chroot" />
-	<privilege set="default" name="sys_audit" />
-	<privilege set="default" name="proc_audit" />
-	<privilege set="default" name="proc_lock_memory" />
-	<privilege set="default" name="proc_owner" />
-	<privilege set="default" name="proc_prioup" />
-	<privilege set="default" name="proc_secflags" />
-	<privilege set="default" name="proc_setid" />
-	<privilege set="default" name="proc_taskid" />
-	<privilege set="default" name="sys_acct" />
-	<privilege set="default" name="sys_admin" />
-	<privilege set="default" name="sys_fs_import" />
-	<privilege set="default" name="sys_ip_config" ip-type="exclusive" />
-	<privilege set="default" name="sys_iptun_config" ip-type="exclusive" />
-	<privilege set="default" name="sys_mount" />
-	<privilege set="default" name="sys_nfs" />
-	<privilege set="default" name="sys_smb" />
-	<privilege set="default" name="sys_resource" />
-	<privilege set="default" name="sys_ppp_config" ip-type="exclusive" />
-
-	<privilege set="prohibited" name="dtrace_kernel" />
-	<privilege set="prohibited" name="proc_zone" />
-	<privilege set="prohibited" name="sys_config" />
-	<privilege set="prohibited" name="sys_devices" />
-	<privilege set="prohibited" name="sys_ip_config" ip-type="shared" />
-	<privilege set="prohibited" name="sys_linkdir" />
-	<privilege set="prohibited" name="sys_net_config" />
-	<privilege set="prohibited" name="sys_res_config" />
-	<privilege set="prohibited" name="sys_suser_compat" />
-	<privilege set="prohibited" name="xvm_control" />
-	<privilege set="prohibited" name="virt_manage" />
-	<privilege set="prohibited" name="sys_ppp_config" ip-type="shared" />
-
-	<privilege set="required" name="proc_exec" />
-	<privilege set="required" name="proc_fork" />
-	<privilege set="required" name="sys_ip_config" ip-type="exclusive" />
-	<privilege set="required" name="sys_mount" />
-</brand>
diff --git a/overlay/generic/usr/lib/brand/joyent/jattach b/overlay/generic/usr/lib/brand/joyent/jattach
deleted file mode 100755
index 11844b9a..00000000
--- a/overlay/generic/usr/lib/brand/joyent/jattach
+++ /dev/null
@@ -1,26 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-. /usr/lib/brand/jcommon/libhooks.ksh
-
-function jcommon_attach_hook
-{
-	jattach_zone_final_setup
-}
-
-ps_brand="joyent"
-. /usr/lib/brand/jcommon/cattach
diff --git a/overlay/generic/usr/lib/brand/joyent/jdetach b/overlay/generic/usr/lib/brand/joyent/jdetach
deleted file mode 100755
index 89681919..00000000
--- a/overlay/generic/usr/lib/brand/joyent/jdetach
+++ /dev/null
@@ -1,19 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-ps_brand="joyent"
-. /usr/lib/brand/jcommon/cdetach
diff --git a/overlay/generic/usr/lib/brand/joyent/jinstall b/overlay/generic/usr/lib/brand/joyent/jinstall
deleted file mode 100755
index 8e6ec2a7..00000000
--- a/overlay/generic/usr/lib/brand/joyent/jinstall
+++ /dev/null
@@ -1,31 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-# Does this brand support reprovisioning?
-jst_reprovision="yes"
-
-# Is a template image optional?
-# jst_tmplopt="yes"
-
-. /usr/lib/brand/jcommon/libhooks.ksh
-
-function jcommon_attach_hook
-{
-	jattach_zone_final_setup
-}
-
-. /usr/lib/brand/jcommon/cinstall
diff --git a/overlay/generic/usr/lib/brand/joyent/juninstall b/overlay/generic/usr/lib/brand/joyent/juninstall
deleted file mode 100755
index 09051a17..00000000
--- a/overlay/generic/usr/lib/brand/joyent/juninstall
+++ /dev/null
@@ -1,25 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-. /usr/lib/brand/jcommon/libhooks.ksh
-
-function jcommon_uninstall_hook
-{
-	juninstall_delegated_dataset
-}
-
-. /usr/lib/brand/jcommon/cuninstall
diff --git a/overlay/generic/usr/lib/brand/joyent/manifests b/overlay/generic/usr/lib/brand/joyent/manifests
deleted file mode 100644
index 00c43b3f..00000000
--- a/overlay/generic/usr/lib/brand/joyent/manifests
+++ /dev/null
@@ -1,176 +0,0 @@
-#
-# This file lists the SMF manifests which are available in the global
-# zone and which should be setup for use in non-global zones.  Not
-# all SMF services are usable within a zone, so only those that are usable
-# should be listed here.
-#
-# The format of the file is:
-#	manifest_name enable/disable
-# The manifest_name is found relative to /lib/svc/manifest on the system.
-# The second field is used to indicate if the svc should be enabled or
-# disabled by default within zones, independently of its current status in
-# the global zone.
-#
-# The following is a list of SMF svcs which could be run in a zone, but
-# which we're not currently installing on our live image.  If we add any
-# of these to the image and we want it to also be available in zones,
-# then we need to move the entry to the end and uncomment it out.
-#
-# application/cups.xml
-# application/font/fc-cache.xml
-# application/graphical-login/gdm.xml
-# application/management/net-snmp.xml
-# application/management/seaport.xml
-# application/management/snmpdx.xml
-# application/opengl/ogl-select.xml
-# application/print/service-selector.xml
-# application/security/tcsd.xml
-# application/x11/x11-server.xml
-# application/x11/xfs.xml
-# application/x11/xvnc-inetd.xml
-# network/rpc/keyserv.xml
-# network/socket-filter-kssl.xml
-# network/ssl/kssl-proxy.xml
-# network/dns/server.xml
-# network/ftp.xml
-# network/finger.xml
-# network/comsat.xml
-# network/rpc/rstat.xml
-# network/rpc/rusers.xml
-# network/rpc/spray.xml
-# network/rpc/wall.xml
-# network/talk.xml
-# network/ntp.xml
-# network/sendmail-client.xml
-# network/smtp-sendmail.xml
-# network/telnet.xml
-# network/wpa.xml
-# network/rpc/gss.xml
-# network/security/kadmin.xml
-# network/security/krb5kdc.xml
-# network/security/ktkt_warn.xml
-# network/rpc/smserver.xml
-# network/nfs/cbd.xml
-# network/ipmievd.xml
-# network/http-apache22.xml
-# system/consolekit.xml
-# system/device/devices-audio.xml
-# system/fm/notify-params.xml
-# system/install/system-config.xml
-# system/pkgserv.xml
-#
-
-#
-# The following is a list of SMF svcs which are installed on our live image and
-# which could be run in a zone, but which we choose not to run in our zones.
-# If we ever do want to run any of these, move the entry to the end and
-# uncomment it out.
-#
-# system/boot-archive-update.xml
-# system/boot-config.xml
-#
-
-#
-# The following is a list of SMF svc manifests under /lib/svc/manifest.  These
-# are available on our live image and are runnable in a zone.  Since the zones
-# are sharing the base file system with the global zone, we set up so that
-# only these svcs are configured in zones, independently of the global zone
-# /lib/svc/manifest hierarchy.
-#
-milestone/multi-user-server.xml				enabled
-milestone/multi-user.xml				enabled
-milestone/name-services.xml				enabled
-milestone/network.xml					enabled
-milestone/single-user.xml				enabled
-milestone/sysconfig.xml					enabled
-network/bridge.xml					enabled
-network/dlmgmt.xml					enabled
-network/dns/client.xml					enabled
-network/dns/install.xml					disabled
-network/dns/multicast.xml				disabled
-network/forwarding.xml					disabled
-network/inetd-upgrade.xml				enabled
-network/inetd.xml					disabled
-network/ipfilter.xml					disabled
-network/ipsec/ike.xml					disabled
-network/ipsec/ipsecalgs.xml				enabled
-network/ipsec/manual-key.xml				disabled
-network/ipsec/policy.xml				enabled
-network/ldap/client.xml					disabled
-network/loadbalancer/ilbd.xml				disabled
-network/login.xml					enabled
-network/network-initial.xml				enabled
-network/network-install.xml				disabled
-network/network-ipmgmt.xml				enabled
-network/network-ipqos.xml				disabled
-network/network-iptun.xml				enabled
-network/network-location.xml				disabled
-network/network-loopback.xml				enabled
-network/network-netcfg.xml				enabled
-network/network-netmask.xml				enabled
-network/network-physical.xml				enabled
-network/network-routing-setup.xml			enabled
-network/network-service.xml				enabled
-network/nfs/client.xml					disabled
-network/nfs/mapid.xml					disabled
-network/nfs/nlockmgr.xml				disabled
-network/nfs/rquota.xml					disabled
-network/nfs/status.xml					disabled
-network/nis/client.xml					disabled
-network/rexec.xml					disabled
-network/routing/legacy-routing.xml			enabled
-network/routing/ndp.xml					disabled
-network/routing/rdisc.xml				disabled
-network/routing/ripng.xml				disabled
-network/routing/route.xml				disabled
-network/rpc/bind.xml					enabled
-network/shares/group.xml				enabled
-network/shares/reparsed.xml				disabled
-network/shell.xml					disabled
-network/slp.xml						disabled
-network/smb/client.xml					disabled
-network/smb/server.xml					disabled
-network/ssh.xml						enabled
-network/vrrp.xml					disabled
-system/auditd.xml					disabled
-system/auditset.xml					disabled
-system/boot-archive.xml					enabled
-system/consadm.xml					disabled
-system/console-login.xml				disabled
-system/coreadm.xml					enabled
-system/cron.xml						enabled
-system/cryptosvc.xml					enabled
-system/device/allocate.xml				disabled
-system/device/devices-local.xml				enabled
-system/device/mpxio-upgrade.xml				disabled
-system/early-manifest-import.xml			enabled
-system/extended-accounting.xml				enabled
-system/filesystem/autofs.xml				disabled
-system/filesystem/joyent-fs.xml				enabled
-system/filesystem/local-fs.xml				enabled
-system/filesystem/minimal-fs.xml			enabled
-system/filesystem/root-fs.xml				enabled
-system/filesystem/usr-fs.xml				enabled
-system/fmd.xml						disabled
-system/hostid.xml					enabled
-system/hotplug.xml					disabled
-system/identity.xml					enabled
-system/idmap.xml					disabled
-system/keymap.xml					enabled
-system/logadm-upgrade.xml				enabled
-system/manifest-import.xml				enabled
-system/mdata.xml					disabled
-system/name-service-cache.xml				enabled
-system/pfexecd.xml					enabled
-system/process-security.xml				enabled
-system/rbac.xml						enabled
-system/rcap.xml						disabled
-system/rmtmpfiles.xml					enabled
-system/sac.xml						disabled
-system/sar.xml						disabled
-system/svc/global.xml					disabled
-system/svc/restarter.xml				enabled
-system/sysidtool.xml					enabled
-system/system-log.xml					enabled
-system/utmp.xml						enabled
-system/vtdaemon.xml					disabled
diff --git a/overlay/generic/usr/lib/brand/joyent/platform.xml b/overlay/generic/usr/lib/brand/joyent/platform.xml
deleted file mode 100644
index 5a4a9601..00000000
--- a/overlay/generic/usr/lib/brand/joyent/platform.xml
+++ /dev/null
@@ -1,168 +0,0 @@
-<?xml version="1.0"?>
-
-<!--
- CDDL HEADER START
-
- The contents of this file are subject to the terms of the
- Common Development and Distribution License (the "License").
- You may not use this file except in compliance with the License.
-
- You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
- or http://www.opensolaris.org/os/licensing.
- See the License for the specific language governing permissions
- and limitations under the License.
-
- When distributing Covered Code, include this CDDL HEADER in each
- file and include the License file at usr/src/OPENSOLARIS.LICENSE.
- If applicable, add the following below this CDDL HEADER, with the
- fields enclosed by brackets "[]" replaced with your own identifying
- information: Portions Copyright [yyyy] [name of copyright owner]
-
- CDDL HEADER END
-
- Copyright 2017 Joyent, Inc.
-
- DO NOT EDIT THIS FILE.
--->
-
-<!DOCTYPE platform PUBLIC "-//Joyent Inc//Zones Platform//EN"
-    "file:///usr/share/lib/xml/dtd/zone_platform.dtd.1">
-
-<platform name="joyent" allow-exclusive-ip="true">
-
-	<!-- Global filesystems to mount when booting the zone -->
-	<global_mount special="/dev" directory="/dev" type="dev"
-	    opt="attrdir=%R/root/dev"/>
-
-	<global_mount special="/var/zonecontrol/%z" directory="/.zonecontrol"
-	    opt="ro,nodevices,nosetuid,noexec" type="lofs" />
-	<global_mount special="/lib" directory="/lib"
-	    opt="ro,nodevices" type="lofs" />
-	<global_mount special="%P/manifests/joyent"
-	    directory="/lib/svc/manifest"
-	    opt="ro,nodevices" type="lofs" />
-	<global_mount special="%R/site" directory="/lib/svc/manifest/site"
-	    opt="nodevices" type="lofs" />
-	<global_mount special="/sbin" directory="/sbin"
-	    opt="ro,nodevices" type="lofs" />
-	<global_mount special="/usr" directory="/usr"
-	    opt="ro,nodevices" type="lofs" />
-	<global_mount special="%R/local" directory="/usr/local"
-	    opt="nodevices" type="lofs" />
-	<global_mount special="%R/ccs" directory="/usr/ccs"
-	    opt="nodevices" type="lofs" />
-
-	<!-- Local filesystems to mount when booting the zone -->
-	<mount special="/proc" directory="/proc" type="proc" />
-	<mount special="ctfs" directory="/system/contract" type="ctfs" />
-	<mount special="mnttab" directory="/etc/mnttab" type="mntfs" />
-	<mount special="objfs" directory="/system/object" type="objfs" />
-	<mount special="lxproc" directory="/system/lxproc" type="lxproc" />
-	<mount special="swap" directory="/etc/svc/volatile" type="tmpfs" />
-
-	<!-- Devices to create under /dev -->
-	<device match="arp" />
-	<device match="bpf" />
-	<device match="conslog" />
-	<device match="cpu/self/cpuid" />
-	<device match="crypto" />
-	<device match="cryptoadm" />
-	<device match="dsk" />
-	<device match="dtrace/*" />
-	<device match="dtrace/provider/*" />
-	<device match="eventfd" />
-	<device match="fd" />
-	<device match="full" />
-	<device match="inotify" />
-	<device match="ipnet" />
-	<device match="kstat" />
-	<device match="lo0" />
-	<device match="lofictl" />
-	<device match="lofi" />
-	<device match="log" />
-	<device match="logindmux" />
-	<device match="nsmb" />
-	<device match="net/*" />
-	<device match="null" />
-	<device match="openprom" arch="sparc" />
-	<device match="poll" />
-	<device match="pool" />
-	<device match="ptmx" />
-	<device match="pts/*" />
-	<device match="random" />
-	<device match="rdsk" />
-	<device match="rlofi" />
-	<device match="rmt" />
-	<device match="sad/user" />
-	<device match="smbsrv" />
-	<device match="signalfd" />
-	<device match="svvslo0" />
-	<device match="svvslo1" />
-	<device match="svvslo2" />
-	<device match="svvslo3" />
-	<device match="swap" />
-	<device match="sysevent" />
-	<device match="tap" />
-	<device match="tcp" />
-	<device match="tcp6" />
-	<device match="term" />
-	<device match="ticlts" />
-	<device match="ticots" />
-	<device match="ticotsord" />
-	<device match="timerfd" />
-	<device match="tty" />
-	<device match="tun" />
-	<device match="udp" />
-	<device match="udp6" />
-	<device match="urandom" />
-	<device match="vnd/*" />
-	<device match="zero" />
-	<device match="zfs" />
-	<device match="zvol/dsk/%P/%z/*" />
-	<device match="zvol/rdsk/%P/%z/*" />
-
-	<!-- Devices to create in exclusive IP zone only -->
-	<device match="dld" ip-type="exclusive" />
-	<device match="icmp" ip-type="exclusive" />
-	<device match="icmp6" ip-type="exclusive" />
-	<device match="ip" ip-type="exclusive" />
-	<device match="ip6" ip-type="exclusive" />
-	<device match="ipauth" ip-type="exclusive" />
-	<device match="ipd" ip-type="exclusive" />
-	<device match="ipf" ip-type="exclusive" />
-	<device match="ipl" ip-type="exclusive" />
-	<device match="iplookup" ip-type="exclusive" />
-	<device match="ipmpstub" ip-type="exclusive" />
-	<device match="ipnat" ip-type="exclusive" />
-	<device match="ipscan" ip-type="exclusive" />
-	<device match="ipsecah" ip-type="exclusive" />
-	<device match="ipsecesp" ip-type="exclusive" />
-	<device match="ipstate" ip-type="exclusive" />
-	<device match="ipsync" ip-type="exclusive" />
-	<device match="keysock" ip-type="exclusive" />
-	<device match="rawip" ip-type="exclusive" />
-	<device match="rawip6" ip-type="exclusive" />
-	<device match="rts" ip-type="exclusive" />
-	<device match="sad/admin" ip-type="exclusive" />
-	<device match="sctp" ip-type="exclusive" />
-	<device match="sctp6" ip-type="exclusive" />
-	<device match="spdsock" ip-type="exclusive" />
-	<device match="sppp" ip-type="exclusive" />
-	<device match="sppptun" ip-type="exclusive" />
-	<device match="vni" ip-type="exclusive" />
-
-	<!-- Renamed devices to create under /dev -->
-	<device match="zcons/%z/zoneconsole" name="zconsole" />
-
-	<!-- Symlinks to create under /dev -->
-	<symlink source="console" target="zconsole" />
-	<symlink source="dtremote" target="/dev/null" />
-	<symlink source="msglog" target="zconsole" />
-	<symlink source="stderr" target="./fd/2" />
-	<symlink source="stdin" target="./fd/0" />
-	<symlink source="stdout" target="./fd/1" />
-	<symlink source="syscon" target="zconsole" />
-	<symlink source="sysmsg" target="zconsole" />
-	<symlink source="systty" target="zconsole" />
-
-</platform>
diff --git a/overlay/generic/usr/lib/brand/joyent/poststate b/overlay/generic/usr/lib/brand/joyent/poststate
deleted file mode 100755
index 6cd0d0a1..00000000
--- a/overlay/generic/usr/lib/brand/joyent/poststate
+++ /dev/null
@@ -1,19 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-ps_brand="joyent"
-. /usr/lib/brand/jcommon/poststate
diff --git a/overlay/generic/usr/lib/brand/joyent/prestate b/overlay/generic/usr/lib/brand/joyent/prestate
deleted file mode 100755
index 10b73285..00000000
--- a/overlay/generic/usr/lib/brand/joyent/prestate
+++ /dev/null
@@ -1,19 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-ps_brand="joyent"
-. /usr/lib/brand/jcommon/prestate
diff --git a/overlay/generic/usr/lib/brand/joyent/statechange b/overlay/generic/usr/lib/brand/joyent/statechange
deleted file mode 100755
index 5e2eeff0..00000000
--- a/overlay/generic/usr/lib/brand/joyent/statechange
+++ /dev/null
@@ -1,42 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2018 Joyent, Inc.  All rights reserved.
-#
-
-# Do we support vrrp?
-jst_vrrp="yes"
-
-# Do we support unfiltered promiscuous mode
-# jst_ufpromisc="yes"
-
-# Do we use vnd devices
-# jst_createvnd="yes"
-
-# Do we not need to have various SMF and ccs stuff created for us?
-# jst_simplefs="yes"
-
-# Should we show snapshots?
-jst_showsnap="yes"
-
-# Where does the mdata socket live?
-jst_mdatapath="/.zonecontrol/"
-
-# Ensure docker zfd(7D) log is not put in the wrong place
-if [[ "$_ZONECFG_attr_docker" == true ]]; then
-	typeset -A FORCED_ATTRS
-	FORCED_ATTRS["zlog-name"]=
-fi
-
-. /usr/lib/brand/jcommon/statechange
diff --git a/overlay/generic/usr/lib/brand/kvm/config.xml b/overlay/generic/usr/lib/brand/kvm/config.xml
deleted file mode 100644
index 461805ae..00000000
--- a/overlay/generic/usr/lib/brand/kvm/config.xml
+++ /dev/null
@@ -1,77 +0,0 @@
-<?xml version="1.0"?>
-
-<!--
- CDDL HEADER START
-
- The contents of this file are subject to the terms of the
- Common Development and Distribution License (the "License").
- You may not use this file except in compliance with the License.
-
- You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
- or http://www.opensolaris.org/os/licensing.
- See the License for the specific language governing permissions
- and limitations under the License.
-
- When distributing Covered Code, include this CDDL HEADER in each
- file and include the License file at usr/src/OPENSOLARIS.LICENSE.
- If applicable, add the following below this CDDL HEADER, with the
- fields enclosed by brackets "[]" replaced with your own identifying
- information: Portions Copyright [yyyy] [name of copyright owner]
-
- CDDL HEADER END
-
- Copyright 2010,2011 Joyent, Inc.  All rights reserved.
- Use is subject to license terms.
-
- DO NOT EDIT THIS FILE.
--->
-
-<!DOCTYPE brand PUBLIC "-//Joyent Inc//DTD Brands//EN"
-    "file:///usr/share/lib/xml/dtd/brand.dtd.1">
-
-<brand name="kvm">
-	<modname></modname>
-
-	<initname>/startvm</initname>
-	<restartinit>false</restartinit>
-	<login_cmd>/usr/bin/login -z %Z %u</login_cmd>
-	<forcedlogin_cmd>/usr/bin/login -z %Z -f %u</forcedlogin_cmd>
-	<user_cmd>/usr/bin/getent passwd %u</user_cmd>
-
-	<install>/usr/lib/brand/kvm/kinstall -z %z -R %R</install>
-	<installopts>R:t:U:q:z:</installopts>
-	<boot></boot>
-	<halt></halt>
-	<verify_cfg></verify_cfg>
-	<verify_adm></verify_adm>
-	<postclone></postclone>
-	<postinstall></postinstall>
-	<attach>/usr/lib/brand/kvm/kattach -z %z -R %R</attach>
-	<detach>/usr/lib/brand/kvm/kdetach -z %z -R %R</detach>
-	<clone></clone>
-	<uninstall>/usr/lib/brand/kvm/kuninstall -z %z -R %R</uninstall>
-	<prestatechange>/usr/lib/brand/kvm/prestate %z %R</prestatechange>
-	<poststatechange>/usr/lib/brand/kvm/poststate %z %R</poststatechange>
-
-	<privilege set="default" name="net_rawaccess" ip-type="exclusive" />
-	<privilege set="default" name="proc_clock_highres" />
-	<privilege set="default" name="proc_lock_memory" />
-	<privilege set="default" name="sys_admin" />
-	<privilege set="default" name="sys_mount" />
-
-	<privilege set="prohibited" name="dtrace_kernel" />
-	<privilege set="prohibited" name="proc_zone" />
-	<privilege set="prohibited" name="sys_config" />
-	<privilege set="prohibited" name="sys_devices" />
-	<privilege set="prohibited" name="sys_ip_config" ip-type="shared" />
-	<privilege set="prohibited" name="sys_linkdir" />
-	<privilege set="prohibited" name="sys_net_config" />
-	<privilege set="prohibited" name="sys_res_config" />
-	<privilege set="prohibited" name="sys_suser_compat" />
-	<privilege set="prohibited" name="xvm_control" />
-	<privilege set="prohibited" name="virt_manage" />
-	<privilege set="prohibited" name="sys_ppp_config" ip-type="shared" />
-
-	<privilege set="required" name="proc_exec" />
-	<privilege set="required" name="sys_mount" />
-</brand>
diff --git a/overlay/generic/usr/lib/brand/kvm/kattach b/overlay/generic/usr/lib/brand/kvm/kattach
deleted file mode 100755
index 17d1242c..00000000
--- a/overlay/generic/usr/lib/brand/kvm/kattach
+++ /dev/null
@@ -1,26 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-. /usr/lib/brand/jcommon/libhooks.ksh
-
-function jcommon_attach_hook
-{
-	jattach_kvm_final_setup
-}
-
-ps_brand="kvm"
-. /usr/lib/brand/jcommon/cattach
diff --git a/overlay/generic/usr/lib/brand/kvm/kdetach b/overlay/generic/usr/lib/brand/kvm/kdetach
deleted file mode 100755
index f3785b45..00000000
--- a/overlay/generic/usr/lib/brand/kvm/kdetach
+++ /dev/null
@@ -1,19 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-ps_brand="kvm"
-. /usr/lib/brand/jcommon/cdetach
diff --git a/overlay/generic/usr/lib/brand/kvm/kinstall b/overlay/generic/usr/lib/brand/kvm/kinstall
deleted file mode 100755
index b070f3a1..00000000
--- a/overlay/generic/usr/lib/brand/kvm/kinstall
+++ /dev/null
@@ -1,31 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-# Does this brand support reprovisioning?
-# jst_reprovision="yes"
-
-# Is a template image optional?
-jst_tmplopt="yes"
-
-. /usr/lib/brand/jcommon/libhooks.ksh
-
-function jcommon_attach_hook
-{
-	jattach_kvm_final_setup
-}
-
-. /usr/lib/brand/jcommon/cinstall
diff --git a/overlay/generic/usr/lib/brand/kvm/kuninstall b/overlay/generic/usr/lib/brand/kvm/kuninstall
deleted file mode 100755
index 136044ad..00000000
--- a/overlay/generic/usr/lib/brand/kvm/kuninstall
+++ /dev/null
@@ -1,23 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-function jcommon_uninstall_hook
-{
-	:
-}
-
-. /usr/lib/brand/jcommon/cuninstall
diff --git a/overlay/generic/usr/lib/brand/kvm/platform.xml b/overlay/generic/usr/lib/brand/kvm/platform.xml
deleted file mode 100644
index 825344b1..00000000
--- a/overlay/generic/usr/lib/brand/kvm/platform.xml
+++ /dev/null
@@ -1,145 +0,0 @@
-<?xml version="1.0"?>
-
-<!--
- CDDL HEADER START
-
- The contents of this file are subject to the terms of the
- Common Development and Distribution License (the "License").
- You may not use this file except in compliance with the License.
-
- You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
- or http://www.opensolaris.org/os/licensing.
- See the License for the specific language governing permissions
- and limitations under the License.
-
- When distributing Covered Code, include this CDDL HEADER in each
- file and include the License file at usr/src/OPENSOLARIS.LICENSE.
- If applicable, add the following below this CDDL HEADER, with the
- fields enclosed by brackets "[]" replaced with your own identifying
- information: Portions Copyright [yyyy] [name of copyright owner]
-
- CDDL HEADER END
-
- Copyright 2010, 2011 Joyent, Inc.  All rights reserved.
- Use is subject to license terms.
-
- DO NOT EDIT THIS FILE.
--->
-
-<!DOCTYPE platform PUBLIC "-//Joyent Inc//Zones Platform//EN"
-    "file:///usr/share/lib/xml/dtd/zone_platform.dtd.1">
-
-<platform name="kvm" allow-exclusive-ip="true">
-
-	<!-- Global filesystems to mount when booting the zone -->
-	<global_mount special="/dev" directory="/dev" type="dev"
-	    opt="attrdir=%R/root/dev"/>
-
-	<global_mount special="/lib" directory="/lib"
-	    opt="ro,nodevices" type="lofs" />
-	<global_mount special="/sbin" directory="/sbin"
-	    opt="ro,nodevices" type="lofs" />
-	<global_mount special="/usr" directory="/usr"
-	    opt="ro,nodevices" type="lofs" />
-	<global_mount special="/smartdc" directory="/smartdc"
-	    opt="ro,nodevices" type="lofs" />
-
-	<!-- Local filesystems to mount when booting the zone -->
-	<mount special="swap" directory="/etc/svc/volatile" type="tmpfs" />
-
-	<!-- Devices to create under /dev -->
-	<device match="arp" />
-	<device match="bpf" />
-	<device match="conslog" />
-	<device match="cpu/self/cpuid" />
-	<device match="crypto" />
-	<device match="cryptoadm" />
-	<device match="dsk" />
-	<device match="dtrace/*" />
-	<device match="dtrace/provider/*" />
-	<device match="fd" />
-	<device match="ipnet" />
-	<device match="kstat" />
-	<device match="kvm" />
-	<device match="lo0" />
-	<device match="lofictl" />
-	<device match="lofi" />
-	<device match="log" />
-	<device match="logindmux" />
-	<device match="nsmb" />
-	<device match="net/*" />
-	<device match="null" />
-	<device match="openprom" arch="sparc" />
-	<device match="poll" />
-	<device match="pool" />
-	<device match="ptmx" />
-	<device match="pts/*" />
-	<device match="random" />
-	<device match="rdsk" />
-	<device match="rlofi" />
-	<device match="rmt" />
-	<device match="sad/user" />
-	<device match="svvslo0" />
-	<device match="svvslo1" />
-	<device match="svvslo2" />
-	<device match="svvslo3" />
-	<device match="swap" />
-	<device match="sysevent" />
-	<device match="tcp" />
-	<device match="tcp6" />
-	<device match="term" />
-	<device match="ticlts" />
-	<device match="ticots" />
-	<device match="ticotsord" />
-	<device match="tty" />
-	<device match="udp" />
-	<device match="udp6" />
-	<device match="urandom" />
-	<device match="vnd/*" />
-	<device match="zero" />
-	<device match="zfs" />
-
-	<!-- Devices to create in exclusive IP zone only -->
-	<device match="dld" ip-type="exclusive" />
-	<device match="icmp" ip-type="exclusive" />
-	<device match="icmp6" ip-type="exclusive" />
-	<device match="ip" ip-type="exclusive" />
-	<device match="ip6" ip-type="exclusive" />
-	<device match="ipauth" ip-type="exclusive" />
-	<device match="ipf" ip-type="exclusive" />
-	<device match="ipl" ip-type="exclusive" />
-	<device match="iplookup" ip-type="exclusive" />
-	<device match="ipmpstub" ip-type="exclusive" />
-	<device match="ipnat" ip-type="exclusive" />
-	<device match="ipscan" ip-type="exclusive" />
-	<device match="ipsecah" ip-type="exclusive" />
-	<device match="ipsecesp" ip-type="exclusive" />
-	<device match="ipstate" ip-type="exclusive" />
-	<device match="ipsync" ip-type="exclusive" />
-	<device match="keysock" ip-type="exclusive" />
-	<device match="rawip" ip-type="exclusive" />
-	<device match="rawip6" ip-type="exclusive" />
-	<device match="rts" ip-type="exclusive" />
-	<device match="sad/admin" ip-type="exclusive" />
-	<device match="sctp" ip-type="exclusive" />
-	<device match="sctp6" ip-type="exclusive" />
-	<device match="spdsock" ip-type="exclusive" />
-	<device match="sppp" ip-type="exclusive" />
-	<device match="sppptun" ip-type="exclusive" />
-	<device match="vni" ip-type="exclusive" />
-
-	<!-- Renamed devices to create under /dev -->
-	<device match="zcons/%z/zoneconsole" name="zconsole" />
-
-	<!-- Symlinks to create under /dev -->
-	<symlink source="console" target="zconsole" />
-	<symlink source="dtremote" target="/dev/null" />
-	<symlink source="msglog" target="zconsole" />
-	<symlink source="stderr" target="./fd/2" />
-	<symlink source="stdin" target="./fd/0" />
-	<symlink source="stdout" target="./fd/1" />
-	<symlink source="syscon" target="zconsole" />
-	<symlink source="sysmsg" target="zconsole" />
-	<symlink source="systty" target="zconsole" />
-
-</platform>
diff --git a/overlay/generic/usr/lib/brand/kvm/poststate b/overlay/generic/usr/lib/brand/kvm/poststate
deleted file mode 100755
index 17060a3b..00000000
--- a/overlay/generic/usr/lib/brand/kvm/poststate
+++ /dev/null
@@ -1,19 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-ps_brand="kvm"
-. /usr/lib/brand/jcommon/poststate
diff --git a/overlay/generic/usr/lib/brand/kvm/prestate b/overlay/generic/usr/lib/brand/kvm/prestate
deleted file mode 100755
index a05fe693..00000000
--- a/overlay/generic/usr/lib/brand/kvm/prestate
+++ /dev/null
@@ -1,19 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-ps_brand="kvm"
-. /usr/lib/brand/jcommon/prestate
diff --git a/overlay/generic/usr/lib/brand/kvm/statechange b/overlay/generic/usr/lib/brand/kvm/statechange
deleted file mode 100755
index 4e3fab34..00000000
--- a/overlay/generic/usr/lib/brand/kvm/statechange
+++ /dev/null
@@ -1,36 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-# Do we support vrrp?
-# jst_vrrp="yes"
-
-# Do we support unfiltered promiscuous mode
-jst_ufpromisc="yes"
-
-# Do we use vnd devices
-jst_createvnd="yes"
-
-# Do we not need to have various SMF and ccs stuff created for us?
-jst_simplefs="yes"
-
-# Should we show snapshots?
-# jst_showsnap="yes"
-
-# Where does the mdata socket live?
-jst_mdatapath="/var/run/smartdc"
-
-. /usr/lib/brand/jcommon/statechange
diff --git a/overlay/generic/usr/lib/brand/lx/config.xml b/overlay/generic/usr/lib/brand/lx/config.xml
deleted file mode 100644
index ba2192f8..00000000
--- a/overlay/generic/usr/lib/brand/lx/config.xml
+++ /dev/null
@@ -1,111 +0,0 @@
-<?xml version="1.0"?>
-
-<!--
- CDDL HEADER START
-
- The contents of this file are subject to the terms of the
- Common Development and Distribution License (the "License").
- You may not use this file except in compliance with the License.
-
- You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
- or http://www.opensolaris.org/os/licensing.
- See the License for the specific language governing permissions
- and limitations under the License.
-
- When distributing Covered Code, include this CDDL HEADER in each
- file and include the License file at usr/src/OPENSOLARIS.LICENSE.
- If applicable, add the following below this CDDL HEADER, with the
- fields enclosed by brackets "[]" replaced with your own identifying
- information: Portions Copyright [yyyy] [name of copyright owner]
-
- CDDL HEADER END
-
- Copyright (c) 2005, 2010, Oracle and/or its affiliates. All rights reserved.
- Copyright 2015, Joyent, Inc.
-
- DO NOT EDIT THIS FILE.
--->
-
-<!DOCTYPE brand PUBLIC "-//Sun Microsystems Inc//DTD Brands//EN"
-    "file:///usr/share/lib/xml/dtd/brand.dtd.1">
-
-<brand name="lx">
-	<modname>lx_brand</modname>
-
-	<initname>/native/usr/lib/brand/lx/lxinit</initname>
-	<login_cmd>/bin/login -h zone:%Z %u</login_cmd>
-	<forcedlogin_cmd>/bin/login -h zone:%Z -f %u</forcedlogin_cmd>
-	<user_cmd>/usr/bin/getent passwd %u</user_cmd>
-
-	<install>/usr/lib/brand/lx/lx_install -z %z -R %R</install>
-	<installopts>R:t:U:q:z:</installopts>
-	<boot>/usr/lib/brand/lx/lx_boot %z %R</boot>
-	<halt>/usr/lib/brand/lx/lx_support halt %R %z</halt>
-	<verify_cfg>/usr/lib/brand/lx/lx_support verify</verify_cfg>
-	<verify_adm></verify_adm>
-	<postclone></postclone>
-	<postinstall></postinstall>
-	<uninstall>/usr/lib/brand/lx/lx_uninstall -z %z -R %R</uninstall>
-	<prestatechange>/usr/lib/brand/lx/prestate %z %R</prestatechange>
-	<poststatechange>/usr/lib/brand/lx/poststate %z %R</poststatechange>
-
-	<privilege set="default" name="contract_event" />
-	<privilege set="default" name="contract_identity" />
-	<privilege set="default" name="contract_observer" />
-	<privilege set="default" name="dtrace_proc" />
-	<privilege set="default" name="dtrace_user" />
-	<privilege set="default" name="file_chown" />
-	<privilege set="default" name="file_chown_self" />
-	<privilege set="default" name="file_dac_execute" />
-	<privilege set="default" name="file_dac_read" />
-	<privilege set="default" name="file_dac_search" />
-	<privilege set="default" name="file_dac_write" />
-	<privilege set="default" name="file_owner" />
-	<privilege set="default" name="file_setid" />
-	<privilege set="default" name="ipc_dac_read" />
-	<privilege set="default" name="ipc_dac_write" />
-	<privilege set="default" name="ipc_owner" />
-	<privilege set="default" name="net_bindmlp" />
-	<privilege set="default" name="net_icmpaccess" />
-	<privilege set="default" name="net_mac_aware" />
-	<privilege set="default" name="net_privaddr" />
-	<privilege set="default" name="net_rawaccess" ip-type="exclusive" />
-	<privilege set="default" name="proc_chroot" />
-	<privilege set="default" name="sys_audit" />
-	<privilege set="default" name="proc_audit" />
-	<privilege set="default" name="proc_clock_highres" />
-	<privilege set="default" name="proc_lock_memory" />
-	<privilege set="default" name="proc_owner" />
-	<privilege set="default" name="proc_secflags" />
-	<privilege set="default" name="proc_setid" />
-	<privilege set="default" name="proc_prioup" />
-	<privilege set="default" name="proc_taskid" />
-	<privilege set="default" name="sys_acct" />
-	<privilege set="default" name="sys_admin" />
-	<privilege set="default" name="sys_fs_import" />
-	<privilege set="default" name="sys_ip_config" ip-type="exclusive" />
-	<privilege set="default" name="sys_iptun_config" ip-type="exclusive" />
-	<privilege set="default" name="sys_mount" />
-	<privilege set="default" name="sys_nfs" />
-	<privilege set="default" name="sys_smb" />
-	<privilege set="default" name="sys_resource" />
-	<privilege set="default" name="sys_ppp_config" ip-type="exclusive" />
-
-	<privilege set="prohibited" name="dtrace_kernel" />
-	<privilege set="prohibited" name="proc_zone" />
-	<privilege set="prohibited" name="sys_config" />
-	<privilege set="prohibited" name="sys_devices" />
-	<privilege set="prohibited" name="sys_ip_config" ip-type="shared" />
-	<privilege set="prohibited" name="sys_linkdir" />
-	<privilege set="prohibited" name="sys_net_config" />
-	<privilege set="prohibited" name="sys_ppp_config" ip-type="shared" />
-	<privilege set="prohibited" name="sys_res_config" />
-	<privilege set="prohibited" name="sys_suser_compat" />
-	<privilege set="prohibited" name="xvm_control" />
-	<privilege set="prohibited" name="virt_manage" />
-
-	<privilege set="required" name="proc_exec" />
-	<privilege set="required" name="proc_fork" />
-	<privilege set="required" name="sys_ip_config" ip-type="exclusive" />
-	<privilege set="required" name="sys_mount" />
-</brand>
diff --git a/overlay/generic/usr/lib/brand/lx/lx_boot_zone_docker b/overlay/generic/usr/lib/brand/lx/lx_boot_zone_docker
deleted file mode 100755
index 9d332a72..00000000
--- a/overlay/generic/usr/lib/brand/lx/lx_boot_zone_docker
+++ /dev/null
@@ -1,17 +0,0 @@
-#!/bin/ksh -p
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright 2014 Joyent, Inc.  All rights reserved.
-#
-
-# Hand control back to lx_boot
diff --git a/overlay/generic/usr/lib/brand/lx/lx_install b/overlay/generic/usr/lib/brand/lx/lx_install
deleted file mode 100755
index d979bb37..00000000
--- a/overlay/generic/usr/lib/brand/lx/lx_install
+++ /dev/null
@@ -1,62 +0,0 @@
-#!/bin/ksh -p
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright 2015 Joyent, Inc.
-#
-
-# Does this brand support reprovisioning?
-jst_reprovision="yes"
-
-# Is a template image optional?
-# jst_tmplopt="yes"
-
-. /usr/lib/brand/jcommon/libhooks.ksh
-
-function jcommon_attach_hook
-{
-	# lx-brand specific stuff is done here as final step of install
-
-	#
-	# Make sure the localhost has a hostname alias in the zone's
-	# /etc/hosts file
-	#
-	zroot=$ZONEPATH/root
-	hname=$ZONENAME
-	hostnamef=$zroot/etc/hostname
-	if [[ ! -h $hostnamef ]]; then
-		echo $hname >$hostnamef
-	fi
-
-	hostfile=$zroot/etc/hosts
-	if [[ -f $hostfile && ! -h $hostfile ]]; then
-		# use awk to search and append to loopback in one command
-		awk -v hname="$hname" '{
-		    if ($1 ~ /^127\./ && index($0, hname) == 0) {
-		        printf("%s %s\n", $0, hname);
-		    } else {
-		        print $0
-		    }
-		}' $hostfile >/tmp/tmp_${ZONENAME}_$$
-		mv /tmp/tmp_${ZONENAME}_$$ $hostfile
-		chmod 644 $hostfile
-	fi
-
-	rm -rf $ZONEPATH/cores
-	CORE_QUOTA=102400
-	zfs create -o quota=${CORE_QUOTA}m \
-	    -o mountpoint=/${PDS_NAME}/$bname/cores ${PDS_NAME}/cores/$bname
-
-	chmod 700 $ZONEPATH
-}
-
-. /usr/lib/brand/jcommon/cinstall
diff --git a/overlay/generic/usr/lib/brand/lx/lx_uninstall b/overlay/generic/usr/lib/brand/lx/lx_uninstall
deleted file mode 100755
index 136044ad..00000000
--- a/overlay/generic/usr/lib/brand/lx/lx_uninstall
+++ /dev/null
@@ -1,23 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-function jcommon_uninstall_hook
-{
-	:
-}
-
-. /usr/lib/brand/jcommon/cuninstall
diff --git a/overlay/generic/usr/lib/brand/lx/poststate b/overlay/generic/usr/lib/brand/lx/poststate
deleted file mode 100755
index 49370fce..00000000
--- a/overlay/generic/usr/lib/brand/lx/poststate
+++ /dev/null
@@ -1,19 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-ps_brand="lx"
-. /usr/lib/brand/jcommon/poststate
diff --git a/overlay/generic/usr/lib/brand/lx/prestate b/overlay/generic/usr/lib/brand/lx/prestate
deleted file mode 100755
index 04d9969a..00000000
--- a/overlay/generic/usr/lib/brand/lx/prestate
+++ /dev/null
@@ -1,19 +0,0 @@
-#!/bin/ksh -p
-#
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2014 Joyent, Inc.  All rights reserved.
-#
-
-ps_brand="lx"
-. /usr/lib/brand/jcommon/prestate
diff --git a/overlay/generic/usr/lib/brand/lx/statechange b/overlay/generic/usr/lib/brand/lx/statechange
deleted file mode 100755
index d0bc11ee..00000000
--- a/overlay/generic/usr/lib/brand/lx/statechange
+++ /dev/null
@@ -1,41 +0,0 @@
-#!/bin/ksh -p
-#
-# This file and its contents are supplied under the terms of the
-# Common Development and Distribution License ("CDDL"), version 1.0.
-# You may only use this file in accordance with the terms of version
-# 1.0 of the CDDL.
-#
-# A full copy of the text of the CDDL should have accompanied this
-# source.  A copy of the CDDL is also available via the Internet at
-# http://www.illumos.org/license/CDDL.
-#
-
-#
-# Copyright (c) 2018 Joyent, Inc.  All rights reserved.
-#
-
-# Do we support vrrp?
-# jst_vrrp="yes"
-
-# Do we support unfiltered promiscuous mode
-# jst_ufpromisc="yes"
-
-# Do we use vnd devices
-# jst_createvnd="yes"
-
-# Do we not need to have various SMF and ccs stuff created for us?
-jst_simplefs="yes"
-
-# Should we show snapshots?
-jst_showsnap="yes"
-
-# Where does the mdata socket live?
-jst_mdatapath="/native/.zonecontrol/"
-
-# Ensure docker zfd(7D) log is not put in the wrong place
-if [[ "$_ZONECFG_attr_docker" == true ]]; then
-	typeset -A FORCED_ATTRS
-	FORCED_ATTRS["zlog-name"]=
-fi
-
-. /usr/lib/brand/jcommon/statechange
diff --git a/overlay/generic/usr/lib/localedef/extensions/UTF-8.x b/overlay/generic/usr/lib/localedef/extensions/UTF-8.x
deleted file mode 100644
index b7ab359b..00000000
--- a/overlay/generic/usr/lib/localedef/extensions/UTF-8.x
+++ /dev/null
@@ -1,114 +0,0 @@
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").  
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-#
-# Copyright 1996-1997, 2000-2003 Sun Microsystems, Inc.  All rights reserved.
-# Use is subject to license terms.
-#
-# Method file for Solaris Unicode locales.
-#
-#
-#ident	"@(#)UTF-8.x	1.4 03/08/19 SMI"
-#
-
-METHODS
-
-#
-# Encoding definitions to use UTF-8 (MB) and UTF-32 (WC):
-file_code	utf8
-process_code	ucs4
-
-#
-# We use the following methods from the libc:
-iswctype@native	"__iswctype_std"        "libc" "/usr/lib/" "libc.so.1"
-towctrans@native "__towctrans_std"
-towlower@native	"__towlower_std"
-towupper@native "__towupper_std"
-trwctype        "__trwctype_std"
-wctrans         "__wctrans_std"
-wctype          "__wctype_std"
-
-mbsinit		"__mbsinit_gen"
-mbrlen		"__mbrlen_gen"
- 
-strcoll         "__strcoll_std"
-strxfrm         "__strxfrm_std"
-wcscoll         "__wcscoll_bc"
-wcscoll@native  "__wcscoll_std"
-wcsxfrm         "__wcsxfrm_bc"
-wcsxfrm@native  "__wcsxfrm_std"
-
-fnmatch         "__fnmatch_std"
-regcomp         "__regcomp_std"
-regexec         "__regexec_std"
-regerror        "__regerror_std"
-regfree         "__regfree_std"
-
-strfmon         "__strfmon_std"
-
-strftime        "__strftime_std"
-strptime        "__strptime_std"
-wcsftime        "__wcsftime_std"
-
-getdate         "__getdate_std"
-
-#
-# The methods designated at below are all Unicode locale-specific methods
-# coming from the methods_unicode.so.3 shared object:
-eucpctowc	"__u32_to_dense_u32_utf8"	"localelib" "/usr/lib/locale/common" "methods_unicode.so.3"
-wctoeucpc	"__dense_u32_to_u32_utf8"
-
-iswctype        "__iswctype_bc_utf8"
-towctrans       "__towctrans_bc_utf8"
-towlower        "__towlower_bc_utf8"
-towupper        "__towupper_bc_utf8"
-
-mbftowc		"__mbftowc_dense_utf8"
-mbftowc@native	"__mbftowc_dense_native_utf8"
-fgetwc		"__fgetwc_dense_utf8"
-fgetwc@native	"__fgetwc_dense_native_utf8"
-mblen		"__mblen_dense_utf8"
-mbstowcs	"__mbstowcs_dense_utf8"
-mbstowcs@native	"__mbstowcs_dense_native_utf8"
-mbtowc		"__mbtowc_dense_utf8"
-mbtowc@native	"__mbtowc_dense_native_utf8"
-wcstombs	"__wcstombs_dense_utf8"
-wcstombs@native	"__wcstombs_dense_native_utf8"
-wcswidth	"__wcswidth_dense_utf8"
-wcswidth@native	"__wcswidth_dense_utf8"
-wctomb		"__wctomb_dense_utf8"
-wctomb@native	"__wctomb_dense_native_utf8"
-wcwidth		"__wcwidth_dense_utf8"
-wcwidth@native	"__wcwidth_dense_utf8"
-
-btowc		"__btowc_dense_utf8"
-btowc@native	"__btowc_dense_utf8"
-wctob		"__wctob_dense_utf8"
-wctob@native	"__wctob_dense_utf8"
-mbrtowc		"__mbrtowc_dense_utf8"
-mbrtowc@native	"__mbrtowc_dense_native_utf8"
-wcrtomb		"__wcrtomb_dense_utf8"
-wcrtomb@native	"__wcrtomb_dense_native_utf8"
-mbsrtowcs	"__mbsrtowcs_dense_utf8"
-mbsrtowcs@native "__mbsrtowcs_dense_native_utf8"
-wcsrtombs	"__wcsrtombs_dense_utf8"
-wcsrtombs@native "__wcsrtombs_dense_native_utf8"
-
-END METHODS
diff --git a/overlay/generic/usr/sbin/fssstat b/overlay/generic/usr/sbin/fssstat
deleted file mode 100755
index 7feb7ffa..00000000
--- a/overlay/generic/usr/sbin/fssstat
+++ /dev/null
@@ -1,128 +0,0 @@
-#!/bin/bash
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-# Copyright 2012, Joyent, Inc.  All rights reserved.
-#
-
-PATH=/usr/bin:/usr/sbin
-export PATH
-
-count=-1
-
-shift $(( $OPTIND - 1 ))
-
-[[ "$1" > 0 ]] && count=$1
-
-/usr/sbin/dtrace -qn '
-
-inline int COUNTER     = '$count';
-
-dtrace:::BEGIN
-{
-        maxcnt = COUNTER;
-	cnt = 0;
-}
-
-fbt::fss_update:entry
-{
-	/*      pid tid zid prd tks opr npr prn ps% zrt  shu  fssp */
-	printf("%5s %6s %3s %3s %3s %3s %3s %3s %3s %5s %12s %14s\n",
-	    "pid",
-	    "tid",
-	    "zid",
-	    "prd",
-	    "tks",
-	    "opr",
-	    "npr",
-	    "prn",
-	    "ps%",
-	    "zrtck",
-	    "shusage",
-	    "prjuse");
-        self->t = 1;
-	cnt++;
-}
-
-fbt::fss_update:return
-/cnt == maxcnt/
-{
-        exit(0);
-}
-
-fbt::fss_update:return
-{
-        self->t = 0;
-}
-
-fbt::fss_newpri:entry
-/self->t/
-{
-	self->fpp = (fssproc_t *)arg0;
-	self->org_pri = self->fpp->fss_umdpri;
-	self->org_ticks = self->fpp->fss_ticks;
-}
-
-fbt::fss_newpri:return
-/self->t/
-{
-	/*      pid tid zid prd tks opr npr prn ps% zrt    shu  fssp */
-	printf("%5d %6d %3d %3d %3d %3d %3d %3d %3d %5d %12llu %14llu\n",
-	    self->fpp->fss_tp->t_procp->p_pidp->pid_id,
-	    self->fpp->fss_tp->t_did,
-	    self->fpp->fss_proj->fssp_fsszone->fssz_zone->zone_id,
-	    self->fpp->fss_proj->fssp_proj->kpj_id,
-	    self->org_ticks,
-	    self->org_pri,
-	    self->fpp->fss_umdpri,
-	    self->fpp->fss_proj->fssp_runnable,
-	    self->fpp->fss_proj->fssp_shr_pct / 10,
-	    self->fpp->fss_proj->fssp_fsszone->fssz_zone->zone_run_ticks,
-	    (unsigned long long)self->fpp->fss_proj->fssp_shusage,
-	    (unsigned long long)self->fpp->fss_proj->fssp_usage);
-
-	    /* (unsigned long long)self->fpp->fss_fsspri); */
-
-	self->org_pri = 0;
-	self->org_ticks = 0;
-	self->fpp = 0;
-}
-
-sdt:::fss-onproc
-{
-	this->fpp = (fssproc_t *)arg0;
-
-	/*      pid tid zid prd tks opr npr prn ps% zrt    shu  fssp */
-	printf("%5d %6d %3d %3d %3d %3d   * %3d %3d %5d %12llu %14llu\n",
-	    this->fpp->fss_tp->t_procp->p_pidp->pid_id,
-	    this->fpp->fss_tp->t_did,
-	    this->fpp->fss_proj->fssp_fsszone->fssz_zone->zone_id,
-	    this->fpp->fss_proj->fssp_proj->kpj_id,
-	    this->fpp->fss_ticks,
-	    this->fpp->fss_umdpri,
-	    this->fpp->fss_proj->fssp_runnable,
-	    this->fpp->fss_proj->fssp_shr_pct / 10,
-	    this->fpp->fss_proj->fssp_fsszone->fssz_zone->zone_run_ticks,
-	    (unsigned long long)this->fpp->fss_proj->fssp_shusage,
-	    (unsigned long long)this->fpp->fss_proj->fssp_usage);
-
-	    /* (unsigned long long)this->fpp->fss_fsspri); */
-}
-'
diff --git a/overlay/generic/usr/sbin/zonememstat b/overlay/generic/usr/sbin/zonememstat
deleted file mode 100755
index 2d2da157..00000000
--- a/overlay/generic/usr/sbin/zonememstat
+++ /dev/null
@@ -1,243 +0,0 @@
-#!/bin/sh
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-# Copyright 2016, Joyent, Inc.
-#
-
-unset LD_LIBRARY_PATH
-PATH=/usr/bin:/usr/sbin
-export PATH
-
-sum_proc()
-{
-	pmap -x $1 2>/dev/null | nawk '{
-		if ($1 == "Address") next
-		if ($1 == "total") next
-		if ($8 == "stack") {
-			stk_kb += $2
-			if ($3 != "-") stk_rss += $3
-			if ($4 != "-") stk_anon += $4
-			if ($5 != "-") stk_locked += $5
-		} else if ($8 == "heap") {
-			heap_kb += $2
-			if ($3 != "-") heap_rss += $3
-			if ($4 != "-") heap_anon += $4
-			if ($5 != "-") heap_locked += $5
-		} else if ($8 == "ism") {
-			shm_kb += $2
-			if ($3 != "-") shm_rss += $3
-			if ($4 != "-") shm_anon += $4
-			if ($5 != "-") shm_locked += $5
-		} else {
-			txt_kb += $2
-			if ($3 != "-") txt_rss += $3
-			if ($4 != "-") txt_anon += $4
-			if ($5 != "-") txt_locked += $5
-		}
-	}
-	END {
-		printf("stk %d %d %6d %d\n",
-		    stk_kb, stk_rss, stk_anon, stk_locked);
-		printf("heap %d %d %d %d\n",
-		    heap_kb, heap_rss, heap_anon, heap_locked);
-		printf("shm %d %d %d %d\n",
-		    shm_kb, shm_rss, shm_anon, shm_locked);
-		printf("txt %d %d %d %d\n",
-		    txt_kb, txt_rss, txt_anon, txt_locked);
-	}'
-}
-
-sum_zone()
-{
-	for p in `ls $2/root/proc`
-	do
-		sum_proc $p
-	done
-}
-
-do_proc()
-{
-	printf "    %8s %8s %8s %8s %8s %8s %8s %8s\n" \
-	    "txtrss" "stkrss" "stkanon" "heaprss" "heapanon" "heaplck" \
-	    "shmrss" "shmlck"
-	for z in `zoneadm list`
-	do
-		[ $z == "global" ] && continue
-		[[ "$ZONENAME" != "ALL" && "$ZONENAME" != "$z" ]] && continue
-		echo "$z"
-		zpath=`zonecfg -z $z info zonepath | cut -d' ' -f2`
-		sum_zone $z $zpath | nawk '{
-			if ($1 == "stk") {
-				stk_kb += $2
-				stk_rss += $3
-				stk_anon += $4
-				stk_locked += $5
-			} else if ($1 == "heap") {
-				heap_kb += $2
-				heap_rss += $3
-				heap_anon += $4
-				heap_locked += $5
-			} else if ($1 == "shm") {
-				shm_kb += $2
-				shm_rss += $3
-				shm_anon += $4
-				shm_locked += $5
-			} else {
-				txt_kb += $2
-				txt_rss += $3
-				txt_anon += $4
-				txt_locked += $5
-			}
-		}
-		END {
-			printf("    %8d %8d %8d %8d %8d %8d %8d %8d\n",
-			    txt_rss,
-			    stk_rss, stk_anon,
-			    heap_rss, heap_anon, heap_locked,
-			    shm_rss, shm_locked);
-		}'
-	done
-
-	exit 0;
-}
-
-usage() {
-	echo 'zonememstat [-athH] [-p | -o] [-z zonename]'
-}
-
-HEADER=1
-OVER=0
-SUMMARY=0
-SHOW_ALIAS=0
-ZONENAME="ALL"
-TOTAL=0
-
-while getopts "aoHhptz:" opt
-do
-	case "$opt" in
-	a)	SHOW_ALIAS=1;;
-	H)	HEADER=0;;
-	p)	SUMMARY=1;;
-	o)	OVER=1;;
-	t)	TOTAL=1;;
-	z)	ZONENAME=$OPTARG;;
-	h)	usage; exit 0;;
-	*)	usage; exit 1;;
-	esac
-done
-shift OPTIND-1
-
-[ $SUMMARY == 1 ] && do_proc
-
-kstat -m memory_cap -c zone_memory_cap | nawk \
-    -v "show_alias=$SHOW_ALIAS" \
-    -v "zname=$ZONENAME" \
-    -v "over=$OVER" \
-    -v "total=$TOTAL" \
-    -v "header=$HEADER" \
-    'BEGIN {
-	# is gz if cap is UINT64_MAX / 1048576
-	maxcap = 2147483000;
-	OFMT = "%.2f"
-	if (show_alias == 1) {
-		alias_len = 12
-		while ("vmadm list -o zonename,alias -H" | getline) {
-		    zone_alias[$1] = $2
-		    if (length($2) > alias_len) {
-			alias_len = length($2);
-		    }
-                }
-		if (header)
-			printf("%37s %*s %8s %6s %8s %9s %5s\n", \
-			    "ZONE", alias_len, "ALIAS", \
-			    "RSS(MB)", "CAP(MB)", "NOVER", "POUT(MB)", \
-			    "SWAP%");
-	} else {
-		if (header)
-			printf("%37s %8s %8s %6s %9s %5s\n", \
-			    "ZONE", "RSS(MB)", "CAP(MB)", "NOVER", "POUT(MB)", \
-			    "SWAP%");
-	}
-    }
-    {
-	if ($1 == "nover") {
-		nover = $2
-		nover_t += nover
-	} else if ($1 == "pagedout") {
-		pout = $2 / 1048576
-		pout_t += pout
-	} else if ($1 == "physcap") {
-		cap = $2 / 1048576
-		if (cap < maxcap)
-			cap_t += cap
-	} else if ($1 == "rss") {
-		rss = $2 / 1048576
-		rss_t += rss
-	} else if ($1 == "swap") {
-		swap = $2 / 1048576
-	} else if ($1 == "swapcap") {
-		swapcap = $2 / 1048576
-	} else if ($1 == "zonename") {
-		if (zname != "ALL" && zname != $2)
-			next
-		if (over == 1 && nover == 0)
-			next
-		alias=zone_alias[$2]
-		if (length(alias) == 0)
-		    alias = "-"
-
-		if (swapcap >= maxcap) {
-			swappct = "-"
-		} else {
-			swappct = (swap / swapcap) * 100
-		}
-
-		# If cap is UINT64_MAX / 1048576
-		if (cap >= maxcap) {
-			if (show_alias == 1)
-				printf("%37s %*s %8u %6s %8s %9s %5s\n",
-				    $2, alias_len, alias, rss, "-", "-", "-",
-				    swappct);
-			else
-				printf("%37s %8u %8s %6s %9s %5s\n",
-				    $2, rss, "-", "-", "-", swappct);
-		} else {
-			if (show_alias == 1)
-				printf("%37s %*s %8u %6u %8u %9u %5s\n",
-				    $2, alias_len, alias, rss, cap, nover,
-				    pout, swappct);
-			else
-				printf("%37s %8u %8u %6u %9u %5s\n",
-				    $2, rss, cap, nover, pout, swappct);
-		}
-	}
-    }
-    END {
-	if (total == 1) {
-		if (show_alias == 1)
-			printf("%37s %*s %8u %6u %8u %9u %5s\n",
-			    "total", alias_len, "-", rss_t, cap_t,
-			    nover_t, pout_t, "-");
-		else
-			printf("%37s %8u %8u %6u %9u %5s\n",
-			    "total", rss_t, cap_t, nover_t, pout_t, "-");
-	}
-    }'
diff --git a/overlay/generic/usr/sbin/zonemon b/overlay/generic/usr/sbin/zonemon
deleted file mode 100755
index c3130e86..00000000
--- a/overlay/generic/usr/sbin/zonemon
+++ /dev/null
@@ -1,260 +0,0 @@
-#!/usr/bin/ksh -p
-#
-# CDDL HEADER START
-#
-# The contents of this file are subject to the terms of the
-# Common Development and Distribution License (the "License").
-# You may not use this file except in compliance with the License.
-#
-# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
-# or http://www.opensolaris.org/os/licensing.
-# See the License for the specific language governing permissions
-# and limitations under the License.
-#
-# When distributing Covered Code, include this CDDL HEADER in each
-# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
-# If applicable, add the following below this CDDL HEADER, with the
-# fields enclosed by brackets "[]" replaced with your own identifying
-# information: Portions Copyright [yyyy] [name of copyright owner]
-#
-# CDDL HEADER END
-#
-# Copyright 2012 Joyent, Inc.  All rights reserved.
-# Use is subject to license terms.
-#
-
-unset LD_LIBRARY_PATH
-PATH=/usr/bin:/usr/sbin
-export PATH
-
-myzone=`zonename`
-
-if [[ $myzone != "global" ]]; then
-	echo "zonemon can only be run in the global zone"
-	exit 1
-fi
-
-show_kernel()
-{
-    echo "Kernel state:"
-    echo "::zone" | mdb -k | nawk '{
-	print $0
-	if ($3 == "STATUS") next
-	if ($3 != "running")
-		hung[$1]=$2
-    } END {
-	for (i in hung) {
-		printf("Zone %d hung - references\n", hung[i]);
-		cmd = "echo \"" i "::zone -rv\" | mdb -k"
-		system(cmd);
-	}
-        for (i in hung) {
-		printf("Zone %d hung - zsd\n", hung[i]);
-		cmd = "echo \"" i "::walk zsd | ::print struct zsd_entry\"" \
-		    "| mdb -k"
-		system(cmd);
-	}
-
-	for (i in hung) {
-		printf("Zone %d hung - processes\n", hung[i]);
-		cmd = "echo \"::ps -z\" | mdb -k | nawk -v zid=" hung[i] \
-		    " \047{if ($6 == zid) print $0}\047"
-		system(cmd);
-	}
-    }'
-}
-
-show_zone_up_down()
-{
-	exec /usr/sbin/dtrace -n '
-	#pragma D option quiet
-        #pragma D option bufsize=16k
-
-	inline string ZONENAME = "'$ZONENAME'";
-
-	dtrace:::BEGIN
-	{
-		zname = ZONENAME;
-	}
-
-	/*
-	 * arg1 is zone_status_t
-	 *	ZONE_IS_UNINITIALIZED = 0
-	 *	ZONE_IS_INITIALIZED
-	 *	ZONE_IS_READY
-	 *	ZONE_IS_BOOTING
-	 *	ZONE_IS_RUNNING
-	 *	ZONE_IS_SHUTTING_DOWN
-	 *	ZONE_IS_EMPTY
-	 *	ZONE_IS_DOWN
-	 *	ZONE_IS_DYING
-	 *	ZONE_IS_DEAD
-	 */
-	fbt::zone_status_set:entry
-	/stringof(((zone_t *)arg0)->zone_name) == zname &&
-	    (arg1 == 4 || arg1 == 5)/
-	{
-		printf("%13s %3d %s\n",
-		    (arg1 == 4 ? "running" : "shutting_down"), arg1,
-		    stringof(((zone_t *)arg0)->zone_name));
-	}
-	'
-	exit 0
-}
-
-show_all_zone_up_down()
-{
-	exec /usr/sbin/dtrace -n '
-	#pragma D option quiet
-
-	/*
-	 * arg1 is zone_status_t
-	 *	ZONE_IS_UNINITIALIZED = 0
-	 *	ZONE_IS_INITIALIZED
-	 *	ZONE_IS_READY
-	 *	ZONE_IS_BOOTING
-	 *	ZONE_IS_RUNNING
-	 *	ZONE_IS_SHUTTING_DOWN
-	 *	ZONE_IS_EMPTY
-	 *	ZONE_IS_DOWN
-	 *	ZONE_IS_DYING
-	 *	ZONE_IS_DEAD
-	 */
-	fbt::zone_status_set:entry
-	/arg1 == 4 || arg1 == 5/
-	{
-		printf("%13s %3d %s\n",
-		    (arg1 == 4 ? "running" : "shutting_down"), arg1,
-		    stringof(((zone_t *)arg0)->zone_name));
-	}
-	'
-	exit 0
-}
-
-show_zone_trans()
-{
-	echo "State Transitions:"
-
-	exec /usr/sbin/dtrace -n '
-	#pragma D option quiet
-
-	fbt::zone_create:entry
-	{
-		this->zonename = stringof(copyinstr(arg0));
-		printf("%Y %15s   - %s\n", walltimestamp, probefunc,
-		    this->zonename);
-	}
-
-	fbt::zone_create:return
-	/errno != 0/
-	{
-		printf("%Y %15s    - %s failed, errno %d\n", walltimestamp,
-		    probefunc, this->zonename, errno);
-		this->zonename=0;
-	}
-
-	fbt::zone_create:return
-	/errno == 0/
-	{
-		printf("%Y %15s %3d %s\n", walltimestamp, probefunc, arg1,
-		     this->zonename);
-		this->zonename=0;
-	}
-
-	fbt::zsched:entry
-	{
-		printf("%Y %15s %3d\n", walltimestamp, probefunc,
-		    ((struct zsched_arg *)args[0])->zone->zone_id);
-	}
-
-	fbt::zone_start_init:entry
-	{
-       	 printf("%Y %15s %3d\n", walltimestamp, probefunc,
-	    curpsinfo->pr_zoneid);
-	}
-
-	fbt::zone_boot:entry
-	{
-		this->zoneid=args[0];
-	}
-
-	fbt::zone_boot:return
-	/errno != 0/
-	{
-		printf("%Y %15s %3d failed, errno %d\n", walltimestamp,
-		    probefunc, this->zoneid, errno);
-		this->zoneid=0;
-	}
-
-	fbt::zone_boot:return
-	/errno == 0/
-	{
-		printf("%Y %15s %3d\n", walltimestamp, probefunc, this->zoneid);
-		this->zoneid=0;
-	}
-
-	fbt::zone_empty:entry
-	{
-		this->zoneid=((zone_t *)args[0])->zone_id;
-		printf("%Y %15s %3d start\n", walltimestamp, probefunc,
-		    this->zoneid);
-	}
-
-	fbt::zone_empty:return
-	{
-		printf("%Y %15s %3d return\n", walltimestamp, probefunc,
-		    this->zoneid);
-		this->zoneid=0;
-	}
-
-	fbt::zone_shutdown:entry,
-	fbt::zone_destroy:entry
-	{
-		printf("%Y %15s %3d\n", walltimestamp, probefunc, args[0]);
-		this->zoneid=args[0];
-	}
-
-	fbt::zone_shutdown:return,
-	fbt::zone_destroy:return
-	/errno != 0/
-	{
-		printf("%Y %15s %3d failed, errno %d\n", walltimestamp,
-		    probefunc, this->zoneid, errno);
-		this->zoneid=0;
-	}
-
-	fbt::zone_shutdown:return,
-	fbt::zone_destroy:return
-	/errno == 0/
-	{
-		this->zoneid=0;
-	}
-	'
-
-	exit 0
-}
-
-do_kern=0
-do_mon=0
-do_up_down=0
-do_all_up_down=0
-
-while getopts "kwz:Z" opt
-do
-	case "$opt" in
-		k)	do_kern=1;;
-		w)	do_mon=1;;
-		z)	do_up_down=1
-			ZONENAME=$OPTARG
-			;;
-		Z)	do_all_up_down=1;;
-		*)	printf "zonemon [-k] [-w | -z zonename | -Z]\n"
-			exit 1;;
-	esac
-done
-shift OPTIND-1
-
-(( $do_kern == 1 )) && show_kernel
-(( $do_up_down == 1 )) && show_zone_up_down
-(( $do_all_up_down == 1 )) && show_all_zone_up_down
-(( $do_mon == 1 )) && show_zone_trans
diff --git a/overlay/generic/usr/share/bhyve/README b/overlay/generic/usr/share/bhyve/README
deleted file mode 100644
index a1bb7a08..00000000
--- a/overlay/generic/usr/share/bhyve/README
+++ /dev/null
@@ -1,6 +0,0 @@
-The uefi-csm-rom.bin file is a binary generated from the uefi-edk2 package
-shipped in illumos-extra.  At the time of this writing, facilitating an
-isolated build of the uefi ROM was difficult thanks to its dependency on iasl
-to compile the ACPI tables it ships.  While it is excluded from the build until
-those issues are solved, the ROM can be built from those sources (and patches)
-provided a working iasl can be configured for the task.
diff --git a/overlay/generic/usr/share/bhyve/uefi-csm-rom.bin b/overlay/generic/usr/share/bhyve/uefi-csm-rom.bin
deleted file mode 100755
index a90f7760..00000000
Binary files a/overlay/generic/usr/share/bhyve/uefi-csm-rom.bin and /dev/null differ
diff --git a/overlay/generic/usr/share/bhyve/uefi-rom.bin b/overlay/generic/usr/share/bhyve/uefi-rom.bin
deleted file mode 100755
index ba2214a4..00000000
Binary files a/overlay/generic/usr/share/bhyve/uefi-rom.bin and /dev/null differ
diff --git a/overlay/generic/usr/share/man/man1/json.1 b/overlay/generic/usr/share/man/man1/json.1
deleted file mode 100644
index 6573d2f0..00000000
--- a/overlay/generic/usr/share/man/man1/json.1
+++ /dev/null
@@ -1,917 +0,0 @@
-.\" generated with Ronn/v0.7.3
-.\" http://github.com/rtomayko/ronn/tree/0.7.3
-.
-.TH "JSON" "1" "July 2012" "" "json tool manual"
-.
-.SH "NAME"
-\fBjson\fR \- (aka "jsontool") JSON love for your command line\.
-.
-.SH "SYNOPSIS"
-something\-generating\-JSON\-on\-stdout | \fBjson\fR [OPTIONS] [LOOKUPS]
-.
-.P
-\fBjson\fR \-f FILE [OPTIONS] [LOOKUPS\.\.\.]
-.
-.SH "DESCRIPTION"
-Pipe in your JSON for pretty\-printing, JSON validation, filtering, and modification\. Supply one or more \fBLOOKUPS\fR to extract a subset of the JSON\. HTTP header blocks are skipped by default\.
-.
-.SS "Grouping"
-(Added in json v4\.) Use \'\-g\' or \'\-\-group\' to group objects (into an array of objects) or concatenate arrays (into a single array) separated by no space or by a newline\. This can be helpful for, e\.g\.:
-.
-.IP "" 4
-.
-.nf
-
-$ cat *\.json | json \-g \.\.\.
-.
-.fi
-.
-.IP "" 0
-.
-.P
-and similar\.
-.
-.P
-In json v3 and earlier, this used to be called "auto\-arrayification" and was implicit\. See the \fICOMPATIBILITY\fR section below\.
-.
-.SS "Merging"
-(Added in json v4\.) Use \'\-\-merge\' or \'\-\-deep\-merge\' to merge adjacent JSON objects in the input\. Keys in the last object win\.
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'{"one":"un","two":"deux"}
-{"one":"uno","three":"tres"}\' | json \-\-merge
-{
-  "one": "uno",
-  "two": "deux",
-  "three": "tres"
-}
-.
-.fi
-.
-.IP "" 0
-.
-.P
-This could be useful for merging multiple config files, e\.g\.:
-.
-.IP "" 4
-.
-.nf
-
-$ cat /opt/app/etc/defaults\.json \e
-    /etc/app/config\.json \e
-    ~/\.app/config\.json | json \-\-merge
-\.\.\.
-.
-.fi
-.
-.IP "" 0
-.
-.SS "Execution"
-Use the \fB\-e CODE\fR option to execute code on the input JSON\.
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'{"name":"trent","age":38}\' | json \-e \'age++\'
-{
-  "name": "trent",
-  "age": 39
-}
-.
-.fi
-.
-.IP "" 0
-.
-.P
-If input is an array, this will automatically process each item separately\.
-.
-.SS "Conditional filtering"
-Use the \fB\-c CODE\fR option to filter the input JSON\.
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'[{"age":38},{"age":4}]\' | json \-c \'age>21\'
-[{"age":38}]
-.
-.fi
-.
-.IP "" 0
-.
-.P
-If input is an array, this will automatically process each item separately\.
-.
-.SS "Lookups"
-Use lookup arguments to extract particular values:
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'{"name":"trent","age":38}\' | json name
-trent
-.
-.fi
-.
-.IP "" 0
-.
-.P
-Use \fB\-a\fR for \fIarray processing\fR of lookups and \fItabular output\fR:
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'{"name":"trent","age":38}\' | json name
-trent
-$ echo \'[{"name":"trent","age":38},
-         {"name":"ewan","age":4}]\' | json \-a name age
-trent 38
-ewan 4
-.
-.fi
-.
-.IP "" 0
-.
-.P
-Integral values work for array index lookups:
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'["a", "b", "c"]\' | json 1
-b
-.
-.fi
-.
-.IP "" 0
-.
-.P
-Negative array indeces are also supported:
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'["a", "b", "c"]\' | json \-1
-c
-$ echo \'["a", "b", "c"]\' | json \-2
-b
-.
-.fi
-.
-.IP "" 0
-.
-.SS "Pretty\-printing"
-Output is "jsony" by default: 2\-space indented JSON with one exception, a single string value is printed without quotes\.
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'{"name": "trent", "age": 38}\' | json
-{
-  "name": "trent",
-  "age": 38
-}
-.
-.fi
-.
-.IP "" 0
-.
-.P
-Use \fB\-o json\fR for explicit JSON, \fB\-o json\-N\fR for N\-space indent:
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'{"name": "trent", "age": 38}\' | json \-o json\-0
-{"name":"trent","age":38}
-.
-.fi
-.
-.IP "" 0
-.
-.P
-Use \fB\-H\fR to exclude a leading HTTP header block as from \fBcurl \-i\fR\.
-.
-.SS "Listing keys"
-Sometimes you want the list of keys for an object\. Use \fB\-k\fR or \fB\-\-keys\fR for that:
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'{"name": "trent", "age": 38}\' | json \-k
-[
-  "name",
-  "age"
-]
-$ echo \'{"name": "trent", "age": 38}\' | json \-ka
-name
-age
-.
-.fi
-.
-.IP "" 0
-.
-.SH "OPTIONS"
-.
-.TP
-\fB\-h\fR, \fB\-\-help\fR
-Print this help info and exit\.
-.
-.TP
-\fB\-\-version\fR
-Print version of this command and exit\.
-.
-.TP
-\fB\-q, \-\-quiet\fR
-Don\'t warn if input isn\'t valid JSON\.
-.
-.P
-By default \fBjson\fR will process input from stdin\. Alternative, an input file (or files) can be specified:
-.
-.TP
-\fB\-f FILE\fR
-Specify an input file (instead of stdin)\.
-.
-.P
-If your JSON output is a REST API response, it might include the headers (e\.g\. when calling with \fBcurl \-i\fR)\. By default \fBjson\fR will pass those headers through (without choking on them)\. However if you want them stripped you can use:
-.
-.TP
-\fB\-H\fR
-drop any HTTP header block (as from \fBcurl \-i \.\.\.\fR)
-.
-.P
-Other pre\-JSON input handling:
-.
-.TP
-\fB\-g\fR, \fB\-\-group\fR
-Group adjacent objects into an array of objects, or concatenate adjacent arrays into a single array\.
-.
-.TP
-\fB\-\-merge\fR, \fB\-\-deep\-merge\fR
-Merge adjacent objects into a single object with merged keys\. Values in later objects win\. Use \fB\-\-deep\-merge\fR to recursively merge keys in objects\.
-.
-.P
-You can process elements of an input array separately and generate tabular output:
-.
-.TP
-\fB\-a\fR, \fB\-\-array\fR
-Process input as an array of separate inputs and output in tabular form\.
-.
-.TP
-\fB\-d DELIM\fR
-Delimiter character for tabular output (default is \' \')\.
-.
-.TP
-\fB\-A\fR
-Process input as a single object, i\.e\. stop \fB\-e\fR and \fB\-c\fR automatically processing each item of an input array\.
-.
-.P
-You can execute code on (\fB\-e\fR) and filter (\fB\-c\fR) the input (this is done before LOOKUPS are processed, if any)\. If datum is an object, then a shortcut is \fB<key>\fR\. To remove a key, use \fBthis\.<key> = undefined\fR\. For array items, use \fBthis[<index>] = 42\fR\.
-.
-.TP
-\fB\-e CODE\fR
-Execute the given code on the input\. If input is an array, then each item of the array is processed separately (use \fB\-A\fR to override)\.
-.
-.TP
-\fB\-c CODE\fR
-Filter the input with \fBCODE\fR\. If \fBCODE\fR returns false\-y, then the item is filtered out\. If input is an array, then each item of the array is processed separately (use \fB\-A\fR to override)\.
-.
-.P
-Finally, if \fBLOOKUP\fR arguments are given, these are extracted from the JSON\. By default \fB\.\fR is used as a separator for nested object lookup\. This can be overridden:
-.
-.TP
-\fB\-D DELIM\fR
-Delimiter char between LOOKUPS (default is \'\.\')\. For example: \fB$ echo \'{"a\.b": {"b": 1}}\' | json \-D / a\.b/b\fR
-.
-.P
-An alternative to lookups is to output the keys of the input object:
-.
-.TP
-\fB\-k\fR, \fB\-\-keys\fR
-Output the input object\'s keys\.
-.
-.P
-\fBjson\fR can be restricting to just validating its input, i\.e\. processing and output of the input is skipped:
-.
-.TP
-\fB\-\-validate\fR
-Just validate the input, no processing or output of the JSON content\.
-.
-.P
-By default \fBjson\fR outputs in "jsony" mode\. Basically this is JSON output, with the exception that a single string output value is emitted without the quotes\. The intention here is to be of most use to the UNIX command\-line\. Other output formats are supported:
-.
-.TP
-\fB\-o MODE\fR, \fB\-\-output MODE\fR
-Specify an output mode\. One of \fBjsony\fR (the default; JSON, if a single string then quotes are elided), \fBjson\fR (JSON output, 2\-space indent), \fBjson\-N\fR (JSON output, N\-space indent, e\.g\. \'json\-4\'), or \fBinspect\fR (node\.js \fButil\.inspect\fR output)\.
-.
-.TP
-\fB\-i\fR
-Shortcut for \fB\-o inspect\fR\.
-.
-.TP
-\fB\-j\fR
-Shortcut for \fB\-o json\fR\.
-.
-.SH "EXAMPLES"
-A typical JSON REST API response:
-.
-.IP "" 4
-.
-.nf
-
-$ curl \-s http://ifconfig\.me/all\.json
-{"connection":"","ip_addr":"216\.57\.203\.67","lang":"","remote_host":\.\.\.
-.
-.fi
-.
-.IP "" 0
-.
-.P
-\fBNice output by default\fR:
-.
-.IP "" 4
-.
-.nf
-
-$ curl \-s http://ifconfig\.me/all\.json | json
-{
-  "connection": "",
-  "ip_addr": "201\.73\.103\.12",
-  "lang": "",
-  "remote_host": "",
-  "user_agent": "curl/7\.23\.1 (i386\-sun\-solaris2\.11) libcurl/7\.23\.1 OpenSSL/0\.9\.8w zlib/1\.2\.3 libidn/1\.23 libssh2/1\.2\.2",
-  "charset": "",
-  "port": "63713",
-  "via": "",
-  "forwarded": "",
-  "mime": "*/*",
-  "keep_alive": "",
-  "encoding": ""
-}
-.
-.fi
-.
-.IP "" 0
-.
-.P
-Say you just want to \fBextract one value\fR:
-.
-.IP "" 4
-.
-.nf
-
-$ curl \-s http://ifconfig\.me/all\.json | json ip_addr
-201\.73\.103\.12
-.
-.fi
-.
-.IP "" 0
-.
-.P
-Or, looking at the node\.js project \fIhttps://github\.com/joyent/node\fR using the Github API:
-.
-.IP "" 4
-.
-.nf
-
-$ curl \-s https://api\.github\.com/repos/joyent/node | json open_issues
-517
-.
-.fi
-.
-.IP "" 0
-.
-.P
-If you use \fBcurl \-i\fR to get HTTP headers (because perhaps they contain relevant information), \fBjson will skip the HTTP headers automatically\fR:
-.
-.IP "" 4
-.
-.nf
-
-$ curl \-is https://api\.github\.com/repos/joyent/node | json
-HTTP/1\.1 200 OK
-Server: nginx/1\.0\.13
-Date: Tue, 24 Jul 2012 04:01:08 GMT
-Content\-Type: application/json; charset=utf\-8
-Connection: keep\-alive
-Status: 200 OK
-ETag: "1a21d980a01768dde42145ce2b58694c"
-X\-RateLimit\-Remaining: 4997
-Content\-Length: 1513
-Cache\-Control: public, max\-age=60
-Vary: Accept
-X\-RateLimit\-Limit: 5000
-Last\-Modified: Tue, 24 Jul 2012 03:50:11 GMT
-
-{
-  "master_branch": "master",
-  "has_issues": true,
-  "has_downloads": false,
-  "homepage": "http://nodejs\.org/",
-  "html_url": "https://github\.com/joyent/node",
-\.\.\.
-.
-.fi
-.
-.IP "" 0
-.
-.P
-Or, say you are stuck with the headers in your pipeline, \fB\'json \-H\' will drop HTTP headers\fR:
-.
-.IP "" 4
-.
-.nf
-
-$ curl \-is https://api\.github\.com/repos/joyent/node | json \-H forks
-2158
-.
-.fi
-.
-.IP "" 0
-.
-.P
-Here is \fBan example that shows indexing a list\fR\. (The given "lookup" argument is basically JavaScript code appended, with \'\.\' if necessary, to the JSON data and eval\'d\.)
-.
-.IP "" 4
-.
-.nf
-
-$ curl \-s https://api\.github\.com/legacy/repos/search/nodejs \e
-    | json \'repositories[2]\.name\'
-socket\.io
-.
-.fi
-.
-.IP "" 0
-.
-.P
-Having the quote to avoid shell interpretation of \'[\' is annoying, so \fBjson\fR allows a special case for an integer lookup:
-.
-.IP "" 4
-.
-.nf
-
-$ curl \-s https://api\.github\.com/legacy/repos/search/nodejs \e
-    | json \'repositories\.2\.name\'
-socket\.io
-.
-.fi
-.
-.IP "" 0
-.
-.SS "Array processing with \-a"
-\fBjson\fR includes the \fB\-a\fR (aka \fB\-\-array\fR) option for \fBprocessing each element of an input JSON array independently\fR and \fBusing tabular output\fR\. Let\'s first get a list of open node\.js issues (note that this is a subset because of GH API pagination \fIhttp://developer\.github\.com/v3/#pagination\fR):
-.
-.IP "" 4
-.
-.nf
-
-$ curl \-s https://api\.github\.com/repos/joyent/node/issues?state=open\e&per_page=100
-[
-  {
-    "number": 3757,
-    "html_url": "https://github\.com/joyent/node/issues/3757",
-    "body": "Fix #3756\.\en\enReview, please: @TooTallNate",
-    "milestone": null,
-    "user": {
-      "gravatar_id": "73a2b24daecb976af81e010b7a3ce3c6",
-      "login": "isaacs",
-      "avatar_url": "https://secure\.gravatar\.com/avatar/73a2b24dae\.\.\.
-\.\.\.
-.
-.fi
-.
-.IP "" 0
-.
-.P
-We can then print a table with just some fields as follows:
-.
-.IP "" 4
-.
-.nf
-
-$ curl \-s https://api\.github\.com/repos/joyent/node/issues?state=open\e&per_page=100 \e
-    | json \-a comments number title
-0 3757 readline: Remove event listeners on close
-0 3756 readline: No way to completely unhook interface from input/output
-1 3755 node\-v0\.6\.20 hello example segfaults on RaspberryPi (w/Arch + bash)
-0 3753 Prohibit same listeners in EventEmitter\. Closes #964\.
-1 3752 Auto\-detect hardfloat eabi and armv7 variables on ARM based on compiler
-3 3751 persistent REPL history
-0 3749 glibc errors on SheevaPlug / Debian Squeeze
-\.\.\.
-.
-.fi
-.
-.IP "" 0
-.
-.P
-Ultimately this can be useful for then using other command\-line tools\. For example, we could get the list of top\-five most commented open node issues:
-.
-.IP "" 4
-.
-.nf
-
-$ curl \-s https://api\.github\.com/repos/joyent/node/issues?state=open\e&per_page=100 \e
-    | json \-a comments number title | sort \-n  | tail \-5
-9 3510 Automatically `\.toString()` functions in REPL\.
-11 3668 JSON documentation index listing
-12 3624 Add a return value to Buffer\.write* methods that returns the \.\.\.
-12 3655 defer dgram listening event
-14 3613 Connections closed by node stay permanently in FIN_WAIT2
-.
-.fi
-.
-.IP "" 0
-.
-.P
-Or get a breakdown by ISO language code of the recent tweets mentioning "nodejs":
-.
-.IP "" 4
-.
-.nf
-
-$ curl \-s http://search\.twitter\.com/search\.json?q=nodejs\e&rpp=100 \e
-    | json results | json \-a iso_language_code | sort | uniq \-c | sort
-   1 es
-   1 no
-   1 th
-   4 ru
-  12 ja
-  23 pt
-  58 en
-.
-.fi
-.
-.IP "" 0
-.
-.P
-The \fB\fB\-d\fR option can be used to specify a delimiter\fR:
-.
-.IP "" 4
-.
-.nf
-
-$ curl \-s https://api\.github\.com/repos/joyent/node/issues?state=open \e
-        | json \-a created_at number title \-d,
-2012\-07\-24T03:45:03Z,3757,readline: Remove event listeners on close
-2012\-07\-24T03:32:10Z,3756,readline: No way to completely unhook inte\.\.\.
-2012\-07\-23T21:17:50Z,3755,node\-v0\.6\.20 hello example segfaults on Ra\.\.\.
-2012\-07\-22T16:17:49Z,3753,Prohibit same listeners in EventEmitter\. C\.\.\.
-2012\-07\-22T13:43:40Z,3752,Auto\-detect hardfloat eabi and armv7 varia\.\.\.
-.
-.fi
-.
-.IP "" 0
-.
-.SS "Grouping"
-You can use the \fB\'\-g\' or \'\-\-group\' option to group adjacent objects\fR into an array of those objects; or to concatenate adjacent arrays into a single array\. To attempt to avoid false positives inside JSON strings, \fIadjacent\fR elements must have either no whitespace separation or at least a newline separation\. Examples:
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'{"a":1}{"b":2}\' | json \-g       # group into array of objects
-[
-  {
-    "a": 1
-  },
-  {
-    "b": 2
-  }
-]
-$ echo \'[1,2][3,4]\' | json \-g           # concantenate into one array
-[
-  1,
-  2,
-  3,
-  4
-]
-.
-.fi
-.
-.IP "" 0
-.
-.P
-This can be useful when processing a number of JSON files, e\.g\.:
-.
-.IP "" 4
-.
-.nf
-
-$ cat my_data/*\.json | json \-g \.\.\.
-.
-.fi
-.
-.IP "" 0
-.
-.P
-Or when composing multiple JSON API response, e\.g\. this somewhat contrived search for node\.js bugs mentioning "tty" or "windows":
-.
-.IP "" 4
-.
-.nf
-
-$ echo tty windows | xargs \-n1 \-I{} curl \-s \e
-    https://api\.github\.com/legacy/issues/search/joyent/node/open/{} \e
-    | json \-g \-a issues | json \-g \-a number title
-623 Non\-userfacing native modules should be prefixed with _
-861 child_process fails after stdin close
-1157 `child_process` module should read / write password prompts
-1180 Ctrl+Shift+BS can\'t be input\.
-\.\.\.
-.
-.fi
-.
-.IP "" 0
-.
-.SS "Output formatting"
-You can use the \'\-o MODE\' option (or \'\-\-output MODE\') to control the output flavour\. By default the output is "jsony" (JSON, except that a simple string is printed \fIwithout the quotes\fR):
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'[{"name": "Trent"},{"name": "Ewan"}]\' | json
-[
-  {
-    "name": "Trent"
-  },
-  {
-    "name": "Ewan"
-  }
-]
-
-$ echo \'[{"name": "Trent"},{"name": "Ewan"}]\' | json \'0\.name\'
-Trent
-
-$ echo \'[{"name": "Trent"},{"name": "Ewan"}]\' | json \'0\.name\' \-o jsony
-Trent
-.
-.fi
-.
-.IP "" 0
-.
-.P
-Or for strict JSON output:
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'[{"name": "Trent"},{"name": "Ewan"}]\' | json \-o json
-[
-  {
-    "name": "Trent"
-  },
-  {
-    "name": "Ewan"
-  }
-]
-.
-.fi
-.
-.IP "" 0
-.
-.P
-By default this uses a 2\-space indent\. That can be changed with a "\-N" suffix:
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'[{"name": "Trent"},{"name": "Ewan"}]\' | json \-o json\-4
-[
-    {
-        "name": "Trent"
-    },
-    {
-        "name": "Ewan"
-    }
-]
-
-$ echo \'[{"name": "Trent"},{"name": "Ewan"}]\' | json \-o json\-0
-[{"name":"Trent"},{"name":"Ewan"}]
-.
-.fi
-.
-.IP "" 0
-.
-.P
-You can get colored (non\-JSON) output using node\.js\'s \fButil\.inspect\fR \fIhttp://nodejs\.org/docs/latest/api/all\.html#util\.inspect\fR:
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'[{"name": "Trent"},{"name": "Ewan"}]\' | json \-o inspect
-[ { name: \'Trent\' },
-  { name: \'Ewan\' } ]
-.
-.fi
-.
-.IP "" 0
-.
-.SS "Validation"
-Since v1\.2\.0 \fBjson\fR will give position information and context for JSON syntax errors (\fBSyntaxError\fR)\. This can be handy for validating data and config files:
-.
-.IP "" 4
-.
-.nf
-
-$ cat config\.json | json
-json: error: input is not JSON: Unexpected \',\' at line 17, column 5:
-            , { "name": "smartos64\-1\.4\.7"
-        \.\.\.\.^
-{
-    "use\-proxy": false
-\.\.\.
-$ echo $?
-1
-.
-.fi
-.
-.IP "" 0
-.
-.P
-Processing and output of the input JSON can be suppressed with the \fB\-\-validate\fR option:
-.
-.IP "" 4
-.
-.nf
-
-$ cat config\.json | json \-\-validate
-json: error: input is not JSON: Unexpected \',\' at line 17, column 5:
-            , { "name": "smartos64\-1\.4\.7"
-        \.\.\.\.^
-.
-.fi
-.
-.IP "" 0
-.
-.P
-Together with the \fB\-q\fR you can get silent, exit\-status\-only, JSON validation:
-.
-.IP "" 4
-.
-.nf
-
-$ cat config\.json | json \-\-validate \-q
-$ echo $?
-1
-.
-.fi
-.
-.IP "" 0
-.
-.SS "Executing code snippets on input"
-You can use the \fB\-e CODE\fR option to execute small code snippets to massage the input data\. Some examples (generally use \fBthis\.<key>\fR to refer to a key):
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'{"foo": "bar"}\' | json \-e \'this\.foo="baz"\'
-{"foo":"baz"}
-.
-.fi
-.
-.IP "" 0
-.
-.P
-Or omit the \fBthis\.\fR as a shortcut:
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'{"foo": "bar"}\' | json \-e \'foo="baz"\'
-{"foo":"baz"}
-$ echo \'{"age": 38}\' | json \-e \'age++\'
-{"age":39}
-.
-.fi
-.
-.IP "" 0
-.
-.P
-Set a key to \fBundefined\fR to remove it:
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'{"one": 1, "two": 2}\' | json \-e \'this\.one=undefined\'
-{"two":2}
-.
-.fi
-.
-.IP "" 0
-.
-.P
-If the input is an array, then \fB\-e\fR will automatically process each element separately (use \fB\-A\fR to override this):
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'[{"name":"trent", "age":38}, {"name":"ewan", "age":4}]\' \e
-    | json \-e \'age++\'
-[
-  {
-    "name": "trent",
-    "age": 39
-  },
-  {
-    "name": "ewan",
-    "age": 5
-  }
-]
-.
-.fi
-.
-.IP "" 0
-.
-.SS "Filtering with \'\-c\'"
-You can use the \fB\-c CODE\fR option to filter the input:
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'{"name":"trent", "age":38}\' | json \-c \'age>21\'
-{
-  "name": "trent",
-  "age": 38
-}
-$ echo \'{"name":"trent", "age":38}\' | json \-c \'age==16\'
-$
-.
-.fi
-.
-.IP "" 0
-.
-.P
-If the input is an array, then \fB\-c\fR will automatically process each element separately (use \fB\-A\fR to override this):
-.
-.IP "" 4
-.
-.nf
-
-$ echo \'[{"name":"trent", "age":38}, {"name":"ewan", "age":4}]\' \e
-    | json \-c \'age>21\'
-[
-  {
-    "name": "trent",
-    "age": 38
-  }
-]
-.
-.fi
-.
-.IP "" 0
-.
-.SH "COMPATIBILITY"
-This is json version 4\. The major version is incremented when there is a backward incompatible change\.
-.
-.IP "\(bu" 4
-v4: Made "auto\-arrayification" require an explicit \'\-g\' or \'\-\-group\' option to prefer that implicit processing never magically fix otherwise invalid JSON\. The feature is now called grouping\.
-.
-.IP "\(bu" 4
-v3: Cleaned up json and "jsony" output formatting to be more consistent, especially for array processing\.
-.
-.IP "" 0
-.
-.P
-See the changelog \fIhttps://github\.com/trentm/json/blob/master/CHANGES\.md\fR for full compatibility and change details\.
-.
-.SH "PROJECT & BUGS"
-\fBjson\fR is written in JavaScript and requires node\.js (\fBnode\fR)\. The project lives at \fIhttps://github\.com/trentm/json\fR and is published to npm as "jsontool" ("json" was already taken, boo)\.
-.
-.IP "\(bu" 4
-README, Install notes: \fIhttps://github\.com/trentm/json#readme\fR
-.
-.IP "\(bu" 4
-Report bugs to \fIhttps://github\.com/trentm/json/issues\fR\.
-.
-.IP "\(bu" 4
-See the full changelog at: \fIhttps://github\.com/trentm/json/blob/master/CHANGES\.md\fR
-.
-.IP "" 0
-.
-.SH "LICENSE"
-MIT License (see \fIhttps://github\.com/trentm/json/blob/master/LICENSE\.txt\fR)
-.
-.SH "COPYRIGHT"
-json is Copyright (c) 2012 Trent Mick
diff --git a/overlay/generic/usr/share/man/man1m/fssstat.1m b/overlay/generic/usr/share/man/man1m/fssstat.1m
deleted file mode 100644
index 93fcadb2..00000000
--- a/overlay/generic/usr/share/man/man1m/fssstat.1m
+++ /dev/null
@@ -1,21 +0,0 @@
-'\" te
-.\"  Copyright 2011, Joyent, Inc. All Rights Reserved
-.\" The contents of this file are subject to the terms of the Common Development and Distribution License (the "License").  You may not use this file except in compliance with the License.
-.\" You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE or http://www.opensolaris.org/os/licensing.  See the License for the specific language governing permissions and limitations under the License.
-.\" When distributing Covered Code, include this CDDL HEADER in each file and include the License file at usr/src/OPENSOLARIS.LICENSE.  If applicable, add the following below this CDDL HEADER, with the fields enclosed by brackets "[]" replaced with your own identifying information: Portions Copyright [yyyy] [name of copyright owner]
-.TH fssstat 1M "10 Sep 2012" "SunOS 5.11" "System Administration Commands"
-.SH NAME
-fssstat \- display internal FSS statistics
-.SH SYNOPSIS
-.LP
-.nf
-\fBfssstat\fR [count]
-.fi
-
-.SH DESCRIPTION
-.sp
-.LP
-The \fBfssstat\fR command prints a summary of per-runnable process \fBFSS(7)\fR
-scheduling statistics every second. An optional count, specifying the number
-of iterations, can be provided.  This data is primarily used to diagnose FSS.
-.sp
diff --git a/overlay/generic/var/log/vmactions.debug b/overlay/generic/var/log/vmactions.debug
deleted file mode 100644
index e69de29b..00000000
diff --git a/overlay/generic/var/log/vmactions.log b/overlay/generic/var/log/vmactions.log
deleted file mode 100644
index e69de29b..00000000
diff --git a/tools/build_changelog b/tools/build_changelog
index ee38d844..a667c861 100755
--- a/tools/build_changelog
+++ b/tools/build_changelog
@@ -12,7 +12,7 @@
 #
 
 #
-# Copyright (c) 2013, Joyent, Inc. All rights reserved.
+# Copyright 2019 Joyent, Inc.
 # Copyright (c) 2014 Elysium Digital, L.L.C.
 #
 
@@ -85,10 +85,3 @@ for git_dir in $(/usr/bin/find projects -maxdepth 3 -type d -name .git || \
 	(build_section ${git_dir}/.. ${lastbranch} >> output/changelog.txt) || \
 	    fail "failed to build_section for projects/${project}"
 done
-
-if [[ -d overlay/smartos ]] && \
-    grep -q ${PWD}/overlay/smartos overlay/order; then
-	(build_section overlay/smartos ${lastbranch} smartos-overlay >> \
-	    output/changelog.txt) || \
-	    fail "failed to build_section for overlay/smartos"
-fi
diff --git a/tools/build_live b/tools/build_live
index 98b11c08..cdd17d87 100755
--- a/tools/build_live
+++ b/tools/build_live
@@ -508,7 +508,7 @@ function bi_gen_buildstamp_module
 		fail "could not link buildstamp module"
 	fi
 
-	if ! $ALTCTFCONVERT "$tmp_module"; then
+	if ! $CTFCONVERT "$tmp_module"; then
 		fail "could not add CTF to buildstamp module"
 	fi
 
@@ -554,25 +554,6 @@ function bi_ship_manifest
 	bi_emit_done
 }
 
-function bi_fill_templates
-{
-	bi_emit_start 'Filling in template files'
-
-	#
-	# The buildstamp needs to be included in various files in place of
-	# the template value of an all-zero date.
-	#
-	for f in etc/motd etc/issue; do
-		if ! pfexec gsed -i -e \
-		    "s/ [0-9]\{8\}T[0-9]\{6\}Z/ $bi_buildstamp/" \
-		    "$bi_mnt_root/$f"; then
-			fail "could not set buildstamp in \"$f\""
-		fi
-	done
-
-	bi_emit_done
-}
-
 function bi_file_fixups
 {
 	local kernel_src="$bi_mnt_root/platform/i86pc/kernel/amd64/unix"
@@ -584,6 +565,7 @@ function bi_file_fixups
 		fail "could not copy the kernel"
 	fi
 
+	# FIXME??
 	#
 	# Need to ensure that several files in the image are empty
 	#
@@ -962,7 +944,6 @@ bi_create_password
 bi_gen_etcrelease
 bi_gen_buildstamp_module
 bi_ship_manifest
-bi_fill_templates
 bi_file_fixups
 bi_compress_usr
 bi_finish_archive
diff --git a/tools/builder/Makefile b/tools/builder/Makefile
index 4b9bce31..89fae05a 100644
--- a/tools/builder/Makefile
+++ b/tools/builder/Makefile
@@ -18,7 +18,7 @@ builder: $(OBJS)
 	$(CC) -c $(CFLAGS) -o $@ $<
 
 users.c:
-	./build_users_c.sh $(SRC_ROOT)/overlay/generic > users.c.tmp && mv users.c.tmp users.c
+	./build_users_c.sh $(SRC_ROOT)/proto/ > users.c.tmp && mv users.c.tmp users.c
 
 clean:
 	rm -f $(TARGETS) $(OBJS)
diff --git a/tools/mancf/Makefile b/tools/mancf/Makefile
index 7f7dbacd..00f3a4bf 100644
--- a/tools/mancf/Makefile
+++ b/tools/mancf/Makefile
@@ -10,7 +10,7 @@
 #
 
 #
-# Copyright 2016 Joyent, Inc.
+# Copyright 2019 Joyent, Inc.
 #
 
 PROG =		mancf
@@ -42,7 +42,7 @@ LDLIBS =					\
 ILLUMOS_SRC =	../../projects/illumos
 TOOLS_BIN =	$(ILLUMOS_SRC)/usr/src/tools/proto/root_i386-nd/opt/onbld/bin
 CC =		gcc
-ALTCTFCONVERT =	$(TOOLS_BIN)/i386/ctfconvert-altexec
+CTFCONVERT =	$(TOOLS_BIN)/i386/ctfconvert
 
 COMPILE_C =	$(CC) -c -gdwarf-2 $(CFLAGS) -o $@ $^
 
@@ -59,7 +59,7 @@ all: $(PROG)
 
 $(PROG): $(OBJECTS)
 	$(CC) -o $@ $^ $(LDLIBS)
-	$(ALTCTFCONVERT) -l $(PROG) $@
+	$(CTFCONVERT) -l $(PROG) $@
 
 clean:
 	rm -f $(OBJECTS) $(PROG)
diff --git a/tools/mancheck/Makefile b/tools/mancheck/Makefile
index 7bd78910..d343249c 100644
--- a/tools/mancheck/Makefile
+++ b/tools/mancheck/Makefile
@@ -10,7 +10,7 @@
 #
 
 #
-# Copyright 2016 Joyent, Inc.
+# Copyright 2019 Joyent, Inc.
 #
 
 PROG =		mancheck
@@ -42,7 +42,7 @@ LDLIBS =					\
 ILLUMOS_SRC =	../../projects/illumos
 TOOLS_BIN =	$(ILLUMOS_SRC)/usr/src/tools/proto/root_i386-nd/opt/onbld/bin
 CC =		gcc
-ALTCTFCONVERT =	$(TOOLS_BIN)/i386/ctfconvert-altexec
+CTFCONVERT =	$(TOOLS_BIN)/i386/ctfconvert
 
 COMPILE_C =	$(CC) -c -gdwarf-2 $(CFLAGS) -o $@ $^
 
@@ -59,7 +59,7 @@ all: $(PROG)
 
 mancheck: $(OBJECTS)
 	$(CC) -o $@ $^ $(LDLIBS)
-	$(ALTCTFCONVERT) -l $(PROG) $@
+	$(CTFCONVERT) -l $(PROG) $@
 
 clean:
 	rm -f $(OBJECTS) $(PROG)
diff --git a/tools/tzcheck/Makefile b/tools/tzcheck/Makefile
index cccf9919..4db7c8a2 100644
--- a/tools/tzcheck/Makefile
+++ b/tools/tzcheck/Makefile
@@ -10,7 +10,7 @@
 #
 
 #
-# Copyright 2016 Joyent, Inc.
+# Copyright 2019 Joyent, Inc.
 #
 
 PROG =		tzcheck
@@ -42,7 +42,7 @@ LDLIBS =					\
 ILLUMOS_SRC =	../../projects/illumos
 TOOLS_BIN =	$(ILLUMOS_SRC)/usr/src/tools/proto/root_i386-nd/opt/onbld/bin
 CC =		gcc
-ALTCTFCONVERT =	$(TOOLS_BIN)/i386/ctfconvert-altexec
+CTFCONVERT =	$(TOOLS_BIN)/i386/ctfconvert
 
 COMPILE_C =	$(CC) -c -gdwarf-2 $(CFLAGS) -o $@ $^
 
@@ -59,7 +59,7 @@ all: $(PROG)
 
 $(PROG): $(OBJECTS)
 	$(CC) -o $@ $^ $(LDLIBS)
-	$(ALTCTFCONVERT) -l $(PROG) $@
+	$(CTFCONVERT) -l $(PROG) $@
 
 clean:
 	rm -f $(OBJECTS) $(PROG)
diff --git a/tools/ucodecheck/Makefile b/tools/ucodecheck/Makefile
index bc9c5250..d7549757 100644
--- a/tools/ucodecheck/Makefile
+++ b/tools/ucodecheck/Makefile
@@ -10,7 +10,7 @@
 #
 
 #
-# Copyright (c) 2018 Joyent, Inc.
+# Copyright 2019 Joyent, Inc.
 #
 
 PROG =		ucodecheck
@@ -42,7 +42,7 @@ LDLIBS =					\
 ILLUMOS_SRC =	../../projects/illumos
 TOOLS_BIN =	$(ILLUMOS_SRC)/usr/src/tools/proto/root_i386-nd/opt/onbld/bin
 CC =		gcc
-ALTCTFCONVERT =	$(TOOLS_BIN)/i386/ctfconvert-altexec
+CTFCONVERT =	$(TOOLS_BIN)/i386/ctfconvert
 
 COMPILE_C =	$(CC) -c -gdwarf-2 $(CFLAGS) -o $@ $^
 
@@ -59,7 +59,7 @@ all: $(PROG)
 
 $(PROG): $(OBJECTS)
 	$(CC) -o $@ $^ $(LDLIBS)
-	$(ALTCTFCONVERT) -l $(PROG) $@
+	$(CTFCONVERT) -l $(PROG) $@
 
 clean:
 	rm -f $(OBJECTS) $(PROG)
-- 
2.21.0

