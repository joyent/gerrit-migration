{"project":"joyent/smartos-live","branch":"master","topic":"lullaby-phase4","id":"I4a8588742164eb23b55f14615d97ceb3fa3fe75a","number":"6094","subject":"OS-7453 convert platform build to engbld framework OS-6986 SmartOS release builds should include Ur Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e Approved by: John Levon \u003cjohn.levon@joyent.com\u003e","owner":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"url":"https://cr.joyent.us/6094","commitMessage":"OS-7453 convert platform build to engbld framework\nOS-6986 SmartOS release builds should include Ur\nReviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\nApproved by: John Levon \u003cjohn.levon@joyent.com\u003e\n","createdOn":1554989307,"lastUpdated":1557952923,"open":false,"status":"MERGED","comments":[{"timestamp":1554989307,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 1."},{"timestamp":1554989362,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1554989427,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1554989454,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Topic set to lullaby-phase4"},{"timestamp":1555301035,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(11 comments)"},{"timestamp":1555326484,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 2:\n\n(11 comments)\n\nThanks for the feedback! I\u0027ll post a change with the changes later today. There\u0027s a few open questions in my responses below."},{"timestamp":1555332863,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 3."},{"timestamp":1555332922,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1555334373,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3:\n\n(17 comments)\n\nI think README.md needs updating / adding to."},{"timestamp":1555334559,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1555337073,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1555347171,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 3:\n\n(15 comments)\n\nThanks for the review! I think I\u0027ve addressed all of the comments, and we agreed in ~os that I\u0027d have another go at the ./projects git branch configuration code, so will do that and post the changes I reference below once that\u0027s working."},{"timestamp":1555426378,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(6 comments)"},{"timestamp":1555501423,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 2:\n\n(6 comments)"},{"timestamp":1555510448,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1555514784,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\n(7 comments)"},{"timestamp":1555515929,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1555516098,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1555516675,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1555516874,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1555516990,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1555517636,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1555517757,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1555586075,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 5."},{"timestamp":1555586134,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1555586217,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 5:\n\n\u003e Uploaded patch set 5.\n\nThis patch set does the following:\n\n Introduces \u0027configure-projects\u0027 to deal with ./projects\n Makes deps/eng a submodule\n Better descriptions for smartos-index and smartos-release\n Remove unnecessary \"custom\" build detection code\n configure_branches_desc should get branch info from projects repos\n Remove build_jenkins options we don\u0027t need"},{"timestamp":1555601449,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 5:\n\n(18 comments)\n\nThanks for these changes, it\u0027s starting to look ship shape now."},{"timestamp":1555602008,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 5:\n\nI looked more into the idea of combining output and bits directories. At present, \u0027bits\u0027 is a subdir of \u0027output\u0027, so we do already have a place to store build artifacts that we don\u0027t want uploaded\n\nIt doesn\u0027t seem difficult to have the build move output/*.[tgz|iso|etc] into \u0027output/bits\u0027 during \u0027make world\u0027 or directly from build_root_image, retaining the correct output/*-latest symlinks as we do so. While doing this, we could also move the triton manifest generation code into \u0027make live\u0027 so that we never risk having a manifest with a stale platform image hash.\n\nAll that said, I\u0027m still not sure how much we really care about doing that work, given that (unless I\u0027m mistaken?) it\u0027s only jenkins builds that ever bother uploading artifacts to manta or updates.joyent.com anyway. If the facility were there, is this something ~os engineers are likely to avail of?\n\n\nWhile digging about here, I also came across an undocumented \u0027configure-buildvers\u0027 file which our MG \u0027platform-debug\u0027 job hasn\u0027t been using, but which seems like the perfect candidate to allow the build to create the correct \u0027platform-debug.tgz\u0027 file directly from \u0027build_live\u0027. If we use this, it would simplify some of the Makefile changes under review."},{"timestamp":1556121727,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 5:\n\n(18 comments)\n\nI\u0027m running a test build with the changes mentioned below, will post the updates assuming the build looks good. Thanks for the review!"},{"timestamp":1556122244,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1556203515,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 5:\n\nThat\u0027s a fair point. I think I\u0027d then lean towards a file with the default:\n\nillumos-extra: master: origin\nillumos: master: origin\nlocal/kvm-cmd: master: origin\nlocal/kvm: master: origin\nlocal/mdata-client: master: origin\nlocal/ur-agent: master: origin\n\nso the format being,\n\n\u003crelative dir to $ROOT/projects\u003e: \u003cbranch\u003e: \u003cgit url or keyword\u003e\n\nThe only thing this hides is that \u0027illumos\u0027 is actually our fork of illumos, rather than illumos gate, but we already make that pretty clear in the README.md\n\nDoes this seem reasonable?"},{"timestamp":1556204257,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 5:\n\nSure, thanks."},{"timestamp":1556276272,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 6."},{"timestamp":1556276332,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1556276846,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 7."},{"timestamp":1556276874,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 6:\n\n\u003e Uploaded patch set 7.\n\nSorry, fixed a typo in tools/build_jenkins"},{"timestamp":1556276903,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1556277408,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 6:\n\n(6 comments)"},{"timestamp":1556291711,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 6:\n\n(6 comments)"},{"timestamp":1557240392,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 8."},{"timestamp":1557240430,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 8:\n\n\u003e Uploaded patch set 8.\n\nThis was a rebase, and fixing a markdown syntax error."},{"timestamp":1557240453,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557490126,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 8:\n\n(1 comment)"},{"timestamp":1557490698,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 8:\n\n(1 comment)"},{"timestamp":1557490877,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 9."},{"timestamp":1557490934,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557737172,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 9: Code-Review+1"},{"timestamp":1557827189,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 10."},{"timestamp":1557827244,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557827365,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 10: Code-Review+1"},{"timestamp":1557947327,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 11: Patch Set 10 was rebased."},{"timestamp":1557947381,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11:\n\n\"make check\" passed ok"},{"timestamp":1557951529,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 11: Integration-Approval+1"},{"timestamp":1557952913,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 12: Commit message was updated."},{"timestamp":1557952923,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Tim Foster"}],"currentPatchSet":{"number":"12","revision":"4a8588742164eb23b55f14615d97ceb3fa3fe75a","parents":["a89b45abfd80497679a12f385678d5dda3fde9ad"],"ref":"refs/changes/94/6094/12","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1557952913,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557827244,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557827365,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1557951529,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"SUBM","value":"1","grantedOn":1557952923,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-2},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":230,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":107,"deletions":-7},{"file":"configure","type":"MODIFIED","insertions":125,"deletions":-100},{"file":"default.configure-build","type":"ADDED","insertions":7,"deletions":0},{"file":"default.configure-projects","type":"ADDED","insertions":6,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"sample.configure.smartos","type":"DELETED","insertions":0,"deletions":-33},{"file":"src/platform.imgmanifest.in","type":"ADDED","insertions":27,"deletions":0},{"file":"tools/build_jenkins","type":"ADDED","insertions":184,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/projects_branch_desc","type":"ADDED","insertions":48,"deletions":0},{"file":"tools/smartos-index","type":"ADDED","insertions":30,"deletions":0},{"file":"tools/smartos-release","type":"ADDED","insertions":108,"deletions":0}],"sizeInsertions":882,"sizeDeletions":-147},"patchSets":[{"number":"1","revision":"81664065ef5aec869af672a357117b579c7fd97c","parents":["894fede21953194c3abc3dfd8002df36be39d4c0"],"ref":"refs/changes/94/6094/1","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1554989307,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1554989362,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":223,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"configure","type":"MODIFIED","insertions":19,"deletions":0},{"file":"overlay/generic/smartdc/lib/smartos_prompt_config.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"sample.configure.smartos","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/platform.imgmanifest.in","type":"ADDED","insertions":27,"deletions":0},{"file":"tools/build_boot_image","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"tools/build_changelog","type":"MODIFIED","insertions":4,"deletions":0},{"file":"tools/build_jenkins","type":"ADDED","insertions":266,"deletions":0},{"file":"tools/build_vmware","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"tools/configure_branches_desc","type":"ADDED","insertions":45,"deletions":0},{"file":"tools/smartos-index","type":"ADDED","insertions":19,"deletions":0},{"file":"tools/smartos-release","type":"ADDED","insertions":96,"deletions":0}],"sizeInsertions":731,"sizeDeletions":-15},{"number":"2","revision":"ce1cafcd9116982deaa10dfdf576e703a4a7e158","parents":["d52a276f9121183085768e6dabb7eb50a7a37e95"],"ref":"refs/changes/94/6094/2","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1554989427,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1554989362,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"Makefile","line":16,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Do we have to keep this? I only had this because of what MG did, and it would be great not to have to continue that."},{"file":"Makefile","line":16,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"That\u0027s a result of us running this during gerrit hooks and not wanting to checkout all ./projects for each gerrit commit. I think we\u0027re going to still want this."},{"file":"Makefile","line":16,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Oh yes, I basically forgot about that. OK."},{"file":"Makefile","line":447,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Do we really want $3? Don\u0027t we want anything at $3 and after? This\u0027ll fail if someone ever uses a branch name like dev/foobar."},{"file":"Makefile","line":447,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"That\u0027s true, though this does mirror what MG has done (and eng.git continues to do) - https://github.com/joyent/mountain-gorilla/#package-versioning and\nhttps://github.com/joyent/eng/blob/master/tools/mk/Makefile.defs#L67\n\nSince branch names are used in Manta artifact file and directory names, it\u0027s really problematic to have branches with slashes in them. We have similar assumptions in a few other places (sdc-headnode downloader, agents-installer mk-shar come to mind)\n\nPerhaps we could harden this code some more, but it becomes quite a long line as a result. Here\u0027s a sample Makefile fragment:\n\n\nPLATFORM_BRANCH\u003d$(shell git symbolic-ref HEAD | awk -F/ \u0027{if (NF \u003e 3) { print \"unsupported branch: too many / chars\"; exit 1;}  print $$3}\u0027)\nifneq ($(.SHELLSTATUS), 0)\n    $(error \"Unable to set PLATFORM_BRANCH\")\nendif\n\nall:\n\n        echo $(PLATFORM_BRANCH)"},{"file":"Makefile","line":447,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe we can just fail fast in these cases?"},{"file":"Makefile","line":447,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"If we were using this value for anything other than symbolic purposes, I\u0027d agree that failing fast would be correct.\n\nThe problem is that when building from Gerrit, it\u0027s quite likely that we\u0027ll encounter branches with slashes, e.g. \u0027refs/changes/45/12345/1\u0027, so we need to be able to deal with them.\n\nMore problematic still, is that detached heads behave strangely when asking for a symbolic ref:\n\n\u003d\u003d\u003d\ntimf@iorangi-eth0 (master) git ls-remote | grep 49/5749/5\nFrom https://cr.joyent.us/joyent/illumos-kvm-cmd.git\n10d01499dc302f501c63949a7c7d8c7e6c148470\trefs/changes/49/5749/5\ntimf@iorangi-eth0 (master) git fetch origin refs/changes/49/5749/5\nFrom https://cr.joyent.us/joyent/illumos-kvm-cmd\n * branch            refs/changes/49/5749/5 -\u003e FETCH_HEAD\ntimf@iorangi-eth0 (master) git checkout FETCH_HEAD\nNote: checking out \u0027FETCH_HEAD\u0027.\n\nYou are in \u0027detached HEAD\u0027 state. You can look around, make experimental\nchanges and commit them, and you can discard any commits you make in this\nstate without impacting any branches by performing another checkout.\n\nIf you want to create a new branch to retain commits you create, you may\ndo so (now or later) by using -b with the checkout command again. Example:\n\n  git checkout -b \u003cnew-branch-name\u003e\n\nHEAD is now at 10d0149 fix live migration\ntimf@iorangi-eth0 ((HEAD detached at FETCH_HEAD)) BRANCH\u003d$(git symbolic-ref HEAD | awk \u0027{print $3}\u0027)\nfatal: ref HEAD is not a symbolic ref\ntimf@iorangi-eth0 ((HEAD detached at FETCH_HEAD)) echo _\"$BRANCH\"_\n__\ntimf@iorangi-eth0 ((HEAD detached at FETCH_HEAD))\n\u003d\u003d\u003d\n\nSo I think the right answer here is to simply ask for a \u0027git describe --all\u0027 and use $3 as normal for now.\n\nI\u0027m making complementary changes to \u0027configure\u0027 and \u0027configure_branches_desc\u0027 to deal with this state more elegantly (where previous code review feedback asked that we consult the ./projects git repos to determine their branches rather than trust that the \u0027configure-branches\u0027 file was up to date)"},{"file":"Makefile","line":454,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Missing period?"},{"file":"Makefile","line":454,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Done"},{"file":"Makefile","line":460,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"nit, the tab alignment seems rather random here, maybe don\u0027t bother?"},{"file":"Makefile","line":478,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"It still seems weird to me that we get a totally different UUID every time we invoke any make targets, but I\u0027m not sure I have a better suggestion."},{"file":"Makefile","line":478,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yeah, we\u0027re only using this in the triton-platform-publish target, so we might as well only set that in the target commands directly."},{"file":"Makefile","line":513,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If you don\u0027t wan the cut you can always use \u0027digest -a sha1 $(PLATFORM_TARBALL)\u0027. Assuming there\u0027s only a single file."},{"file":"Makefile","line":513,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, that\u0027s better - thanks. MG used openssl in its corresponding target:\n\nhttps://github.com/joyent/mountain-gorilla/blob/master/Makefile#L2856\n\nmaybe allowing publication from a non-illumos machine after a build had completed and had posted its artifacts somewhere, but I agree that since we know we\u0027re running on illumos at this point, using digest is better."},{"file":"Makefile","line":515,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I\u0027m wondering how much the output-* directories make sense, now we *also* have a bits dir. Seems like two very similar things? What is the benefit of writing it out somewhere, then having a separate step that just copies them about?"},{"file":"Makefile","line":515,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"This is so that we can use bits-upload from eng.git. Other Manta/Triton components have a \"publish\" step which stages changes in ./bits, and a \"bits-upload\" step which posts to Manta and updates.joyent.com\n\nI\u0027ll see whether we can symlink into the bits dir prior to publication and have bits-upload do the right thing. Otherwise changing output-* into bits directories would work, at the risk of breaking any other tools that depend on this layout. \n\nWith the other lullaby changes, we tried to keep them \"MG-compatible\" to allow us to continue building components with MG even after the lullaby conversions integrated in case of problems. We never actually needed that capability though, so maybe changing this now isn\u0027t a big deal."},{"file":"Makefile","line":515,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If we wanted to consolidate, we could probably consolidate the output directories. It\u0027d be nice if the ISO/USB bits had the same symlinking logic and followed what was going on in output. As the person responsible for them, I\u0027m not sure I would do them today.\n\nIt doesn\u0027t seem unreasonble to have the bits directory have a bunch of other output that the normal build doesn\u0027t care about or a different layout. Especially as we\u0027d want to change that layout at eng.git\u0027s preferences and not have annoyed developers be a real consideration. Where as if we change the current layout of at least output/ and the platform-latest symlinks, we will have annoyed engineers."},{"file":"Makefile","line":515,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Fair point.\n\nThis wad as a whole already definitely requires a build flag-day, so I\u0027m probably well down the path of annoying engineers :-) I\u0027m happy to do the work to re-org the layout of the build artifacts, but won\u0027t start that until there\u0027s consensus.\n\nFor reference, here\u0027s what a bits dir looks like on Manta with my current changes, in this case, a full \"triton-and-smartos\" build:\n\ntimf@iorangi-eth0 mls /Joyent_Dev/stor/timf-builds/platform/master-20190411T101956Z/platform\nSINGLE_USER_ROOT_PASSWORD.txt\nboot-master-20190411T101956Z.tgz\nbuild.log\nchangelog.txt\nconfigure-branches\nimages-master-20190411T101956Z.tgz\nindex.html\nmd5sums.txt\nplatform-master-20190411T101956Z.imgmanifest\nplatform-master-20190411T101956Z.tgz\nsmartos-20190411T101956Z-USB.img.gz\nsmartos-20190411T101956Z.iso\nsmartos-20190411T101956Z.vmwarevm.tar.gz\n\nOur local copy of output/bits/platform needs to be identical, though for convenience, we could add \"-latest\" symlinks to relevant artifacts.\n\nHaving looked into the idea of symlinking from ./bits to the various output-* dirs, that won\u0027t work without changes to bits-upload itself as we\u0027re intentionally only uploading files and directories (since doing an \u0027mput\u0027 of a symlinked file results in a duplicated object on Manta, which we don\u0027t want)\n\nWe could easily do things the other way around, retaining output-iso, output-usb, etc. but have their contents symlink into the  output/bits/platform directory.\n\nUltimately, the inefficiency we\u0027re talking about here amounts to a few hundred megabytes being copied around at the end of the build, and built workspaces taking up a bit more space on jenkins agents - maybe not worth the trouble?"},{"file":"Makefile","line":515,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I suspect 95+% of non-automated build development is going to happen without ever running the jenkins scripts, so a top-level bits/ directory won\u0027t appear. I don\u0027t think having it duplicate the bits/ paths from what\u0027s in the current output/ directories is the end of the world, particularly if you want to have a consistent view and not deal with the fact that someone could run gmake live out from under you, but not the corresponding targets for the bits directories which would cause the manifests to all be out of date.\n\nI don\u0027t feel like symlinking the output/ stuff into the bits directories makes sense, given the likelihood for that to get out of date as described above, unless we are very careful about dependencies (which isn\u0027t really the case today). So maybe the above is an answer to John\u0027s question?\n\nFWIW, many of us rely on the platform-latest symlink in the output/ directories for development and staying sane (mostly for the non-tgz link so it can be fed straight to ipxe or however we\u0027re booting), so it\u0027s pretty important that those don\u0027t go away. I know that\u0027s not happening in your change today. But if we\u0027re contemplating other refactoring of how we store output in the normal (gmake live) phase, then we\u0027d need to ensure that it logically still exists. We can deal with it changing if that ultimately leads to a better experience.\n\nI was trying to suggest having the files in bits/ be symlinks, but I\u0027m now less convinced that make sense, due to the fact that manifests would be out of date relative to a gmake live being invoked. So the more I write this, the more I think the duplication is actually a plus and not a minus."},{"file":"Makefile","line":515,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I suppose I\u0027m missing why we can\u0027t just directly put stuff where publish puts them now along with convenience symlinks.\nThat is, we basically have the needed bits of publish inside the normal targets. I realise this means more refactoring how stuff is built."},{"file":"Makefile","line":515,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"OK thanks. I don\u0027t think we care about MG for this in particular as it\u0027s a lot more complicated than other components."},{"file":"Makefile","line":515,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If we\u0027re going to refactor everything and make sure manifest generation is up to date with things like gmake live, then that\u0027s more likely to be fine. The problem I was trying to point out was that many things like the upload targets don\u0027t depend on anything at all, so it seems very likely that we\u0027ll have dependencies get out of date. I would not be surprised a person manually trying to use these targets (which they will do since they\u0027re here now) will end up uploading an artifact whose manifest has a different checksum than the artifact because of having run gmake live at some point and not realizing that they\u0027re not synced at all.\n\nImproving the layout for humans makes sense, but hopefully at some point we can change the automated tools to just construct what they want without changing what humans see, because if everyone developing has to change what they\u0027re used to doing every time we want to change how something looks in the artifact storage system, people will get annoyed. So, if it makes sense to change it and we think it\u0027ll actually be better, let\u0027s do it. Let\u0027s just not forget the human cost.\n\nIf this stuff changes, we definitely need documentation updates to the smartos-live README, etc. and a much firmer heads up, because otherwise folks basically would have been able to get through this with the standard gmake update; ./configure; gmake live."},{"file":"Makefile","line":515,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"So Tim, if you think it\u0027s worth at least investigating what this might look like, that\u0027d be good. Or if you don\u0027t want to bother, I\u0027m fine with that too I suppose."},{"file":"Makefile","line":515,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep. Let me get this next set of changes posted here for review first (test builds running now) and I\u0027ll look at the output-dir reorg after that."},{"file":"Makefile","line":515,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Also, will it be OK for us to have items in here that we aren\u0027t necessarily uploading / releasing? For example, say we have the ability to build images for other environments or targets, will that then throw things off?"},{"file":"Makefile","line":515,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"To clarify that a bit more: Say I manually build an iso image for vmware to test on, but then I want to upload the main bits, I probably don\u0027t want that uploaded. Or say we in the future have some other form of the image, like we pre-create a KVM/bhyve/other virt image, it\u0027d be great to make sure that doesn\u0027t end up leaking into the upload."},{"file":"Makefile","line":515,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Right now, bits-upload will upload all files and directories from the bits dir to Manta and will \u0027updates-imgadm add\u0027 all Triton manifest/image pairs found in the upload area.\n\nIf we need the ability to not upload certain files, we\u0027ll either need a separate place for those, or come up with an exception mechanism to prevent those bits from being uploaded. \n\nThe model we\u0027re following here is the one used for other Manta/Triton images - build them, \u0027publish\u0027 to an upload area, then upload. If that doesn\u0027t match the needs of certain flavors of platform build, nothing\u0027s stopping us from either changing the model, being careful about what artifacts are \"published\", or us deciding that model really doesn\u0027t fit well here."},{"file":"Makefile","line":515,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This makes me feel like combining the output and bits directories is the wrong approach."},{"file":"Makefile","line":553,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Is the bug filed? Can we refer to it directly here please?"},{"file":"Makefile","line":553,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Will do. I hadn\u0027t filed a bug, but have done so now - TOOLS-2241"},{"file":"Makefile","line":604,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is the assumption that the other tools that will be required, such as the manta tools are being pulled in manually?"},{"file":"Makefile","line":604,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yes that is the assumption.\n\nThat will be correct in our production build environment, where our jenkins agents deliver the manta tools with relevant symlinks in /root/bin, which is on $PATH. Other Manta/Triton components use eng.git:tools/validate-buildenv.sh to verify that these tools are present, \n\nhttps://github.com/joyent/eng/blob/master/tools/validate-buildenv.sh#L594\n\nbut that script is too strict for smartos-live (notably, it requires that the pkgsrc bootstrap tools are in /opt/tools/bin, needed for buildimage, which smartos-live doesn\u0027t use)\n\nI think there\u0027s 3 options here, and I\u0027m veering towards the third, but would welcome opinions:\n\n1. simply document the requirement, noting that this is unlikely to impact non-Joyent users of smartos-live who are unlikely to want to  publish artifacts to Manta (any who do would have been using MG before now, and it already made this assumption)\n\n2. adapt validate-buildenv so that smartos-live can use it report on missing build machine requirements, but not report on things smartos-live doesn\u0027t need.\n\n3. update \u0027configure\u0027 to look for manta tools and imgadm-cli. Since \u0027configure\u0027 is already installing nodejs from pkgsrc, we could have it also \u0027npm install -g\u0027 those if the packages were missing from $PATH.\n\nLine 525/542 does reference \"MANTA_TOOLS_PATH\" so if we\u0027re doing 3. above, we could omit that."},{"file":"Makefile","line":604,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Given the mere presence of mput is not sufficient, I think I\u0027m fine with 1) personally."},{"file":"Makefile","line":604,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, that seems reasonable. I guess given the fact that to successfully succeed you need things like keys on the right servers, there\u0027s not much point in doing it here."},{"file":"Makefile","line":604,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Cool."},{"file":"Makefile","line":613,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Surely dependong on release *type* not cadence? But really, I\u0027m not quite sure what value this comment has here."},{"file":"Makefile","line":613,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"There was a recent discussion about build cadence, switching Triton to a 4-weekly build, but keeping SmartOS on a biweekly schedule.\n\nThe impact there was that for every other biweekly build, we\u0027d need to build both Triton and SmartOS, with interim release builds only needing to build SmartOS. That\u0027s more context that we\u0027re including here though, and I agree the comment as it stands isn\u0027t useful.\n\nI\u0027ll just remove the paragraph from 611-613, as the target names are already self-descriptive."},{"file":"Makefile","line":618,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"FWIW, live invokes world, so there\u0027s no need to list it separately."},{"file":"Makefile","line":618,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Done"},{"file":"tools/build_changelog","line":16,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"copyright?"},{"file":"tools/build_changelog","line":16,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Done"},{"file":"tools/build_changelog","line":85,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Are we really sure we want projects/eng/ not deps/eng/ ?"},{"file":"tools/build_changelog","line":85,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"This is a \"submodule vs. projects framework\" question I think.\n\nThe way we have it now in projects means it fits better with the way smartos-live deals with extra repositories.\n\nThe risk of not using eng.git as a submodule, is that smartos-live would be immediately broken by any bad commits to eng.git (with submodules we lock to a specific version of eng.git and need a smartos-live commit to upgrade to a newer version)\n\nThis is a trade-off to be sure.  I\u0027m slightly more comfortable with eng-as-a-submodule, but it will need a new top-level directory in smartos-live if we go that route."},{"file":"tools/build_changelog","line":85,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Fair enough, I guess this is fine for now."},{"file":"tools/build_jenkins","line":1,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"A general question here: did you consider how much of this script could meaningfully be moved directly into the build? Generally the less special jenkins stuff the better IMO"},{"file":"tools/build_jenkins","line":30,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Do you care about which date is used? GNU, platform, etc.?"},{"file":"tools/build_jenkins","line":30,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"I tried the platform date, /opt/local/bin/date and its symlink target, /opt/local/bin/gdate and they have the same behaviour with this CLI argument. Since we know we\u0027re running on smartos though, I\u0027ll hardcode this to /bin/date. Thanks!"},{"file":"tools/build_jenkins","line":31,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What do you need from /usr/sfw/bin?"},{"file":"tools/build_jenkins","line":31,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"This was just me porting from mountain-gorilla.git. Looking more closely, that assumption seems to be old at this point:\n\nhttps://github.com/joyent/mountain-gorilla/blob/master/Makefile#L2811\n\n2811 # PATH: Ensure using GCC from SFW as require for platform build.\n\nI\u0027ll remove this."},{"file":"tools/build_jenkins","line":65,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Is there a specific reason that the branches is local content, but the configure file is a URL?"},{"file":"tools/build_jenkins","line":65,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"It felt like configure-branches was short enough to be a jenkins text-entry box, whether as copy/pasting an entire shell script in there seemed more unweildy.\n\nInvoking a jenkins build via curl with a full shell script passed as a parameter also felt like it might be fraught with problems trying to escape special characters (admittedly, we only ever need to specify $BRANCH and $PLAT_FLAVOR from our current CLI build-launcher - see https://cr.joyent.us/#/c/6092/ but I wasn\u0027t sure if others do more from the CLI)\n\n(We\u0027re discussing this in ~os as I write this, and have settled on a potential solution to ease the confusion here, which I\u0027ll prototype this week and have a demo sent out)"},{"file":"tools/build_jenkins","line":73,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Any reason not to:\n - make the make targets themselves output the \"Running...\"\n   (like we now do for illumos-extra targets)\n - redirect this entire script\u0027s output to ${ENGBLD_LOG}\n\nThen we can remove these?"},{"file":"tools/build_jenkins","line":73,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Sure. There was some shenanigans about wanting the manta upload attempt to appear in the log itself, but I\u0027ll see if I can remove this and just | tee to the log file instead."},{"file":"tools/build_jenkins","line":92,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I guess -d is tough, and -F makes sense, but why aren\u0027t -c and -i subsumed into PLAT_CONFIGURE_ARGS ? Why do we need separate args there?"},{"file":"tools/build_jenkins","line":92,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"This felt more user-friendly - this script tells the user what options it supports rather than expecting them to know what arguments \u0027configure\u0027 supports.."},{"file":"tools/build_jenkins","line":92,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"It\u0027s not a big deal I suppose, but this isn\u0027t complete then. I think anyone can read the description of the CONFIGURE_ARGS option in jenkins and go inspect the script? I\u0027d definitely lean towards less code here."},{"file":"tools/build_jenkins","line":153,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason that the stamps are being manually cleared here? I guess we can\u0027t use the gmake update target at all? What if one needs to re-run ./configure between incremental builds?"},{"file":"tools/build_jenkins","line":153,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"I was following the advice from https://github.com/joyent/smartos-live/#incremental-development which suggested that by removing the stamps, we get incremental builds of those components.\n\nIs re-running configure between incremental builds something we\u0027d support - perhaps to force an illumos clobber, but switching between debug/nondebug bits across an incremental boundary, or switching compilers between incremental builds seems a bit risky?\n\nWhile the primary use-case of the \u0027build_jenkins\u0027 script was production jenkins builds themselves (and as such, incremental builds would never happen) I thought that adding this incremental option _might_ be useful when trying to debug the production build on a standalone build machine."},{"file":"tools/build_jenkins","line":153,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Seems like you can trivially just always remove the stamps regardless of this setting? I actually don\u0027t see much point in -i at all - it would just produce a warning if not set?"},{"file":"tools/build_jenkins","line":153,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"The intent here was to let developers more easily debug production builds on local systems. If we don\u0027t think that\u0027s useful (relating to your earlier point, where could do with less logic in build_jenkins) then I\u0027m fine with removing this."},{"file":"tools/build_jenkins","line":153,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Would we ever do production builds with the -i option? It feels like for the debugging case, someone will likely be manually invoking make targets or using bldenv to dig into things."},{"file":"tools/build_jenkins","line":153,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"No, I don\u0027t think we\u0027d ever do a production build with -i. I agree with you about how developers are likely to debug, so let\u0027s just remove this option altogether."},{"file":"tools/build_jenkins","line":153,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"What I\u0027m saying is we can just rm -f the stamp files here unconditionally, without any need for inspecting an -i option at all."},{"file":"tools/build_jenkins","line":159,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"You can just do:\n\nif echo $BRANCH | grep -q \"^release\"; then\n  ENGBLD_RELEASE\u003dtrue\nelse\n  ENGBLD_RELEASE\u003d\"\"\nfi\n\nno need to fiddle with -e"},{"file":"tools/build_jenkins","line":159,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Ah, thanks"},{"file":"tools/build_jenkins","line":175,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I don\u0027t understand what\u0027s going on with the basename here."},{"file":"tools/build_jenkins","line":175,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"This is back to the old \u0027Jenkins vs. Gerrit, refs/remotes/origin/master vs refs/remotes/cr/master\u0027 ambiguity.\n\nSince Jenkins uses the long-form refs/remotes/origin/master branch name, and sets $BRANCH to that when we launch this script, we have to use the basename of $BRANCH to express it in a form that configure-branches can deal with.\n\nconfigure-branches doesn\u0027t have the same ambiguity of branch names that Jenkins does since the projects framework only ever configures a single \u0027git remote\u0027 per project."},{"file":"tools/build_jenkins","line":175,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I think this might change somewhat with the most recent discussion we had on #os so we can come back to this if needed."},{"file":"tools/build_jenkins","line":212,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What does this correspond to? Where does this SHA come from?"},{"file":"tools/build_jenkins","line":212,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Originally the point of this was to set \"$ENGBLD_CUSTOM\" which then gets used in the description of the platform image manifest.\n\nThis code actually predated our inclusion of a list of uniquified hyphen-separated branches from configure-branches in the platform stamp, from the smartos-live Makefile:\n\n458 PUB_BRANCH_DESC         \u003d $(shell ./tools/configure_branches_desc $(PLATFORM_BRANCH))\n.\n.\n461 PLATFORM_STAMP                  \u003d $(PLATFORM_BRANCH)$(PUB_BRANCH_DESC)-$(PLATFORM_TIMESTAMP)\n\nwhich then appears in the platform manifest from the platform-publish target:\n\n506         cat src/platform.imgmanifest.in | sed \\\n507             -e \"s/UUID/$(PLATFORM_IMAGE_UUID)/\" \\\n508             -e \"s/ENGBLD_CUSTOM/$(ENGBLD_CUSTOM)/\" \\\n509             -e \"s/VERSION_STAMP/$(PLATFORM_STAMP)/\" \\\n510             -e \"s/BUILDSTAMP/$(PLATFORM_STAMP)/\" \\\n511             -e \"s/SIZE/$$(stat --printf\u003d\"%s\" $(PLATFORM_TARBALL))/\" \\\n512             -e \"s#SHA#$$(digest -a sha1 $(PLATFORM_TARBALL))#\" \\\n513             \u003e $(PUB_PLATFORM_MF)\n\nand ends up appearing in the buildstamp tags field:\n\n$ cat -n src/platform.imgmanifest.in\n.\n.    19    \"description\": \"SmartDataCenter platform imageENGBLD_CUSTOM\",\n    20    \"tags\": {\n    21      \"smartdc_service\": \"true\",\n    22      \"buildstamp\": \"BUILDSTAMP\"\n    23    },\n\nso we could really drop this hash-based annotation of the platform image description. Perhaps it just adds complexity for little benefit."},{"file":"tools/build_jenkins","line":212,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So this is supposed to be a sha of the branch master being concatenated? I\u0027m not sure whether it\u0027s useful or not, but it definitely needs to be better commented here. It basically looks like a magic number and I don\u0027t think I would have guessed how it was derived."},{"file":"tools/build_jenkins","line":212,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"The SHA was a hash of a standard \u0027configure-branches\u0027 file, and was intended as one way of detecting a non-standard build.\n\nGiven the improvements I\u0027m making to configure_branches_desc, we really don\u0027t need this anymore, so I\u0027m removing it."},{"file":"tools/configure_branches_desc","line":12,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Did you consider actually asking the git repositories for their branch? Certainly when developing, configure-branches file is *almost always* out of date, as you switch between different branches etc."},{"file":"tools/configure_branches_desc","line":12,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"That\u0027s a fair point. Initially this was a one-liner which grew into this shell script, but yes it would be much better to use what\u0027s _actually_ in the git repository, rather than what we think might be there.\n\nThe other advantage of your suggestion is that we can also denote \u0027dirty\u0027 repositories that way.\n\nI\u0027ll make this change."},{"file":"tools/configure_branches_desc","line":12,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"FWIW, most repos today aren\u0027t trying to keep themselves dirty or not. illumos-joyent will pretty much always be dirty barring major work. I do agree with asking the repo the branch directly. This should just work like the building of /etc/release does and hopefully you can reuse its code."},{"file":"tools/configure_branches_desc","line":12,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Ok, good to know that we\u0027re not expecting clean repositories - bits-upload.sh has guards against uploading artifacts that were marked as \u0027-dirty\u0027 (all Manta/Triton builds pass that test)\n\nI\u0027ll make sure not to include repository dirtiness in artifact names for the platform build though, thanks!"},{"file":"tools/smartos-index","line":11,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can we please have a comment that explains what the purpose of this script is? It seems to need to be invoked from a rather particular location, given the way that it seems to be building outputting an index."},{"file":"tools/smartos-index","line":11,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yes, I\u0027ll add that. This script was copied directly over from mountain-gorilla.git."},{"file":"tools/smartos-release","line":63,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Presumably we should actually check that we actually have valid values here and not just drive on?"},{"file":"tools/smartos-release","line":63,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yes, again, this code was ported over from MG, but we should probably improve it."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":223,"deletions":-2},{"file":"configure","type":"MODIFIED","insertions":19,"deletions":0},{"file":"sample.configure.smartos","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/platform.imgmanifest.in","type":"ADDED","insertions":27,"deletions":0},{"file":"tools/build_changelog","type":"MODIFIED","insertions":4,"deletions":0},{"file":"tools/build_jenkins","type":"ADDED","insertions":266,"deletions":0},{"file":"tools/configure_branches_desc","type":"ADDED","insertions":45,"deletions":0},{"file":"tools/smartos-index","type":"ADDED","insertions":19,"deletions":0},{"file":"tools/smartos-release","type":"ADDED","insertions":96,"deletions":0}],"sizeInsertions":702,"sizeDeletions":-3},{"number":"3","revision":"49bfd4c002cf2c2a9b1eb3e75c6e6e3174bef174","parents":["08a267d21e7cd215a57abd1089f7b4b4de15ec41"],"ref":"refs/changes/94/6094/3","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1555332863,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1555332922,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"tools/smartos-release","line":97,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I\u0027m a bit confused as to when smartos-index gets called..."},{"file":"tools/smartos-release","line":97,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"It\u0027s part of the \u0027smartos-publish\u0027 Makefile target. I should just mention that here."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"tools/build_jenkins","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"tools/smartos-index","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"tools/smartos-release","type":"MODIFIED","insertions":8,"deletions":-1}],"sizeInsertions":21,"sizeDeletions":-8},{"number":"4","revision":"42226945e0395c9d9dbcb19f1faeb0ba01e3e4da","parents":["ad632fe2cc950e085a9f700dbef3664665739299"],"ref":"refs/changes/94/6094/4","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1555337073,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1555332922,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":221,"deletions":-2},{"file":"configure","type":"MODIFIED","insertions":19,"deletions":0},{"file":"sample.configure.smartos","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/platform.imgmanifest.in","type":"ADDED","insertions":27,"deletions":0},{"file":"tools/build_changelog","type":"MODIFIED","insertions":4,"deletions":0},{"file":"tools/build_jenkins","type":"ADDED","insertions":265,"deletions":0},{"file":"tools/configure_branches_desc","type":"ADDED","insertions":45,"deletions":0},{"file":"tools/smartos-index","type":"ADDED","insertions":28,"deletions":0},{"file":"tools/smartos-release","type":"ADDED","insertions":103,"deletions":0}],"sizeInsertions":715,"sizeDeletions":-3},{"number":"5","revision":"0021a9493b5c44fa734c161f6eef39ba7b1f9778","parents":["ad632fe2cc950e085a9f700dbef3664665739299"],"ref":"refs/changes/94/6094/5","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1555586075,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1555586134,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"Makefile","line":437,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I had to double-check, but the plural of suffix is \"suffixes\""},{"file":"Makefile","line":437,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Done"},{"file":"Makefile","line":439,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"ditto"},{"file":"Makefile","line":439,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Done"},{"file":"Makefile","line":503,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"don\u0027t we want to record configure-build as well, if it exists?"},{"file":"Makefile","line":503,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Good point, yes."},{"file":"Makefile","line":557,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Can we now reference the bug you filed please?"},{"file":"Makefile","line":557,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Sorry, yes I thought I\u0027d added that. Fixed."},{"file":"README.md","line":304,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Should we expand this for the deps/eng infrastructure? Maybe a reference to the docs in that repo? Not sure where\u0027s good to point to.\n\nBut we should definitely briefly describe your new main targets.\n\nAlso, build_jenkins?"},{"file":"README.md","line":304,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yes. While we\u0027re not using any of the deps/eng Makefile infrastructure, our new targets follow the same pattern, but we should document them.\n\nI suspect the number of users who\u0027ll ever need them is small (given that they\u0027re fairly Joyent-specific) so it should go in a separate list of targets and their descriptions."},{"file":"README.md","line":418,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"needs cleaning up"},{"file":"README.md","line":418,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Thanks, will do."},{"file":"configure","line":30,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I would prefer these to be actual checked-in files:\n\ndefault.configure-projects\ndefault.configure-build\n\nWhere we only use them if we can\u0027t find \u0027configure-projects\u0027 or \u0027configure-build\u0027.\n\nWhy? It\u0027s much easier to direct users to \"cp default.blah blah then edit\", than \"go to configure line 50, copy that out, etc.\""},{"file":"configure","line":30,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Good point, I\u0027ll change that."},{"file":"configure","line":45,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"s/built it at/build/ ?"},{"file":"configure","line":45,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Done"},{"file":"configure","line":128,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"It seems a bit weird that configure-projects isn\u0027t fully correct for at least *one* field?\nOriginally I had the repo plus the local directory path, so everything was fully specified in the file - is there a reason we didn\u0027t do that?\n\nIt feels like the cognitive load of having to look here as well the configure-projects file to find out what\u0027s going on is more than just being a *little* more verbose in the configuration file."},{"file":"configure","line":128,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"I can see there\u0027s a trade-off, I\u0027m just trading-off in the other direction :-)\n\nIt feels to me that users shouldn\u0027t have to include values in the config file which will never change - ur-agent will always come from sdc-ur-agent.git, so users shouldn\u0027t have to deal with that extra gunk in the config file. Specifying the path in addition to the short name of the repository doesn\u0027t really make their lives any easier. Yes it might help when debugging, but that\u0027s all."},{"file":"configure","line":128,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"OK, but can we make at least the first field mean something? Right now, it\u0027s not the repo name, and it\u0027s not the local directory - they\u0027re both transformed. That is, can we have at least:\n\nillumos-kvm\nillumos-kvm-cmd\nsdc-ur-agent\n\nthere, and remove lines 130:135?"},{"file":"configure","line":155,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"nit: shouldn\u0027t this be defined above the function that calls it?"},{"file":"configure","line":155,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, will fix."},{"file":"configure","line":170,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"as per my comment above. But, if we keep this, it should be other way around - projects/local/ is the default, with illumos/illumos-extra as odd exceptions."},{"file":"configure","line":170,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"I\u0027ll change that so that illumos/illumos-extra are the exceptions."},{"file":"configure","line":349,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"remove?"},{"file":"configure","line":349,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Oops, yes."},{"file":"configure","line":495,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"can this be removed now too"},{"file":"configure","line":495,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yup."},{"file":"tools/build_changelog","line":85,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"We have deps/eng now right?"},{"file":"tools/build_changelog","line":85,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Good point."},{"file":"tools/build_jenkins","line":50,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"-c has gone"},{"file":"tools/build_jenkins","line":50,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Done"},{"file":"tools/build_jenkins","line":136,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Just to check, the artifact that gives us where we uploaded bits to - is that cleaned here? Does it need to be?"},{"file":"tools/build_jenkins","line":136,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"It doesn\u0027t need to be - that gets taken care of by bits-upload.sh itself\nhttps://github.com/joyent/eng/blob/master/tools/bits-upload.sh#L439,L443"},{"file":"tools/projects_branch_desc","line":27,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Did we reach a conclusion as to whether we need to support customization of projects/local/ contents? If we do this might need picking up from configure-projects?"},{"file":"tools/projects_branch_desc","line":27,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Well, to your earlier point, if we did include path information in configure-projects, then this would be able to reuse that data.\n\nI suspect though that very few people ever add new projects to ./projects, and if they did, then without changes here, the worst thing that would happen is that we may confuse build-artifacts that don\u0027t include branch names of that new prototype ./projects directory.\n\nI\u0027m inclined to skip this for now (given that I\u0027m hoping we\u0027ll opt for the simpler format for configure-projects)"},{"file":"tools/projects_branch_desc","line":45,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Instead of a temp file, why not just pipe directly:\n\ndone | sort -u ..."},{"file":"tools/projects_branch_desc","line":45,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Much nicer - I\u0027ll do that, thanks."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-2},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":222,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":35,"deletions":-5},{"file":"configure","type":"MODIFIED","insertions":158,"deletions":-83},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"sample.configure.smartos","type":"DELETED","insertions":0,"deletions":-33},{"file":"src/platform.imgmanifest.in","type":"ADDED","insertions":27,"deletions":0},{"file":"tools/build_changelog","type":"MODIFIED","insertions":4,"deletions":0},{"file":"tools/build_jenkins","type":"ADDED","insertions":183,"deletions":0},{"file":"tools/projects_branch_desc","type":"ADDED","insertions":53,"deletions":0},{"file":"tools/smartos-index","type":"ADDED","insertions":30,"deletions":0},{"file":"tools/smartos-release","type":"ADDED","insertions":108,"deletions":0}],"sizeInsertions":827,"sizeDeletions":-125},{"number":"6","revision":"b85fc775fa41183a67a70b8c4e10383279ebec40","parents":["ad632fe2cc950e085a9f700dbef3664665739299"],"ref":"refs/changes/94/6094/6","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1556276272,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556276332,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"README.md","line":327,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"nit: \"release builds\""},{"file":"README.md","line":327,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Done"},{"file":"README.md","line":346,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"In Markdown, underscore needs escaping, but not sure if it\u0027s done consistently here already? You can use `` ..."},{"file":"README.md","line":346,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Weird. At the time of writing, these are appearing ok at\nhttps://github.com/timfoster/smartos-live/blob/master/README.md\nbut I\u0027ll wrap these and the upload environment variables below with back-quotes all the same."},{"file":"configure","line":35,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"did you forget to git add the default files?"},{"file":"configure","line":35,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Sorry yes. They made it to the fork I maintain on my own github, but to get from there to this cr workspace, I \u0027git format-patch -1\u0027 and apply the patch here, then commit, but forgot to add those new files."},{"file":"configure","line":173,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"How come we don\u0027t need to transform illumos-\u003eillumos-joyent here?"},{"file":"configure","line":173,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Good catch :-/. I\u0027ll fix that."},{"file":"tools/build_jenkins","line":62,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Curious where this came from :)"},{"file":"tools/build_jenkins","line":62,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"On a PC keyboard plugged into a mac, \u0027alt-s\u0027 generates \"\", whereas I actually wanted \u0027winkey-s\u0027 (or \"command-s\") to save the file. This is a mistake I make all the time :-/"},{"file":"tools/projects_branch_desc","line":48,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I meant, why not pipe directly into the while? There\u0027s no need for any temp file is there?"},{"file":"tools/projects_branch_desc","line":48,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"No reason, force of habit. I\u0027ll fix that."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-2},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":230,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":107,"deletions":-7},{"file":"configure","type":"MODIFIED","insertions":122,"deletions":-100},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"sample.configure.smartos","type":"DELETED","insertions":0,"deletions":-33},{"file":"src/platform.imgmanifest.in","type":"ADDED","insertions":27,"deletions":0},{"file":"tools/build_jenkins","type":"ADDED","insertions":184,"deletions":0},{"file":"tools/projects_branch_desc","type":"ADDED","insertions":53,"deletions":0},{"file":"tools/smartos-index","type":"ADDED","insertions":30,"deletions":0},{"file":"tools/smartos-release","type":"ADDED","insertions":108,"deletions":0}],"sizeInsertions":868,"sizeDeletions":-144},{"number":"7","revision":"57125d0d2faac34a81cc78ee10d609005432b863","parents":["ad632fe2cc950e085a9f700dbef3664665739299"],"ref":"refs/changes/94/6094/7","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1556276846,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556276903,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-2},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":230,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":107,"deletions":-7},{"file":"configure","type":"MODIFIED","insertions":122,"deletions":-100},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"sample.configure.smartos","type":"DELETED","insertions":0,"deletions":-33},{"file":"src/platform.imgmanifest.in","type":"ADDED","insertions":27,"deletions":0},{"file":"tools/build_jenkins","type":"ADDED","insertions":184,"deletions":0},{"file":"tools/projects_branch_desc","type":"ADDED","insertions":53,"deletions":0},{"file":"tools/smartos-index","type":"ADDED","insertions":30,"deletions":0},{"file":"tools/smartos-release","type":"ADDED","insertions":108,"deletions":0}],"sizeInsertions":868,"sizeDeletions":-144},{"number":"8","revision":"d6401537908cdcc9b9d8f9615ef42153f6bdbfb3","parents":["0158021c21657bdc537895a634d1a73b593e6639"],"ref":"refs/changes/94/6094/8","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1557240392,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557240453,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"default.configure-build","line":1,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I don\u0027t think this should have a license, but if it should, it should be MPL not CDDL."},{"file":"default.configure-build","line":1,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Sure. I\u0027ll just drop it, given that the contents came from sample.configure-smartos which also didn\u0027t have a license."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-2},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":230,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":107,"deletions":-7},{"file":"configure","type":"MODIFIED","insertions":125,"deletions":-100},{"file":"default.configure-build","type":"ADDED","insertions":21,"deletions":0},{"file":"default.configure-projects","type":"ADDED","insertions":6,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"sample.configure.smartos","type":"DELETED","insertions":0,"deletions":-33},{"file":"src/platform.imgmanifest.in","type":"ADDED","insertions":27,"deletions":0},{"file":"tools/build_jenkins","type":"ADDED","insertions":184,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/projects_branch_desc","type":"ADDED","insertions":48,"deletions":0},{"file":"tools/smartos-index","type":"ADDED","insertions":30,"deletions":0},{"file":"tools/smartos-release","type":"ADDED","insertions":108,"deletions":0}],"sizeInsertions":896,"sizeDeletions":-147},{"number":"9","revision":"1ff1f0e4aef61c946f48ac9181c921504a609c1d","parents":["0158021c21657bdc537895a634d1a73b593e6639"],"ref":"refs/changes/94/6094/9","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1557490877,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557490934,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557737172,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-2},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":230,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":107,"deletions":-7},{"file":"configure","type":"MODIFIED","insertions":125,"deletions":-100},{"file":"default.configure-build","type":"ADDED","insertions":7,"deletions":0},{"file":"default.configure-projects","type":"ADDED","insertions":6,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"sample.configure.smartos","type":"DELETED","insertions":0,"deletions":-33},{"file":"src/platform.imgmanifest.in","type":"ADDED","insertions":27,"deletions":0},{"file":"tools/build_jenkins","type":"ADDED","insertions":184,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/projects_branch_desc","type":"ADDED","insertions":48,"deletions":0},{"file":"tools/smartos-index","type":"ADDED","insertions":30,"deletions":0},{"file":"tools/smartos-release","type":"ADDED","insertions":108,"deletions":0}],"sizeInsertions":882,"sizeDeletions":-147},{"number":"10","revision":"5a0a59c4e9eeb5ec11ea91bfe676dd9dba8158b6","parents":["4a90933b843370f461433d7ec71ad0538e5302b9"],"ref":"refs/changes/94/6094/10","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1557827189,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557827244,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557827365,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-2},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":230,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":107,"deletions":-7},{"file":"configure","type":"MODIFIED","insertions":125,"deletions":-100},{"file":"default.configure-build","type":"ADDED","insertions":7,"deletions":0},{"file":"default.configure-projects","type":"ADDED","insertions":6,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"sample.configure.smartos","type":"DELETED","insertions":0,"deletions":-33},{"file":"src/platform.imgmanifest.in","type":"ADDED","insertions":27,"deletions":0},{"file":"tools/build_jenkins","type":"ADDED","insertions":184,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/projects_branch_desc","type":"ADDED","insertions":48,"deletions":0},{"file":"tools/smartos-index","type":"ADDED","insertions":30,"deletions":0},{"file":"tools/smartos-release","type":"ADDED","insertions":108,"deletions":0}],"sizeInsertions":882,"sizeDeletions":-147},{"number":"11","revision":"f23d18bf3f2ba6f866f0752b93a01835981eed1e","parents":["a89b45abfd80497679a12f385678d5dda3fde9ad"],"ref":"refs/changes/94/6094/11","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1557947327,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557827244,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557827365,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1557951529,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-2},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":230,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":107,"deletions":-7},{"file":"configure","type":"MODIFIED","insertions":125,"deletions":-100},{"file":"default.configure-build","type":"ADDED","insertions":7,"deletions":0},{"file":"default.configure-projects","type":"ADDED","insertions":6,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"sample.configure.smartos","type":"DELETED","insertions":0,"deletions":-33},{"file":"src/platform.imgmanifest.in","type":"ADDED","insertions":27,"deletions":0},{"file":"tools/build_jenkins","type":"ADDED","insertions":184,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/projects_branch_desc","type":"ADDED","insertions":48,"deletions":0},{"file":"tools/smartos-index","type":"ADDED","insertions":30,"deletions":0},{"file":"tools/smartos-release","type":"ADDED","insertions":108,"deletions":0}],"sizeInsertions":882,"sizeDeletions":-147},{"number":"12","revision":"4a8588742164eb23b55f14615d97ceb3fa3fe75a","parents":["a89b45abfd80497679a12f385678d5dda3fde9ad"],"ref":"refs/changes/94/6094/12","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1557952913,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557827244,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557827365,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1557951529,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"SUBM","value":"1","grantedOn":1557952923,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-2},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":230,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":107,"deletions":-7},{"file":"configure","type":"MODIFIED","insertions":125,"deletions":-100},{"file":"default.configure-build","type":"ADDED","insertions":7,"deletions":0},{"file":"default.configure-projects","type":"ADDED","insertions":6,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"sample.configure.smartos","type":"DELETED","insertions":0,"deletions":-33},{"file":"src/platform.imgmanifest.in","type":"ADDED","insertions":27,"deletions":0},{"file":"tools/build_jenkins","type":"ADDED","insertions":184,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/projects_branch_desc","type":"ADDED","insertions":48,"deletions":0},{"file":"tools/smartos-index","type":"ADDED","insertions":30,"deletions":0},{"file":"tools/smartos-release","type":"ADDED","insertions":108,"deletions":0}],"sizeInsertions":882,"sizeDeletions":-147}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}]}