{"project":"joyent/sdc-vmapi","branch":"master","id":"I6952470eea9fefaa6c6f630efcb843354ab7e7de","number":"1655","subject":"ZAPI-770 changefeed events should be published for every changes made to VM objects in moray Reviewed by: Richard Kiene \u003crichard.kiene@joyent.com\u003e Reviewed by: Josh Wilsdon \u003cjwilsdon@joyent.com\u003e Approved by: Richard Kiene \u003crichard.kiene@joyent.com\u003e","owner":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"url":"https://cr.joyent.us/1655","commitMessage":"ZAPI-770 changefeed events should be published for every changes made to VM objects in moray\nReviewed by: Richard Kiene \u003crichard.kiene@joyent.com\u003e\nReviewed by: Josh Wilsdon \u003cjwilsdon@joyent.com\u003e\nApproved by: Richard Kiene \u003crichard.kiene@joyent.com\u003e\n","createdOn":1489445396,"lastUpdated":1490145356,"open":false,"status":"MERGED","comments":[{"timestamp":1489445396,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 1."},{"timestamp":1489445424,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1489445849,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 1:\n\n(6 comments)"},{"timestamp":1489446196,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1489465101,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 1:\n\n(11 comments)\n\nOverall seems like a pretty good idea!"},{"timestamp":1489520102,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 1:\n\n(8 comments)"},{"timestamp":1489520252,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1489521227,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1489521730,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1489522459,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 2."},{"timestamp":1489522498,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1489532682,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Patch Set 2:\n\n(4 comments)\n\nIt mostly looks good. I\u0027m going to do one more pass through."},{"timestamp":1489543501,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 3."},{"timestamp":1489543536,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1489543597,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2:\n\n(4 comments)"},{"timestamp":1490052978,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 4."},{"timestamp":1490053013,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1490053096,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 5."},{"timestamp":1490053131,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1490056054,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 6."},{"timestamp":1490056100,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1490056316,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 7."},{"timestamp":1490056357,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1490068156,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Patch Set 7:\n\n(4 comments)\n\nI really like where this is headed. I assume there are a few more changes coming, but I thought I\u0027d leave my initial feedback."},{"timestamp":1490123291,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 8."},{"timestamp":1490123302,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 7:\n\n(4 comments)"},{"timestamp":1490123339,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1490129473,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 7:\n\n(4 comments)"},{"timestamp":1490129677,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1490130902,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 9."},{"timestamp":1490130936,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1490133091,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Patch Set 9: Code-Review+1"},{"timestamp":1490133285,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 9: Code-Review+1\n\nI\u0027m not sure +1 is good enough for this work of art."},{"timestamp":1490138975,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 10."},{"timestamp":1490139021,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1490140235,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 10: Code-Review+1\n\nüöÄ"},{"timestamp":1490143977,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Patch Set 10: Code-Review+1 Integration-Approval+1"},{"timestamp":1490145328,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 11: Commit message was updated."},{"timestamp":1490145356,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Julien Gilli"}],"currentPatchSet":{"number":"11","revision":"0ca1d9b443b59a1a307cc11c025d9314568b1912","parents":["c3e3474838c9f76c035ec8bc960a8a68a1309f4b"],"ref":"refs/changes/55/1655/11","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1490145328,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1490139021,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1490140235,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1490143977,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1490143977,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"SUBM","value":"1","grantedOn":1490145356,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":116,"deletions":-6},{"file":"lib/common/util.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/endpoints/jobs.js","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":32,"deletions":-132},{"file":"lib/vmapi.js","type":"MODIFIED","insertions":3,"deletions":-35},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"server.js","type":"MODIFIED","insertions":29,"deletions":-13},{"file":"test/fixtures/vmapi-server-throwing-expected-stderr.txt","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/fixtures/vmapi-server-with-throwing-handler.js","type":"MODIFIED","insertions":16,"deletions":-3},{"file":"test/lib/changefeed.js","type":"ADDED","insertions":31,"deletions":0},{"file":"test/lib/moray.js","type":"ADDED","insertions":29,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":95,"deletions":0},{"file":"test/vms.delete_non_existing_no_workflow.test.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/vms.list.test.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"test/vms.marker.test.js","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"tools/add-test-vms.js","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"tools/fix-no-owner.js","type":"MODIFIED","insertions":37,"deletions":-13},{"file":"tools/kvm-backfill.js","type":"MODIFIED","insertions":133,"deletions":-115}],"sizeInsertions":569,"sizeDeletions":-343},"patchSets":[{"number":"1","revision":"d3b943bbb2ffde896c767ce08dc74a45e3d79170","parents":["39ee324064c651c529785740aba4342e593db818"],"ref":"refs/changes/55/1655/1","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1489445396,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1489445424,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/apis/moray.js","line":8,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"It\u0027s 2017 even with DST!"},{"file":"lib/apis/moray.js","line":8,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":":)"},{"file":"lib/apis/moray.js","line":639,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"This function could probably use a comment explaining exactly how it\u0027s to be used and what it\u0027ll return."},{"file":"lib/apis/moray.js","line":639,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"This function was taken from another part of the existing code, as is. I didn\u0027t want to change it to make that obvious, but I agree with your comment, so I\u0027ll do that."},{"file":"lib/apis/moray.js","line":652,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"What would this indicate? It seems this would happen the arguments are not both objects? Is there a case where this can happen when it\u0027s not programmer error?"},{"file":"lib/apis/moray.js","line":652,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"This is how the original code behaves and I didn\u0027t want to change it, but that\u0027s a good question, I\u0027ll have to look into that."},{"file":"lib/apis/moray.js","line":747,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"we deepCopy here but don\u0027t elsewhere before calling putVm, why is this one so special?\n\nIf we always need to copy, would it make sense to do in putVm itself?"},{"file":"lib/apis/moray.js","line":747,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"We deepCopy here because we need to pass the new VM object and the old one, before it was marked as destroyed. If we didn\u0027t deepCopy and instead just assigned vm to oldVm, then both objects would be identical and no change wold be published.\n\nIn other places where we call putVm, we don\u0027t deepCopy because we already have two separate objects: one that represents the new VM object to be written to moray, and the original one."},{"file":"lib/endpoints/jobs.js","line":8,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Still 2017"},{"file":"lib/endpoints/jobs.js","line":15,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"hooray for alphabetization!"},{"file":"lib/endpoints/jobs.js","line":15,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":":)"},{"file":"lib/endpoints/jobs.js","line":80,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"do we need a deepCopy of obj here as we do in moray.markAsDestroyed?"},{"file":"lib/endpoints/jobs.js","line":80,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"No, because \"obj\" is a separate object from \"vm\", and putVm doesn\u0027t modify either \"vm\" or \"obj\"."},{"file":"lib/endpoints/vms.js","line":8,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"+\u003d1"},{"file":"lib/endpoints/vms.js","line":327,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"again: do we need to deepcopy req.vm?"},{"file":"lib/endpoints/vms.js","line":327,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"We don\u0027t because vm and req.vm are two distinct objects."},{"file":"lib/endpoints/vms.js","line":1148,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"need some deepcopy action on oldVm here?"},{"file":"lib/endpoints/vms.js","line":1148,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"We don\u0027t because vm and oldVm are two distinct objects."},{"file":"lib/vmapi.js","line":232,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Basically, what I wanted to do is to be able to:\n\n1. create a changefeed publisher instance\n2. create a \"moray api‚Äù (lib/apis/moray.js) instance and pass it the changefeed publisher instance created in 1# as a constructor parameter\n3. pass that moray api instance to vmapi‚Äôs constructor\n\nBut that‚Äôs not really possible because the changefeed publisher constructor takes a restify server instance as a parameter.\n\nSo what I would have needed is not have the changefeed publisher add routes to the restify server as part of its constructor, but as part of a separate method.\n\nInstead, doing this now seems a reasonable workaround, and I can create a ticket in node-sdc-changefeed to eventually implement what\u0027s described above."},{"file":"lib/vmapi.js","line":232,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"üëç"},{"file":"test/lib/vm.js","line":8,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"off by one"},{"file":"test/vms.changefeed.test.js","line":641,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"is purposedly like purposely?"},{"file":"test/vms.changefeed.test.js","line":641,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Good catch!"},{"file":"test/vms.changefeed.test.js","line":650,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"excellent point.\n\nI wonder if we should eventually add a flag that can be passed with the VM payload that forces a failure?"},{"file":"test/vms.changefeed.test.js","line":650,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"That\u0027s a great point. It seems it would work and be safe to enable in production, so we wouldn\u0027t need to run vmapi in a \"special\" test mode.\n\nShould I create a new ticket for that?"},{"file":"test/vms.changefeed.test.js","line":650,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Yeah, I think a ticket for that would be great."},{"file":"test/vms.changefeed.test.js","line":650,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Will do!"},{"file":"tools/fix-no-owner.js","line":8,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I barely remember 2014!"},{"file":"tools/kvm-backfill.js","line":8,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"2014+3 \u003d 2017!"},{"file":"tools/kvm-backfill.js","line":99,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"How\u0027d we fix it? Epoxy?"},{"file":"tools/kvm-backfill.js","line":99,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Is it the name that\u0027s not great? My English might be failing me here :("},{"file":"tools/kvm-backfill.js","line":99,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"The name\u0027s not too bad. I think it was me that was failing here. My initial thought when I saw fixedVm was: \"How was it broken?\" then I realized this is in the backfill, so it\u0027s not actually \"broken\" it\u0027s just that we need to add an image_uuid if one is missing, right? But I guess that all depends on whether you consider a VM with no image_uuid at the top level \"broken\" or not. And this code does indeed seem to be treating that as breakage.\n\nPerhaps just adding a comment here saying something like:\n\n    // This code considers KVM VMs that are missing an image_uuid at the top level as broken and updates them to include the image_uuid of the first disk.\n\nwould eliminate my confusion."},{"file":"tools/kvm-backfill.js","line":99,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Sounds good!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":92,"deletions":-5},{"file":"lib/endpoints/jobs.js","type":"MODIFIED","insertions":2,"deletions":-5},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":42,"deletions":-129},{"file":"lib/vmapi.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":93,"deletions":0},{"file":"tools/fix-no-owner.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"tools/kvm-backfill.js","type":"MODIFIED","insertions":4,"deletions":-2}],"sizeInsertions":243,"sizeDeletions":-146},{"number":"2","revision":"5c2ebbe2b3bd21854dd3a72d24ac5266002f175c","parents":["39ee324064c651c529785740aba4342e593db818"],"ref":"refs/changes/55/1655/2","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1489522459,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1489522498,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/apis/moray.js","line":132,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"super nit: Maybe setCfPublisher so that this all fits on line 131"},{"file":"lib/apis/moray.js","line":132,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Sounds good!"},{"file":"lib/apis/moray.js","line":641,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"\"...and computes the difference between them.\" maybe?"},{"file":"lib/apis/moray.js","line":641,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Good catch!"},{"file":"lib/apis/moray.js","line":696,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"I wonder if we should abort if self.changefeedPublisher is not defined. Otherwise consumers could potentially miss out on a change notification."},{"file":"lib/apis/moray.js","line":696,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"That\u0027s a great point. After our face to face conversation this afternoon, I thought about it more and I\u0027d like to continue the conversation tomorrow. In other words, this is definitely not ready as it is, and this CR will need to have at least another patchset before it\u0027s ready."},{"file":"test/vms.changefeed.test.js","line":642,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"tests"},{"file":"test/vms.changefeed.test.js","line":642,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Good catch again :)"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":103,"deletions":-6},{"file":"lib/common/util.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/endpoints/jobs.js","type":"MODIFIED","insertions":3,"deletions":-6},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":43,"deletions":-131},{"file":"lib/vmapi.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":93,"deletions":0},{"file":"tools/fix-no-owner.js","type":"MODIFIED","insertions":8,"deletions":-5},{"file":"tools/kvm-backfill.js","type":"MODIFIED","insertions":11,"deletions":-3}],"sizeInsertions":271,"sizeDeletions":-153},{"number":"3","revision":"ee8fe5a2077a806261da5fe34e8a8dbfd36ea6bc","parents":["39ee324064c651c529785740aba4342e593db818"],"ref":"refs/changes/55/1655/3","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1489543501,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1489543536,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":102,"deletions":-6},{"file":"lib/common/util.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/endpoints/jobs.js","type":"MODIFIED","insertions":3,"deletions":-6},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":43,"deletions":-131},{"file":"lib/vmapi.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":93,"deletions":0},{"file":"tools/fix-no-owner.js","type":"MODIFIED","insertions":8,"deletions":-5},{"file":"tools/kvm-backfill.js","type":"MODIFIED","insertions":11,"deletions":-3}],"sizeInsertions":270,"sizeDeletions":-153},{"number":"4","revision":"6162f0767b103ea1f3e20110f16c0525f89ff5df","parents":["39ee324064c651c529785740aba4342e593db818"],"ref":"refs/changes/55/1655/4","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1490052978,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1490053013,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":107,"deletions":-6},{"file":"lib/common/util.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/endpoints/jobs.js","type":"MODIFIED","insertions":3,"deletions":-6},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":43,"deletions":-131},{"file":"lib/vmapi.js","type":"MODIFIED","insertions":5,"deletions":-34},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"server.js","type":"MODIFIED","insertions":28,"deletions":-12},{"file":"test/fixtures/vmapi-server-throwing-expected-stderr.txt","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/fixtures/vmapi-server-with-throwing-handler.js","type":"MODIFIED","insertions":16,"deletions":-3},{"file":"test/lib/changefeed.js","type":"ADDED","insertions":31,"deletions":0},{"file":"test/lib/moray.js","type":"ADDED","insertions":29,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":95,"deletions":0},{"file":"test/vms.delete_non_existing_no_workflow.test.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/vms.exits-on-uncaught.test.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/vms.list.test.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/vms.marker.test.js","type":"MODIFIED","insertions":8,"deletions":-5},{"file":"tools/add-test-vms.js","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"tools/fix-no-owner.js","type":"MODIFIED","insertions":44,"deletions":-24},{"file":"tools/kvm-backfill.js","type":"MODIFIED","insertions":135,"deletions":-102}],"sizeInsertions":572,"sizeDeletions":-335},{"number":"5","revision":"9b45fe2565b15a45ee467589be4ed6a8ee33a663","parents":["39ee324064c651c529785740aba4342e593db818"],"ref":"refs/changes/55/1655/5","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1490053096,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1490053131,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":107,"deletions":-6},{"file":"lib/common/util.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/endpoints/jobs.js","type":"MODIFIED","insertions":3,"deletions":-6},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":43,"deletions":-131},{"file":"lib/vmapi.js","type":"MODIFIED","insertions":5,"deletions":-34},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"server.js","type":"MODIFIED","insertions":28,"deletions":-12},{"file":"test/fixtures/vmapi-server-throwing-expected-stderr.txt","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/fixtures/vmapi-server-with-throwing-handler.js","type":"MODIFIED","insertions":16,"deletions":-3},{"file":"test/lib/changefeed.js","type":"ADDED","insertions":31,"deletions":0},{"file":"test/lib/moray.js","type":"ADDED","insertions":29,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":95,"deletions":0},{"file":"test/vms.delete_non_existing_no_workflow.test.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/vms.list.test.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/vms.marker.test.js","type":"MODIFIED","insertions":8,"deletions":-5},{"file":"tools/add-test-vms.js","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"tools/fix-no-owner.js","type":"MODIFIED","insertions":44,"deletions":-24},{"file":"tools/kvm-backfill.js","type":"MODIFIED","insertions":135,"deletions":-102}],"sizeInsertions":571,"sizeDeletions":-335},{"number":"6","revision":"a1e9dd637f293ae4cf0f2666d6e3fcbc2d3bc112","parents":["c3e3474838c9f76c035ec8bc960a8a68a1309f4b"],"ref":"refs/changes/55/1655/6","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1490056054,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1490056100,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":107,"deletions":-6},{"file":"lib/common/util.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/endpoints/jobs.js","type":"MODIFIED","insertions":3,"deletions":-6},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":43,"deletions":-131},{"file":"lib/vmapi.js","type":"MODIFIED","insertions":5,"deletions":-34},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"server.js","type":"MODIFIED","insertions":28,"deletions":-12},{"file":"test/fixtures/vmapi-server-throwing-expected-stderr.txt","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/fixtures/vmapi-server-with-throwing-handler.js","type":"MODIFIED","insertions":16,"deletions":-3},{"file":"test/lib/changefeed.js","type":"ADDED","insertions":31,"deletions":0},{"file":"test/lib/moray.js","type":"ADDED","insertions":29,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":95,"deletions":0},{"file":"test/vms.delete_non_existing_no_workflow.test.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/vms.list.test.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/vms.marker.test.js","type":"MODIFIED","insertions":8,"deletions":-5},{"file":"tools/add-test-vms.js","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"tools/fix-no-owner.js","type":"MODIFIED","insertions":35,"deletions":-13},{"file":"tools/kvm-backfill.js","type":"MODIFIED","insertions":133,"deletions":-115}],"sizeInsertions":564,"sizeDeletions":-336},{"number":"7","revision":"19df6ea257a8abf556e498d56064f2f57f315e68","parents":["c3e3474838c9f76c035ec8bc960a8a68a1309f4b"],"ref":"refs/changes/55/1655/7","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1490056316,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1490056357,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/common/util.js","line":8,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"copyright bot does not like the past."},{"file":"lib/endpoints/jobs.js","line":61,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"I think _some_ kind of comment might be warranted here. I get why you took it away though :)"},{"file":"lib/endpoints/jobs.js","line":61,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Good point. I renamed the function to \"postJobResults\" too, to make its purpose more explicit."},{"file":"lib/endpoints/vms.js","line":48,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"I feel like this could use a comment."},{"file":"lib/endpoints/vms.js","line":48,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"This change shouldn\u0027t have made it here. I\u0027ll remove that. Good catch!"},{"file":"lib/vmapi.js","line":90,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"This isn\u0027t your fault, but I\u0027m not sure changefeed is really optional anymore. Honestly I don\u0027t recall why it ever was :)"},{"file":"lib/vmapi.js","line":90,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Good point, fixed."},{"file":"package.json","line":12,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"We\u0027ll want to change this to the actual NPM published version I assume."},{"file":"package.json","line":12,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Correct. It will be done once cr.joyent.us/#/c/1688 is merged."},{"file":"server.js","line":8,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Copyright bot wants to modify this and move it to the correct year but can\u0027t. Poor thing."},{"file":"test/vms.list.test.js","line":8,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"2016?! üò≤"},{"file":"test/vms.marker.test.js","line":8,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"2016 called and would like their copyright notice back."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":107,"deletions":-6},{"file":"lib/common/util.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/endpoints/jobs.js","type":"MODIFIED","insertions":3,"deletions":-6},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":43,"deletions":-131},{"file":"lib/vmapi.js","type":"MODIFIED","insertions":5,"deletions":-34},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"server.js","type":"MODIFIED","insertions":28,"deletions":-12},{"file":"test/fixtures/vmapi-server-throwing-expected-stderr.txt","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/fixtures/vmapi-server-with-throwing-handler.js","type":"MODIFIED","insertions":16,"deletions":-3},{"file":"test/lib/changefeed.js","type":"ADDED","insertions":31,"deletions":0},{"file":"test/lib/moray.js","type":"ADDED","insertions":29,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":95,"deletions":0},{"file":"test/vms.delete_non_existing_no_workflow.test.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/vms.list.test.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/vms.marker.test.js","type":"MODIFIED","insertions":8,"deletions":-5},{"file":"tools/add-test-vms.js","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"tools/fix-no-owner.js","type":"MODIFIED","insertions":37,"deletions":-13},{"file":"tools/kvm-backfill.js","type":"MODIFIED","insertions":133,"deletions":-115}],"sizeInsertions":566,"sizeDeletions":-336},{"number":"8","revision":"481363f45001922570d0520654f71c5dc798888e","parents":["c3e3474838c9f76c035ec8bc960a8a68a1309f4b"],"ref":"refs/changes/55/1655/8","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1490123291,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1490123339,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1490129677,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":107,"deletions":-6},{"file":"lib/common/util.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/endpoints/jobs.js","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":32,"deletions":-132},{"file":"lib/vmapi.js","type":"MODIFIED","insertions":3,"deletions":-35},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"server.js","type":"MODIFIED","insertions":28,"deletions":-12},{"file":"test/fixtures/vmapi-server-throwing-expected-stderr.txt","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/fixtures/vmapi-server-with-throwing-handler.js","type":"MODIFIED","insertions":16,"deletions":-3},{"file":"test/lib/changefeed.js","type":"ADDED","insertions":31,"deletions":0},{"file":"test/lib/moray.js","type":"ADDED","insertions":29,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":95,"deletions":0},{"file":"test/vms.delete_non_existing_no_workflow.test.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/vms.list.test.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/vms.marker.test.js","type":"MODIFIED","insertions":8,"deletions":-5},{"file":"tools/add-test-vms.js","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"tools/fix-no-owner.js","type":"MODIFIED","insertions":37,"deletions":-13},{"file":"tools/kvm-backfill.js","type":"MODIFIED","insertions":133,"deletions":-115}],"sizeInsertions":556,"sizeDeletions":-339},{"number":"9","revision":"dee103d169c5d1b32216afac3bf53da927a23c1d","parents":["c3e3474838c9f76c035ec8bc960a8a68a1309f4b"],"ref":"refs/changes/55/1655/9","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1490130902,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1490130936,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1490133091,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1490133285,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":107,"deletions":-6},{"file":"lib/common/util.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/endpoints/jobs.js","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":32,"deletions":-132},{"file":"lib/vmapi.js","type":"MODIFIED","insertions":3,"deletions":-35},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"server.js","type":"MODIFIED","insertions":29,"deletions":-13},{"file":"test/fixtures/vmapi-server-throwing-expected-stderr.txt","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/fixtures/vmapi-server-with-throwing-handler.js","type":"MODIFIED","insertions":16,"deletions":-3},{"file":"test/lib/changefeed.js","type":"ADDED","insertions":31,"deletions":0},{"file":"test/lib/moray.js","type":"ADDED","insertions":29,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":95,"deletions":0},{"file":"test/vms.delete_non_existing_no_workflow.test.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/vms.list.test.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"test/vms.marker.test.js","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"tools/add-test-vms.js","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"tools/fix-no-owner.js","type":"MODIFIED","insertions":37,"deletions":-13},{"file":"tools/kvm-backfill.js","type":"MODIFIED","insertions":133,"deletions":-115}],"sizeInsertions":560,"sizeDeletions":-343},{"number":"10","revision":"6952470eea9fefaa6c6f630efcb843354ab7e7de","parents":["c3e3474838c9f76c035ec8bc960a8a68a1309f4b"],"ref":"refs/changes/55/1655/10","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1490138975,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1490139021,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1490143977,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1490143977,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1490140235,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":116,"deletions":-6},{"file":"lib/common/util.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/endpoints/jobs.js","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":32,"deletions":-132},{"file":"lib/vmapi.js","type":"MODIFIED","insertions":3,"deletions":-35},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"server.js","type":"MODIFIED","insertions":29,"deletions":-13},{"file":"test/fixtures/vmapi-server-throwing-expected-stderr.txt","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/fixtures/vmapi-server-with-throwing-handler.js","type":"MODIFIED","insertions":16,"deletions":-3},{"file":"test/lib/changefeed.js","type":"ADDED","insertions":31,"deletions":0},{"file":"test/lib/moray.js","type":"ADDED","insertions":29,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":95,"deletions":0},{"file":"test/vms.delete_non_existing_no_workflow.test.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/vms.list.test.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"test/vms.marker.test.js","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"tools/add-test-vms.js","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"tools/fix-no-owner.js","type":"MODIFIED","insertions":37,"deletions":-13},{"file":"tools/kvm-backfill.js","type":"MODIFIED","insertions":133,"deletions":-115}],"sizeInsertions":569,"sizeDeletions":-343},{"number":"11","revision":"0ca1d9b443b59a1a307cc11c025d9314568b1912","parents":["c3e3474838c9f76c035ec8bc960a8a68a1309f4b"],"ref":"refs/changes/55/1655/11","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1490145328,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1490139021,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1490143977,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1490143977,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1490140235,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1490145356,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":116,"deletions":-6},{"file":"lib/common/util.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/endpoints/jobs.js","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":32,"deletions":-132},{"file":"lib/vmapi.js","type":"MODIFIED","insertions":3,"deletions":-35},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"server.js","type":"MODIFIED","insertions":29,"deletions":-13},{"file":"test/fixtures/vmapi-server-throwing-expected-stderr.txt","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/fixtures/vmapi-server-with-throwing-handler.js","type":"MODIFIED","insertions":16,"deletions":-3},{"file":"test/lib/changefeed.js","type":"ADDED","insertions":31,"deletions":0},{"file":"test/lib/moray.js","type":"ADDED","insertions":29,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/vms.changefeed.test.js","type":"MODIFIED","insertions":95,"deletions":0},{"file":"test/vms.delete_non_existing_no_workflow.test.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/vms.list.test.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"test/vms.marker.test.js","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"tools/add-test-vms.js","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"tools/fix-no-owner.js","type":"MODIFIED","insertions":37,"deletions":-13},{"file":"tools/kvm-backfill.js","type":"MODIFIED","insertions":133,"deletions":-115}],"sizeInsertions":569,"sizeDeletions":-343}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}]}